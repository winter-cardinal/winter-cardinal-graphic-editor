/*
 WinterCardinal Graphic Editor v0.1.0
 Copyright (C) TOSHIBA Coorporation
 SPDX-License-Identifier: Apache-2.0

 Material Design icons by Google
 Apache license version 2.0.
*/
!function(t,e){"use strict";var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}"function"==typeof SuppressedError&&SuppressedError;var o=function(t){function e(e,n){var i=t.call(this)||this;return i._commands=e,i._selection=n,i}return i(e,t),Object.defineProperty(e.prototype,"commands",{get:function(){return this._commands},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e.prototype.redo=function(){var t=this._selection,e=this._commands;t.lock();for(var n=0,i=e.length;n<i;++n)e[n].redo();return t.unlock(),!0},e.prototype.undo=function(){var t=this._selection;t.lock();for(var e=this._commands,n=e.length-1;0<=n;--n)e[n].undo();return t.unlock(),!0},e.prototype.destroy=function(){for(var t=this._commands,e=0,n=t.length;e<n;++e)t[e].destroy()},e}(t.DCommandBase),r=function(e){function n(t,n,i,o,r,a,l,u,s,p,h){var c=e.call(this)||this;return c._diagram=t,c._canvas=n,c._name=i,c._label=o,c._width=r,c._height=a,c._category=l,c._summary=u,c._description=s,c._backgroundColor=p,c._backgroundAlpha=h,c}return i(n,e),Object.defineProperty(n.prototype,"diagram",{get:function(){return this._diagram},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"category",{get:function(){return this._category},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"summary",{get:function(){return this._summary},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"description",{get:function(){return this._description},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"backgroundColor",{get:function(){return this._backgroundColor},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"backgroundAlpha",{get:function(){return this._backgroundAlpha},enumerable:!1,configurable:!0}),n.prototype.execute=function(){return this.redo()},n.prototype.redo=function(){var e=this._canvas,n=this._name;this._name=e.name,e.name=n;var i=this._label;this._label=e.label,e.label=i;var o=this._width;this._width=e.width,e.width=o;var r=this._height;this._height=e.height,e.height=r;var a=this._category;this._category=e.category,e.category=a;var l=this._summary;this._summary=e.summary,e.summary=l;var u=this._description;this._description=e.description,e.description=u;var s=this._backgroundColor,p=this._backgroundAlpha,h=new t.DBaseStateSetImpl,c=e.background;return this._backgroundColor=c.getColor(h),this._backgroundAlpha=c.getAlpha(h),c.color=s,c.alpha=p,this._diagram.emit("change",this._diagram),!0},n.prototype.undo=function(){return this.redo()},n}(t.DCommandBase),a=function(e){function n(t,n,i){var o=e.call(this)||this;return o._diagram=t,o._color=n,o._alpha=i,o}return i(n,e),Object.defineProperty(n.prototype,"diagram",{get:function(){return this._diagram},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"color",{get:function(){return this._color},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"alpha",{get:function(){return this._alpha},enumerable:!1,configurable:!0}),n.prototype.execute=function(){return this.redo()},n.prototype.redo=function(){var e=this._diagram.canvas;if(null!=e){var n=e.background,i=this._color,o=this._alpha,r=new t.DBaseStateSetImpl;this._color=n.getColor(r),this._alpha=n.getAlpha(r),n.color=i,n.alpha=o,this._diagram.emit("change",this._diagram)}return!0},n.prototype.undo=function(){return this.redo()},n}(t.DCommandBase),l=function(t){function e(e,n,i){var o=t.call(this)||this;return o._diagram=e,o._canvas=n,o._category=i,o}return i(e,t),Object.defineProperty(e.prototype,"diagram",{get:function(){return this._diagram},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"category",{get:function(){return this._category},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._canvas,e=this._category;return this._category=t.category,t.category=e,this._diagram.emit("change",this._diagram),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),u=function(t){function e(e,n){var i=t.call(this)||this;return i._diagram=e,i._canvas=n,i}return i(e,t),Object.defineProperty(e.prototype,"diagram",{get:function(){return this._diagram},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e}(t.DCommandCreate),s=function(t){function e(e,n,i){var o=t.call(this)||this;return o._diagram=e,o._canvas=n,o._description=i,o}return i(e,t),Object.defineProperty(e.prototype,"diagram",{get:function(){return this._diagram},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._description},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._canvas,e=this._description;return this._description=t.description,t.description=e,this._diagram.emit("change",this._diagram),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),p=function(t){function e(e,n,i){var o=t.call(this)||this;return o._diagram=e,o._canvas=n,o._height=i,o}return i(e,t),Object.defineProperty(e.prototype,"diagram",{get:function(){return this._diagram},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._canvas,e=this._height;return this._height=t.height,t.y=t.y+.5*(t.height-e),t.height=e,this._diagram.emit("change",this._diagram),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),h=function(t){function e(e,n,i){var o=t.call(this)||this;return o._diagram=e,o._canvas=n,o._label=i,o}return i(e,t),Object.defineProperty(e.prototype,"diagram",{get:function(){return this._diagram},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._canvas,e=this._label;return this._label=t.label,t.label=e,this._diagram.emit("change",this._diagram),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),c=function(t){function e(e,n,i){var o=t.call(this)||this;return o._diagram=e,o._canvas=n,o._name=i,o}return i(e,t),Object.defineProperty(e.prototype,"diagram",{get:function(){return this._diagram},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._canvas,e=this._name;return this._name=t.name,t.name=e,this._diagram.emit("change",this._diagram),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),d=function(t){function e(e,n){var i=t.call(this)||this;return i._diagram=e,i._canvas=n,i}return i(e,t),Object.defineProperty(e.prototype,"diagram",{get:function(){return this._diagram},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e}(t.DCommandCreate),g=function(t){function e(e,n){var i=t.call(this)||this;return i._snapper=e,i._index=n,i}return i(e,t),Object.defineProperty(e.prototype,"snapper",{get:function(){return this._snapper},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._index;return this._snapper.target.swap(t-1,t),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),f=function(t){function e(e,n){var i=t.call(this)||this;return i._snapper=e,i._target=n,i}return i(e,t),Object.defineProperty(e.prototype,"snapper",{get:function(){return this._snapper},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){return this._snapper.target.add(this._target),!0},e.prototype.undo=function(){var t=this._snapper.target;return t.remove(t.size-1),!0},e}(t.DCommandBase),y=function(t){function e(e,n,i){var o=t.call(this)||this;return o._snapper=e,o._index=n,o._target=i,o}return i(e,t),Object.defineProperty(e.prototype,"snapper",{get:function(){return this._snapper},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){return this._snapper.target.remove(this._index),!0},e.prototype.undo=function(){return this._snapper.target.add(this._target,this._index),!0},e}(t.DCommandBase),v=function(t){function e(e,n){var i=t.call(this)||this;return i._snapper=e,i._size=n,i}return i(e,t),Object.defineProperty(e.prototype,"snapper",{get:function(){return this._snapper},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._snapper,e=this._size;return this._size=t.grid.size,t.grid.size=e,!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),b=function(t){function e(e){var n=t.call(this)||this;return n._snapper=e,n}return i(e,t),Object.defineProperty(e.prototype,"snapper",{get:function(){return this._snapper},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._snapper.grid;return t.visible=!t.visible,!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),m=function(t){function e(e){var n=t.call(this)||this;return n._snapper=e,n}return i(e,t),Object.defineProperty(e.prototype,"snapper",{get:function(){return this._snapper},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._snapper.grid;return t.enable=!t.enable,!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),_=function(t){function e(e,n,i,o){var r=t.call(this)||this;return r._snapper=e,r._oldValue=n,r._newValue=i,r._index=e.target.values.indexOf(r._oldValue),r._list=o,r}return i(e,t),Object.defineProperty(e.prototype,"snapper",{get:function(){return this._snapper},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newValue",{get:function(){return this._newValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._index;if(0<=t){var e=this._list,n=this._newValue,i=this._snapper;e.data.selection.contains(this._oldValue)?(i.target.replace(t,n),e.data.selection.clearAndAdd(n)):i.target.replace(t,n)}return!0},e.prototype.undo=function(){var t=this._index;if(0<=t){var e=this._list,n=this._oldValue,i=this._snapper;e.data.selection.contains(this._newValue)?(i.target.replace(t,n),e.data.selection.clearAndAdd(n)):i.target.replace(t,n)}return!0},e}(t.DCommandBase),S=function(t){function e(e,n){var i=t.call(this)||this;return i._snapper=e,i._index=n,i}return i(e,t),Object.defineProperty(e.prototype,"snapper",{get:function(){return this._snapper},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._index;return this._snapper.target.swap(t,t+1),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),w=function(t){function e(e){var n=t.call(this)||this;return n._snapper=e,n}return i(e,t),Object.defineProperty(e.prototype,"snapper",{get:function(){return this._snapper},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._snapper.target;return t.visible=!t.visible,!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),T=function(t){function e(e){var n=t.call(this)||this;return n._snapper=e,n}return i(e,t),Object.defineProperty(e.prototype,"snapper",{get:function(){return this._snapper},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._snapper.target;return t.enable=!t.enable,!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),E=function(t){function e(e){var n=t.call(this)||this;return n._snapper=e,n}return i(e,t),Object.defineProperty(e.prototype,"snapper",{get:function(){return this._snapper},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._snapper;return t.enable=!t.enable,!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),C=function(t){function e(e,n,i){var o=t.call(this)||this;return o._diagram=e,o._canvas=n,o._summary=i,o}return i(e,t),Object.defineProperty(e.prototype,"diagram",{get:function(){return this._diagram},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"summary",{get:function(){return this._summary},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._canvas,e=this._summary;return this._summary=t.summary,t.summary=e,this._diagram.emit("change",this._diagram),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),D=function(t){function e(e,n,i){var o=t.call(this)||this;return o._diagram=e,o._canvas=n,o._width=i,o}return i(e,t),Object.defineProperty(e.prototype,"diagram",{get:function(){return this._diagram},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){var t=this._canvas,e=this._width;return this._width=t.width,t.x=t.x+.5*(t.width-e),t.width=e,this._diagram.emit("change",this._diagram),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),L=function(e){function n(t,n){var i=e.call(this)||this;return i._index=t,i._layerContainer=n,i}return i(n,e),Object.defineProperty(n.prototype,"index",{get:function(){return this._index},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"layerContainer",{get:function(){return this._layerContainer},enumerable:!1,configurable:!0}),n.prototype.execute=function(){return this.redo()},n.prototype.redo=function(){var e=this._index,n=this._layerContainer,i=n.children,o=i[e];return i[e]=i[e+1],i[e+1]=o,n.onChildrenChange(e),n.emit("change",n),t.DApplications.update(n),!0},n.prototype.undo=function(){return this.redo(),!0},n}(t.DCommandBase),A=function(){function t(t,e,n){this.enable=t,this.color=e,this.alpha=n}return t.prototype.isEqual=function(t){return this.enable===t.enable&&this.color===t.color&&this.alpha===t.alpha},t.from=function(e){return new t(e.background.enable,e.background.color,e.background.alpha)},t}(),B=function(){function e(t,e,n,i,o,r,a,l,u){this.name=t,this.x=e,this.y=n,this.width=i,this.height=o,this.background=r,this.visible=a,this.interactive=l,this.gesture=u}return e.prototype.isEqual=function(t){return this.name===t.name&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.background.isEqual(t.background)&&this.visible===t.visible&&this.interactive===t.interactive&&this.gesture===t.gesture},e.prototype.copyTo=function(e){e.name=this.name,e.position.set(this.x,this.y),e.width=this.width,e.height=this.height,e.background.copy(this.background);var n=e.state;n.lock(),n.set(t.EShapeLayerState.INVISIBLE,!this.visible),n.set(t.EShapeLayerState.INTERACTIVE,this.interactive);var i=this.gesture;return n.set(t.EShapeLayerState.DRAGGABLE,!!(i&t.EShapeActionValueGestureOperationType.DRAG)),n.set(t.EShapeLayerState.PINCHABLE,!!(i&t.EShapeActionValueGestureOperationType.PINCH)),n.unlock(),this},e.from=function(n){var i=(n.state.is(t.EShapeLayerState.DRAGGABLE)?t.EShapeActionValueGestureOperationType.DRAG:t.EShapeActionValueGestureOperationType.NONE)|(n.state.is(t.EShapeLayerState.PINCHABLE)?t.EShapeActionValueGestureOperationType.PINCH:t.EShapeActionValueGestureOperationType.NONE);return new e(n.name,n.position.x,n.position.y,n.width,n.height,A.from(n),!n.state.is(t.EShapeLayerState.INVISIBLE),n.state.is(t.EShapeLayerState.INTERACTIVE),i)},e}(),O=function(t){function e(e,n,i){var o=t.call(this)||this;return o._layer=e,o._layerContainer=i,o._oldValue=B.from(e),o._newValue=n,o}return i(e,t),Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newValue",{get:function(){return this._newValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerContainer",{get:function(){return this._layerContainer},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){this._newValue.copyTo(this._layer);var t=this._layerContainer;return t.emit("change",t),!0},e.prototype.undo=function(){this._oldValue.copyTo(this._layer);var t=this._layerContainer;return t.emit("change",t),!0},e}(t.DCommandBase),P=function(t){function e(e,n,i){var o=t.call(this)||this;return o._value=e,o._layerContainer=n,o._layerActive=n.active,o._layerCreated=null,o._selection=i,o._selectionStored=null,o}return i(e,t),e.prototype.newLayer=function(t,e){var n=e.create(t.name,!0);return t.copyTo(n),n},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerContainer",{get:function(){return this._layerContainer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerActive",{get:function(){return this._layerActive},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerCreated",{get:function(){return this._layerCreated},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionStored",{get:function(){return this._selectionStored},enumerable:!1,configurable:!0}),e.prototype.execute=function(){var t=this._selection;return t.isEmpty()?this._selectionStored=null:(this._selectionStored=t.store(),t.clear()),this._layerCreated=this.newLayer(this._value,this._layerContainer),this._layerCreated.reference+=1,!0},e.prototype.redo=function(){null!=this._selectionStored&&this._selection.clear();var t=this._layerCreated;return null!=t&&this._layerContainer.attach(t,!0),!0},e.prototype.undo=function(){var t=this._layerCreated;null!=t&&this._layerContainer.detach(t,this._layerActive);var e=this._selectionStored;return null!=e&&this._selection.restore(e),!0},e.prototype.destroy=function(){var t=this._layerCreated;null!=t&&(t.reference-=1,null==t.parent&&t.reference<=0&&t.destroy()),this._layerActive=null},e}(t.DCommandBase),I=function(t){function e(e,n,i){var o=t.call(this)||this;return o._layerContainer=n,o._layerActive=n.active,o._layer=e,e.reference+=1,o._layerIndex=-1,o._selection=i,o._selectionStored=null,o}return i(e,t),Object.defineProperty(e.prototype,"layerContainer",{get:function(){return this._layerContainer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerActive",{get:function(){return this._layerActive},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerIndex",{get:function(){return this._layerIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionStored",{get:function(){return this._selectionStored},enumerable:!1,configurable:!0}),e.prototype.execute=function(){var t=this._layer,e=this._layerContainer,n=this._selection;return t!==e.active||n.isEmpty()?this._selectionStored=null:(this._selectionStored=n.store(),n.clear()),this._layerIndex=e.delete(t,!0),!0},e.prototype.redo=function(){return null!=this._selectionStored&&this._selection.clear(),this._layerContainer.delete(this._layer,!0),!0},e.prototype.undo=function(){return this._layerContainer.attachAt(this._layer,this._layerIndex,this._layer===this._layerActive),null!=this._selectionStored&&this._selection.restore(this._selectionStored),!0},e.prototype.destroy=function(){var t=this._layer;t.reference-=1,null==t.parent&&t.reference<=0&&t.destroy(),this._layerActive=null,this._selectionStored=null},e}(t.DCommandBase),x=function(e){function n(t,n){var i=e.call(this)||this;return i._index=t,i._layerContainer=n,i}return i(n,e),Object.defineProperty(n.prototype,"index",{get:function(){return this._index},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"layerContainer",{get:function(){return this._layerContainer},enumerable:!1,configurable:!0}),n.prototype.execute=function(){return this.redo()},n.prototype.redo=function(){var e=this._index,n=this._layerContainer,i=n.children,o=i[e];return i[e]=i[e-1],i[e-1]=o,n.onChildrenChange(e),n.emit("change",n),t.DApplications.update(n),!0},n.prototype.undo=function(){return this.redo(),!0},n}(t.DCommandBase),R=function(t){function e(e,n){var i=t.call(this)||this;return i._selection=n,i._value=e,i}return i(e,t),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){for(var t=this._value,e=this._selection.get(),n=0,i=e.length;n<i;++n)e[n].action.add(t);return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._selection.get(),e=0,n=t.length;e<n;++e){var i=t[e];i.action.remove(i.action.size()-1)}return this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),k=function(t){function e(e,n){var i=t.call(this)||this;return i._selection=n,i._target=e,i._indices=[],i}return i(e,t),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),e.prototype.execute=function(){for(var t=this._target,e=this._indices,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i],a=r.action.indexOf(t);e.push(a),0<a&&r.action.swap(a-1,a)}return this._indices=e,this._selection.update("PROPERTY"),!0},e.prototype.redo=function(){for(var t=this._selection.get(),e=this._indices,n=0,i=t.length;n<i;++n){var o=t[n],r=e[n];0<r&&o.action.swap(r-1,r)}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),V=function(t){function e(e,n){var i=t.call(this)||this;return i._selection=n,i._target=e,i._indices=[],i}return i(e,t),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),e.prototype.execute=function(){for(var t=this._target,e=this._indices,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i],a=r.action.indexOf(t);e.push(a),0<=a&&r.action.remove(a)}return this._selection.update("PROPERTY"),!0},e.prototype.redo=function(){for(var t=this._indices,e=this._selection.get(),n=0,i=e.length;n<i;++n){var o=e[n],r=t[n];0<=r&&o.action.remove(r)}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._target,e=this._indices,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i],a=e[i];0<=a&&r.action.add(t,a)}return this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),M=function(t){function e(e,n,i,o){var r=t.call(this)||this;return r._selection=i,r._oldValue=e,r._newValue=n,r._list=o,r._indices=[],r._oldValues=[],r}return i(e,t),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newValue",{get:function(){return this._newValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldValues",{get:function(){return this._oldValues},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.execute=function(){for(var t=this._oldValue,e=this._newValue,n=this._indices,i=this._oldValues,o=this._selection.get(),r=0,a=o.length;r<a;++r){var l=o[r],u=l.action.indexOf(t);n.push(u),0<=u?(i.push(l.action.get(u)),l.action.set(u,e)):i.push(e)}var s=this._list;return s.data.selection.contains(t)&&s.data.selection.clearAndAdd(e),this._selection.update("PROPERTY"),!0},e.prototype.redo=function(){for(var t=this._newValue,e=this._indices,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=e[i];0<=r&&n[i].action.set(r,t)}var a=this._list;return a.data.selection.contains(this._oldValue)&&a.data.selection.clearAndAdd(t),this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._indices,e=this._oldValues,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=t[i];0<=r&&n[i].action.set(r,e[i])}var a=this._list;return a.data.selection.contains(this._newValue)&&a.data.selection.clearAndAdd(this._oldValue),this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),N=function(t){function e(e,n){var i=t.call(this)||this;i._selection=n,i._target=e;for(var o=[],r=i._selection.get(),a=0,l=r.length;a<l;++a){var u=r[a].action,s=u.indexOf(e);o.push(s),0<=s&&s<u.size()-1&&u.swap(s+1,s)}return i._indices=o,i._selection.update("PROPERTY"),i}return i(e,t),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._selection.get(),e=this._indices,n=0,i=t.length;n<i;++n){var o=t[n].action,r=e[n];0<=r&&r<o.size()-1&&o.swap(r+1,r)}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),F=function(t){function e(e,n,i,o){var r=t.call(this)||this;r._shapes=e;for(var a=0,l=e.length;a<l;++a)e[a].reference+=1;return r._parent=n,r._selection=i,r._select=o,r}return i(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shapes",{get:function(){return this._shapes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionStored",{get:function(){return this._selectionStored},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},enumerable:!1,configurable:!0}),e.prototype.execute=function(){var t=this._selection;return t.lock(),this._select&&(this._selectionStored=t.store(),t.clearAndAddAll(this._shapes)),t.update("TREE"),t.unlock(),!0},e.prototype.redo=function(){for(var t=this._shapes,e=this._parent,n=0,i=t.length;n<i;++n)t[n].attach(e);var o=this._selection;return o.lock(),this._select&&o.clearAndAddAll(t),o.update("TREE"),o.unlock(),!0},e.prototype.undo=function(){for(var t=this._shapes,e=0,n=t.length;e<n;++e)t[e].detach();var i=this._selection,o=this._selectionStored;return i.lock(),this._select&&null!=o&&i.restore(o),i.update("TREE"),i.unlock(),!0},e.prototype.destroy=function(){for(var t=this._shapes,e=0,n=t.length;e<n;++e){var i=t[e];i.reference-=1,null==i.parent&&i.reference<=0&&i.destroy()}},e}(t.DCommandBase),j=function(e){function n(t,n){var i=e.call(this)||this;return i._selection=n,i._value=t,i}return i(n,e),Object.defineProperty(n.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),n.prototype.execute=function(){return this.redo()},n.prototype.redo=function(){for(var e=this._value,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i];t.EShapeCapabilities.contains(r,t.EShapeCapability.DATA_MAPPING)&&r.data.mapping.add(e)}return this._selection.update("PROPERTY"),!0},n.prototype.undo=function(){for(var e=this._selection.get(),n=0,i=e.length;n<i;++n){var o=e[n];if(t.EShapeCapabilities.contains(o,t.EShapeCapability.DATA_MAPPING)){var r=o.data.getMapping();r&&r.remove(r.size()-1)}}return this._selection.update("PROPERTY"),!0},n}(t.DCommandBase),z=function(e){function n(n,i){var o=e.call(this)||this;o._selection=i,o._target=n;for(var r=[],a=o._selection.get(),l=0,u=a.length;l<u;++l){var s=a[l];if(t.EShapeCapabilities.contains(s,t.EShapeCapability.DATA_MAPPING)){var p=s.data.getMapping();if(p){var h=p.indexOf(n);r.push(h),0<h&&p.swap(h-1,h)}else r.push(-1)}else r.push(-1)}return o._indices=r,o._selection.update("PROPERTY"),o}return i(n,e),Object.defineProperty(n.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),n.prototype.execute=function(){return!0},n.prototype.redo=function(){for(var t=this._selection.get(),e=this._indices,n=0,i=t.length;n<i;++n){var o=t[n],r=e[n];if(0<r){var a=o.data.getMapping();a&&a.swap(r-1,r)}}return this._selection.update("PROPERTY"),!0},n.prototype.undo=function(){return this.redo()},n}(t.DCommandBase),H=function(e){function n(n,i){var o=e.call(this)||this;o._selection=i,o._target=n;for(var r=[],a=o._selection.get(),l=0,u=a.length;l<u;++l){var s=a[l];if(t.EShapeCapabilities.contains(s,t.EShapeCapability.DATA_MAPPING)){var p=s.data.getMapping();if(p){var h=p.indexOf(n);r.push(h),0<=h&&p.remove(h)}else r.push(-1)}else r.push(-1)}return o._indices=r,o._selection.update("PROPERTY"),o}return i(n,e),Object.defineProperty(n.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),n.prototype.execute=function(){return!0},n.prototype.redo=function(){for(var t=this._selection.get(),e=this._indices,n=0,i=t.length;n<i;++n){var o=t[n],r=e[n];if(0<=r){var a=o.data.getMapping();a&&a.remove(r)}}return this._selection.update("PROPERTY"),!0},n.prototype.undo=function(){for(var t=this._target,e=this._selection.get(),n=this._indices,i=0,o=e.length;i<o;++i){var r=e[i],a=n[i];if(0<=a){var l=r.data.getMapping();l&&l.add(t,a)}}return this._selection.update("PROPERTY"),!0},n}(t.DCommandBase),G=function(e){function n(n,i,o,r){var a=e.call(this)||this;a._selection=o,a._oldValue=n,a._newValue=i,a._list=r;for(var l=[],u=[],s=a._selection.get(),p=0,h=s.length;p<h;++p){var c=s[p];if(t.EShapeCapabilities.contains(c,t.EShapeCapability.DATA_MAPPING)){var d=c.data.getMapping();if(d){var g=d.indexOf(n);l.push(g),0<=g?(u.push(d.get(g)),d.set(g,i)):u.push(i)}else l.push(-1),u.push(i)}else l.push(-1),u.push(i)}return a._indices=l,a._oldValues=u,r.data.selection.contains(n)&&r.data.selection.clearAndAdd(i),a._selection.update("PROPERTY"),a}return i(n,e),Object.defineProperty(n.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"newValue",{get:function(){return this._newValue},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"oldValues",{get:function(){return this._oldValues},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),n.prototype.execute=function(){return!0},n.prototype.redo=function(){for(var t=this._newValue,e=this._indices,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i],a=e[i];if(0<=a){var l=r.data.getMapping();l&&l.set(a,t)}}var u=this._list;return u.data.selection.contains(this._oldValue)&&u.data.selection.clearAndAdd(t),this._selection.update("PROPERTY"),!0},n.prototype.undo=function(){for(var t=this._indices,e=this._oldValues,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i],a=t[i];if(0<=a){var l=r.data.getMapping();l&&l.set(a,e[i])}}var u=this._list;return u.data.selection.contains(this._newValue)&&u.data.selection.clearAndAdd(this._oldValue),this._selection.update("PROPERTY"),!0},n}(t.DCommandBase),U=function(e){function n(n,i){var o=e.call(this)||this;o._selection=i,o._target=n;for(var r=[],a=o._selection.get(),l=0,u=a.length;l<u;++l){var s=a[l];if(t.EShapeCapabilities.contains(s,t.EShapeCapability.DATA_MAPPING)){var p=s.data.getMapping();if(p){var h=p.indexOf(n);r.push(h),0<=h&&h<p.size()-1&&p.swap(h+1,h)}else r.push(-1)}else r.push(-1)}return o._indices=r,o._selection.update("PROPERTY"),o}return i(n,e),Object.defineProperty(n.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),n.prototype.execute=function(){return!0},n.prototype.redo=function(){for(var t=this._selection.get(),e=this._indices,n=0,i=t.length;n<i;++n){var o=t[n],r=e[n],a=o.data.getMapping();a&&0<=r&&r<a.size()-1&&a.swap(r+1,r)}return this._selection.update("PROPERTY"),!0},n.prototype.undo=function(){return this.redo()},n}(t.DCommandBase),Y=function(t){function e(e,n){var i=t.call(this)||this;return i._selection=n,i._value=e,i}return i(e,t),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){for(var t=this._value,e=this._selection.get(),n=0,i=e.length;n<i;++n)e[n].data.add(t);return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._selection.get(),e=0,n=t.length;e<n;++e){var i=t[e];i.data.remove(i.data.size()-1)}return this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),X=function(t){function e(e,n){var i=t.call(this)||this;i._selection=n,i._target=e;for(var o=[],r=i._selection.get(),a=0,l=r.length;a<l;++a){var u=r[a],s=u.data.indexOf(e);o.push(s),0<s&&u.data.swap(s-1,s)}return i._indices=o,i._selection.update("PROPERTY"),i}return i(e,t),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._selection.get(),e=this._indices,n=0,i=t.length;n<i;++n){var o=t[n],r=e[n];0<r&&o.data.swap(r-1,r)}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),W=function(t){function e(e,n){var i=t.call(this)||this;i._selection=n,i._target=e;for(var o=[],r=i._selection.get(),a=0,l=r.length;a<l;++a){var u=r[a],s=u.data.indexOf(e);o.push(s),0<=s&&u.data.remove(s)}return i._indices=o,i._selection.update("PROPERTY"),i}return i(e,t),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._indices,e=this._selection.get(),n=0,i=e.length;n<i;++n){var o=e[n],r=t[n];0<=r&&o.data.remove(r)}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._target,e=this._indices,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i],a=e[i];0<=a&&r.data.add(t,a)}return this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),K=function(t){function e(e,n,i,o){var r=t.call(this)||this;r._selection=i,r._oldValue=e,r._newValue=n,r._list=o;for(var a=[],l=[],u=r._selection.get(),s=0,p=u.length;s<p;++s){var h=u[s],c=h.data.indexOf(e);a.push(c),0<=c?(l.push(h.data.get(c)),h.data.set(c,n)):l.push(n)}return r._indices=a,r._oldValues=l,o.data.selection.contains(e)&&o.data.selection.clearAndAdd(n),r._selection.update("PROPERTY"),r}return i(e,t),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newValue",{get:function(){return this._newValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldValues",{get:function(){return this._oldValues},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._newValue,e=this._indices,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=e[i];0<=r&&n[i].data.set(r,t)}var a=this._list;return a.data.selection.contains(this._oldValue)&&a.data.selection.clearAndAdd(t),this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._indices,e=this._oldValues,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=t[i];0<=r&&n[i].data.set(r,e[i])}var a=this._list;return a.data.selection.contains(this._newValue)&&a.data.selection.clearAndAdd(this._oldValue),this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),Z=function(t){function e(e,n){var i=t.call(this)||this;i._selection=n,i._target=e;for(var o=[],r=i._selection.get(),a=0,l=r.length;a<l;++a){var u=r[a].data,s=u.indexOf(e);o.push(s),0<=s&&s<u.size()-1&&u.swap(s+1,s)}return i._indices=o,i._selection.update("PROPERTY"),i}return i(e,t),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._selection.get(),e=this._indices,n=0,i=t.length;n<i;++n){var o=t[n].data,r=e[n];0<=r&&r<o.size()-1&&o.swap(r+1,r)}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),q=function(){function e(){}return e.toIndices=function(t){for(var e=[],n=0,i=t.length;n<i;++n)e.push(t[n].index);return e},e.toDepth=function(e){for(var n=0,i=e.parent;i instanceof t.EShapeBase;)n+=1,i=i.parent;return n},e.toSharedParent=function(e,n){if(this.toDepth(e)<this.toDepth(n)){for(var i=e.parent;i instanceof t.EShapeBase;){if(this.isParent(n,i))return i;i=i.parent}return i}for(var o=n.parent;o instanceof t.EShapeBase;){if(this.isParent(e,o))return o;o=o.parent}return o},e.toOfParent=function(e,n){for(var i=e.parent;i!==n&&i instanceof t.EShapeBase;)e=i,i=i.parent;return e},e.isParent=function(e,n){for(var i=e.parent;i instanceof t.EShapeBase;){if(i===n)return!0;i=i.parent}return!1},e.toSelected=function(e){for(var n=e;n instanceof t.EShapeBase;){if(n.selected)return n;n=n.parent}return null},e.findChildById=function(t,n,i){for(var o=t.children,r=0,a=o.length;r<a;++r){var l=o[r];if(l.id===n)return l;if(!0===i){var u=e.findChildById(l,n,i);if(null!=u)return u}}return null},e.findChildByType=function(t,n,i){for(var o=t.children,r=0,a=o.length;r<a;++r){var l=o[r];if(l.type===n)return l;if(!0===i){var u=e.findChildByType(l,n,i);if(null!=u)return u}}return null},e.findChild=function(t,n,i){for(var o=t.children,r=0,a=o.length;r<a;++r){var l=o[r];if(n(l))return l;if(!0===i){var u=e.findChild(l,n,i);if(null!=u)return u}}return null},e.findChildrenByType=function(t,n,i,o){o=o||[];for(var r=t.children,a=0,l=r.length;a<l;++a){var u=r[a];u.type===n&&o.push(u),!0===i&&e.findChildrenByType(u,n,i,o)}return o},e.findChildren=function(t,n,i,o){o=o||[];for(var r=t.children,a=0,l=r.length;a<l;++a){var u=r[a];n(u)&&o.push(u),!0===i&&e.findChildren(u,n,i,o)}return o},e.COMPARATOR_INDEX=function(t,e){return t.index-e.index},e}(),J=function(){function t(){}return t.addAll=function(t,e){for(var n=0,i=t.length;n<i;++n){var o=t[n];e.add(o),this.addAll(o.children,e)}return e},t.delete=function(e,n,i,o){var r,a=e.children,l=a.length;null!=o||(o=null!==(r=t.EXCEPTIONS)&&void 0!==r?r:t.EXCEPTIONS=new Set);for(var u=0;u<l;++u)(h=a[u]).selected?(h.index=l+u,o.add(h),this.addAll(h.children,o)):h.index=u;if(a.sort(q.COMPARATOR_INDEX),!0===i){for(u=l-1;0<=u;--u){if(!(h=a[u]).selected){t.EXCEPTIONS===o&&o.clear();var s=a.length-(u+1);if(0<s){var p=a.splice(u+1,s);return null!=n&&(n.length=0),e.onChildTransformChange(),e.toDirty(),p}return null!=n&&(n.length=0),null}h.index-=l,h.parent=null,h.selected=!1,h.uploaded=void 0,h.onDetach(o)}return t.EXCEPTIONS===o&&o.clear(),0<a.length?(p=a.splice(0,a.length),null!=n&&(n.length=0),e.onChildTransformChange(),e.toDirty(),p):(null!=n&&(n.length=0),null)}for(u=l-1;0<=u;--u){var h;if(!(h=a[u]).selected)return t.EXCEPTIONS===o&&o.clear(),a.length=u+1,null!=n&&(n.length=0),e.onChildTransformChange(),e.toDirty(),null;h.parent=null,h.selected=!1,h.uploaded=void 0,h.onDetach(o)}return t.EXCEPTIONS===o&&o.clear(),0<a.length?(a.length=0,null!=n&&(n.length=0),e.onChildTransformChange(),e.toDirty()):null!=n&&(n.length=0),null},t}(),Q=function(t){function e(e,n,i,o,r){var a=t.call(this)||this;a._shapes=e;for(var l=0,u=e.length;l<u;++l)e[l].reference+=1;return a._indices=n,a._parent=i,a._selection=o,a._select=r,a}return i(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shapes",{get:function(){return this._shapes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e.prototype.redo=function(){var t=this._selection;if(this._select)t.delete(!1);else{for(var e=this._shapes,n=0,i=e.length;n<i;++n)e[n].selected=!0;J.delete(this._parent,void 0,!1),t.update("TREE")}return!0},e.prototype.undo=function(){for(var t=this._shapes,e=this._indices,n=this._parent,i=0,o=t.length;i<o;++i)t[i].attach(n,e[i]);var r=this._selection;return r.lock(),this._select&&r.clearAndAddAll(t),r.update("TREE"),r.unlock(),!0},e.prototype.destroy=function(){for(var t=this._shapes,e=0,n=t.length;e<n;++e){var i=t[e];i.reference-=1,null==i.parent&&i.reference<=0&&i.destroy()}t.length=0},e}(t.DCommandBase),$=function(e){function n(t,n){var i=e.call(this)||this;return i._parent=t,i._selection=n,i._before=[],i._deleteds=[],i._indices=[],i._createds=[],i}return i(n,e),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"before",{get:function(){return this._before},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"deleteds",{get:function(){return this._deleteds},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"createds",{get:function(){return this._createds},enumerable:!1,configurable:!0}),n.prototype.execute=function(){var e=this._selection;this._before=e.store(),e.lock();for(var n=e.get(),i=n.length-1;0<=i;--i){var o=n[i];t.EShapeCapabilities.contains(o,t.EShapeCapability.GROUPING)||(o.selected=!1,n.splice(i,1))}var r=this._parent,a=new Set,l=J.delete(r,n,!0,a)||[];this._deleteds=l,i=0;for(var u=l.length;i<u;++i)l[i].reference+=1;var s=e.modifier,p=s.position.x+.5*s.width,h=s.position.y+.5*s.height,c=s.width,d=s.height,g=new t.EShapeGroup(t.EShapeResourceManagerDeserializationMode.EDITOR);g.transform.position.set(p,h),g.size.set(c,d),g.attach(r);var f=g.children;for(i=0,u=l.length;i<u;++i){var y=l[i].clone();y.lock(t.EShapeLockPart.ALL);var v=y.transform.position;if(v.set(v.x-p,v.y-h),y instanceof t.EShapeConnectorLine){var b=y.edge,m=b.tail,_=m.acceptor,S=_.shape,w=m.local;null==S?w.set(w.x-p,w.y-h):a.has(S)||(_.shape=null,w.set(w.x-p,w.y-h));var T=b.head,E=T.acceptor,C=E.shape,D=T.local;null==C?D.set(D.x-p,D.y-h):a.has(C)||(E.shape=null,D.set(D.x-p,D.y-h))}y.parent=g,f.push(y)}for(t.EShapeConnectors.moveAll(l,f,l,f),i=0,u=f.length;i<u;++i)f[i].unlock(t.EShapeLockPart.ALL,!0);return g.onChildTransformChange(),g.toDirty(),g.onAttach(),g.reference+=1,this._createds=[g],a.clear(),this._indices=q.toIndices(l),e.clearAndAddAll(this._createds),e.update("TREE"),e.unlock(),!0},n.prototype.redo=function(){var t=this._selection;t.lock(),t.clearAndAddAll(this._deleteds),t.delete(!1);for(var e=this._parent,n=this._createds,i=0,o=n.length;i<o;++i)n[i].attach(e);return t.update("TREE"),t.unlock(),!0},n.prototype.undo=function(){var t=this._parent,e=this._selection;e.lock();for(var n=this._createds,i=n.length-1;0<=i;--i)n[i].detach();for(var o=this._deleteds,r=this._indices,a=(i=0,o.length);i<a;++i)o[i].attach(t,r[i]);return this._selection.restore(this._before),e.update("TREE"),e.unlock(),!0},n.prototype.destroy=function(){this._before.length=0;for(var t=this._deleteds,e=0,n=t.length;e<n;++e){var i=t[e];i.reference-=1,null==i.parent&&i.reference<=0&&i.destroy()}t.length=0;var o=this._createds;for(e=0,n=o.length;e<n;++e){var r=o[e];r.reference-=1,null==r.parent&&r.reference<=0&&r.destroy()}o.length=0},n}(t.DCommandBase),tt={NONE:0,PROPERTY:1,PROPERTY_ID:2,SELECTION:4,TREE:8,ALL:15},et=function(e){function n(t,n,i){void 0===i&&(i=t.get());var o=e.call(this)||this;return o._selection=t,o._shapes=[],o._capabilities=[],o._data=[],o._property=n,o._targets=i,o._isMerged=!1,o}return i(n,e),Object.defineProperty(n.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"shapes",{get:function(){return this._shapes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),n.prototype.toCapability=function(e){return t.EShapeCapability.ALL},n.prototype.isRecursive=function(){return!1},n.prototype.isMergeable=function(){return!1},n.prototype.isClassMergeable=function(t){return t.constructor===this.constructor},n.prototype.execute=function(){for(var t=this._shapes,e=this._capabilities,n=this._property,i=0,o=t.length;i<o;++i)this.initProperty(t[i],e[i],n);return this._selection.update(this.getParts()),!0},n.prototype.init=function(e,n,i,o,r){for(var a=0,l=e.length;a<l;++a){var u=e[a];if(r&&u instanceof t.EShapeGroup)t.EShapeCapabilities.contains(u,t.EShapeCapability.CHILDREN)&&this.init(u.children,n,i,o,r);else{var s=this.toCapability(u);s!==t.EShapeCapability.NONE&&(n.push(u),o.push(this.getProperty(u,s)),i.push(s))}}},n.prototype.merge=function(t){return this.isMergeable()&&this.isClassMergeable(t)?(this._isMerged=!0,this._shapes=t.shapes,this._capabilities=t.capabilities,this._data=t.data,!0):(this.init(this._targets,this._shapes,this._capabilities,this._data,this.isRecursive()),!1)},n.prototype.isMerged=function(){return this._isMerged},n.prototype.redo=function(){for(var t=this._shapes,e=this._data,n=this._capabilities,i=0,o=t.length;i<o;++i){var r=t[i],a=e[i],l=n[i];e[i]=this.getProperty(r,l),this.setProperty(r,l,a)}return this._selection.update(this.getParts()),!0},n.prototype.undo=function(){return this.redo()},n.prototype.destroy=function(){this._shapes.length=0,this._data.length=0},n.prototype.getParts=function(){return tt.PROPERTY},n}(t.DCommandBase),nt=function(e){function n(t){return e.call(this,t,void 0)||this}return i(n,e),n.prototype.toCapability=function(e){if(e instanceof t.EShapeConnectorLine){var n=e.edge;return null==n.tail.acceptor.shape&&null==n.head.acceptor.shape?t.EShapeCapability.ALL:t.EShapeCapability.NONE}var i=t.EShapeCapability.NONE;return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)&&(i|=t.EShapeCapability.POSITION),t.EShapeCapabilities.contains(e,t.EShapeCapability.WIDTH)&&(i|=t.EShapeCapability.WIDTH),t.EShapeCapabilities.contains(e,t.EShapeCapability.HEIGHT)&&(i|=t.EShapeCapability.HEIGHT),t.EShapeCapabilities.contains(e,t.EShapeCapability.ROTATION)&&(i|=t.EShapeCapability.ROTATION),t.EShapeCapabilities.contains(e,t.EShapeCapability.SKEW)&&(i|=t.EShapeCapability.SKEW),i},n.prototype.getProperty=function(e,n){if(e instanceof t.EShapeConnectorLine){var i=e.edge,o=i.tail.local,r=i.head.local;return[o.x,o.y,r.x,r.y,0,0]}var a=e.transform,l=a.position,u=e.size,s=a.skew;return[l.x,l.y,u.x,u.y,a.rotation,s.x]},n.prototype.setProperty=function(e,n,i){if(e instanceof t.EShapeConnectorLine){var o=e.edge;o.tail.local.set(i[0],i[1]),o.head.local.set(i[2],i[3])}else{var r=e.transform;n&t.EShapeCapability.POSITION&&r.position.set(i[0],i[1]),n&t.EShapeCapability.HEIGHT?n&t.EShapeCapability.WIDTH?e.size.set(i[2],i[3]):e.size.y=i[3]:n&t.EShapeCapability.WIDTH&&(e.size.x=i[2]),n&t.EShapeCapability.ROTATION&&(r.rotation=i[4]),n&t.EShapeCapability.SKEW&&r.skew.set(i[5],i[5])}},n.prototype.initProperty=function(t,e,n){},n}(et),it=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.getProperty=function(e,n){var i=e.getCapability();return null!=i?i.locked:t.EShapeCapability.NONE},n.prototype.setProperty=function(e,n,i){if(i!==t.EShapeCapability.NONE)e.capability.locked=i;else{var o=e.getCapability();null!=o&&(o.locked=i)}},n}(et),ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.initProperty=function(t,e,n){t.capability.locked|=n},e}(it),rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.initProperty=function(t,e,n){t.capability.locked&=~n},e}(it),at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.corner},e.prototype.setProperty=function(t,e,n){t.corner=n},e.prototype.initProperty=function(t,e,n){t.corner&=~n},e}(et),lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.corner},e.prototype.setProperty=function(t,e,n){t.corner=n},e.prototype.initProperty=function(t,e,n){t.corner|=n},e}(et),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.initProperty=function(t,e,n){this.setProperty(t,e,n)},e}(et),st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.cursor},e.prototype.setProperty=function(t,e,n){t.cursor=n},e}(ut),pt=function(t){function e(e,n){return t.call(this,e,n)||this}return i(e,t),e.prototype.isRecursive=function(){return!0},e}(et),ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.initProperty=function(t,e,n){this.setProperty(t,e,n)},e}(pt),ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return[t.fill.color,t.fill.alpha]},e.prototype.setProperty=function(t,e,n){t.fill.set(void 0,n[0],n[1])},e}(ht),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.fill.enable},e.prototype.setProperty=function(t,e,n){t.fill.enable=n},e}(ht),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.state.isFocusable},e.prototype.setProperty=function(t,e,n){t.state.isFocusable=n},e}(ut),ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.id},e.prototype.setProperty=function(t,e,n){t.id=n},e.prototype.getParts=function(){return tt.PROPERTY_ID},e}(ut),yt=function(t){function e(e){return t.call(this,e,void 0)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.image},e.prototype.setProperty=function(t,e,n){t.image=n},e.prototype.initProperty=function(t,e,n){t.image=void 0,t.gradient=void 0},e}(et),vt=function(t){function e(e){return t.call(this,e,void 0)||this}return i(e,t),e.prototype.getProperty=function(t,e){var n=t.size;return[n.x,n.y]},e.prototype.setProperty=function(t,e,n){t.size.set(n[0],n[1])},e.prototype.initProperty=function(t,e,n){var i=t.image;i&&t.size.set(i.width,i.height)},e}(pt),bt=function(t){function e(e,n,i){return t.call(this,e,[n,i])||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.image},e.prototype.setProperty=function(t,e,n){t.image=n},e.prototype.initProperty=function(t,e,n){t.image=n[0],t.gradient=n[1]},e}(et),mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.interactive},e.prototype.setProperty=function(t,e,n){t.interactive=n},e}(ut),_t=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)?t.EShapeCapability.LINE_HEAD:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){var n=t.points;if(n){var i=n.marker.head.fill;return[i.color,i.alpha]}return[0,0]},n.prototype.setProperty=function(t,e,n){var i=t.points;i&&i.marker.head.fill.set(void 0,n[0],n[1])},n}(ht),St=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)?t.EShapeCapability.LINE_HEAD:t.EShapeCapability.NONE},n.prototype.getProperty=function(e,n){return e instanceof t.EShapeConnectorLine?e.edge.head.margin:0},n.prototype.setProperty=function(e,n,i){e instanceof t.EShapeConnectorLine&&(e.edge.head.margin=i)},n}(ht),wt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)?t.EShapeCapability.LINE_HEAD:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){var n=t.points;return n?n.marker.head.size.x:0},n.prototype.setProperty=function(t,e,n){var i=t.points;i&&(i.marker.head.size.x=n)},n}(ht),Tt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)?t.EShapeCapability.LINE_HEAD:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){var n=t.points;return n?n.marker.head.size.y:0},n.prototype.setProperty=function(t,e,n){var i=t.points;i&&(i.marker.head.size.y=n)},n}(ht),Et=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)?t.EShapeCapability.LINE_HEAD:t.EShapeCapability.NONE},n.prototype.getProperty=function(e,n){var i=e.points;return i?i.marker.head.type:t.EShapePointsMarkerType.NONE},n.prototype.setProperty=function(t,e,n){var i=t.points;i&&(i.marker.head.type=n)},n}(ht),Ct=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)?t.EShapeCapability.LINE_TAIL:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){var n=t.points;if(n){var i=n.marker.tail.fill;return[i.color,i.alpha]}return[0,0]},n.prototype.setProperty=function(t,e,n){var i=t.points;i&&i.marker.tail.fill.set(void 0,n[0],n[1])},n}(ht),Dt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)?t.EShapeCapability.LINE_TAIL:t.EShapeCapability.NONE},n.prototype.getProperty=function(e,n){return e instanceof t.EShapeConnectorLine?e.edge.tail.margin:0},n.prototype.setProperty=function(e,n,i){e instanceof t.EShapeConnectorLine&&(e.edge.tail.margin=i)},n}(ht),Lt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)?t.EShapeCapability.LINE_TAIL:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){var n=t.points;return n?n.marker.tail.size.x:0},n.prototype.setProperty=function(t,e,n){var i=t.points;i&&(i.marker.tail.size.x=n)},n}(ht),At=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)?t.EShapeCapability.LINE_TAIL:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){var n=t.points;return n?n.marker.tail.size.y:0},n.prototype.setProperty=function(t,e,n){var i=t.points;i&&(i.marker.tail.size.y=n)},n}(ht),Bt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)?t.EShapeCapability.LINE_TAIL:t.EShapeCapability.NONE},n.prototype.getProperty=function(e,n){var i=e.points;return i?i.marker.tail.type:t.EShapePointsMarkerType.NONE},n.prototype.setProperty=function(t,e,n){var i=t.points;i&&(i.marker.tail.type=n)},n}(ht),Ot=function(e){function n(t,n,i){return e.call(this,t,[n,i])||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE)?t.EShapeCapability.LINE:t.EShapeCapability.NONE},n.prototype.getProperty=function(e,n){var i=e.points;return null!=i?i.style:t.EShapePointsStyle.NONE},n.prototype.setProperty=function(t,e,n){var i=t.points;null!=i&&(i.style=n)},n.prototype.initProperty=function(t,e,n){var i=t.points;null!=i&&(i.style=i.style&~n[1]|n[0])},n}(et),Pt=function(e){function n(t){return e.call(this,t,void 0)||this}return i(n,e),n.prototype.toCapability=function(e){if(e instanceof t.EShapeConnectorLine){var n=e.edge;return null==n.tail.acceptor.shape&&null==n.head.acceptor.shape?t.EShapeCapability.ALL:t.EShapeCapability.NONE}var i=t.EShapeCapability.NONE;return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)&&(i|=t.EShapeCapability.POSITION),t.EShapeCapabilities.contains(e,t.EShapeCapability.ROTATION)&&(i|=t.EShapeCapability.ROTATION),i},n.prototype.getProperty=function(e,n){if(e instanceof t.EShapeConnectorLine){var i=e.edge,o=i.tail.local,r=i.head.local;return[o.x,o.y,r.x,r.y]}var a=e.transform,l=a.position;return[l.x,l.y,a.rotation,0]},n.prototype.setProperty=function(e,n,i){if(e instanceof t.EShapeConnectorLine){var o=e.edge;o.tail.local.set(i[0],i[1]),o.head.local.set(i[2],i[3])}else{var r=e.transform;n&t.EShapeCapability.POSITION&&r.position.set(i[0],i[1]),n&t.EShapeCapability.ROTATION&&(r.rotation=i[2])}},n.prototype.initProperty=function(t,e,n){},n}(et),It=function(n){function o(){return null!==n&&n.apply(this,arguments)||this}return i(o,n),o.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)?t.EShapeCapability.POSITION:t.EShapeCapability.NONE},o.prototype.getProperty=function(t,e){return t.transform.position.x},o.prototype.setProperty=function(t,e,n){t.transform.position.x=n},o.prototype.initProperty=function(t,n,i){var r,a=null!==(r=o.WORK)&&void 0!==r?r:o.WORK=new e.Rectangle;t.getBoundsLocal(!1,a),t.transform.position.x+=i-a.x},o.prototype.isMergeable=function(){return!0},o}(et),xt=function(n){function o(){return null!==n&&n.apply(this,arguments)||this}return i(o,n),o.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)?t.EShapeCapability.POSITION:t.EShapeCapability.NONE},o.prototype.getProperty=function(t,e){return t.transform.position.y},o.prototype.setProperty=function(t,e,n){t.transform.position.y=n},o.prototype.initProperty=function(t,n,i){var r,a=null!==(r=o.WORK)&&void 0!==r?r:o.WORK=new e.Rectangle;t.getBoundsLocal(!1,a),t.transform.position.y+=i-a.y},o.prototype.isMergeable=function(){return!0},o}(et),Rt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)?t.EShapeCapability.POSITION:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){return t.transform.position.x},n.prototype.setProperty=function(t,e,n){t.transform.position.x=n},n.prototype.isMergeable=function(){return!0},n}(ut),kt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)?t.EShapeCapability.POSITION:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){return t.transform.position.y},n.prototype.setProperty=function(t,e,n){t.transform.position.y=n},n.prototype.isMergeable=function(){return!0},n}(ut),Vt=function(e){function n(t){return e.call(this,t,void 0)||this}return i(n,e),n.prototype.toCapability=function(e){if(e instanceof t.EShapeConnectorLine){var n=e.edge;return null==n.tail.acceptor.shape&&null==n.head.acceptor.shape?t.EShapeCapability.POSITION:t.EShapeCapability.NONE}return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)?t.EShapeCapability.POSITION:t.EShapeCapability.NONE},n.prototype.getProperty=function(e,n){if(e instanceof t.EShapeConnectorLine){var i=e.edge,o=i.tail.local,r=i.head.local;return[o.x,o.y,r.x,r.y]}var a=e.transform.position;return[a.x,a.y,0,0]},n.prototype.setProperty=function(e,n,i){if(e instanceof t.EShapeConnectorLine){var o=e.edge;o.tail.local.set(i[0],i[1]),o.head.local.set(i[2],i[3])}else e.transform.position.set(i[0],i[1])},n.prototype.initProperty=function(t,e,n){},n}(et),Mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.radius},e.prototype.setProperty=function(t,e,n){t.radius=n},e.prototype.isMergeable=function(){return!0},e}(ut),Nt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.ROTATION)?t.EShapeCapability.ROTATION:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){return t.transform.rotation},n.prototype.setProperty=function(t,e,n){t.transform.rotation=n},n.prototype.isMergeable=function(){return!0},n}(ut),Ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.shortcut},e.prototype.setProperty=function(t,e,n){t.shortcut=n},e}(ut),jt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.WIDTH)?t.EShapeCapability.WIDTH:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){return t.size.x},n.prototype.setProperty=function(t,e,n){t.size.x=n},n.prototype.isMergeable=function(){return!0},n}(ut),zt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.HEIGHT)?t.EShapeCapability.HEIGHT:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){return t.size.y},n.prototype.setProperty=function(t,e,n){t.size.y=n},n.prototype.isMergeable=function(){return!0},n}(ut),Ht=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.SKEW)?t.EShapeCapability.SKEW:t.EShapeCapability.NONE},n.prototype.getProperty=function(t,e){return t.transform.skew.x},n.prototype.setProperty=function(t,e,n){t.transform.skew.set(n,n)},n.prototype.isMergeable=function(){return!0},n}(ut),Gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.stroke.align},e.prototype.setProperty=function(t,e,n){t.stroke.align=n},e.prototype.isMergeable=function(){return!0},e}(ht),Ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return[t.stroke.color,t.stroke.alpha]},e.prototype.setProperty=function(t,e,n){t.stroke.set(void 0,n[0],n[1])},e}(ht),Yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.stroke.enable},e.prototype.setProperty=function(t,e,n){t.stroke.enable=n},e}(ht),Xt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.stroke.side},e.prototype.setProperty=function(t,e,n){t.stroke.side=n},e.prototype.initProperty=function(t,e,n){t.stroke.side&=~n},e}(pt),Wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.stroke.side},e.prototype.setProperty=function(t,e,n){t.stroke.side=n},e.prototype.initProperty=function(t,e,n){t.stroke.side|=n},e}(pt),Kt=function(t){function e(e,n,i){return t.call(this,e,[n,i])||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.stroke.style},e.prototype.setProperty=function(t,e,n){t.stroke.style=n},e.prototype.initProperty=function(t,e,n){var i=t.stroke;i.style=i.style&~n[1]|n[0]},e}(et),Zt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.stroke.width},e.prototype.setProperty=function(t,e,n){t.stroke.width=n},e.prototype.isMergeable=function(){return!0},e}(ht),qt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.align.horizontal},e.prototype.setProperty=function(t,e,n){t.text.align.horizontal=n},e}(ut),Jt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.align.vertical},e.prototype.setProperty=function(t,e,n){t.text.align.vertical=n},e}(ut),Qt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.clipping},e.prototype.setProperty=function(t,e,n){t.text.clipping=n},e}(ut),$t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){var n=t.text;return[n.color,n.alpha]},e.prototype.setProperty=function(t,e,n){var i=t.text;i.color=n[0],i.alpha=n[1]},e}(ut),te=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.direction},e.prototype.setProperty=function(t,e,n){t.text.direction=n},e}(ut),ee=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.family},e.prototype.setProperty=function(t,e,n){t.text.family=n},e}(ut),ne=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.fitting},e.prototype.setProperty=function(t,e,n){t.text.fitting=n},e}(ut),ie=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.offset.horizontal},e.prototype.setProperty=function(t,e,n){t.text.offset.horizontal=n},e}(ut),oe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.offset.vertical},e.prototype.setProperty=function(t,e,n){t.text.offset.vertical=n},e}(ut),re=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){var n=t.text.outline;return[n.color,n.alpha]},e.prototype.setProperty=function(t,e,n){var i=t.text.outline;i.color=n[0],i.alpha=n[1]},e}(ut),ae=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.outline.enable},e.prototype.setProperty=function(t,e,n){t.text.outline.enable=n},e}(ut),le=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.outline.width},e.prototype.setProperty=function(t,e,n){t.text.outline.width=n},e.prototype.isMergeable=function(){return!0},e}(ut),ue=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.padding.horizontal},e.prototype.setProperty=function(t,e,n){t.text.padding.horizontal=n},e}(ut),se=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.padding.vertical},e.prototype.setProperty=function(t,e,n){t.text.padding.vertical=n},e}(ut),pe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.size},e.prototype.setProperty=function(t,e,n){t.text.size=n},e.prototype.initProperty=function(t,e,n){var i=t.text;i.size=Math.max(0,i.size+n)},e}(et),he=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.size},e.prototype.setProperty=function(t,e,n){t.text.size=n},e}(ut),ce=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.spacing.horizontal},e.prototype.setProperty=function(t,e,n){t.text.spacing.horizontal=n},e.prototype.isMergeable=function(){return!0},e}(ut),de=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.spacing.vertical},e.prototype.setProperty=function(t,e,n){t.text.spacing.vertical=n},e.prototype.isMergeable=function(){return!0},e}(ut),ge=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.style},e.prototype.setProperty=function(t,e,n){t.text.style=n},e}(ut),fe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.value},e.prototype.setProperty=function(t,e,n){t.text.value=n},e.prototype.isMergeable=function(){return!0},e}(ut),ye=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.text.weight},e.prototype.setProperty=function(t,e,n){t.text.weight=n},e}(ut),ve=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t.title},e.prototype.setProperty=function(t,e,n){t.title=n},e}(ut),be=function(t){function e(e,n,i,o){var r=t.call(this)||this;return r._parent=i,r._newShape=e,r._oldShape=n,r._selection=o,r._index=i.children.indexOf(n),e.reference+=1,n.reference+=1,r}return i(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldShape",{get:function(){return this._oldShape},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newShape",{get:function(){return this._newShape},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return this._oldShape.detach(),this._newShape.attach(this._parent,this._index),this._selection.swapLast(this._oldShape,this._newShape),!0},e.prototype.redo=function(){return this._newShape.attach(this._parent,this._index),this._oldShape.detach(),this._selection.swapLast(this._oldShape,this._newShape),!0},e.prototype.undo=function(){return this._newShape.detach(),this._oldShape.attach(this._parent,this._index),this._selection.swapLast(this._newShape,this._oldShape),!0},e.prototype.destroy=function(){var t=this._newShape;t.reference-=1,null==t.parent&&t.reference<=0&&t.destroy();var e=this._oldShape;e.reference-=1,null==e.parent&&e.reference<=0&&e.destroy()},e}(t.DCommandBase),me=function(e){function n(t,n,i){var o=e.call(this)||this;return o._parent=t,o._factory=n,o._selection=i,o._newShapes=[],o._oldShapes=[],o._indices=[],o}return i(n,e),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"oldShapes",{get:function(){return this._oldShapes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"newShapes",{get:function(){return this._newShapes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),n.prototype.execute=function(){for(var e=this._parent,n=this._indices,i=this._newShapes,o=this._oldShapes,r=e.children,a=this._factory,l=0,u=r.length;l<u;++l){var s=r[l];if(s.selected){var p=void 0;if(t.EShapeCapabilities.contains(s,t.EShapeCapability.REPLACING)){if(s instanceof t.EShapeGroup){var h=s.transform.pivot,c=h.x,d=h.y;0!==c||0!==d?(s.lock(t.EShapeLockPart.TRANSFORM),h.set(0,0),p=a(s)||s,h.set(c,d),s.unlock(t.EShapeLockPart.TRANSFORM,!1)):p=a(s)||s}else p=a(s)||s;p!==s&&(s.reference+=1,p.reference+=1,s.detach(),p.attach(e,l))}else p=s;n.push(l),i.push(p),o.push(s)}}var g=this._selection;return g.lock(),g.clearAndAddAll(i),g.update(tt.TREE|tt.SELECTION),g.unlock(),!0},n.prototype.redo=function(){for(var t=this._parent,e=this._indices,n=this._oldShapes,i=this._newShapes,o=0,r=i.length;o<r;++o){var a=n[o],l=i[o];a!==l&&(a.detach(),l.attach(t,e[o]))}var u=this._selection;return u.lock(),u.clearAndAddAll(i),u.update(tt.TREE|tt.SELECTION),u.unlock(),!0},n.prototype.undo=function(){for(var t=this._parent,e=this._indices,n=this._oldShapes,i=this._newShapes,o=0,r=i.length;o<r;++o){var a=n[o],l=i[o];a!==l&&(l.detach(),a.attach(t,e[o]))}var u=this._selection;return u.lock(),u.clearAndAddAll(n),u.update(tt.TREE|tt.SELECTION),u.unlock(),!0},n.prototype.destroy=function(){for(var t=this._oldShapes,e=this._newShapes,n=0,i=e.length;n<i;++n){var o=t[n],r=e[n];o!==r&&(r.reference-=1,null==r.parent&&r.reference<=0&&r.destroy(),o.reference-=1,null==o.parent&&o.reference<=0&&o.destroy())}t.length=0,e.length=0,this.indices.length=0},n}(t.DCommandBase),_e=function(t){function e(e,n,i){var o=t.call(this)||this;return o._before=e,o._after=n,o._selection=i,o}return i(e,t),Object.defineProperty(e.prototype,"before",{get:function(){return this._before},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"after",{get:function(){return this._after},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),e.prototype.isClean=function(){return!0},e.prototype.execute=function(){return!0},e.prototype.redo=function(){return this._selection.restore(this._after),!0},e.prototype.undo=function(){return this._selection.restore(this._before),!0},e.prototype.destroy=function(){this._before.length=0,this._after.length=0},e}(t.DCommandBase),Se=function(t){function e(e,n,i){var o=t.call(this)||this;return o._indices=e,o._parent=n,o._selection=i,o}return i(e,t),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._indices,e=this._parent,n=e.children,i=0,o=t.length;i<o;++i){var r=t[i],a=n[r];n[r]=n[r+1],n[r+1]=a}return e.toDirty(),this._selection.update(tt.TREE),!0},e.prototype.undo=function(){for(var t=this._indices,e=this._parent,n=e.children,i=t.length-1;0<=i;--i){var o=t[i],r=n[o+1];n[o+1]=n[o],n[o]=r}return e.toDirty(),this._selection.update(tt.TREE),!0},e.prototype.destroy=function(){this._indices.length=0},e}(t.DCommandBase),we=function(t,e){return t.index-e.index},Te=function(t){function e(e,n,i){var o=t.call(this)||this;return o._indices=e,o._parent=n,o._selection=i,o}return i(e,t),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._indices,e=this._parent,n=e.children,i=n.length,o=0;o<i;++o)n[o].index=o;o=0;for(var r=t.length;o<r;++o){var a=t[o];n[a].index=i+a}return n.sort(we),e.toDirty(),this._selection.update(tt.TREE),!0},e.prototype.undo=function(){for(var t=this._indices,e=this._parent,n=e.children,i=n.length,o=t.length,r=0,a=o;r<a;++r){var l=t[r];(h=n[i-1-r]).index=l}var u=o-1,s=t[u],p=0;for(r=0,a=i-o;r<a;++r){var h=n[r];(l=r+p)<s?h.index=l:(p+=1,s=0<=(u-=1)?t[u]:Number.MAX_SAFE_INTEGER,r-=1)}return n.sort(we),e.toDirty(),this._selection.update(tt.TREE),!0},e.prototype.destroy=function(){this._indices.length=0},e}(t.DCommandBase),Ee=function(t){function e(e,n,i){var o=t.call(this)||this;return o._indices=e,o._parent=n,o._selection=i,o}return i(e,t),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._indices,e=this._parent,n=e.children,i=0,o=t.length;i<o;++i){var r=t[i],a=n[r];n[r]=n[r-1],n[r-1]=a}return e.toDirty(),this._selection.update(tt.TREE),!0},e.prototype.undo=function(){for(var t=this._indices,e=this._parent,n=e.children,i=t.length-1;0<=i;--i){var o=t[i],r=n[o-1];n[o-1]=n[o],n[o]=r}return e.toDirty(),this._selection.update(tt.TREE),!0},e.prototype.destroy=function(){this._indices.length=0},e}(t.DCommandBase),Ce=function(t,e){return t.index-e.index},De=function(t){function e(e,n,i){var o=t.call(this)||this;return o._indices=e,o._parent=n,o._selection=i,o}return i(e,t),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._indices,e=this._parent,n=e.children,i=n.length,o=0;o<i;++o)n[o].index=o;o=0;for(var r=t.length;o<r;++o){var a=t[o];n[a].index=a-i}return n.sort(Ce),e.toDirty(),this._selection.update(tt.TREE),!0},e.prototype.undo=function(){for(var t=this._indices,e=this._parent,n=e.children,i=t.length,o=0,r=i;o<r;++o){var a=t[o];(h=n[o]).index=a}var l=0,u=t[l],s=-i,p=n.length;for(o=i;o<p;++o){var h=n[o];(a=o+s)<u?h.index=a:(s+=1,u=(l+=1)<i?t[l]:Number.MAX_SAFE_INTEGER,o-=1)}return n.sort(Ce),e.toDirty(),this._selection.update(tt.TREE),!0},e.prototype.destroy=function(){this._indices.length=0},e}(t.DCommandBase),Le=function(){function e(){}return e.prepare=function(e){var n=e.editor;null==n&&(n=new t.EShapeEditor,e.editor=n),e.updateTransform();var i=e.parent;i instanceof t.EShapeBase?i.transform.internalTransform.copyTo(n.internalTransformParentInverse).invert():n.internalTransformParentInverse.identity(),e.transform.internalTransform.copyTo(n.internalTransform),n.rotation=e.transform.rotation,n.size.copyFrom(e.size),e.lock(t.EShapeLockPart.TRANSFORM_CHILD)},e.finalize=function(e){e.unlock(t.EShapeLockPart.TRANSFORM_CHILD,!0)},e.apply=function(t,e,n){var i=t.editor;if(null!=i){var o=i.localTransform;i.internalTransformParentInverse.copyTo(o).append(e).append(i.internalTransform),this.applyLocal(t,o,n,i.size)}},e.applyLocal=function(e,n,i,o){var r=n.a,a=n.b,l=n.c,u=n.d,s=n.tx,p=n.ty;e.lock(t.EShapeLockPart.UPLOADED);var h=e.transform,c=!!(i&t.EShapeCapability.POSITION),d=!!(i&t.EShapeCapability.ROTATION),g=!!(i&t.EShapeCapability.SKEW),f=!!(i&t.EShapeCapability.WIDTH),y=!!(i&t.EShapeCapability.HEIGHT);if(d||g){var v=Math.atan2(-l,u),b=Math.atan2(+a,r);if(d&&(h.rotation=.5*(v+b)),g){var m=.5*(b-v);h.skew.set(m,m)}}if(c){var _=h.pivot,S=_.x,w=_.y;h.position.set(s+(r*S+l*w),p+(a*S+u*w))}if(null!=o&&(f||y)){var T=t.toSizeNormalized(o.x*Math.sqrt(r*r+a*a)),E=t.toSizeNormalized(o.y*Math.sqrt(l*l+u*u)),C=e.size;f&&y?C.set(T,E):f?C.x=T:C.y=E}e.unlock(t.EShapeLockPart.UPLOADED,!0)},e}(),Ae=function(e){function n(t,n){var i=e.call(this)||this;return i._parent=t,i._selection=n,i._before=[],i._deleteds=[],i._indices=[],i._createds=[],i}return i(n,e),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"before",{get:function(){return this._before},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"deleteds",{get:function(){return this._deleteds},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"indices",{get:function(){return this._indices},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"createds",{get:function(){return this._createds},enumerable:!1,configurable:!0}),n.prototype.execute=function(){var e=this._selection;e.lock(),this._before=e.store();for(var n=e.get(),i=n.length-1;0<=i;--i){var o=n[i];this.isUngroupable(o)||(o.selected=!1,n.splice(i,1))}var r=this._parent,a=J.delete(r,n,!0)||[];this._deleteds=a,i=0;for(var l=a.length;i<l;++i)a[i].reference+=1;var u=[];for(i=0,l=a.length;i<l;++i){for(var s=a[i],p=s.transform.localTransform,h=p.a,c=p.b,d=p.c,g=p.d,f=p.tx,y=p.ty,v=s.children,b=[],m=0,_=v.length;m<_;++m){(H=v[m].clone()).lock(t.EShapeLockPart.ALL),H.parent=null,H.updateTransform();var S=H.transform.localTransform;S.prepend(p);var w=t.EShapeCapability.NONE;if(t.EShapeCapabilities.contains(H,t.EShapeCapability.POSITION)&&(w|=t.EShapeCapability.POSITION),t.EShapeCapabilities.contains(H,t.EShapeCapability.ROTATION)&&(w|=t.EShapeCapability.ROTATION),t.EShapeCapabilities.contains(H,t.EShapeCapability.SKEW)&&(w|=t.EShapeCapability.SKEW),w!==t.EShapeCapability.NONE&&Le.applyLocal(H,S,w),H instanceof t.EShapeConnectorLine){var T=H.edge,E=T.tail;if(null==E.acceptor.shape){var C=E.local,D=C.x,L=C.y;C.set(h*D+d*L+f,c*D+g*L+y);var A=E.normal,B=A.x,O=A.y;if(1e-6<(N=(V=h*B+d*O)*V+(M=c*B+g*O)*M)){var P=Math.sqrt(1/N);A.set(V*P,M*P)}}var I=T.head;if(null==I.acceptor.shape){var x=I.local,R=x.x,k=x.y;x.set(h*R+d*k+f,c*R+g*k+y);var V,M,N,F=I.normal,j=F.x,z=F.y;1e-6<(N=(V=h*j+d*z)*V+(M=c*j+g*z)*M)&&(P=Math.sqrt(1/N),F.set(V*P,M*P))}}b.push(H)}for(t.EShapeConnectors.moveAll(v,b,v,b),m=0,_=b.length;m<_;++m){var H;(H=b[m]).unlock(t.EShapeLockPart.ALL,!0),H.attach(r),H.reference+=1,u.push(H)}}return this._createds=u,this._indices=q.toIndices(a),e.clearAndAddAll(u),e.update("TREE"),e.unlock(),!0},n.prototype.isUngroupable=function(e){return e instanceof t.EShapeGroup&&t.EShapeCapabilities.contains(e,t.EShapeCapability.CHILDREN)&&t.EShapeCapabilities.contains(e,t.EShapeCapability.UNGROUPING)},n.prototype.redo=function(){var t=this._selection;t.lock(),t.clearAndAddAll(this._deleteds),t.delete(!1);for(var e=this._parent,n=this._createds,i=0,o=n.length;i<o;++i)n[i].attach(e);return t.clearAndAddAll(n),t.update("TREE"),t.unlock(),!0},n.prototype.undo=function(){var t=this._parent,e=this._selection;e.lock();for(var n=this._createds,i=n.length-1;0<=i;--i)n[i].detach();for(var o=this._deleteds,r=this._indices,a=(i=0,o.length);i<a;++i)o[i].attach(t,r[i]);return this._selection.restore(this._before),e.update("TREE"),e.unlock(),!0},n.prototype.destroy=function(){this._before.length=0;for(var t=this._deleteds,e=0,n=t.length;e<n;++e){var i=t[e];i.reference-=1,null==i.parent&&i.reference<=0&&i.destroy()}t.length=0;var o=this._createds;for(e=0,n=o.length;e<n;++e){var r=o[e];r.reference-=1,null==r.parent&&r.reference<=0&&r.destroy()}o.length=0},n}(t.DCommandBase);function Be(t,e){return{id:void 0,graphicId:e.id,name:t,mappings:new Map}}var Oe=function(){function t(t){this.lines=t,this.linesLength=t.length,this.cursor=-1,this.line="",this.lineLength=0}return t.prototype.next=function(){var t=this.cursor+1;if(t<this.linesLength){this.cursor=t;var e=this.lines[t];return this.line=e,this.lineLength=e.length,!0}return!1},t}(),Pe=function(){function t(){}return t.parseLine=function(t){for(var e=[],n=-1,i=t.line,o=t.lineLength,r=0;r<o;++r)if('"'===i.charAt(r))for(var a=r+1;a<o;++a){var l=i.indexOf('"',a);if(l<0){if(t.next()){i+="\n"+t.line,o+=1+t.lineLength,a-=1;continue}a=o+1,e.push(this.unescape(i.substring(r+1,a-1))),r=a}else{if((a=l+1)<o&&'"'===i.charAt(a))continue;e.push(this.unescape(i.substring(r+1,a-1))),r=a}break}else n<r&&(n=i.indexOf(",",r))<0&&(n=o),e.push(i.substring(r,n)),r=n;return e},t.parse=function(t){for(var e=t.split(/(?:\r\n?|\n)/g),n=[],i=new Oe(e);i.next();){var o=this.parseLine(i);0<o.length&&n.push(o)}return n},t.stringifyLine=function(t){for(var e="",n="",i=0,o=t.length;i<o;++i)e+=n+this.escape(String(t[i])),n=",";return e},t.stringify=function(t){for(var e="",n="",i=0,o=t.length;i<o;++i)e+=n+this.stringifyLine(t[i]),n="\n";return e},t.escape=function(t){var e=t.replace(/"/g,'""');return e.length!==t.length||0<=t.indexOf(",")||0<=t.indexOf("\n")||0<=t.indexOf("\r")?'"'.concat(e,'"'):t},t.unescape=function(t){return t.replace(/""/g,'"')},t}();function Ie(t){for(var e=Pe.parse(t),n=new Map,i=0,o=e.length;i<o;++i){var r=e[i],a=parseInt(r[0],10);if(a==a){var l=r[1]||"",u=r[2]||"";if(0<l.length&&0<u.length){var s=n.get(a);null==s&&(s={},n.set(a,s)),s[l]=u}}}return n}function xe(t){for(var e=JSON.parse(t.mappings),n=e[0],i=e[1],o=new Map,r=0,a=Math.min(n.length,i.length);r<a;++r)o.set(n[r],i[r]);return{id:t.id,graphicId:t.graphicId,name:t.name,mappings:o}}function Re(t){var e=t.mappings,n=[],i=[];return e.forEach((function(t,e){n.push(e),i.push(t)})),{id:t.id,graphicId:t.graphicId,name:t.name,mappings:JSON.stringify([n,i])}}var ke,Ve,Me,Ne=function(){function e(){}return e.add=function(e){var n,i;(null!==(n=this._typeToExtension)&&void 0!==n?n:this._typeToExtension=new Map).set(e.type,e),(null!==(i=this._extensions)&&void 0!==i?i:this._extensions=[]).push(e),t.EShapeActionValueDeserializers[e.type]=e.deserializer},e.get=function(t){var e=this._typeToExtension;if(null!=e)return e.get(t)},e.each=function(t){var e=this._extensions;if(null!=e)for(var n=0,i=e.length;n<i;++n)t(e[n])},e}(),Fe={TEXT:0},je=function(){function e(t,e,n,i){this._extension=t,this._dialog=e,this._condition=n,this._layout=i}return Object.defineProperty(e.prototype,"select",{get:function(){var t=this._select;return void 0===t&&(t=this.newSelect(),this._select=t),t},enumerable:!1,configurable:!0}),e.prototype.newSelect=function(){var e=this._extension.items;return null!=e&&0<e.length?new t.DSelect({weight:1,value:e[0].type,menu:{items:this.newSelectMenuItems(e)}}):null},e.prototype.newSelectMenuItems=function(t){for(var e=[],n=0,i=t.length;n<i;++n){var o=t[n];e.push({value:o.type,text:{value:o.label}})}return e},Object.defineProperty(e.prototype,"selectLayout",{get:function(){var t=this._selectLayout;if(void 0===t){if(null!=(t=this.newSelectLayout())){var e=this._layout,n=e.getChildIndex(this._condition);0<=n?e.addChildAt(t,n):e.addChild(t)}this._selectLayout=t}return t},enumerable:!1,configurable:!0}),e.prototype.newSelectLayout=function(){var t=this.select;return null!=t?this.newLabeled("",t):null},Object.defineProperty(e.prototype,"inputs",{get:function(){var t=this._inputs;return void 0===t&&(t=this.newInputs(),this._inputs=t),t},enumerable:!1,configurable:!0}),e.prototype.newInputs=function(){var t=[],e=this._extension.inputs;if(null!=e)for(var n=0,i=e.length;n<i;++n)if(e[n].type===Fe.TEXT){var o=this.newInputText();t.push(o)}return t},e.prototype.newInputText=function(){var e=this;return new t.DInputText({weight:1,on:{enter:function(){e.ok()}}})},e.prototype.newLabel=function(e){return new t.DInputLabel({width:60,text:{value:e}})},e.prototype.newSpace=function(){return new t.DLayoutSpace({width:60})},e.prototype.newLabeled=function(e,n){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[null!=e?this.newLabel(e):this.newSpace(),n,this.newSpace()]})},Object.defineProperty(e.prototype,"inputLayouts",{get:function(){var t=this._inputLayouts;return void 0===t&&(t=this.newInputLayouts(),this._inputLayouts=t),t},enumerable:!1,configurable:!0}),e.prototype.newInputLayouts=function(){var t=[],e=this.inputs,n=this._layout,i=this._extension.inputs;if(null!=i)for(var o=n.getChildIndex(this._condition),r=0,a=e.length;r<a;++r){var l=this.newLabeled(i[r].label,e[r]);t.push(l),0<=o?n.addChildAt(l,o+1+r):n.addChild(l)}return t},Object.defineProperty(e.prototype,"value",{get:function(){return this._extension.toValue(this.select,this._condition.input,this.inputs)},set:function(t){null!=t&&this._extension.fromValue(t,this.select,this._condition.input,this.inputs)},enumerable:!1,configurable:!0}),e.prototype.show=function(){var t=this.selectLayout;null!=t&&t.show();var e=this.inputLayouts;if(0<e.length){var n=this._extension;if(null!=n.onShow)n.onShow(e);else for(var i=0,o=e.length;i<o;++i)e[i].show()}},e.prototype.hide=function(){var t=this._selectLayout;null!=t&&t.hide();var e=this._inputLayouts;if(null!=e)for(var n=0,i=e.length;n<i;++n)e[n].hide()},e.prototype.reset=function(){var t=this._select;if(t){var e=this._extension.items;null!=e&&0<e.length?t.value=e[0].type:t.value=null}var n=this._inputs;if(n){var i=this._extension.inputs;if(null!=i)for(var o=0,r=n.length;o<r;++o)n[o].value=i[o].initial||""}},e.prototype.ok=function(){this._dialog.ok()},e}(),ze=function(){function t(t,e,n){this._data=new Map,this._dialog=t,this._condition=e,this._layout=n}return Object.defineProperty(t.prototype,"value",{get:function(){var t=this._selected;return t?t.value:null},set:function(t){if(null!=t){var e=this._data.get(t.type);null!=e&&(e.value=t)}},enumerable:!1,configurable:!0}),t.prototype.get=function(t){var e=this._data,n=e.get(t);if(null!=n)return n;var i=Ne.get(t);return null==i?null:(n=new je(i,this._dialog,this._condition,this._layout),e.set(t,n),n)},t.prototype.show=function(t){if(null!=t){var e=this.get(t);if(null!=e){var n=this._selected;n!==e&&(null!=n&&n.hide(),this._selected=e,e.show())}else this.hide()}else this.hide()},t.prototype.hide=function(){var t=this._selected;null!=t&&(t.hide(),this._selected=null)},t.prototype.reset=function(){this._data.forEach((function(t){t.reset()}))},t.prototype.onChange=function(t){this.show(t)},t}(),He=function(t){return"extension_icon_".concat(t)},Ge=function(){function e(){}return e.add=function(e){var n,i;if("type"in e){var o=e.type;(null!==(n=this._typeToExtension)&&void 0!==n?n:this._typeToExtension=new Map).set(o,e);var r=e.deserializer;null!=r&&(t.EShapeDeserializers[o]=r);var a=e.onDeserialized;null!=a&&(t.EShapeOnDeserializeds[o]=a);var l=e.runtime;l&&(t.EShapeRuntimes[o]=l);var u=e.capability;null!=u&&t.EShapeCapabilities.set(o,u);var s=e.uploaded;null!=s?t.EShapeUploadeds[o]=s:null==t.EShapeUploadeds[o]&&(t.EShapeUploadeds[o]=t.createGroupUploaded)}(null!==(i=this._extensions)&&void 0!==i?i:this._extensions=[]).push(e)},e.get=function(t){var e=this._typeToExtension;if(null!=e)return e.get(t)},e.each=function(t){var e=this._extensions;if(null!=e)for(var n=0,i=e.length;n<i;++n)t(e[n])},e.merge=function(t){var e=this._extensions;if(null!=e)for(var n=0,i=e.length;n<i;++n){var o=e[n];if("icon"in o){var r=o.icon;t.add(He(n),r.width,r.height,r.svg)}}},e.build=function(t){var e=this._extensions;if(null!=e)for(var n=0,i=e.length;n<i;++n){var o=e[n];"icon"in o&&(o.icon.texture=t[He(n)])}},e}(),Ue=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.getProperty=function(e,n){return e instanceof t.EShapeEmbeddedAcceptorEdge?e.side:t.EShapeAcceptorEdgeSide.NONE},n.prototype.setProperty=function(e,n,i){e instanceof t.EShapeEmbeddedAcceptorEdge&&(e.side=i)},n}(ut),Ye=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.getProperty=function(e,n){return e instanceof t.EShapeEmbeddedAcceptorEdge?e.subtype:t.EShapeAcceptorEdgeType.HEAD},n.prototype.setProperty=function(e,n,i){e instanceof t.EShapeEmbeddedAcceptorEdge&&(e.subtype=i)},n}(ut),Xe=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.getProperty=function(e,n){return e instanceof t.EShapeEmbeddedAcceptorEdge&&e.vvisible},n.prototype.setProperty=function(e,n,i){e instanceof t.EShapeEmbeddedAcceptorEdge&&(e.vvisible=i)},n}(ut),We=function(e){function n(t){var n=e.call(this,t)||this;n._icons=t.icons;var i=t.selection;return n._selection=i,n._diagram=t.diagram,n.initLayout(),n}return i(n,e),n.prototype.initLayout=function(){var e=this;this.content.setHeight("padding"),new t.DLayoutVertical({parent:this.content,x:"padding",y:"padding",width:"padding",height:"padding",children:[this.newTextLabel(),this.selectSubtype,this.selectSide,this.checkVvisible]});var n=this._selection;this.state.isDisabled=n.isEmpty(),n.on("change",(function(){e.state.isDisabled=n.isEmpty(),e.onSelectionChange(n)})),this.onSelectionChange(n)},n.prototype.newTextLabel=function(){return new t.DText({width:"100%",text:{value:this.subtheme.getLabel()}})},Object.defineProperty(n.prototype,"selectSubtype",{get:function(){var t;return null!==(t=this._selectSubtype)&&void 0!==t?t:this._selectSubtype=this.newSelectSubtype()},enumerable:!1,configurable:!0}),n.prototype.newSelectSubtype=function(){var e=this,n=this.subtheme;return new t.DSelect({width:"padding",value:t.EShapeAcceptorEdgeType.HEAD,menu:{items:[{value:t.EShapeAcceptorEdgeType.HEAD,text:{value:n.toSelectSubtypeLabel(t.EShapeAcceptorEdgeType.HEAD)}},{value:t.EShapeAcceptorEdgeType.TAIL,text:{value:n.toSelectSubtypeLabel(t.EShapeAcceptorEdgeType.TAIL)}},{value:t.EShapeAcceptorEdgeType.ALL,text:{value:n.toSelectSubtypeLabel(t.EShapeAcceptorEdgeType.ALL)}}]},on:{change:function(t){e.onSelectSubtypeChanged(t)}}})},n.prototype.onSelectSubtypeChanged=function(e){t.DControllers.getCommandController().push(new Ye(this._selection,e))},Object.defineProperty(n.prototype,"selectSide",{get:function(){var t;return null!==(t=this._selectSide)&&void 0!==t?t:this._selectSide=this.newSelectSide()},enumerable:!1,configurable:!0}),n.prototype.newSelectSide=function(){var e=this,n=this.subtheme;return new t.DSelectMultiple({width:"padding",values:[t.EShapeAcceptorEdgeSide.LEFT],menu:{items:[{value:t.EShapeAcceptorEdgeSide.LEFT,text:{value:n.toSelectSideLabel(t.EShapeAcceptorEdgeSide.LEFT)},check:!0},{value:t.EShapeAcceptorEdgeSide.TOP,text:{value:n.toSelectSideLabel(t.EShapeAcceptorEdgeSide.TOP)},check:!0},{value:t.EShapeAcceptorEdgeSide.RIGHT,text:{value:n.toSelectSideLabel(t.EShapeAcceptorEdgeSide.RIGHT)},check:!0},{value:t.EShapeAcceptorEdgeSide.BOTTOM,text:{value:n.toSelectSideLabel(t.EShapeAcceptorEdgeSide.BOTTOM)},check:!0}]},on:{change:function(t){e.onSelectSideChange(t)}}})},n.prototype.onSelectSideChange=function(e){t.DControllers.getCommandController().push(new Ue(this._selection,this.fromSelectSideValues(e)))},n.prototype.toSelectSideValues=function(e){var n=[];return e&t.EShapeAcceptorEdgeSide.LEFT&&n.push(t.EShapeAcceptorEdgeSide.LEFT),e&t.EShapeAcceptorEdgeSide.TOP&&n.push(t.EShapeAcceptorEdgeSide.TOP),e&t.EShapeAcceptorEdgeSide.RIGHT&&n.push(t.EShapeAcceptorEdgeSide.RIGHT),e&t.EShapeAcceptorEdgeSide.BOTTOM&&n.push(t.EShapeAcceptorEdgeSide.BOTTOM),n},n.prototype.fromSelectSideValues=function(e){for(var n=t.EShapeAcceptorEdgeSide.NONE,i=0,o=e.length;i<o;++i)n|=e[i];return n},Object.defineProperty(n.prototype,"checkVvisible",{get:function(){var t;return null!==(t=this._checkVvisible)&&void 0!==t?t:this._checkVvisible=this.newCheckIsVvisible()},enumerable:!1,configurable:!0}),n.prototype.newCheckIsVvisible=function(){var e=this;return new t.DButtonCheckRight({width:"padding",text:{value:this.subtheme.getCheckIsVvisibleLabel()},on:{active:function(){e.onCheckVvisibleChanged(!0)},inactive:function(){e.onCheckVvisibleChanged(!1)}}})},n.prototype.onCheckVvisibleChanged=function(e){t.DControllers.getCommandController().push(new Xe(this._selection,e))},n.prototype.onSelectionChange=function(e){var n=this.selectSubtype,i=this.selectSide,o=this.checkVvisible,r=e.last();r instanceof t.EShapeEmbeddedAcceptorEdge?(n.value=r.subtype,n.state.isEnabled=!0,i.values=this.toSelectSideValues(r.side),i.state.isEnabled=!0,o.state.isActive=r.vvisible,o.state.isEnabled=!0):(n.state.isEnabled=!1,i.state.isEnabled=!1,o.state.isEnabled=!1)},Object.defineProperty(n.prototype,"subtheme",{get:function(){var t;return null!==(t=this._subtheme)&&void 0!==t?t:this._subtheme=this.newSubtheme()},enumerable:!1,configurable:!0}),n.prototype.newSubtheme=function(){return t.DThemes.get("EEditorShapeEmbeddedAcceptorEdge")},n}(t.DPane),Ke=function(){function e(){}return e.getTheme=function(){return t.DThemes.get("EShapeEmbeddedAcceptorEdge")},e.create=function(e){var n=new t.EShapeEmbeddedAcceptorEdge;return e?n.copy(e):(n.subtype=t.EShapeAcceptorEdgeType.HEAD,n.side=t.EShapeAcceptorEdgeSide.LEFT,n.vvisible=!0,n.stroke.set(!1,3381759,1),n.fill.set(!0,3381759,1)),n},e.load=function(){var n=this.getTheme().getName();Ge.add({type:t.EShapeType.EMBEDDED_ACCEPTOR_EDGE,name:n,icon:{width:24,height:24,svg:'<g transform="scale(0.667,0.667) translate(480, 480) rotate(+90) translate(-480, 480)" fill="#fff" stroke="none"><path d="M480-640 280-440l56 56 104-103v407h80v-407l104 103 56-56-200-200ZM146-260q-32-49-49-105T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 59-17 115t-49 105l-58-58q22-37 33-78t11-84q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 43 11 84t33 78l-58 58Z"/></g>'},title:n,creator:function(t){return e.create(t)},editor:We})},e}(),Ze=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.getProperty=function(e,n){return e instanceof t.EShapeButton&&e.state.isActive},n.prototype.setProperty=function(e,n,i){e instanceof t.EShapeButton&&(e.state.isActive=i)},n}(ut),qe=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.getProperty=function(e,n){return e instanceof t.EShapeButton&&e.isGrouped},n.prototype.setProperty=function(e,n,i){e instanceof t.EShapeButton&&(e.isGrouped=i)},n}(ut),Je=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.getProperty=function(e,n){return e instanceof t.EShapeButton&&e.isToggle},n.prototype.setProperty=function(e,n,i){e instanceof t.EShapeButton&&(e.isToggle=i)},n}(ut),Qe=function(e){function n(t){var n=e.call(this,t)||this;n._icons=t.icons;var i=t.selection;return n._selection=i,n._diagram=t.diagram,n.initLayout(),n}return i(n,e),n.prototype.initLayout=function(){var e=this;this.content.setHeight("padding"),new t.DLayoutVertical({parent:this.content,x:"padding",y:"padding",width:"padding",height:"padding",children:[this.newTextLabel(),this.checkIsToggle,this.checkIsGrouped,this.checkIsActive]});var n=this._selection;this.state.isDisabled=n.isEmpty(),n.on("change",(function(){e.state.isDisabled=n.isEmpty(),e.onSelectionChange(n)})),this.onSelectionChange(n)},n.prototype.newTextLabel=function(){return new t.DText({width:"100%",text:{value:this.subtheme.getLabel()}})},Object.defineProperty(n.prototype,"checkIsToggle",{get:function(){var t;return null!==(t=this._checkIsToggle)&&void 0!==t?t:this._checkIsToggle=this.newCheckIsToggle()},enumerable:!1,configurable:!0}),n.prototype.newCheckIsToggle=function(){var e=this;return new t.DButtonCheckRight({width:"padding",text:{value:this.subtheme.getCheckIsToggleLabel()},on:{active:function(){e.onCheckIsToggleChanged(!0)},inactive:function(){e.onCheckIsToggleChanged(!1)}}})},n.prototype.onCheckIsToggleChanged=function(e){t.DControllers.getCommandController().push(new Je(this._selection,e))},n.prototype.onSelectionChangeCheckIsToggle=function(e){var n=this.checkIsToggle.state,i=e.last();i instanceof t.EShapeButton?(n.lock(),n.isActive=i.isToggle,n.isDisabled=!1,n.unlock()):n.isDisabled=!0},Object.defineProperty(n.prototype,"checkIsGrouped",{get:function(){var t;return null!==(t=this._checkIsGrouped)&&void 0!==t?t:this._checkIsGrouped=this.newCheckIsGrouped()},enumerable:!1,configurable:!0}),n.prototype.newCheckIsGrouped=function(){var e=this;return new t.DButtonCheckRight({width:"padding",text:{value:this.subtheme.getCheckIsGroupedLabel()},on:{active:function(){e.onCheckIsGroupedChanged(!0)},inactive:function(){e.onCheckIsGroupedChanged(!1)}}})},n.prototype.onCheckIsGroupedChanged=function(e){t.DControllers.getCommandController().push(new qe(this._selection,e))},n.prototype.onSelectionChangeCheckIsGrouped=function(e){var n=this.checkIsGrouped.state,i=e.last();i instanceof t.EShapeButton?(n.lock(),n.isActive=i.isGrouped,n.isDisabled=!1,n.unlock()):n.isDisabled=!0},Object.defineProperty(n.prototype,"checkIsActive",{get:function(){var t;return null!==(t=this._checkIsActive)&&void 0!==t?t:this._checkIsActive=this.newCheckIsActive()},enumerable:!1,configurable:!0}),n.prototype.newCheckIsActive=function(){var e=this;return new t.DButtonCheckRight({width:"padding",text:{value:this.subtheme.getCheckIsActiveLabel()},on:{active:function(){e.onCheckIsActiveChanged(!0)},inactive:function(){e.onCheckIsActiveChanged(!1)}}})},n.prototype.onCheckIsActiveChanged=function(e){t.DControllers.getCommandController().push(new Ze(this._selection,e))},n.prototype.onSelectionChangeCheckIsActive=function(e){var n=this.checkIsActive.state,i=e.last();i instanceof t.EShapeButton?(n.lock(),n.isActive=i.state.isActive,n.isDisabled=!1,n.unlock()):n.isDisabled=!0},n.prototype.onSelectionChange=function(t){this.onSelectionChangeCheckIsToggle(t),this.onSelectionChangeCheckIsGrouped(t),this.onSelectionChangeCheckIsActive(t)},Object.defineProperty(n.prototype,"subtheme",{get:function(){var t;return null!==(t=this._subtheme)&&void 0!==t?t:this._subtheme=this.newSubtheme()},enumerable:!1,configurable:!0}),n.prototype.newSubtheme=function(){return t.DThemes.get("EEditorShapeButton")},n}(t.DPane),$e=function(){function e(){}return e.getTheme=function(){return t.DThemes.get("EShapeButton")},e.create=function(e){var n=new t.EShapeButton;if(e)n.copy(e);else{var i=this.getTheme().getLabel();n.stroke.set(!1,3381759,1),n.fill.set(!0,3381759,1),n.text.set(i,16777215,1),n.cursor="pointer",n.state.isFocusable=!0,n.interactive=!0}return n},e.load=function(){var n=this.getTheme().getName();Ge.add({type:t.EShapeType.BUTTON,name:n,icon:{width:24,height:24,svg:'<g transform="scale(26.6666)" fill="#fff" stroke="none"><path d="M22,9v6c0,1.1-0.9,2-2,2h-1l0-2h1V9H4v6h6v2H4c-1.1,0-2-0.9-2-2V9c0-1.1,0.9-2,2-2h16C21.1,7,22,7.9,22,9z M14.5,19 l1.09-2.41L18,15.5l-2.41-1.09L14.5,12l-1.09,2.41L11,15.5l2.41,1.09L14.5,19z M17,14l0.62-1.38L19,12l-1.38-0.62L17,10l-0.62,1.38 L15,12l1.38,0.62L17,14z M14.5,19l1.09-2.41L18,15.5l-2.41-1.09L14.5,12l-1.09,2.41L11,15.5l2.41,1.09L14.5,19z M17,14l0.62-1.38 L19,12l-1.38-0.62L17,10l-0.62,1.38L15,12l1.38,0.62L17,14z"/></g>'},title:n,creator:function(t){return e.create(t)},editor:Qe})},e}(),tn=function(){function e(e,n,i,o,r,a){this.label=e,this.weight=n,this.layers=i,this.bringToFront=o,this.isGrouped=r,this.isActive=a,this.action=new t.EShapeActionValueShowHideLayer("isActive",i,o)}return e.prototype.isEquals=function(t){if(this.label!==t.label)return!1;if(this.weight!==t.weight)return!1;if(this.bringToFront!==t.bringToFront)return!1;if(this.isGrouped!==t.isGrouped)return!1;if(this.isActive!==t.isActive)return!1;var e=this.layers,n=e.length,i=t.layers;if(n!==i.length)return!1;for(var o=0;o<n;++o)if(e[o]!==i[o])return!1;return!0},e.prototype.serizlize=function(t){var e=this.serializedLayers(t),n=(this.bringToFront?1:0)|(this.isGrouped?2:0)|(this.isActive?4:0);return t.addResource("[".concat(t.addResource(this.label),",").concat(this.weight,",").concat(e,",").concat(n,"]"))},e.prototype.serializedLayers=function(t){for(var e=this.layers,n="[",i="",o=0,r=e.length;o<r;++o)n+=i+e[o],i=",";return n+="]",t.addResource(n)},e.deserialize=function(t,n){var i=n.resources;if(0<=t&&t<i.length){var o=n.getExtension(t);return null==o&&(o=JSON.parse(i[t]),n.setExtension(t,o)),new e(i[o[0]],o[1],this.deserializeLayers(o[2],n),!!(1&o[3]),!!(2&o[3]),!!(4&o[3]))}return null},e.deserializeLayers=function(t,e){var n=[],i=e.resources,o=i.length;if(0<=t&&t<o){var r=e.getExtension(t);null==r&&(r=JSON.parse(i[t]),e.setExtension(t,r));for(var a=0,l=r.length;a<l;++a)n.push(r[a])}return n},e}(),en=function(){function t(t){this._values=[],this._sizeX=1,this._margin=2,this._onChange=t}return Object.defineProperty(t.prototype,"values",{get:function(){return this._values},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"margin",{get:function(){return this._margin},set:function(t){this._margin!==t&&(this._margin=t,this._onChange())},enumerable:!1,configurable:!0}),t.prototype.add=function(t,e){null!=e?this._values.splice(e,0,t):this._values.push(t),this._onChange()},t.prototype.remove=function(t){var e=this._values;if(0<=t&&t<e.length){var n=e.splice(t,1)[0];return this._onChange(),n}return null},t.prototype.indexOf=function(t){for(var e=this._values,n=0,i=e.length;n<i;++n)if(e[n]===t)return n;for(n=0,i=e.length;n<i;++n)if(e[n].isEquals(t))return n;return-1},t.prototype.get=function(t){var e=this._values[t];return null!=e?e:null},t.prototype.set=function(t,e){this._values[t]=e,this._onChange()},t.prototype.swap=function(t,e){var n=this._values,i=n[e];n[e]=n[t],n[t]=i,this._onChange()},t.prototype.size=function(){return this._values.length},t.prototype.copy=function(t){for(var e=this._values,n=t._values,i=n.length,o=0;o<i;++o)e[o]=n[o];return e.length!==i&&(e.length=i),this._sizeX=t._sizeX,this._onChange(),this},t.prototype.serialize=function(t){for(var e="",n="[",i=this._values,o=0,r=i.length;o<r;++o)e+=n+i[o].serizlize(t),n=",";return e+=n+this._margin+"]",t.addResource(e)},t.prototype.deserialize=function(t,e){var n=e.resources;if(0<=t&&t<n.length){var i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i));var o=!1,r=this._values;0<r.length&&(r.length=0,o=!0);for(var a=0,l=i.length-1;a<l;++a){var u=tn.deserialize(i[a],e);null!=u&&r.push(u)}var s=i[i.length-1];this._margin!==s&&(this._margin=s,o=!0),0<r.length&&(o=!0),o&&this._onChange()}},t}(),nn=function(){function e(){}return e.ID=t.EShapeType.EXTENSION+200,e}(),on=function(e){function n(n,i){void 0===i&&(i=nn.ID);var o=e.call(this,n,i)||this;return o._button=new en((function(){o.onButtonValueChange()})),o._corner=t.EShapeCorner.ALL,o}return i(n,e),Object.defineProperty(n.prototype,"button",{get:function(){return this._button},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"corner",{get:function(){return this._corner},set:function(t){this._corner!==t&&(this._corner=t,this.updateUploaded())},enumerable:!1,configurable:!0}),n.prototype.onButtonValueChange=function(){this.newButtons(),this.layoutButtons()},n.prototype.onSizeChange=function(){e.prototype.onSizeChange.call(this),this.layoutButtons()},n.prototype.newButtons=function(){var e=this.button,n=e.size(),i=e.values,o=this.children,r=o.length;if(r<n)for(var a=0<r?o[r-1]:null,l=r;l<n;++l){var u=new t.EShapeButton,s=i[l];null!=a?(u.copy(a),u.text.value=s.label):(u.stroke.set(!1,3381759,1),u.fill.set(!0,3381759,1),u.text.set(s.label,16777215,1),u.state.isFocusable=!0,u.interactive=!0),0<u.action.size()?u.action.set(0,s.action):u.action.add(s.action),u.isToggle=!0,u.isGrouped=!0,u.attach(this)}else if(n<r)for(l=r-1;n<=l;--l)o[l].detach();var p=this.corner;for(l=0;l<n;++l){var h=o[l];s=i[l],h.corner=this.toCorner(l,n,p),h.text.value=s.label,0<h.action.size()?h.action.set(0,s.action):h.action.add(s.action),h.state.isActive=s.isActive}},n.prototype.layoutButtons=function(){for(var e=this.button,n=e.values,i=n.length,o=e.margin,r=this.size,a=r.x,l=r.y,u=this.children,s=u.length,p=0,h=0;h<i;++h)p+=n[h].weight;p=Math.max(1e-4,p);var c=Math.max(0,a-(i-1)*o)/p,d=.5*-a;for(h=0;h<s;++h){var g=n[h].weight*c,f=u[h];f.lock(t.EShapeLockPart.ALL),f.size.set(g,l),f.transform.position.set(d+.5*g,0),f.unlock(t.EShapeLockPart.ALL,!0),d+=g+o}},n.prototype.toCorner=function(e,n,i){var o=t.EShapeCorner.NONE;return 0===e&&(o|=t.EShapeCorner.LEFT&i),e===n-1&&(o|=t.EShapeCorner.RIGHT&i),o},n.prototype.copy=function(i,o){void 0===o&&(o=t.EShapeCopyPart.ALL);var r=e.prototype.copy.call(this,i,o);return i instanceof n&&this._button.copy(i.button),r},n.prototype.serialize=function(t){var n=e.prototype.serialize.call(this,t),i=n[15];return n[15]=t.addResource("[".concat(this._button.serialize(t),",").concat(i,"]")),n},n}(t.EShapeGroupShadowed),rn=function(t){function e(e,n){var i=t.call(this)||this;return i._selection=n,i._value=e,i}return i(e,t),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){for(var t=this._value,e=this._selection.get(),n=0,i=e.length;n<i;++n){var o=e[n];o instanceof on&&o.button.add(t)}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._selection.get(),e=0,n=t.length;e<n;++e){var i=t[e];i instanceof on&&i.button.remove(i.button.size()-1)}return this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),an=function(t){function e(e,n){var i=t.call(this)||this;i._selection=n,i._target=e;for(var o=[],r=i._selection.get(),a=0,l=r.length;a<l;++a){var u=r[a];if(u instanceof on){var s=u.button.indexOf(e);o.push(s),0<s&&u.button.swap(s-1,s)}}return i._indices=o,i._selection.update("PROPERTY"),i}return i(e,t),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._selection.get(),e=this._indices,n=0,i=t.length;n<i;++n){var o=t[n];if(o instanceof on){var r=e[n];0<r&&o.button.swap(r-1,r)}}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),ln=function(t){function e(e,n){for(var i=t.call(this)||this,o=n.get(),r=[],a=0,l=o.length;a<l;++a){var u=o[a];u instanceof on?(r.push(u.button.margin),u.button.margin=e):r.push(0)}return i._values=r,i._selection=n,i}return i(e,t),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._selection,e=t.get(),n=[],i=0,o=e.length;i<o;++i){var r=e[i];if(r instanceof on){var a=n[i];n[i]=r.button.margin,r.button.margin=a}}return t.update("PROPERTY"),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),un=function(t){function e(e,n){var i=t.call(this)||this;i._selection=n,i._target=e;for(var o=[],r=i._selection.get(),a=0,l=r.length;a<l;++a){var u=r[a];if(u instanceof on){var s=u.button.indexOf(e);o.push(s),0<=s&&u.button.remove(s)}}return i._indices=o,i._selection.update("PROPERTY"),i}return i(e,t),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._indices,e=this._selection.get(),n=0,i=e.length;n<i;++n){var o=e[n];if(o instanceof on){var r=t[n];0<=r&&o.button.remove(r)}}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._target,e=this._indices,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i];if(r instanceof on){var a=e[i];0<=a&&r.button.add(t,a)}}return this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),sn=function(t){function e(e,n,i,o){var r=t.call(this)||this;r._selection=i,r._oldValue=e,r._newValue=n,r._list=o;for(var a=[],l=[],u=r._selection.get(),s=0,p=u.length;s<p;++s){var h=u[s];if(h instanceof on){var c=h.button.indexOf(e);a.push(c),0<=c?(l.push(h.button.get(c)),h.button.set(c,n)):l.push(n)}else a.push(-1),l.push(n)}return r._indices=a,r._oldValues=l,o.data.selection.contains(e)&&o.data.selection.clearAndAdd(n),r._selection.update("PROPERTY"),r}return i(e,t),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._newValue,e=this._indices,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i];if(r instanceof on){var a=e[i];0<=a&&r.button.set(a,t)}}var l=this._list;return l.data.selection.contains(this._oldValue)&&l.data.selection.clearAndAdd(t),this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._indices,e=this._oldValues,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i];if(r instanceof on){var a=t[i];0<=a&&r.button.set(a,e[i])}}var l=this._list;return l.data.selection.contains(this._newValue)&&l.data.selection.clearAndAdd(this._oldValue),this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),pn=function(t){function e(e,n){var i=t.call(this)||this;i._selection=n,i._target=e;for(var o=[],r=i._selection.get(),a=0,l=r.length;a<l;++a){var u=r[a];if(u instanceof on){var s=u.button,p=s.indexOf(e);o.push(p),0<=p&&p<s.size()-1&&s.swap(p+1,p)}else o.push(-1)}return i._indices=o,i._selection.update("PROPERTY"),i}return i(e,t),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._selection.get(),e=this._indices,n=0,i=t.length;n<i;++n){var o=t[n];if(o instanceof on){var r=o.button,a=e[n];0<=a&&a<r.size()-1&&r.swap(a+1,a)}}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),hn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.newContentChildren=function(t,n){var i=e.prototype.newContentChildren.call(this,t,n);return i.push(this.inputLabel,this.inputWidth,this.newLayoutOf(t.getSelectLayerLabel(),this.selectLayer),this.newLayoutOf(null,this.checkBringToFront),this.newLayoutOf(null,this.checkIsGrouped),this.newLayoutOf(null,this.checkIsActive)),i},n.prototype.newLayoutOf=function(e,n){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLayoutLabel(e),n,this.newLayoutSpace()]})},n.prototype.newLayoutLabel=function(e){return null!=e?new t.DInputLabel({width:60,text:{value:e}}):this.newLayoutSpace()},n.prototype.newLayoutSpace=function(){return new t.DLayoutSpace({width:60})},Object.defineProperty(n.prototype,"inputLabel",{get:function(){var t;return null!==(t=this._inputLabel)&&void 0!==t?t:this._inputLabel=this.newInputLabel()},enumerable:!1,configurable:!0}),n.prototype.newInputLabel=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputLabelLabel()}},input:{weight:1,text:{value:""},on:{enter:function(){e.ok()}}},space:{width:60}})},Object.defineProperty(n.prototype,"inputWidth",{get:function(){var t;return null!==(t=this._inputWidth)&&void 0!==t?t:this._inputWidth=this.newInputWidth()},enumerable:!1,configurable:!0}),n.prototype.newInputWidth=function(){var e=this;return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputWidthLabel()}},input:{weight:1,text:{value:0},min:0,on:{enter:function(){e.ok()}}},space:{width:60}})},Object.defineProperty(n.prototype,"selectLayer",{get:function(){var t;return null!==(t=this._selectLayer)&&void 0!==t?t:this._selectLayer=this.newSelectLayer()},enumerable:!1,configurable:!0}),n.prototype.newSelectLayer=function(){return new t.DSelectMultiple({weight:1})},n.prototype.newSelectLayerMenuItemOptions=function(){var t,e=null===(t=this.options)||void 0===t?void 0:t.diagram;if(null!=e){var n=e.canvas;if(null!=n){for(var i=[],o=n.layer.children,r=o.length-1;0<=r;--r){var a=o[r];i.push({value:r,text:{value:a.name},check:!0})}return i}}return[]},Object.defineProperty(n.prototype,"checkBringToFront",{get:function(){var t;return null!==(t=this._checkBringToFront)&&void 0!==t?t:this._checkBringToFront=this.newCheckBringToFront()},enumerable:!1,configurable:!0}),n.prototype.newCheckBringToFront=function(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckBringToFromLabel(),align:{horizontal:"LEFT"}}})},Object.defineProperty(n.prototype,"checkIsGrouped",{get:function(){var t;return null!==(t=this._checkIsGrouped)&&void 0!==t?t:this._checkIsGrouped=this.newCheckIsGrouped()},enumerable:!1,configurable:!0}),n.prototype.newCheckIsGrouped=function(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckIsGroupedLabel(),align:{horizontal:"LEFT"}}})},Object.defineProperty(n.prototype,"checkIsActive",{get:function(){var t;return null!==(t=this._checkIsActive)&&void 0!==t?t:this._checkIsActive=this.newCheckIsActive()},enumerable:!1,configurable:!0}),n.prototype.newCheckIsActive=function(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckIsActiveLabel(),align:{horizontal:"LEFT"}}})},n.prototype.reset=function(){return this.inputLabel.input.value=this.theme.newInputLabel(),this.inputWidth.input.value=1,this.selectLayer.values=[],this.selectLayer.menu=new t.DMenu({fit:!0,items:this.newSelectLayerMenuItemOptions()}),this.checkBringToFront.state.isActive=!1,this.checkIsGrouped.state.isActive=!0,this},Object.defineProperty(n.prototype,"value",{get:function(){return new tn(this.inputLabel.input.value,this.inputWidth.input.value,this.selectLayer.values.slice(0),this.checkBringToFront.state.isActive,this.checkIsGrouped.state.isActive,this.checkIsActive.state.isActive)},set:function(e){this.selectLayer.menu=new t.DMenu({fit:!0,items:this.newSelectLayerMenuItemOptions()}),null!=e&&(this.inputLabel.input.value=e.label,this.inputWidth.input.value=e.weight,this.selectLayer.values=e.layers,this.checkBringToFront.state.isActive=e.bringToFront,this.checkIsGrouped.state.isActive=e.isGrouped,this.checkIsActive.state.isActive=e.isActive)},enumerable:!1,configurable:!0}),n.prototype.getResolvedValue=function(){return this.value},n.prototype.getType=function(){return"EDialogShapeButtonLayerValue"},n}(t.DDialogLayered),cn=function(e){function n(t){var n=e.call(this,t)||this;n._icons=t.icons;var i=t.selection;return n._selection=i,n._diagram=t.diagram,n.initLayout(),n}return i(n,e),n.prototype.initLayout=function(){var e=this;this.content.setHeight("padding"),new t.DLayoutVertical({parent:this.content,x:"padding",y:"padding",width:"padding",height:"padding",children:[new t.DLayoutHorizontal({width:"100%",height:"auto",children:[this.newTextLabel(),this.buttonNew,this.buttonDelete,this.buttonBringForward,this.buttonSendBackward]}),this.columnList,this.inputMargin]});var n=this._selection;this.state.isDisabled=n.isEmpty(),n.on("change",(function(){e.state.isDisabled=n.isEmpty(),e.onSelectionChange(n)}));var i=this.columnList;i.data.selection.on("change",(function(){e.onListSelectionChange(i)})),this.onSelectionChange(n)},n.prototype.newTextLabel=function(){return new t.DText({weight:1,text:{value:this.subtheme.getLabel()}})},Object.defineProperty(n.prototype,"buttonNew",{get:function(){var t;return null!==(t=this._buttonNew)&&void 0!==t?t:this._buttonNew=this.newButtonNew()},enumerable:!1,configurable:!0}),n.prototype.newButtonNew=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.subtheme.getButtonNewTitle(),on:{active:function(t){e.onButtonNewActive(t)}}})},n.prototype.onButtonNewActive=function(e){var n=this;this.dialogButton.reset().open(e).then((function(e){null!=e&&t.DControllers.getCommandController().push(new rn(e,n._selection))}))},n.prototype.onSelectionChangeButtonNew=function(t){var e=this.buttonNew;t.last()instanceof on?e.state.isDisabled=!1:e.state.isDisabled=!0},Object.defineProperty(n.prototype,"buttonDelete",{get:function(){var t;return null!==(t=this._buttonDelete)&&void 0!==t?t:this._buttonDelete=this.newButtonDelete()},enumerable:!1,configurable:!0}),n.prototype.newButtonDelete=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.subtheme.getButtonDeleteTitle(),on:{active:function(){var n=e.columnList,i=n.data.selection.first;null!=i&&1<n.data.size()&&t.DControllers.getCommandController().push(new un(i,e._selection))}}})},n.prototype.onListSelectionChangeButtonDelete=function(t){this.buttonDelete.state.isDisabled=t.data.size()<=1||t.data.selection.isEmpty()},Object.defineProperty(n.prototype,"buttonBringForward",{get:function(){var t;return null!==(t=this._buttonBringForward)&&void 0!==t?t:this._buttonBringForward=this.newButtonBringForward()},enumerable:!1,configurable:!0}),n.prototype.newButtonBringForward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.subtheme.getButtonBringForwardTitle(),on:{active:function(){var n=e.columnList,i=n.selection.first;null!=i&&n.data.items[0]!==i&&t.DControllers.getCommandController().push(new an(i,e._selection))}}})},n.prototype.onListSelectionChangeButtonBringForward=function(t){var e=t.data.selection.first,n=t.data.items;this.buttonBringForward.state.isDisabled=null==e||n[0]===e},Object.defineProperty(n.prototype,"buttonSendBackward",{get:function(){var t;return null!==(t=this._buttonSendBackward)&&void 0!==t?t:this._buttonSendBackward=this.newButtonSendBackward()},enumerable:!1,configurable:!0}),n.prototype.newButtonSendBackward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.subtheme.getButtonSendBackwardTitle(),on:{active:function(){var n=e.columnList,i=n.selection.first,o=n.data.items;null!=i&&o[o.length-1]!==i&&t.DControllers.getCommandController().push(new pn(i,e._selection))}}})},n.prototype.onListSelectionChangeButtonSendBackward=function(t){var e=t.selection.first,n=t.data.items;this.buttonSendBackward.state.isDisabled=null==e||n[n.length-1]===e},Object.defineProperty(n.prototype,"dialogButton",{get:function(){var t;return null!==(t=this._dialogButton)&&void 0!==t?t:this._dialogButton=this.newDialogButton()},enumerable:!1,configurable:!0}),n.prototype.newDialogButton=function(){return new hn({diagram:this._diagram})},Object.defineProperty(n.prototype,"columnList",{get:function(){var t;return null!==(t=this._columnList)&&void 0!==t?t:this._columnList=this.newColumnList()},enumerable:!1,configurable:!0}),n.prototype.newColumnList=function(){var e=this,n=new t.DList({width:"100%",weight:1,data:{toLabel:function(t){return t.label}},updater:{newItem:function(i){return new t.DListItem(i,{on:{dblclick:function(t,i,o){e.onColumnListDblClick(t,i,o,n)}}})}}});return n},n.prototype.onColumnListDblClick=function(e,n,i,o){var r=this,a=i.value;if(null!=a){var l=this.dialogButton;l.value=a,l.open(i).then((function(e){null!=e&&t.DControllers.getCommandController().push(new sn(a,e,r._selection,o))}))}},n.prototype.onSelectionChangeColumnList=function(t){var e=t.last(),n=this.columnList;n.data.items=e instanceof on?e.button.values:[],this.onListSelectionChange(n)},Object.defineProperty(n.prototype,"inputMargin",{get:function(){var t;return null!==(t=this._inputMargin)&&void 0!==t?t:this._inputMargin=this.newInputMargin()},enumerable:!1,configurable:!0}),n.prototype.newInputMargin=function(){var e=this;return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.subtheme.getInputMarginLabel()}},input:{weight:1,on:{change:function(n){t.DControllers.getCommandController().push(new ln(n,e._selection))}}}})},n.prototype.onSelectionChangeInputRowHeight=function(t){var e=t.last(),n=this.inputMargin;e instanceof on?(n.input.value=e.button.margin,n.state.isDisabled=!1):n.state.isDisabled=!0},n.prototype.onSelectionChange=function(t){this.onSelectionChangeButtonNew(t),this.onSelectionChangeColumnList(t)},n.prototype.onListSelectionChange=function(t){this.onListSelectionChangeButtonDelete(t),this.onListSelectionChangeButtonBringForward(t),this.onListSelectionChangeButtonSendBackward(t)},Object.defineProperty(n.prototype,"subtheme",{get:function(){var t;return null!==(t=this._subtheme)&&void 0!==t?t:this._subtheme=this.newSubtheme()},enumerable:!1,configurable:!0}),n.prototype.newSubtheme=function(){return t.DThemes.get("EEditorShapeButtonLayer")},n}(t.DPane),dn=function(){function e(){}return e.getTheme=function(){return t.DThemes.get("EShapeButtonLayer")},e.create=function(e){var n=new on(t.EShapeResourceManagerDeserializationMode.EDITOR);if(e){if(n.copy(e),!(e instanceof on)){var i=this.getTheme().getLabel();n.button.add(new tn(i,1,[],!1,!0,!1))}}else i=this.getTheme().getLabel(),n.button.add(new tn(i,1,[],!1,!0,!1));return n.onSizeChange(),n},e.load=function(){var n=this.getTheme().getName();Ge.add({type:nn.ID,name:n,icon:{width:24,height:24,svg:'<g transform="scale(26.6666)" fill="#fff" stroke="none"><path d="M22,9v6c0,1.1-0.9,2-2,2h-1l0-2h1V9H4v6h6v2H4c-1.1,0-2-0.9-2-2V9c0-1.1,0.9-2,2-2h16C21.1,7,22,7.9,22,9z"/><path d="M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16zm0-11.47L17.74 9 12 13.47 6.26 9 12 4.53z" transform="translate(7.25,8) scale(0.6)"/></g>'},title:n,creator:function(t){return e.create(t)},deserializer:function(t,n){return e.deserialize(t,n)},editor:cn,uploaded:t.createGroupUploaded,capability:(t.EShapeCapability.PRIMITIVE|t.EShapeCapability.STROKE_SIDE|t.EShapeCapability.BORDER_RADIUS)&~t.EShapeCapability.CHILDREN})},e.deserialize=function(e,n){var i=new on(n.mode),o=e[15],r=n.resources;if(0<=o&&o<r.length){var a=n.getExtension(o);null==a&&(a=JSON.parse(r[o]),n.setExtension(o,a)),i.button.deserialize(a[0],n),e[15]=a[a.length-1]}var l=t.deserializeBase(e,n,i);return i.size.init(),l},e}(),gn=function(){function t(t,e){this.major=t,this.minor=e}return t.prototype.copy=function(t){return this.major.copy(t.major),this.minor.copy(t.minor),this},t.prototype.serialize=function(t){return t.addResource("[".concat(this.major.serialize(t),",").concat(this.minor.serialize(t),"]"))},t.prototype.deserialize=function(t,e){var n=e.resources;if(0<=t&&t<n.length){var i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),this.major.deserialize(i[0],e),this.minor.deserialize(i[1],e)}},t}(),fn=function(){function t(t){this.count=t}return t.prototype.copy=function(t){return this.count=t.count,this},t.prototype.serialize=function(t){return t.addResource("".concat(this.count))},t.prototype.deserialize=function(t,e){var n=e.resources;if(0<=t&&t<n.length){var i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),this.count=i}},t}(),yn=function(){function t(t){this.count=t}return t.prototype.copy=function(t){return this.count=t.count,this},t.prototype.serialize=function(t){return t.addResource("".concat(this.count))},t.prototype.deserialize=function(t,e){var n=e.resources;if(0<=t&&t<n.length){var i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),this.count=i}},t}(),vn=function(){function t(){this.padding=10,this.tick=new gn(new fn(3),new yn(3))}return t.prototype.copy=function(t){return this.padding=t.padding,this.tick.copy(t.tick),this},t.prototype.serialize=function(t){return t.addResource("[".concat(this.padding,",").concat(this.tick.serialize(t),"]"))},t.prototype.deserialize=function(t,e){var n=e.resources;if(0<=t&&t<n.length){var i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),this.padding=i[0],this.tick.deserialize(i[1],e)}},t}(),bn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(vn),mn=function(){function t(){this.x=new vn,this.y=new bn}return t.prototype.copy=function(t){return this.x.copy(t.x),this.y.copy(t.y),this},t.prototype.serialize=function(t){return t.addResource("[".concat(this.x.serialize(t),",").concat(this.y.serialize(t),"]"))},t.prototype.deserialize=function(t,e){var n=e.resources;if(0<=t&&t<n.length){var i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),this.x.deserialize(i[0],e),this.y.deserialize(i[1],e)}},t}(),_n=function(){function e(){}return e.ID=t.EShapeType.EXTENSION+0,e.PLOT_AREA_ID="plot-area",e.LINE_ID="line",e.X_AXIS_ID="x-axis",e.X_AXIS_TICK_MAJOR_ID="x-axis-tick-major",e.X_AXIS_TICK_MINOR_ID="x-axis-tick-minor",e.Y_AXIS_ID="y-axis",e.Y_AXIS_TICK_MAJOR_ID="y-axis-tick-major",e.Y_AXIS_TICK_MINOR_ID="y-axis-tick-minor",e}(),Sn=function(e){function n(t,n){void 0===n&&(n=_n.ID);var i=e.call(this,t,n)||this;return i.axis=new mn,i}return i(n,e),n.prototype.copy=function(i,o){void 0===o&&(o=t.EShapeCopyPart.ALL);var r=e.prototype.copy.call(this,i,o);return i instanceof n&&this.axis.copy(i.axis),r},n.prototype.serialize=function(t){var n=e.prototype.serialize.call(this,t),i=n[15];return n[15]=t.addResource("[".concat(this.axis.serialize(t),",").concat(i,"]")),n},n}(t.EShapeGroup),wn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t instanceof Sn?t.axis.x.padding:0},e.prototype.setProperty=function(t,e,n){t instanceof Sn&&(t.axis.x.padding=n)},e.prototype.isMergeable=function(){return!0},e}(ut),Tn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t instanceof Sn?t.axis.y.padding:0},e.prototype.setProperty=function(t,e,n){t instanceof Sn&&(t.axis.y.padding=n)},e.prototype.isMergeable=function(){return!0},e}(ut),En=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t instanceof Sn?t.axis.x.tick.major.count:0},e.prototype.setProperty=function(t,e,n){t instanceof Sn&&(t.axis.x.tick.major.count=n)},e.prototype.isMergeable=function(){return!0},e}(ut),Cn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t instanceof Sn?t.axis.x.tick.minor.count:0},e.prototype.setProperty=function(t,e,n){t instanceof Sn&&(t.axis.x.tick.minor.count=n)},e.prototype.isMergeable=function(){return!0},e}(ut),Dn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t instanceof Sn?t.axis.y.tick.major.count:0},e.prototype.setProperty=function(t,e,n){t instanceof Sn&&(t.axis.y.tick.major.count=n)},e.prototype.isMergeable=function(){return!0},e}(ut),Ln=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getProperty=function(t,e){return t instanceof Sn?t.axis.y.tick.minor.count:0},e.prototype.setProperty=function(t,e,n){t instanceof Sn&&(t.axis.y.tick.minor.count=n)},e.prototype.isMergeable=function(){return!0},e}(ut),An=function(){function e(){}return e.getTheme=function(){return t.DThemes.get("EShapeChartLine")},e.getPlotArea=function(t){return q.findChildById(t,_n.PLOT_AREA_ID)},e.newPlotArea=function(e){var n=new t.EShapeRectangle;return n.id=_n.PLOT_AREA_ID,n.size.set(e.size.x,e.size.y),n.stroke.enable=!1,n.fill.alpha=.5*t.EShapeDefaults.FILL_ALPHA,n.text.value=this.getTheme().newPlotAreaLabel(),n.text.align.vertical=t.EShapeTextAlignVertical.OUTSIDE_TOP,n.attach(e),n},e.getLine=function(t){return q.findChildById(t,_n.LINE_ID)},e.newLine=function(e){var n=.8*e.size.x*.5,i=.8*e.size.y*.5,o=t.createLine([-n,+i,+n,-i],[],t.EShapeDefaults.STROKE_WIDTH,t.EShapePointsStyle.NONE);return o.id=_n.LINE_ID,o.attach(e),o},e.getXAxis=function(t){return q.findChildById(t,_n.X_AXIS_ID)},e.getXAxisTickMajor=function(t){return q.findChildById(t,_n.X_AXIS_TICK_MAJOR_ID)},e.getXAxisTickMinor=function(t){return q.findChildById(t,_n.X_AXIS_TICK_MINOR_ID)},e.newXAxis=function(e){var n=new t.EShapeBar;return n.id=_n.X_AXIS_ID,n.size.set(e.size.x,0),n.transform.position.set(0,.5*e.size.y),n.points.position=t.EShapeBarPosition.LEFT,n.points.size=-1,n.stroke.width=t.EShapeDefaults.STROKE_WIDTH,n.text.value=this.getTheme().newXAxisLabel(),n.text.align.vertical=t.EShapeTextAlignVertical.OUTSIDE_BOTTOM,n.text.padding.set(50,50),n.attach(e),n},e.createXAxis=function(t){t.createChildren((function(t){return[e.newXAxis(t)]}))},e.deleteXAxis=function(t){t.deleteChildren((function(t){var n=null,i=e.getXAxis(t);null!=i&&(n=[i]);var o=e.getXAxisTickMajor(t);null!=o&&(null==n?n=[o]:n.push(o));var r=e.getXAxisTickMinor(t);return null!=r&&(null==n?n=[r]:n.push(r)),n}))},e.setXAxisPadding=function(e,n){t.DControllers.getCommandController().push(new wn(n,e))},e.newXAxisTickMajor=function(e){var n=new t.EShapeBar;return n.id=_n.X_AXIS_TICK_MAJOR_ID,n.size.set(0,0),n.transform.position.set(0,.5*e.size.y),n.points.position=t.EShapeBarPosition.TOP,n.points.size=10,n.stroke.width=t.EShapeDefaults.STROKE_WIDTH,n.text.value="%YMD\n%Hms.%mi",n.text.align.vertical=t.EShapeTextAlignVertical.TOP,n.text.padding.set(12.5,12.5),n.attach(e),n},e.newXAxisTickMinor=function(e,n,i){var o=new t.EShapeBar;return o.id=_n.X_AXIS_TICK_MINOR_ID,o.size.set(0,0),o.transform.position.set(n,i),o.points.position=t.EShapeBarPosition.TOP,o.points.size=5,o.stroke.width=.5*t.EShapeDefaults.STROKE_WIDTH,o.attach(e),o},e.createXAxisTickMajor=function(t){var n=this;t.createChildren((function(t){return null!=e.getXAxis(t)?[n.newXAxisTickMajor(t)]:null}))},e.deleteXAxisTickMajor=function(t){t.deleteChildren((function(t){var n=null,i=e.getXAxisTickMajor(t);null!=i&&(n=[i]);var o=e.getXAxisTickMinor(t);return null!=o&&(null==n?n=[o]:n.push(o)),n}))},e.setXAxisTickMajorCount=function(e,n){t.DControllers.getCommandController().push(new En(n,e))},e.createXAxisTickMinor=function(t){var n=this;t.createChildren((function(t){var i=e.getXAxis(t);if(null!=i){var o=i.size.x,r=i.transform.position;return[n.newXAxisTickMinor(t,r.x-.25*o,r.y)]}return null}))},e.deleteXAxisTickMinor=function(t){t.deleteChildren((function(t){var n=e.getXAxisTickMinor(t);return null!=n?[n]:null}))},e.setXAxisTickMinorCount=function(e,n){t.DControllers.getCommandController().push(new Cn(n,e))},e.getYAxis=function(t){return q.findChildById(t,_n.Y_AXIS_ID)},e.getYAxisTickMajor=function(t){return q.findChildById(t,_n.Y_AXIS_TICK_MAJOR_ID)},e.getYAxisTickMinor=function(t){return q.findChildById(t,_n.Y_AXIS_TICK_MINOR_ID)},e.newYAxis=function(e){var n=new t.EShapeBar;return n.id=_n.Y_AXIS_ID,n.size.set(0,e.size.y),n.transform.position.set(.5*-e.size.x,0),n.points.position=t.EShapeBarPosition.TOP,n.points.size=-1,n.stroke.width=t.EShapeDefaults.STROKE_WIDTH,n.text.value=this.getTheme().newYAxisLabel(),n.text.align.horizontal=t.EShapeTextAlignHorizontal.OUTSIDE_LEFT,n.text.direction=t.EShapeTextDirection.BOTTOM_TO_TOP,n.text.padding.set(50,50),n.attach(e),n},e.createYAxis=function(t){t.createChildren((function(t){return[e.newYAxis(t)]}))},e.deleteYAxis=function(t){t.deleteChildren((function(t){var n=null,i=e.getYAxis(t);null!=i&&(n=[i]);var o=e.getYAxisTickMajor(t);null!=o&&(null==n?n=[o]:n.push(o));var r=e.getYAxisTickMinor(t);return null!=r&&(null==n?n=[r]:n.push(r)),n}))},e.setYAxisPadding=function(e,n){t.DControllers.getCommandController().push(new Tn(n,e))},e.newYAxisTickMajor=function(e){var n=new t.EShapeBar;return n.id=_n.Y_AXIS_TICK_MAJOR_ID,n.size.set(0,0),n.transform.position.set(.5*-e.size.x,0),n.points.position=t.EShapeBarPosition.RIGHT,n.points.size=10,n.stroke.width=t.EShapeDefaults.STROKE_WIDTH,n.text.value="%ssi",n.text.align.horizontal=t.EShapeTextAlignHorizontal.RIGHT,n.text.padding.set(12.5,12.5),n.attach(e),n},e.newYAxisTickMinor=function(e,n,i){var o=new t.EShapeBar;return o.id=_n.Y_AXIS_TICK_MINOR_ID,o.size.set(0,0),o.transform.position.set(n,i),o.points.position=t.EShapeBarPosition.RIGHT,o.points.size=5,o.stroke.width=.5*t.EShapeDefaults.STROKE_WIDTH,o.attach(e),o},e.createYAxisTickMajor=function(t){var n=this;t.createChildren((function(t){return null!=e.getYAxis(t)?[n.newYAxisTickMajor(t)]:null}))},e.deleteYAxisTickMajor=function(t){t.deleteChildren((function(t){var n=null,i=e.getYAxisTickMajor(t);null!=i&&(n=[i]);var o=e.getYAxisTickMinor(t);return null!=o&&(null==n?n=[o]:n.push(o)),n}))},e.setYAxisTickMajorCount=function(e,n){t.DControllers.getCommandController().push(new Dn(n,e))},e.createYAxisTickMinor=function(t){var n=this;t.createChildren((function(t){var i=e.getYAxis(t);if(null!=i){var o=i.size.y,r=i.transform.position;return[n.newYAxisTickMinor(t,r.x,r.y+.25*o)]}return null}))},e.deleteYAxisTickMinor=function(t){t.deleteChildren((function(t){var n=e.getYAxisTickMinor(t);return null!=n?[n]:null}))},e.setYAxisTickMinorCount=function(e,n){t.DControllers.getCommandController().push(new Ln(n,e))},e}(),Bn=function(e){function n(n){var i=e.call(this,n)||this,o=n.selection;i.state.isDisabled=o.isEmpty(),o.on("change",(function(){i.state.isDisabled=o.isEmpty()}));var r=i.subtheme;return new t.DLayoutVertical({parent:i.content,x:"padding",y:"padding",width:"padding",height:"auto",children:[i.newTextLabel(),new t.DButtonCheckRight({width:"100%",text:{value:r.getCheckXAxisLabel()},padding:0,background:{color:null},on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn?(t.state.isActive=null!=An.getXAxis(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),o.on("change",e)},active:function(){An.createXAxis(o)},inactive:function(){An.deleteXAxis(o)}}}),new t.DButtonCheckRight({width:"100%",text:{value:r.getCheckXAxisMajorTickLabel()},padding:{top:0,right:0,left:10,bottom:0},background:{color:null},on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn&&null!=An.getXAxis(e)?(t.state.isActive=null!=An.getXAxisTickMajor(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),o.on("change",e)},active:function(){An.createXAxisTickMajor(o)},inactive:function(){An.deleteXAxisTickMajor(o)}}}),new t.DButtonCheckRight({width:"100%",text:{value:r.getCheckXAxisMinorTickLabel()},padding:{top:0,right:0,left:10,bottom:0},background:{color:null},on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn&&null!=An.getXAxis(e)?(t.state.isActive=null!=An.getXAxisTickMinor(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),o.on("change",e)},active:function(){An.createXAxisTickMinor(o)},inactive:function(){An.deleteXAxisTickMinor(o)}}}),new t.DButtonCheckRight({width:"100%",text:{value:r.getCheckYAxisLabel()},padding:0,background:{color:null},on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn?(t.state.isActive=null!=An.getYAxis(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),o.on("change",e)},active:function(){An.createYAxis(o)},inactive:function(){An.deleteYAxis(o)}}}),new t.DButtonCheckRight({width:"100%",text:{value:r.getCheckYAxisMajorTickLabel()},padding:{top:0,right:0,left:10,bottom:0},background:{color:null},on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn&&null!=An.getYAxis(e)?(t.state.isActive=null!=An.getYAxisTickMajor(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),o.on("change",e)},active:function(){An.createYAxisTickMajor(o)},inactive:function(){An.deleteYAxisTickMajor(o)}}}),new t.DButtonCheckRight({width:"100%",text:{value:r.getCheckYAxisMinorTickLabel()},padding:{top:0,right:0,left:10,bottom:0},background:{color:null},on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn&&null!=An.getYAxis(e)?(t.state.isActive=null!=An.getYAxisTickMinor(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),o.on("change",e)},active:function(){An.createYAxisTickMinor(o)},inactive:function(){An.deleteYAxisTickMinor(o)}}}),new t.DText({width:"100%",text:{value:r.getTextMajorTickCountLabel()}}),new t.DLayoutHorizontal({width:"100%",children:[new t.DInputInteger({weight:1,min:0,on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn&&(t.value=e.axis.x.tick.major.count)};e(),o.on("change",e)},change:function(t){An.setXAxisTickMajorCount(t,o)}}}),new t.DInputInteger({weight:1,min:0,on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn&&(t.value=e.axis.y.tick.major.count)};e(),o.on("change",e)},change:function(t){An.setYAxisTickMajorCount(t,o)}}})]}),new t.DText({width:"100%",text:{value:r.getTextMinorTickCountLabel()}}),new t.DLayoutHorizontal({width:"100%",children:[new t.DInputInteger({weight:1,min:0,on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn&&(t.value=e.axis.x.tick.minor.count)};e(),o.on("change",e)},change:function(t){An.setXAxisTickMinorCount(t,o)}}}),new t.DInputInteger({weight:1,min:0,on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn&&(t.value=e.axis.y.tick.minor.count)};e(),o.on("change",e)},change:function(t){An.setYAxisTickMinorCount(t,o)}}})]}),new t.DText({width:"100%",text:{value:r.getTextPaddingLabel()}}),new t.DLayoutHorizontal({width:"100%",children:[new t.DInputInteger({weight:1,min:0,on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn&&(t.value=e.axis.x.padding)};e(),o.on("change",e)},change:function(t){An.setXAxisPadding(t,o)}}}),new t.DInputInteger({weight:1,min:0,on:{init:function(t){var e=function(){var e=o.last();e instanceof Sn&&(t.value=e.axis.y.padding)};e(),o.on("change",e)},change:function(t){An.setYAxisPadding(t,o)}}})]})],on:{init:function(t){var e=function(){t.state.isDisabled=!(o.last()instanceof Sn)};e(),o.on("change",e)}}}),i}return i(n,e),n.prototype.newTextLabel=function(){return new t.DText({width:"100%",text:{value:this.subtheme.getLabel()}})},Object.defineProperty(n.prototype,"subtheme",{get:function(){var t;return null!==(t=this._subtheme)&&void 0!==t?t:this._subtheme=this.newSubtheme()},enumerable:!1,configurable:!0}),n.prototype.newSubtheme=function(){return t.DThemes.get("EEditorShapeChartLine")},n}(t.DPane),On=function(e){function n(n){var i=e.call(this)||this,o=q.findChildById(n,"line");if(null!=o){var r=n.data;if(r.size()<=0)o.detach(),i.lines=[];else{for(var a=[o],l=1,u=r.size();l<u;++l){var s=o.clone();s.attach(n),a.push(s)}i.lines=a}}else i.lines=[];var p=3,h=3,c=3,d=3;n instanceof Sn&&(p=n.axis.x.tick.major.count,h=n.axis.y.tick.major.count,c=n.axis.x.tick.minor.count,d=n.axis.y.tick.minor.count),i.xmajorCount=p,i.ymajorCount=h,i.xminorCount=c,i.yminorCount=d,i.xmajors=i.initTicks(n,_n.X_AXIS_TICK_MAJOR_ID,p),i.ymajors=i.initTicks(n,_n.Y_AXIS_TICK_MAJOR_ID,h),i.xminors=i.initTicks(n,_n.X_AXIS_TICK_MINOR_ID,(p+1)*c),i.yminors=i.initTicks(n,_n.Y_AXIS_TICK_MINOR_ID,(h+1)*d),i.workMajorPositions=new Float64Array(Math.max(p,h));var g=q.findChildById(n,_n.X_AXIS_TICK_MAJOR_ID);i.xformatter=t.NumberFormatters.create(null!=g?g.text.value:"");var f=q.findChildById(n,_n.Y_AXIS_TICK_MAJOR_ID);i.yformatter=t.NumberFormatters.create(null!=f?f.text.value:""),i.plotArea=q.findChildById(n,"plot-area");var y=10,v=10;return n instanceof Sn&&(y=n.axis.x.padding,v=n.axis.y.padding),i.xpadding=y,i.ypadding=v,i}return i(n,e),n.prototype.initTicks=function(t,e,n){var i=q.findChildById(t,e);if(null!=i){if(n<=0)return i.detach(),[];for(var o=[i],r=1;r<n;++r){var a=i.clone();a.attach(t),o.push(a)}return o}return[]},n.prototype.toStepScale=function(t){return 5.5<=t?10:2.2<=t?5:1.1<=t?2:1},n.prototype.getStep=function(t,e,n){if(n<=0||e<=t)return-1;var i=(e-t)/n,o=Math.floor(Math.log(i)/Math.LN10),r=Math.pow(10,o);return this.toStepScale(i/r)*r},n.prototype.getTickPositions=function(t,e,n,i,o,r,a){if(n<=0)return a;if(e<=t||i<=0){a[0]=t;for(var l=1;l<n;++l)a[l]=NaN;return a}var u=t/i,s=Math.floor(u);o<(u-s)*i*r&&(s=Math.ceil(u));var p=e/i,h=Math.ceil(p);o<(h-p)*i*r&&(h=Math.floor(p));var c=Math.min(n,Math.ceil(h-s+1));for(l=0;l<c;++l)a[l]=(s+l)*i;for(l=c;l<n;++l)a[l]=NaN;return a},n.prototype.updateTicksXMinor=function(e,n,i,o,r,a,l){var u=this.xminors;if(0<u.length){var s=this.xminorCount;if(0<e){var p=this.xpadding;if(n<0)for(var h=0,c=(n+1)*s;h<s;h+=1,c+=1){var d=u[c];a-p<=(g=(i-(s-h)*e-o)*r+a)?(d.lock(t.EShapeLockPart.UPLOADED),d.visible=!0,d.transform.position.x=g,d.unlock(t.EShapeLockPart.UPLOADED,!0)):d.visible=!1}else for(h=0,c=(n+1)*s;h<s;h+=1,c+=1){var g;d=u[c],(g=(i+(h+1)*e-o)*r+a)<=l+p?(d.lock(t.EShapeLockPart.UPLOADED),d.visible=!0,d.transform.position.x=g,d.unlock(t.EShapeLockPart.UPLOADED,!0)):d.visible=!1}}else for(var f=(h=(n+1)*s)+s;h<f;++h)u[h].visible=!1}},n.prototype.toStepMinor=function(t,e){return 0<=t?t/(e+1):-1},n.prototype.updateTicksX=function(e,n,i,o,r){var a=this.xmajors,l=this.xminors,u=this.xminorCount,s=this.xpadding,p=this.getStep(e,n,a.length),h=this.getTickPositions(e,n,a.length,p,s,i,this.workMajorPositions),c=this.toStepMinor(p,u);this.updateTicksXMinor(c,-1,h[0],e,i,o,r);for(var d=0,g=a.length;d<g;++d){var f=a[d],y=h[d];if(y==y)f.lock(t.EShapeLockPart.UPLOADED),f.visible=!0,f.transform.position.x=(y-e)*i+o,f.text.value=this.xformatter.format(y,p),f.unlock(t.EShapeLockPart.UPLOADED,!0),this.updateTicksXMinor(c,d,h[d],e,i,o,r);else if(f.visible=!1,0<l.length)for(var v=(d+1)*u,b=v+u;v<b;++v)l[v].visible=!1}},n.prototype.updateTicksYMinor=function(e,n,i,o,r,a,l){var u=this.yminors;if(0<u.length){var s=this.yminorCount;if(0<e){var p=this.ypadding;if(n<0)for(var h=0,c=(n+1)*s;h<s;h+=1,c+=1){var d=u[c];(g=l-(i-(s-h)*e-o)*r)<=l+p?(d.lock(t.EShapeLockPart.UPLOADED),d.visible=!0,d.transform.position.y=g,d.unlock(t.EShapeLockPart.UPLOADED,!0)):d.visible=!1}else for(h=0,c=(n+1)*s;h<s;h+=1,c+=1){var g;d=u[c],a-p<=(g=l-(i+(h+1)*e-o)*r)?(d.lock(t.EShapeLockPart.UPLOADED),d.visible=!0,d.transform.position.y=g,d.unlock(t.EShapeLockPart.UPLOADED,!0)):d.visible=!1}}else for(var f=(h=(n+1)*s)+s;h<f;++h)u[h].visible=!1}},n.prototype.updateTicksY=function(e,n,i,o,r){var a=this.ymajors,l=this.yminors,u=this.yminorCount,s=this.ypadding,p=this.getStep(e,n,a.length),h=this.getTickPositions(e,n,a.length,p,s,i,this.workMajorPositions),c=this.toStepMinor(p,u);this.updateTicksYMinor(c,-1,h[0],e,i,o,r);for(var d=0,g=a.length;d<g;++d){var f=a[d],y=h[d];if(y==y)f.lock(t.EShapeLockPart.UPLOADED),f.visible=!0,f.transform.position.y=r-(y-e)*i,f.text.value=this.yformatter.format(y,p),f.unlock(t.EShapeLockPart.UPLOADED,!0),this.updateTicksYMinor(c,d,h[d],e,i,o,r);else if(f.visible=!1,0<l.length)for(var v=(d+1)*u,b=v+u;v<b;++v)l[v].visible=!1}},n.prototype.updateLines=function(e,n,i,o,r,a,l){for(var u=this.lines,s=0,p=Math.min(u.length,e.size());s<p;++s){var h=e.get(s);if(null!=h){var c=u[s],d=c.points;if(null!=d){var g=d.values,f=h.values,y=f.length;if(2<=y){var v=h.times;if(v.length<y)for(var b=0;b<y;++b)g[0+(m=b<<1)]=(b+1-n)*i+o,g[m+1]=l-(f[b]-r)*a;else for(b=0;b<y;++b){var m;g[0+(m=b<<1)]=(v[b]-n)*i+o,g[m+1]=l-(f[b]-r)*a}c.lock(t.EShapeLockPart.UPLOADED),c.visible=!0,d.values=g,c.unlock(t.EShapeLockPart.UPLOADED,!0)}else c.visible=!1}}}},n.prototype.execute=function(t,e,n){var i=t.data;if(i.isChanged){for(var o=1/0,r=-1/0,a=1/0,l=-1/0,u=0,s=i.size();u<s;++u){var p=i.get(u);if(null!=p){var h=p.values,c=h.length,d=p.times,g=d.length;if(g<c)1<o&&(o=1),r<c&&(r=c);else for(var f=0;f<g;++f){var y=d[f];y<o&&(o=y),r<y&&(r=y)}for(f=0;f<c;++f){var v=h[f];v<a&&(a=v),l<v&&(l=v)}}}r<o?(o=0,r=1):r<=o&&(r=o+1),l<a?(l=1,a=0):l<=a&&(l=a+1);var b=r-o,m=l-a,_=this.plotArea,S=null!=_?_.size:t.size,w=.5*S.x,T=.5*S.y,E=this.xpadding,C=this.ypadding,D=-w+E,L=+w-E,A=-T+C,B=+T-C;L<=D&&(L=D+1),B<=A&&(B=A+1);var O=(L-D)/b,P=(B-A)/m;this.updateTicksX(o,r,O,D,L),this.updateTicksY(a,l,P,A,B),this.updateLines(i,o,O,D,a,P,B)}},n}(t.EShapeActionRuntimeBase),Pn=function(t){function e(e){var n=t.call(this,e)||this;return n.actions.push(new On(e)),n}return i(e,t),e}(t.EShapeRuntimeImpl),In=function(){function e(){}return e.getTheme=function(){return t.DThemes.get("EShapeChartLine")},e.deserialize=function(e,n){var i=new Sn(n.mode),o=e[15],r=n.resources;if(0<=o&&o<r.length){var a=n.getExtension(o);null==a&&(a=JSON.parse(r[o]),n.setExtension(o,a)),i.axis.deserialize(a[0],n),e[15]=a[a.length-1]}var l=t.deserializeBase(e,n,i);return i.size.init(),l},e.create=function(e){var n=new Sn(t.EShapeResourceManagerDeserializationMode.EDITOR);return e&&n.copy(e),An.newPlotArea(n),An.newLine(n),An.newXAxis(n),An.newXAxisTickMajor(n),An.newYAxis(n),An.newYAxisTickMajor(n),e instanceof Sn&&n.axis.copy(e.axis),n},e.load=function(){var t=this.getTheme().getName();Ge.add({type:_n.ID,name:t,icon:{width:24,height:24,svg:'<g transform="scale(26.6666)" fill="#fff" stroke="none"><path d="M23,8c0,1.1-0.9,2-2,2c-0.18,0-0.35-0.02-0.51-0.07l-3.56,3.55C16.98,13.64,17,13.82,17,14c0,1.1-0.9,2-2,2s-2-0.9-2-2 c0-0.18,0.02-0.36,0.07-0.52l-2.55-2.55C10.36,10.98,10.18,11,10,11c-0.18,0-0.36-0.02-0.52-0.07l-4.55,4.56 C4.98,15.65,5,15.82,5,16c0,1.1-0.9,2-2,2s-2-0.9-2-2s0.9-2,2-2c0.18,0,0.35,0.02,0.51,0.07l4.56-4.55C8.02,9.36,8,9.18,8,9 c0-1.1,0.9-2,2-2s2,0.9,2,2c0,0.18-0.02,0.36-0.07,0.52l2.55,2.55C14.64,12.02,14.82,12,15,12c0.18,0,0.36,0.02,0.52,0.07 l3.55-3.56C19.02,8.35,19,8.18,19,8c0-1.1,0.9-2,2-2S23,6.9,23,8z"/></g>'},title:t,creator:function(t){return e.create(t)},editor:Bn,deserializer:function(t,n){return e.deserialize(t,n)},runtime:Pn})},e}(),xn=function(){function e(){}return e.getTheme=function(){return t.DThemes.get("EShapeInput")},e.create=function(e){var n=new t.EShapeRectangleRounded;return e?n.copy(e):(n.stroke.set(!0,t.EShapeDefaults.STROKE_COLOR,1,1),n.fill.set(!0,16777215,1),n.text.set(this.getTheme().getLabel()),n.cursor="text",n.state.isFocusable=!0,n.interactive=!0),n.action.add(new t.EShapeActionValueMiscInput(t.EShapeActionValueMiscType.INPUT_TEXT,'"ALWAYS"',"",t.EShapeActionValueOnInputAction.EMIT_EVENT)),n.action.add(new t.EShapeActionValueChangeColor(t.EShapeActionValueChangeColorType.STROKE,"inFocused",t.EShapeActionValueChangeColorTarget.COLOR,t.EShapeDefaults.HIGHLIGHT_COLOR,0,"")),n.action.add(new t.EShapeActionValueChangeColor(t.EShapeActionValueChangeColorType.TEXT,"inDisabled",t.EShapeActionValueChangeColorTarget.ALPHA,0,.5,"")),n},e.load=function(){var t=this.getTheme().getName();Ge.add({icon:{width:24,height:24,svg:'<g transform="scale(26.6666)" fill="#fff" stroke="none"><path d="M22,9v6c0,1.1-0.9,2-2,2h-1l0-2h1V9H4v6h6v2H4c-1.1,0-2-0.9-2-2V9c0-1.1,0.9-2,2-2h16C21.1,7,22,7.9,22,9z"/><path d="M5 4v3h5.5v12h3V7H19V4H5z" transform="translate(7.25,8.5) scale(0.6)" /></g>'},title:t,creator:function(t){return e.create(t)}})},e}(),Rn=function(){function t(t){this._parent=t}return Object.defineProperty(t.prototype,"values",{get:function(){for(var t=this._parent,e=t.data.values,n=t.column.values,i=[],o=0,r=e.length;o<r;++o){for(var a=e[o],l=[],u=0,s=n.length;u<s;++u){var p=n[u].runtime;null!=p&&l.push(p.toValue(a,u,e))}i.push(l)}return i},enumerable:!1,configurable:!0}),t}(),kn=function(){function t(){}return t.prototype.isEquals=function(t){return!0},t.prototype.serialize=function(t){return-1},t.deserialize=function(e,n){return new t},t}(),Vn=function(){function t(t){this.label=t}return t.prototype.isEquals=function(t){return this.label===t.label},t.prototype.serialize=function(t){var e=t.addResource(this.label);return t.addResource("[".concat(e,"]"))},t.deserialize=function(e,n){var i=n.resources;if(0<=e&&e<i.length){var o=n.getExtension(e);return null==o&&(o=JSON.parse(i[e]),n.setExtension(e,o)),new t(i[o[0]])}return new t("")},t}(),Mn={TEXT:0,NUMBER:1},Nn=function(){function t(t,e,n,i,o,r,a,l){this.weight=t,this.type=e,this.getter=n,this.setter=i,this.format=o,this.align=r,this.header=a,this.body=l}return t.prototype.isEquals=function(t){return this.weight===t.weight&&this.type===t.type&&this.getter===t.getter&&this.setter===t.setter&&this.format===t.format&&this.align===t.align&&this.header.isEquals(t.header)&&this.body.isEquals(t.body)},t.prototype.toLabel=function(){return this.header.label},t.prototype.serialize=function(t){var e=t.addResource(this.getter),n=t.addResource(this.setter),i=t.addResource(this.format),o=this.header.serialize(t),r=this.body.serialize(t);return t.addResource("[".concat(this.weight,",").concat(this.type,",").concat(e,",").concat(n,",")+"".concat(i,",").concat(this.align,",-1,").concat(o,",").concat(r,"]"))},t.deserialize=function(e,n){var i=n.resources;if(0<=e&&e<i.length){var o=n.getExtension(e);return null==o&&(o=JSON.parse(i[e]),n.setExtension(e,o)),new t(o[0],o[1],i[o[2]],i[o[3]],i[o[4]],o[5],Vn.deserialize(o[7],n),kn.deserialize(o[8],n))}return null},t}(),Fn=function(){function t(t){this.values=[],this._sizeX=1,this._onChange=t}return t.prototype.add=function(t,e){null!=e?this.values.splice(e,0,t):this.values.push(t),this._onChange()},t.prototype.remove=function(t){var e=this.values;if(0<=t&&t<e.length){var n=e.splice(t,1)[0];return this._onChange(),n}return null},t.prototype.indexOf=function(t){for(var e=this.values,n=0,i=e.length;n<i;++n)if(e[n]===t)return n;for(n=0,i=e.length;n<i;++n)if(e[n].isEquals(t))return n;return-1},t.prototype.get=function(t){var e=this.values[t];return null!=e?e:null},t.prototype.set=function(t,e){this.values[t]=e,this._onChange()},t.prototype.swap=function(t,e){var n=this.values,i=n[e];n[e]=n[t],n[t]=i,this._onChange()},t.prototype.size=function(){return this.values.length},t.prototype.copy=function(t){for(var e=this.values,n=t.values,i=n.length,o=0;o<i;++o)e.push(n[o]);return e.length!==i&&(e.length=i),this._sizeX=t._sizeX,this._onChange(),this},t.prototype.serialize=function(t){for(var e="",n="[",i=this.values,o=0,r=i.length;o<r;++o)e+=n+i[o].serialize(t),n=",";return e+="]",t.addResource(e)},t.prototype.deserialize=function(t,e){var n=e.resources;if(0<=t&&t<n.length){var i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i));var o=!1,r=this.values;0<r.length&&(r.length=0,o=!0);for(var a=0,l=i.length;a<l;++a){var u=Nn.deserialize(i[a],e);null!=u&&r.push(u)}0<r.length&&(o=!0),o&&this._onChange()}},t}(),jn=function(){function e(){}return e.ID=t.EShapeType.EXTENSION+100,e.HEADER_ID=t.EShapeType.EXTENSION+101,e.BODY_ID=t.EShapeType.EXTENSION+102,e}(),zn={NONE:0,SINGLE:1,MULTIPLE:2},Hn=function(){function t(t){this.parent=t,this.type=zn.NONE,this.indices=[],this.body=null}return Object.defineProperty(t.prototype,"values",{get:function(){var t=this.indices,e=this.parent.data.values,n=this._values=this._values||[];if(null!=e){n.length=0;for(var i=0,o=t.length;i<o;++i){var r=t[i];0<=r&&r<e.length&&n.push(e[r])}}return n},enumerable:!1,configurable:!0}),t.prototype.size=function(){return this.indices.length},t.prototype.isEmpty=function(){return this.indices.length<=0},t.prototype.toggle=function(t){var e,n=this.indices,i=n.indexOf(t);i<0?(n.push(t),null!=(e=this.getBody())&&this.setRowActive(e,t,!0)):(n.splice(i,1),null!=(e=this.getBody())&&this.setRowActive(e,t,!1))},t.prototype.add=function(t){var e=this.indices;if(e.indexOf(t)<0){e.push(t);var n=this.getBody();null!=n&&this.setRowActive(n,t,!0)}},t.prototype.addTo=function(t){var e=this.indices,n=e[e.length-1];if(n<t)for(var i=this.getBody(),o=n+1;o<=t;++o)e.indexOf(o)<0&&(e.push(o),null!=i&&this.setRowActive(i,o,!0));else if(t<n)for(i=this.getBody(),o=n-1;t<=o;--o)e.indexOf(o)<0&&(e.push(o),null!=i&&this.setRowActive(i,o,!0))},t.prototype.remove=function(t){var e=this.indices,n=e.indexOf(t);if(0<=n){e.splice(n,1);var i=this.getBody();null!=i&&this.setRowActive(i,t,!1)}},t.prototype.clear=function(){var t=this.indices,e=this.getBody();if(null!=e)for(var n=0,i=t.length;n<i;++n)this.setRowActive(e,t[n],!1);t.length=0},t.prototype.clearAndAdd=function(t){var e=this.indices,n=this.getBody();if(null!=n){for(var i=0,o=e.length;i<o;++i){var r=e[i];r!==t&&this.setRowActive(n,r,!1)}this.setRowActive(n,t,!0)}e.length=0,e.push(t)},t.prototype.getBody=function(){var t=this.body;return null!=t?t:this.body=q.findChildByType(this.parent,jn.BODY_ID)},t.prototype.getRow=function(t,e){var n=t.children;return 0<=e&&e<n.length?n[e]:null},t.prototype.setRowActive=function(t,e,n){var i=this.getRow(t,e);if(null!=i)for(var o=i.children,r=0,a=o.length;r<a;++r)o[r].state.isActive=n},t.prototype.serialize=function(t){return t.addResource("[".concat(this.type,"]"))},t.prototype.deserialize=function(t,e){var n=e.resources;if(0<=t&&t<n.length){var i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i));var o=i[0];this.type!==o&&(this.type=o)}},t}(),Gn=function(){function t(t,e){this._height=40,this._onChange=e,this._isCellUpdateAllowed=!0,this._isCellUpdateCalled=!1,this.selection=new Hn(t)}return t.prototype.toDirty=function(){this.updateCells()},t.prototype.disallowCellUpdate=function(){this._isCellUpdateAllowed=!1,this._isCellUpdateCalled=!1},t.prototype.allowCellUpdate=function(t){this._isCellUpdateAllowed=!0;var e=this._isCellUpdateCalled;t&&e&&this.updateCells()},t.prototype.updateCells=function(){this._isCellUpdateAllowed?this._onChange():this._isCellUpdateCalled=!0},Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(t){t=Math.max(5,t),this._height!==t&&(this._height=t,this.updateCells())},enumerable:!1,configurable:!0}),t.prototype.copy=function(t){return this.disallowCellUpdate(),this._height=t._height,this.allowCellUpdate(!1),this.updateCells(),this},t.prototype.serialize=function(t){var e=this.selection.serialize(t);return t.addResource("[".concat(this._height,",").concat(e,"]"))},t.prototype.deserialize=function(t,e){var n=e.resources;if(0<=t&&t<n.length){var i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i));var o=!1,r=i[0];this._height!==r&&(this._height=r,o=!0),this.selection.deserialize(i[1],e),o&&this._onChange()}},t}(),Un=function(e){function n(t,n){void 0===n&&(n=jn.ID);var i=e.call(this,t,n)||this;return i._columnWidths=[],i._columnXs=[],i.column=new Fn((function(){i.onColumnChange()})),i.row=new Gn(i,(function(){i.onRowChange()})),i.cell=new Rn(i),i}return i(n,e),n.prototype.onColumnChange=function(){this.newCellsHeader(),this.newCellsBody(!0),this.layoutCells()},n.prototype.onRowChange=function(){this.newCellsBody(!1),this.layoutCells()},n.prototype.onSizeChange=function(){e.prototype.onSizeChange.call(this),this.newCellsBody(!1),this.layoutCells()},n.prototype.newCellsHeader=function(){if(!(this.children.length<=0)){var e=this.children[0],n=this.column,i=n.size(),o=n.values,r=e.children,a=r.length;if(a<i)for(var l=r[a-1]||this,u=a;u<i;++u){var s=(new t.EShapeRectangle).copy(l);s.text.value=o[u].header.label,s.attach(e)}else if(i<a)for(u=a-1;i<=u;--u)r[u].detach();for(u=0;u<i;++u)r[u].text.value=o[u].header.label}},n.prototype.toRowCountRequired=function(){return Math.min(1e3,Math.max(1,Math.floor(Math.abs(this.size.y)/this.row.height)))-1},n.prototype.newCellsBody=function(e){if(!(this.children.length<=1)){var n=this.children[1],i=n.children,o=i.length,r=this.toRowCountRequired(),a=Math.max(2,r);if(o<a)for(var l=(0<o?i[0]:null)||this,u=(1<o?i[1]:null)||this,s=this.mode,p=o;p<a;++p){var h=p%2==0?l:u;new t.EShapeGroupShadowed(s).copy(h,t.EShapeCopyPart.ACTION).attach(n)}else if(a<o)for(var c=o-1;a<=c;--c)i[c].detach();0<i.length&&(i[0].visible=0<r),1<i.length&&(i[1].visible=1<r);var d=(0<i.length?i[0].children[0]:null)||this,g=(1<i.length?i[1].children[0]:null)||this,f=this.column,y=f.values,v=f.size();for(p=0;p<a;++p){var b=p<=1?Math.max(1,v):v,m=i[p],_=m.children,S=_.length;if(h=p%2==0?d:g,S<b)for(var w=S;w<b;++w)(new t.EShapeRectangle).copy(h).attach(m);else if(b<S)for(c=S-1;b<=c;--c)_[c].detach();if(0<_.length&&(_[0].visible=0<v),1<_.length&&(_[1].visible=1<v),e)for(c=0;c<v;++c)_[c].text.align.horizontal=y[c].align}}},n.prototype.layoutCells=function(){if(!(this.children.length<=1)){for(var e=this.row.height,n=.5*e,i=this.column,o=this.size,r=o.x,a=o.y,l=.5*-r,u=.5*-a,s=i.values,p=s.length,h=0,c=0;c<p;++c)h+=s[c].weight;h=Math.max(1e-5,h);var d=this._columnWidths,g=this._columnXs,f=r/h,y=0;for(c=0;c<p;++c){var v=s[c].weight*f;d[c]=v,g[c]=y+.5*v,y+=v}var b=this.children[0];b.lock(t.EShapeLockPart.ALL),b.size.set(r,e),b.transform.position.set(0,u+n),b.unlock(t.EShapeLockPart.ALL,!0);for(var m=b.children,_=m.length,S=0;S<_;++S){var w=m[S];w.lock(t.EShapeLockPart.ALL),w.size.set(d[S],e),w.transform.position.set(l+g[S],0),w.unlock(t.EShapeLockPart.ALL,!0)}var T=this.children[1];T.lock(t.EShapeLockPart.ALL),T.size.set(r,a-e),T.transform.position.set(0,n),T.unlock(t.EShapeLockPart.ALL,!0);for(var E=T.children,C=E.length,D=0,L=u+e;D<C;++D,L+=e){var A=E[D];A.lock(t.EShapeLockPart.ALL),A.size.set(r,e),A.transform.position.set(0,L),A.unlock(t.EShapeLockPart.ALL,!0);var B=A.children,O=B.length;for(S=0;S<O;++S){var P=B[S];P.lock(t.EShapeLockPart.ALL),P.size.set(d[S],e),P.transform.position.set(l+g[S],0),P.unlock(t.EShapeLockPart.ALL,!0)}}}},n.prototype.copy=function(i,o){void 0===o&&(o=t.EShapeCopyPart.ALL);var r=e.prototype.copy.call(this,i,o);return i instanceof n&&(this.column.copy(i.column),this.row.copy(i.row)),r},n.prototype.serialize=function(t){var n=e.prototype.serialize.call(this,t),i=n[15];return n[15]=t.addResource("[".concat(this.column.serialize(t),",").concat(this.row.serialize(t),",").concat(i,"]")),n},n}(t.EShapeGroupShadowed),Yn=function(t){function e(e,n){var i=t.call(this)||this;return i._selection=n,i._value=e,i}return i(e,t),e.prototype.execute=function(){return this.redo()},e.prototype.redo=function(){for(var t=this._value,e=this._selection.get(),n=0,i=e.length;n<i;++n){var o=e[n];o instanceof Un&&o.column.add(t)}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._selection.get(),e=0,n=t.length;e<n;++e){var i=t[e];i instanceof Un&&i.column.remove(i.column.size()-1)}return this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),Xn=function(t){function e(e,n){var i=t.call(this)||this;i._selection=n,i._target=e;for(var o=[],r=i._selection.get(),a=0,l=r.length;a<l;++a){var u=r[a];if(u instanceof Un){var s=u.column.indexOf(e);o.push(s),0<s&&u.column.swap(s-1,s)}}return i._indices=o,i._selection.update("PROPERTY"),i}return i(e,t),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._selection.get(),e=this._indices,n=0,i=t.length;n<i;++n){var o=t[n];if(o instanceof Un){var r=e[n];0<r&&o.column.swap(r-1,r)}}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),Wn=function(t){function e(e,n){var i=t.call(this)||this;i._selection=n,i._target=e;for(var o=[],r=i._selection.get(),a=0,l=r.length;a<l;++a){var u=r[a];if(u instanceof Un){var s=u.column.indexOf(e);o.push(s),0<=s&&u.column.remove(s)}}return i._indices=o,i._selection.update("PROPERTY"),i}return i(e,t),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._indices,e=this._selection.get(),n=0,i=e.length;n<i;++n){var o=e[n];if(o instanceof Un){var r=t[n];0<=r&&o.column.remove(r)}}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._target,e=this._indices,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i];if(r instanceof Un){var a=e[i];0<=a&&r.column.add(t,a)}}return this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),Kn=function(t){function e(e,n,i,o){var r=t.call(this)||this;r._selection=i,r._oldValue=e,r._newValue=n,r._list=o;for(var a=[],l=[],u=r._selection.get(),s=0,p=u.length;s<p;++s){var h=u[s];if(h instanceof Un){var c=h.column.indexOf(e);a.push(c),0<=c?(l.push(h.column.get(c)),h.column.set(c,n)):l.push(n)}else a.push(-1),l.push(n)}return r._indices=a,r._oldValues=l,o.data.selection.contains(e)&&o.data.selection.clearAndAdd(n),r._selection.update("PROPERTY"),r}return i(e,t),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._newValue,e=this._indices,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i];if(r instanceof Un){var a=e[i];0<=a&&r.column.set(a,t)}}var l=this._list;return l.data.selection.contains(this._oldValue)&&l.data.selection.clearAndAdd(t),this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){for(var t=this._indices,e=this._oldValues,n=this._selection.get(),i=0,o=n.length;i<o;++i){var r=n[i];if(r instanceof Un){var a=t[i];0<=a&&r.column.set(a,e[i])}}var l=this._list;return l.data.selection.contains(this._newValue)&&l.data.selection.clearAndAdd(this._oldValue),this._selection.update("PROPERTY"),!0},e}(t.DCommandBase),Zn=function(t){function e(e,n){var i=t.call(this)||this;i._selection=n,i._target=e;for(var o=[],r=i._selection.get(),a=0,l=r.length;a<l;++a){var u=r[a];if(u instanceof Un){var s=u.column,p=s.indexOf(e);o.push(p),0<=p&&p<s.size()-1&&s.swap(p+1,p)}else o.push(-1)}return i._indices=o,i._selection.update("PROPERTY"),i}return i(e,t),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._selection.get(),e=this._indices,n=0,i=t.length;n<i;++n){var o=t[n];if(o instanceof Un){var r=o.column,a=e[n];0<=a&&a<r.size()-1&&r.swap(a+1,a)}}return this._selection.update("PROPERTY"),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),qn=function(t){function e(e,n){for(var i=t.call(this)||this,o=n.get(),r=[],a=0,l=o.length;a<l;++a){var u=o[a];u instanceof Un?(r.push(u.row.height),u.row.height=e):r.push(35)}return i._values=r,i._selection=n,i}return i(e,t),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._selection,e=t.get(),n=[],i=0,o=e.length;i<o;++i){var r=e[i];if(r instanceof Un){var a=n[i];n[i]=r.row.height,r.row.height=a}}return t.update("PROPERTY"),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),Jn=function(t){function e(e,n){for(var i=t.call(this)||this,o=n.get(),r=[],a=0,l=o.length;a<l;++a){var u=o[a];u instanceof Un?(r.push(u.row.selection.type),u.row.selection.type=e):r.push(zn.NONE)}return i._values=r,i._selection=n,i}return i(e,t),e.prototype.execute=function(){return!0},e.prototype.redo=function(){for(var t=this._selection,e=t.get(),n=[],i=0,o=e.length;i<o;++i){var r=e[i];if(r instanceof Un){var a=n[i];n[i]=r.row.selection.type,r.row.selection.type=a}}return t.update("PROPERTY"),!0},e.prototype.undo=function(){return this.redo()},e}(t.DCommandBase),Qn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.newContentChildren=function(n,i){var o=this,r=e.prototype.newContentChildren.call(this,n,i);return r.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:n.getSelectColumnValueTypeLabel()}}),new t.DSelect({weight:1,value:Mn.TEXT,menu:{items:[{value:Mn.TEXT,text:{value:n.toSelectColumnValueTypeLabel(Mn.TEXT)}},{value:Mn.NUMBER,text:{value:n.toSelectColumnValueTypeLabel(Mn.NUMBER)}}]},on:{init:function(t){o._selectType=t}}}),new t.DLayoutSpace({width:60})]})),r.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:n.getInputLabelLabel()}}),new t.DInputText({weight:1,text:{value:""},on:{init:function(t){o._inputLabel=t},enter:function(){o.ok()}}}),new t.DLayoutSpace({width:60})]})),r.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:n.getInputWidthLabel()}}),new t.DInputReal({weight:1,text:{value:0},min:0,on:{init:function(t){o._inputWidth=t},enter:function(){o.ok()}}}),new t.DLayoutSpace({width:60})]})),r.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:n.getInputGetterLabel()}}),new t.DInputText({weight:1,text:{value:""},on:{init:function(t){o._inputGetter=t},enter:function(){o.ok()}}}),new t.DLayoutSpace({width:60})]})),r.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:n.getInputSetterLabel()}}),new t.DInputText({weight:1,text:{value:""},on:{init:function(t){o._inputSetter=t},enter:function(){o.ok()}}}),new t.DLayoutSpace({width:60})]})),r.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:n.getInputFormatLabel()}}),new t.DInputText({weight:1,text:{value:""},on:{init:function(t){o._inputFormat=t},enter:function(){o.ok()}}}),new t.DLayoutSpace({width:60})]})),r.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:n.getSelectTextAlignLabel()}}),new t.DSelect({weight:1,value:t.EShapeTextAlignHorizontal.CENTER,menu:{items:[{value:t.EShapeTextAlignHorizontal.LEFT,text:{value:n.toTextAlignLabel(t.EShapeTextAlignHorizontal.LEFT)}},{value:t.EShapeTextAlignHorizontal.CENTER,text:{value:n.toTextAlignLabel(t.EShapeTextAlignHorizontal.CENTER)}},{value:t.EShapeTextAlignHorizontal.RIGHT,text:{value:n.toTextAlignLabel(t.EShapeTextAlignHorizontal.RIGHT)}}]},on:{init:function(t){o._selectAlign=t}}}),new t.DLayoutSpace({width:60})]})),r},n.prototype.reset=function(){return this._selectType.value=Mn.TEXT,this._inputLabel.value=this.theme.newInputLabel(),this._inputWidth.value=1,this._inputGetter.value="",this._inputSetter.value="",this._inputFormat.value="",this._selectAlign.value=t.EShapeTextAlignHorizontal.CENTER,this},Object.defineProperty(n.prototype,"value",{get:function(){return new Nn(this._inputWidth.value,this._selectType.value||Mn.TEXT,this._inputGetter.value,this._inputSetter.value,this._inputFormat.value,this._selectAlign.value||t.EShapeTextAlignHorizontal.LEFT,new Vn(this._inputLabel.value),new kn)},set:function(t){null!=t&&(this._selectType.value=t.type,this._inputLabel.value=t.header.label,this._inputWidth.value=t.weight,this._inputGetter.value=t.getter,this._inputSetter.value=t.setter,this._inputFormat.value=t.format,this._selectAlign.value=t.align)},enumerable:!1,configurable:!0}),n.prototype.getResolvedValue=function(){return this.value},n.prototype.getType=function(){return"EDialogShapeTableColumn"},n}(t.DDialogLayered),$n=function(e){function n(n){var i=e.call(this,n)||this;i._icons=n.icons;var o=n.selection;i._selection=o,i.state.isDisabled=o.isEmpty(),o.on("change",(function(){i.state.isDisabled=o.isEmpty()})),i.content.setHeight("padding"),new t.DLayoutVertical({parent:i.content,x:"padding",y:"padding",width:"padding",height:"padding",children:[new t.DLayoutHorizontal({width:"100%",height:"auto",children:[i.newTextLabel(),i.buttonNew,i.buttonDelete,i.buttonBringForward,i.buttonSendBackward]}),i.columnList,new t.DText({width:"100%",text:{value:i.subtheme.getInputRowHeightLabel()}}),i.inputRowHeight,new t.DText({width:"100%",text:{value:i.subtheme.getSelectRowSelectionTypeLabel()}}),i.selectRowSelectionType]}),o.on("change",(function(){i.onSelectionChange(o)}));var r=i.columnList;return r.data.selection.on("change",(function(){i.onListSelectionChange(r)})),i.onSelectionChange(o),i}return i(n,e),n.prototype.newTextLabel=function(){return new t.DText({weight:1,text:{value:this.subtheme.getLabel()}})},Object.defineProperty(n.prototype,"buttonNew",{get:function(){var t;return null!==(t=this._buttonNew)&&void 0!==t?t:this._buttonNew=this.newButtonNew()},enumerable:!1,configurable:!0}),n.prototype.newButtonNew=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.subtheme.getButtonNewTitle(),on:{active:function(t){e.onButtonNewActive(t)}}})},n.prototype.onButtonNewActive=function(e){var n=this;this.columnDialog.reset().open(e).then((function(e){null!=e&&t.DControllers.getCommandController().push(new Yn(e,n._selection))}))},n.prototype.onSelectionChangeButtonNew=function(t){var e=this.buttonNew;t.last()instanceof Un?e.state.isDisabled=!1:e.state.isDisabled=!0},Object.defineProperty(n.prototype,"buttonDelete",{get:function(){var t;return null!==(t=this._buttonDelete)&&void 0!==t?t:this._buttonDelete=this.newButtonDelete()},enumerable:!1,configurable:!0}),n.prototype.newButtonDelete=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.subtheme.getButtonDeleteTitle(),on:{active:function(){var n=e.columnList,i=n.data.selection.first;null!=i&&1<n.data.size()&&t.DControllers.getCommandController().push(new Wn(i,e._selection))}}})},n.prototype.onListSelectionChangeButtonDelete=function(t){this.buttonDelete.state.isDisabled=t.data.size()<=1||t.data.selection.isEmpty()},Object.defineProperty(n.prototype,"buttonBringForward",{get:function(){var t;return null!==(t=this._buttonBringForward)&&void 0!==t?t:this._buttonBringForward=this.newButtonBringForward()},enumerable:!1,configurable:!0}),n.prototype.newButtonBringForward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.subtheme.getButtonBringForwardTitle(),on:{active:function(){var n=e.columnList,i=n.selection.first;null!=i&&n.data.items[0]!==i&&t.DControllers.getCommandController().push(new Xn(i,e._selection))}}})},n.prototype.onListSelectionChangeButtonBringForward=function(t){var e=t.data.selection.first,n=t.data.items;this.buttonBringForward.state.isDisabled=null==e||n[0]===e},Object.defineProperty(n.prototype,"buttonSendBackward",{get:function(){var t;return null!==(t=this._buttonSendBackward)&&void 0!==t?t:this._buttonSendBackward=this.newButtonSendBackward()},enumerable:!1,configurable:!0}),n.prototype.newButtonSendBackward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.subtheme.getButtonSendBackwardTitle(),on:{active:function(){var n=e.columnList,i=n.selection.first,o=n.data.items;null!=i&&o[o.length-1]!==i&&t.DControllers.getCommandController().push(new Zn(i,e._selection))}}})},n.prototype.onListSelectionChangeButtonSendBackward=function(t){var e=t.selection.first,n=t.data.items;this.buttonSendBackward.state.isDisabled=null==e||n[n.length-1]===e},Object.defineProperty(n.prototype,"columnDialog",{get:function(){var t;return null!==(t=this._columnDialog)&&void 0!==t?t:this._columnDialog=this.newColumnDialog()},enumerable:!1,configurable:!0}),n.prototype.newColumnDialog=function(){return new Qn},Object.defineProperty(n.prototype,"columnList",{get:function(){var t;return null!==(t=this._columnList)&&void 0!==t?t:this._columnList=this.newColumnList()},enumerable:!1,configurable:!0}),n.prototype.newColumnList=function(){var e=this,n=new t.DList({width:"100%",weight:1,data:{toLabel:function(t){return t.toLabel()}},updater:{newItem:function(i){return new t.DListItem(i,{on:{dblclick:function(t,i,o){e.onColumnListDblClick(t,i,o,n)}}})}}});return n},n.prototype.onColumnListDblClick=function(e,n,i,o){var r=this,a=i.value;if(null!=a){var l=this.columnDialog;l.value=a,l.open(i).then((function(){var e=l.value;null!=e&&t.DControllers.getCommandController().push(new Kn(a,e,r._selection,o))}))}},n.prototype.onSelectionChangeColumnList=function(t){var e=t.last(),n=this.columnList;n.data.items=e instanceof Un?e.column.values:[],this.onListSelectionChange(n)},Object.defineProperty(n.prototype,"inputRowHeight",{get:function(){var t;return null!==(t=this._inputRowHeight)&&void 0!==t?t:this._inputRowHeight=this.newInputRowHeight()},enumerable:!1,configurable:!0}),n.prototype.newInputRowHeight=function(){var e=this;return new t.DInputReal({width:"100%",min:5,step:1,on:{change:function(n){t.DControllers.getCommandController().push(new qn(n,e._selection))}}})},n.prototype.onSelectionChangeInputRowHeight=function(t){var e=t.last(),n=this.inputRowHeight;e instanceof Un?(n.value=e.row.height,n.state.isDisabled=!1):n.state.isDisabled=!0},Object.defineProperty(n.prototype,"selectRowSelectionType",{get:function(){var t;return null!==(t=this._selectRowSelectionType)&&void 0!==t?t:this._selectRowSelectionType=this.newSelectRowSelectionType()},enumerable:!1,configurable:!0}),n.prototype.newSelectRowSelectionType=function(){var e=this,n=this.subtheme;return new t.DSelect({width:"100%",value:zn.SINGLE,menu:{items:[{value:zn.NONE,text:{value:n.toSelectRowSelectionTypeLabel(zn.NONE)}},{value:zn.SINGLE,text:{value:n.toSelectRowSelectionTypeLabel(zn.SINGLE)}},{value:zn.MULTIPLE,text:{value:n.toSelectRowSelectionTypeLabel(zn.MULTIPLE)}}]},on:{change:function(n){null==n&&(n=zn.SINGLE),t.DControllers.getCommandController().push(new Jn(n,e._selection))}}})},n.prototype.onSelectionChangeSelectRowSelectionType=function(t){var e=t.last(),n=this.selectRowSelectionType;e instanceof Un?(n.value=e.row.selection.type,n.state.isDisabled=!1):n.state.isDisabled=!0},n.prototype.onSelectionChange=function(t){this.onSelectionChangeButtonNew(t),this.onSelectionChangeColumnList(t),this.onSelectionChangeInputRowHeight(t),this.onSelectionChangeSelectRowSelectionType(t)},n.prototype.onListSelectionChange=function(t){this.onListSelectionChangeButtonDelete(t),this.onListSelectionChangeButtonBringForward(t),this.onListSelectionChangeButtonSendBackward(t)},Object.defineProperty(n.prototype,"subtheme",{get:function(){var t;return null!==(t=this._subtheme)&&void 0!==t?t:this._subtheme=this.newSubtheme()},enumerable:!1,configurable:!0}),n.prototype.newSubtheme=function(){return t.DThemes.get("EEditorShapeTable")},n}(t.DPane),ti=function(t){function e(e){var n=t.call(this)||this;return n.body=q.findChildByType(e,jn.BODY_ID),n.column=e.column,n}return i(e,t),e.prototype.execute=function(t,e,n){var i=this.body,o=this.column;if(null!=i&&null!=o){var r=t.data;if(r.isChanged){var a=i.children,l=a.length,u=r.get(0);if(null!=u){for(var s=o.values,p=u.values,h=p.length,c=Math.min(l,h),d=0;d<c;++d){for(var g=p[d],f=(_=a[d].children).length,y=Math.min(f,s.length),v=0;v<y;++v){var b=_[v],m=s[v].runtime;null!=m&&(b.state.isFocusable=!0,b.text.value=m.formatter(m.toValue(g,v,p),v))}for(v=y;v<f;++v)(b=_[v]).state.isFocusable=!1,b.text.value=""}for(d=c;d<l;++d)for(f=(_=a[d].children).length,v=0;v<f;++v)(b=_[v]).state.isFocusable=!1,b.text.value=""}else for(d=0;d<l;++d){var _;for(f=(_=a[d].children).length,v=0;v<f;++v)(b=_[v]).state.isFocusable=!1,b.text.value=""}}}},e}(t.EShapeActionRuntimeBase),ei=function(e){function n(){return e.call(this,t.EShapeActionValueChangeColorType.FILL,"",n.getColorCode(),"","")||this}return i(n,e),n.getColorCode=function(){var e=t.UtilRgb.brighten(t.EShapeDefaults.HIGHLIGHT_COLOR,.8),n=t.UtilRgb.brighten(t.EShapeDefaults.HIGHLIGHT_COLOR,.75),i=t.UtilRgb.brighten(t.EShapeDefaults.HIGHLIGHT_COLOR,.85),o=t.UtilRgb.darken(t.EShapeDefaults.FILL_COLOR,.25);return"inDisabled ? ".concat(o," : ( isActive ?")+"\t( isHovered ? ".concat(e," : ").concat(n," ) :")+"\t( isHovered ? ".concat(i," : null )")+")"},n}(t.EShapeActionValueChangeColorCode),ni=function(n){function o(t){var e=n.call(this,t)||this;return e.lastRowIndex=-1,e.lastColumnIndex=-1,e.init(t),e}return i(o,n),o.prototype.init=function(t){var e=t.parent;if(e instanceof Un){this.selection=e.row.selection;for(var n=t.children,i=0,o=n.length;i<o;++i)for(var r=n[i].children,a=0,l=r.length;a<l;++a)r[a].action.add(new ei)}},o.prototype.onClick=function(t,e){n.prototype.onClick.call(this,t,e);var i=this.selection;if(null!=e&&null!=i&&i.type!==zn.NONE){var o=this.lastRowIndex;if(0<=o){var r=i.indices,a=i.type===zn.SINGLE,l=!a,u="data"in e?e.data.originalEvent:e,s=u.ctrlKey,p=u.shiftKey;a||r.length<=0||!l||!s&&!p?i.clearAndAdd(o):s?i.toggle(o):p&&i.addTo(o)}}},o.prototype.onDblClick=function(t,e,i){var o=n.prototype.onDblClick.call(this,t,e,i),r=this.getCell(t,this.lastRowIndex,this.lastColumnIndex);return null!=r&&r.focus(),o},o.prototype.onOut=function(t,e){n.prototype.onOut.call(this,t,e);var i=this.lastRowIndex;0<=i&&(this.setRowHovered(t,i,!1),this.lastRowIndex=-1)},o.prototype.onCellTouched=function(e,n,i){var o=!1,r=this.lastRowIndex;if(r!==n&&(this.setRowHovered(e,r,!1),this.setRowHovered(e,n,!0),this.lastRowIndex=n,o=!0),this.lastColumnIndex!==i&&(this.lastColumnIndex=i,o=!0),o){var a=this.getCell(e,n,i);e.title=a&&a.text.value||"";var l=t.DApplications.getLayer(e);l&&(l.view.title=e.title)}},o.prototype.getRow=function(t,e){var n=t.children;return 0<=e&&e<n.length?n[e]:null},o.prototype.getCell=function(t,e,n){var i=this.getRow(t,e);if(null!=i){var o=i.children;if(0<=n&&n<o.length)return o[n]}return null},o.prototype.setRowHovered=function(t,e,n){var i=this.getRow(t,e);if(null!=i)for(var o=i.children,r=0,a=o.length;r<a;++r)o[r].state.isHovered=n},o.WORK_POINT=new e.Point,o}(t.EShapeRuntimeImpl),ii=function(t){function e(e,n){return void 0===n&&(n=jn.BODY_ID),t.call(this,e,n)||this}return i(e,t),e.prototype.containsAbs=function(t,e,n,i){if(this.containsAbsBBox(t,e,n,i)){var o=this.children;if(0<o.length){var r=o[0],a=(i+e)/r.size.y|0;if(a<o.length){for(var l=r.children,u=0,s=l.length;u<s;++u){var p=l[u];if(t<p.transform.position.x+.5*p.size.x){var h=this.runtime;return h instanceof ni&&h.onCellTouched(this,a,u),!0}}return!0}return!1}}return!1},e.prototype.containsText=function(t,e){return null},e.prototype.containsChildren=function(t,e){return null},e}(t.EShapeGroupShadowed),oi=function(t,e){return t[e]},ri=function(t,e,n,i){t[e]=i},ai=function(t){return String(t)},li=function(){function e(e){if(this.toValue=this.parseToValue(e.getter,oi,'""'),this.fromValue=this.parseFromValue(e.setter,ri),e.type===Mn.TEXT)this.formatter=this.parseFormat(e.format,ai,'""');else{var n=e.format;if(0<n.trim().length){var i=t.NumberFormatters.create(n);this.formatter=function(t){return i.format(t,1)}}else this.formatter=ai}}return e.prototype.parseToValue=function(t,e,n){if(t.trim().length<=0)return e;try{return Function("row","index","rows","try{ return (".concat(t,"); } catch( e ) { return ").concat(n,"; }"))}catch(t){return e}},e.prototype.parseFromValue=function(t,e){if(t.trim().length<=0)return e;try{return Function("row","index","rows","value","try{ ".concat(t," = value; } catch( e ) {}"))}catch(t){return e}},e.prototype.parseFormat=function(t,e,n){if(t.trim().length<=0)return e;try{return Function("value","index","try{ return (".concat(t,"); } catch( e ) { return ").concat(n,"; }"))}catch(t){return e}},e}(),ui=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(t.EShapeRuntimeImpl),si=function(t){function e(e,n){return void 0===n&&(n=jn.HEADER_ID),t.call(this,e,n)||this}return i(e,t),e}(t.EShapeGroupShadowed),pi=function(t){function e(e){var n=t.call(this,e)||this;if(e instanceof Un){for(var i=e.column.values,o=0,r=i.length;o<r;++o){var a=i[o];a.runtime=new li(a)}n.actions.push(new ti(e))}return n}return i(e,t),e}(t.EShapeRuntimeImpl),hi=function(){function e(){}return e.getTheme=function(){return t.DThemes.get("EShapeTable")},e.create=function(e){var n=t.EShapeResourceManagerDeserializationMode.EDITOR,i=new Un(n),o=new si(n).attach(i),r=(new t.EShapeRectangle).attach(o);r.stroke.side=t.EShapeStrokeSide.BOTTOM,r.stroke.width=1,r.stroke.color=t.UtilRgb.brighten(t.EShapeDefaults.STROKE_COLOR,.65);var a=new ii(n).attach(i);a.state.isFocusable=!0,a.interactive=!0;var l=new t.EShapeGroupShadowed(n).attach(a),u=new t.EShapeGroupShadowed(n).attach(a),s=(new t.EShapeRectangle).attach(l);s.stroke.enable=!1,s.text.value="-",s.text.clipping=!0;var p=(new t.EShapeRectangle).attach(u);return p.fill.color=t.UtilRgb.darken(t.EShapeDefaults.FILL_COLOR,.05),p.stroke.enable=!1,p.text.value="-",p.text.clipping=!0,i.column.add(new Nn(1,Mn.TEXT,"","","",t.EShapeTextAlignHorizontal.CENTER,new Vn(this.getTheme().newHeaderLabel()),new kn)),e&&i.copy(e),i.onSizeChange(),i},e.load=function(){var n=this.getTheme(),i=n.getName();Ge.add({type:jn.ID,name:i,icon:{width:24,height:24,svg:'<g transform="scale(26.6666)" fill="#fff" stroke="none"><path d="M20 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 2v3H5V5h15zm-5 14h-5v-9h5v9zM5 10h3v9H5v-9zm12 9v-9h3v9h-3z"/></g>'},title:i,creator:function(t){return e.create(t)},deserializer:function(t,n){return e.deserialize(t,n)},editor:$n,runtime:pi,uploaded:t.createGroupUploaded}),Ge.add({type:jn.HEADER_ID,name:n.getHeaderName(),deserializer:function(t,n){return e.deserializeHeader(t,n)},runtime:ui,capability:t.EShapeCapability.PRIMITIVE&~t.EShapeCapability.CHILDREN}),Ge.add({type:jn.BODY_ID,name:n.getBodyName(),deserializer:function(t,n){return e.deserializeBody(t,n)},runtime:ni,capability:t.EShapeCapability.PRIMITIVE&~t.EShapeCapability.CHILDREN})},e.deserialize=function(e,n){var i=new Un(n.mode),o=e[15],r=n.resources;if(0<=o&&o<r.length){var a=n.getExtension(o);null==a&&(a=JSON.parse(r[o]),n.setExtension(o,a)),i.column.deserialize(a[0],n),i.row.deserialize(a[1],n),e[15]=a[a.length-1]}var l=t.deserializeBase(e,n,i);return i.size.init(),l},e.deserializeHeader=function(e,n){var i=new si(n.mode),o=t.deserializeBase(e,n,i);return i.size.init(),o},e.deserializeBody=function(e,n){var i=new ii(n.mode),o=t.deserializeBase(e,n,i);return i.size.init(),o},e}(),ci=function(t){return"extension_factory_icon_".concat(t)},di=function(){function t(){}return t.add=function(t){this._factories.push(t)},t.each=function(t){for(var e=this._factories,n=0,i=e.length;n<i;++n)t(e[n])},t.merge=function(t){for(var e=this._factories,n=0,i=e.length;n<i;++n){var o=e[n].icon;t.add(ci(n),o.width,o.height,o.svg)}},t.build=function(t){for(var e=this._factories,n=0,i=e.length;n<i;++n)e[n].icon.texture=t[ci(n)]},t._factories=[],t}(),gi=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.getClipperRect=function(e,n,i){return t.UtilHtmlElement.getClipperRect(null,this,e,n,i)},n}(t.DInputSearch),fi=function(e){function n(n){var i=e.call(this,n)||this;return i.addChild(new t.DLayoutVertical({x:"padding",y:"padding",width:"padding",height:"padding",children:[i.input,i.list,i.text]})),i.onInputChange(""),i}return i(n,e),Object.defineProperty(n.prototype,"input",{get:function(){var t=this._input;return null==t&&(t=this.newInput(),this._input=t),t},enumerable:!1,configurable:!0}),n.prototype.newInput=function(){var t=this;return new gi({width:"padding",on:{input:function(e){t.onInputChange(e)}}})},n.prototype.onInputChange=function(t){this.list.data.clearAndAddAll(this.newKeywords(t))},n.prototype.newKeywords=function(e){var n,i=null!==(n=this._keywords)&&void 0!==n?n:this._keywords=t.DThemes.get("EDialogAction").newKeywords();if(0<e.trim().length){for(var o=[],r=0,a=i.length;r<a;++r){var l=i[r];0<=l.keyword.indexOf(e)&&o.push(l)}return o}return i},Object.defineProperty(n.prototype,"list",{get:function(){var t=this._list;return null==t&&(t=this.newList(),this._list=t),t},enumerable:!1,configurable:!0}),n.prototype.newList=function(){var e=this;return new t.DList({weight:1,width:"padding",data:{selection:{on:{change:function(){e.onListSelectionChange()}}},toLabel:function(t){return t.keyword},toId:function(t){return t.keyword}}})},n.prototype.onListSelectionChange=function(){var t=this.list.data.selection.first;this.text.text=t?"".concat(t.keyword,": ").concat(t.type,"\n").concat(t.description):""},Object.defineProperty(n.prototype,"text",{get:function(){var t=this._text;return null==t&&(t=this.newText(),this._text=t),t},enumerable:!1,configurable:!0}),n.prototype.newText=function(){return new t.DText({width:"padding",height:120,state:"READ_ONLY",text:{style:{wordWrap:"NORMAL"}},theme:"DInputTextArea"})},n.prototype.getType=function(){return"DDialog"},n}(t.DBoard),yi=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.newContentChildren=function(t,n){var i=this,o=e.prototype.newContentChildren.call(this,t,n);o.push(this.selectLayout,this.showHideTypeLayout,this.blinkTypeLayout,this.transformTypeLayout,this.changeColorTypeLayout,this.changeColorTargetLayout,this.rotateTypeLayout,this.resizeTypeLayout,this.originXLayout,this.originYLayout,this.moveTypeLayout,this.openTypeLayout,this.openDialogTypeLayout,this.changeTextTypeLayout,this.miscTypeLayout,this.onInputActionLayout,this.whenTypeLayout,this.gestureTypeLayout,this.gestureOperationTypeLayout,this.selectLayerLayout,this.condition,this.intervalLayout,this.size,this.amount,this.targetName,this.colorLayout,this.target,this.argument,this.contents,this.initialization,this.pointerEventsLayout,this.colorCode,this.alphaCode,this.brightness,this.blend,this.initial,this.step,this.min,this.max,this.scaleLayout,this.checkBringToFrontLayout,this.inNewWindowLayout);var r=function(){i.onChange()};return this.select.on("change",r),this.showHideType.on("change",r),this.blinkType.on("change",r),this.transformType.on("change",r),this.resizeType.on("change",r),this.changeColorTarget.on("change",r),this.openType.on("change",r),this.openDialogType.on("change",r),this.miscType.on("change",r),o},n.prototype.newLabel=function(e){return new t.DInputLabel({width:60,text:{value:e}})},n.prototype.newSpace=function(){return new t.DLayoutSpace({width:60})},n.prototype.newLabeled=function(e,n){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[null!=e?this.newLabel(e):this.newSpace(),n,this.newSpace()]})},Object.defineProperty(n.prototype,"themeShape",{get:function(){var t;return null!==(t=this._themeShape)&&void 0!==t?t:this._themeShape=this.newThemeShape()},enumerable:!1,configurable:!0}),n.prototype.newThemeShape=function(){return t.DThemes.get("EShapeActionValue")},Object.defineProperty(n.prototype,"select",{get:function(){var t;return null!==(t=this._select)&&void 0!==t?t:this._select=this.newSelect()},enumerable:!1,configurable:!0}),n.prototype.newSelect=function(){return new t.DSelect({weight:1,value:t.EShapeActionValueType.SHOW_HIDE,menu:{items:this.newSelectMenuItems()}})},n.prototype.newSelectMenuItems=function(){var e=this.themeShape,n=[{value:t.EShapeActionValueType.SHOW_HIDE,text:{value:e.toTypeLabel(t.EShapeActionValueType.SHOW_HIDE)}},{value:t.EShapeActionValueType.BLINK,text:{value:e.toTypeLabel(t.EShapeActionValueType.BLINK)}},{value:t.EShapeActionValueType.TRANSFORM,text:{value:e.toTypeLabel(t.EShapeActionValueType.TRANSFORM)}},{value:t.EShapeActionValueType.CHANGE_COLOR,text:{value:e.toTypeLabel(t.EShapeActionValueType.CHANGE_COLOR)}},{value:t.EShapeActionValueType.CHANGE_TEXT,text:{value:e.toTypeLabel(t.EShapeActionValueType.CHANGE_TEXT)}},{value:t.EShapeActionValueType.CHANGE_CURSOR,text:{value:e.toTypeLabel(t.EShapeActionValueType.CHANGE_CURSOR)}},{value:t.EShapeActionValueType.OPEN,text:{value:e.toTypeLabel(t.EShapeActionValueType.OPEN)}},{value:t.EShapeActionValueType.GESTURE,text:{value:e.toTypeLabel(t.EShapeActionValueType.GESTURE)}},{value:t.EShapeActionValueType.MISC,text:{value:e.toTypeLabel(t.EShapeActionValueType.MISC)}}];return Ne.each((function(t){n.push({value:t.type,text:{value:t.label}})})),n},Object.defineProperty(n.prototype,"selectLayout",{get:function(){var t;return null!==(t=this._selectLayout)&&void 0!==t?t:this._selectLayout=this.newSelectLayout()},enumerable:!1,configurable:!0}),n.prototype.newSelectLayout=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabel(this.theme.getSelectActionLabel()),this.select,new t.DLayoutHorizontal({width:60,height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonKeyword]})]})},Object.defineProperty(n.prototype,"buttonKeyword",{get:function(){var t;return null!==(t=this._buttonKeyword)&&void 0!==t?t:this._buttonKeyword=this.newButtonKeyword()},enumerable:!1,configurable:!0}),n.prototype.newButtonKeyword=function(){var e,n=this;return new t.DButtonAmbient({width:30,toggle:!0,image:{source:null===(e=this.options)||void 0===e?void 0:e.icons.action_keyword},title:this.theme.getButtonKeywordTitle(),on:{active:function(){n.onButtonKeywordActive()},inactive:function(){n.onButtonKeywordInactive()}}})},n.prototype.onButtonKeywordActive=function(){var e=this.boardKeyword,n=this.getBoardKeywordOffset(),i=this.width,o=t.DApplications.getLayer(this);if(null!=o){var r=e.width;o.width<this.position.x+i+n+r?e.position.x=-r-n:e.position.x=i+n}else e.position.x=i+n;e.show()},n.prototype.onButtonKeywordInactive=function(){this.boardKeyword.hide()},Object.defineProperty(n.prototype,"boardKeyword",{get:function(){var t;return null!==(t=this._boardKeyword)&&void 0!==t?t:this._boardKeyword=this.newBoardKeyword()},enumerable:!1,configurable:!0}),n.prototype.newBoardKeyword=function(){return new fi({parent:this,x:0,y:0,width:function(){return 300},height:function(){return 400},padding:16})},n.prototype.getBoardKeywordOffset=function(){return 16},Object.defineProperty(n.prototype,"showHideType",{get:function(){var t;return null!==(t=this._showHideType)&&void 0!==t?t:this._showHideType=this.newShowHideType()},enumerable:!1,configurable:!0}),n.prototype.newShowHideType=function(){var e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueShowHideType.SHAPE,menu:{items:[{value:t.EShapeActionValueShowHideType.SHAPE,text:{value:e.toShowHideTypeLabel(t.EShapeActionValueShowHideType.SHAPE)}},{value:t.EShapeActionValueShowHideType.LAYER,text:{value:e.toShowHideTypeLabel(t.EShapeActionValueShowHideType.LAYER)}}]}})},Object.defineProperty(n.prototype,"showHideTypeLayout",{get:function(){var t;return null!==(t=this._showHideTypeLayout)&&void 0!==t?t:this._showHideTypeLayout=this.newLabeled(null,this.showHideType)},enumerable:!1,configurable:!0}),n.prototype.onChangeShowHideTypeLayout=function(e){var n=this.showHideTypeLayout;e===t.EShapeActionValueType.SHOW_HIDE?n.show():n.hide()},Object.defineProperty(n.prototype,"blinkType",{get:function(){var t;return null!==(t=this._blinkType)&&void 0!==t?t:this._blinkType=this.newBlinkType()},enumerable:!1,configurable:!0}),n.prototype.newBlinkType=function(){var e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueBlinkType.VISIBILITY,menu:{items:[{value:t.EShapeActionValueBlinkType.VISIBILITY,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.VISIBILITY)}},{value:t.EShapeActionValueBlinkType.BRIGHTEN,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.BRIGHTEN)}},{value:t.EShapeActionValueBlinkType.DARKEN,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.DARKEN)}},{value:t.EShapeActionValueBlinkType.OPACITY,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.OPACITY)}},{value:t.EShapeActionValueBlinkType.COLOR_FILL,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.COLOR_FILL)}},{value:t.EShapeActionValueBlinkType.COLOR_STROKE,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.COLOR_STROKE)}}]}})},Object.defineProperty(n.prototype,"blinkTypeLayout",{get:function(){var t;return null!==(t=this._blinkTypeLayout)&&void 0!==t?t:this._blinkTypeLayout=this.newLabeled(null,this.blinkType)},enumerable:!1,configurable:!0}),n.prototype.onChangeBlinkTypeLayout=function(e){var n=this.blinkTypeLayout;e===t.EShapeActionValueType.BLINK?n.show():n.hide()},Object.defineProperty(n.prototype,"transformType",{get:function(){var t;return null!==(t=this._transformType)&&void 0!==t?t:this._transformType=this.newTransformType()},enumerable:!1,configurable:!0}),n.prototype.newTransformType=function(){var e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueTransformType.MOVE,menu:{items:[{value:t.EShapeActionValueTransformType.MOVE,text:{value:e.toTransformTypeLabel(t.EShapeActionValueTransformType.MOVE)}},{value:t.EShapeActionValueTransformType.ROTATE,text:{value:e.toTransformTypeLabel(t.EShapeActionValueTransformType.ROTATE)}},{value:t.EShapeActionValueTransformType.RESIZE,text:{value:e.toTransformTypeLabel(t.EShapeActionValueTransformType.RESIZE)}}]}})},Object.defineProperty(n.prototype,"transformTypeLayout",{get:function(){var t;return null!==(t=this._transformTypeLayout)&&void 0!==t?t:this._transformTypeLayout=this.newLabeled(null,this.transformType)},enumerable:!1,configurable:!0}),n.prototype.onChangeTransformTypeLayout=function(e){var n=this.transformTypeLayout;e===t.EShapeActionValueType.TRANSFORM?n.show():n.hide()},Object.defineProperty(n.prototype,"changeColorType",{get:function(){var t;return null!==(t=this._changeColorType)&&void 0!==t?t:this._changeColorType=this.newChangeColorType()},enumerable:!1,configurable:!0}),n.prototype.newChangeColorType=function(){var e=this.themeShape;return new t.DSelectMultiple({weight:1,values:[t.EShapeActionValueChangeColorType.FILL],menu:{items:[{value:t.EShapeActionValueChangeColorType.FILL,text:{value:e.toChangeColorTypeLabel(t.EShapeActionValueChangeColorType.FILL)},check:!0},{value:t.EShapeActionValueChangeColorType.STROKE,text:{value:e.toChangeColorTypeLabel(t.EShapeActionValueChangeColorType.STROKE)},check:!0},{value:t.EShapeActionValueChangeColorType.TEXT,text:{value:e.toChangeColorTypeLabel(t.EShapeActionValueChangeColorType.TEXT)},check:!0},{value:t.EShapeActionValueChangeColorType.TEXT_OUTLINE,text:{value:e.toChangeColorTypeLabel(t.EShapeActionValueChangeColorType.TEXT_OUTLINE)},check:!0}]}})},Object.defineProperty(n.prototype,"changeColorTypeLayout",{get:function(){var t;return null!==(t=this._changeColorTypeLayout)&&void 0!==t?t:this._changeColorTypeLayout=this.newLabeled(null,this.changeColorType)},enumerable:!1,configurable:!0}),n.prototype.onChangeChangeColorTypeLayout=function(e){var n=this.changeColorTypeLayout;e===t.EShapeActionValueType.CHANGE_COLOR?n.show():n.hide()},Object.defineProperty(n.prototype,"changeColorTarget",{get:function(){var t;return null!==(t=this._changeColorTarget)&&void 0!==t?t:this._changeColorTarget=this.newChangeColorTarget()},enumerable:!1,configurable:!0}),n.prototype.newChangeColorTarget=function(){var e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA,menu:{items:[{value:t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA,text:{value:e.toChangeColorTargetLabel(t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA)}},{value:t.EShapeActionValueChangeColorTarget.COLOR,text:{value:e.toChangeColorTargetLabel(t.EShapeActionValueChangeColorTarget.COLOR)}},{value:t.EShapeActionValueChangeColorTarget.ALPHA,text:{value:e.toChangeColorTargetLabel(t.EShapeActionValueChangeColorTarget.ALPHA)}},{value:t.EShapeActionValueChangeColorTarget.CODE,text:{value:e.toChangeColorTargetLabel(t.EShapeActionValueChangeColorTarget.CODE)}},{value:t.EShapeActionValueChangeColorTarget.BRIGHTNESS,text:{value:e.toChangeColorTargetLabel(t.EShapeActionValueChangeColorTarget.BRIGHTNESS)}}]}})},Object.defineProperty(n.prototype,"changeColorTargetLayout",{get:function(){var t;return null!==(t=this._changeColorTargetLayout)&&void 0!==t?t:this._changeColorTargetLayout=this.newLabeled(null,this.changeColorTarget)},enumerable:!1,configurable:!0}),n.prototype.onChangeChangeColorTargetLayout=function(e){var n=this.changeColorTargetLayout;e===t.EShapeActionValueType.CHANGE_COLOR?n.show():n.hide()},Object.defineProperty(n.prototype,"rotateType",{get:function(){var t;return null!==(t=this._rotateType)&&void 0!==t?t:this._rotateType=this.newRotateType()},enumerable:!1,configurable:!0}),n.prototype.newRotateType=function(){var e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueTransformRotateType.RELATIVE,menu:{items:[{value:t.EShapeActionValueTransformRotateType.RELATIVE,text:{value:e.toTransformRotateTypeLabel(t.EShapeActionValueTransformRotateType.RELATIVE)}},{value:t.EShapeActionValueTransformRotateType.ABSOLUTE,text:{value:e.toTransformRotateTypeLabel(t.EShapeActionValueTransformRotateType.ABSOLUTE)}}]}})},Object.defineProperty(n.prototype,"rotateTypeLayout",{get:function(){var t;return null!==(t=this._rotateTypeLayout)&&void 0!==t?t:this._rotateTypeLayout=this.newLabeled(null,this.rotateType)},enumerable:!1,configurable:!0}),n.prototype.onChangeRotateTypeLayout=function(e){var n=this.rotateTypeLayout;e===t.EShapeActionValueType.TRANSFORM&&this.transformType.value===t.EShapeActionValueTransformType.ROTATE?n.show():n.hide()},Object.defineProperty(n.prototype,"resizeType",{get:function(){var t;return null!==(t=this._resizeType)&&void 0!==t?t:this._resizeType=this.newResizeType()},enumerable:!1,configurable:!0}),n.prototype.newResizeType=function(){var e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueTransformResizeType.RELATIVE_SIZE,menu:{items:[{value:t.EShapeActionValueTransformResizeType.ABSOLUTE_SIZE,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.ABSOLUTE_SIZE)}},{value:t.EShapeActionValueTransformResizeType.RELATIVE_SIZE,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.RELATIVE_SIZE)}},{value:t.EShapeActionValueTransformResizeType.ABSOLUTE_HEIGHT,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.ABSOLUTE_HEIGHT)}},{value:t.EShapeActionValueTransformResizeType.RELATIVE_HEIGHT,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.RELATIVE_HEIGHT)}},{value:t.EShapeActionValueTransformResizeType.ABSOLUTE_WIDTH,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.ABSOLUTE_WIDTH)}},{value:t.EShapeActionValueTransformResizeType.RELATIVE_WIDTH,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.RELATIVE_WIDTH)}}]}})},Object.defineProperty(n.prototype,"resizeTypeLayout",{get:function(){var t;return null!==(t=this._resizeTypeLayout)&&void 0!==t?t:this._resizeTypeLayout=this.newLabeled(null,this.resizeType)},enumerable:!1,configurable:!0}),n.prototype.onChangeResizeTypeLayout=function(e){var n=this.resizeTypeLayout;e===t.EShapeActionValueType.TRANSFORM&&this.transformType.value===t.EShapeActionValueTransformType.RESIZE?n.show():n.hide()},Object.defineProperty(n.prototype,"originX",{get:function(){var t;return null!==(t=this._originX)&&void 0!==t?t:this._originX=this.newOriginX()},enumerable:!1,configurable:!0}),n.prototype.newOriginX=function(){var e=this;return new t.DInputReal({weight:1,text:{value:.5},step:.1,on:{enter:function(){e.ok()}}})},Object.defineProperty(n.prototype,"originXLayout",{get:function(){var t;return null!==(t=this._originXLayout)&&void 0!==t?t:this._originXLayout=this.newLabeled(this.theme.getInputOriginXLabel(),this.originX)},enumerable:!1,configurable:!0}),n.prototype.onChangeOriginXLayout=function(e){var n=this.originXLayout;if(e===t.EShapeActionValueType.TRANSFORM){var i=this.transformType.value;if(i===t.EShapeActionValueTransformType.RESIZE){var o=this.resizeType.value;o===t.EShapeActionValueTransformResizeType.ABSOLUTE_SIZE||o===t.EShapeActionValueTransformResizeType.RELATIVE_SIZE||o===t.EShapeActionValueTransformResizeType.ABSOLUTE_WIDTH||o===t.EShapeActionValueTransformResizeType.RELATIVE_WIDTH?n.show():n.hide()}else i===t.EShapeActionValueTransformType.ROTATE?n.show():n.hide()}else n.hide()},Object.defineProperty(n.prototype,"originY",{get:function(){var t;return null!==(t=this._originY)&&void 0!==t?t:this._originY=this.newOriginY()},enumerable:!1,configurable:!0}),n.prototype.newOriginY=function(){var e=this;return new t.DInputReal({weight:1,text:{value:.5},step:.1,on:{enter:function(){e.ok()}}})},Object.defineProperty(n.prototype,"originYLayout",{get:function(){var t;return null!==(t=this._originYLayout)&&void 0!==t?t:this._originYLayout=this.newLabeled(this.theme.getInputOriginYLabel(),this.originY)},enumerable:!1,configurable:!0}),n.prototype.onChangeOriginYLayout=function(e){var n=this.originYLayout;if(e===t.EShapeActionValueType.TRANSFORM){var i=this.transformType.value;if(i===t.EShapeActionValueTransformType.RESIZE){var o=this.resizeType.value;o===t.EShapeActionValueTransformResizeType.ABSOLUTE_SIZE||o===t.EShapeActionValueTransformResizeType.RELATIVE_SIZE||o===t.EShapeActionValueTransformResizeType.ABSOLUTE_HEIGHT||o===t.EShapeActionValueTransformResizeType.RELATIVE_HEIGHT?n.show():n.hide()}else i===t.EShapeActionValueTransformType.ROTATE?n.show():n.hide()}else n.hide()},Object.defineProperty(n.prototype,"moveType",{get:function(){var t;return null!==(t=this._moveType)&&void 0!==t?t:this._moveType=this.newMoveType()},enumerable:!1,configurable:!0}),n.prototype.newMoveType=function(){var e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueTransformMoveType.RELATIVE_X,menu:{items:[{value:t.EShapeActionValueTransformMoveType.RELATIVE_X,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.RELATIVE_X)}},{value:t.EShapeActionValueTransformMoveType.RELATIVE_Y,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.RELATIVE_Y)}},{value:t.EShapeActionValueTransformMoveType.ABSOLUTE_X,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.ABSOLUTE_X)}},{value:t.EShapeActionValueTransformMoveType.ABSOLUTE_Y,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.ABSOLUTE_Y)}},{value:t.EShapeActionValueTransformMoveType.FORWARD_OR_BACKWARD,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.FORWARD_OR_BACKWARD)}},{value:t.EShapeActionValueTransformMoveType.LEFT_OR_RIGHT,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.LEFT_OR_RIGHT)}}]}})},Object.defineProperty(n.prototype,"moveTypeLayout",{get:function(){var t;return null!==(t=this._moveTypeLayout)&&void 0!==t?t:this._moveTypeLayout=this.newLabeled(null,this.moveType)},enumerable:!1,configurable:!0}),n.prototype.onChangeMoveTypeLayout=function(e){var n=this.moveTypeLayout;e===t.EShapeActionValueType.TRANSFORM&&this.transformType.value===t.EShapeActionValueTransformType.MOVE?n.show():n.hide()},Object.defineProperty(n.prototype,"openType",{get:function(){var t;return null!==(t=this._openType)&&void 0!==t?t:this._openType=this.newOpenType()},enumerable:!1,configurable:!0}),n.prototype.newOpenType=function(){return new t.DSelect({weight:1,value:t.EShapeActionValueOpenType.DIAGRAM,menu:{items:this.newOpenTypeMenuItems()}})},n.prototype.newOpenTypeMenuItems=function(){var e=this.themeShape,n=[{value:t.EShapeActionValueOpenType.DIAGRAM,text:{value:e.toOpenTypeLabel(t.EShapeActionValueOpenType.DIAGRAM)}},{value:t.EShapeActionValueOpenType.PAGE,text:{value:e.toOpenTypeLabel(t.EShapeActionValueOpenType.PAGE)}},{value:t.EShapeActionValueOpenType.DIALOG,text:{value:e.toOpenTypeLabel(t.EShapeActionValueOpenType.DIALOG)}}];return t.EShapeActionOpenExtensions.each((function(t){n.push({value:t.type,text:{value:t.label}})})),n},Object.defineProperty(n.prototype,"openTypeLayout",{get:function(){var t;return null!==(t=this._openTypeLayout)&&void 0!==t?t:this._openTypeLayout=this.newLabeled(null,this.openType)},enumerable:!1,configurable:!0}),n.prototype.onChangeOpenTypeLayout=function(e){var n=this.openTypeLayout;e===t.EShapeActionValueType.OPEN?n.show():n.hide()},Object.defineProperty(n.prototype,"openDialogType",{get:function(){var t;return null!==(t=this._openDialogType)&&void 0!==t?t:this._openDialogType=this.newOpenDialogType()},enumerable:!1,configurable:!0}),n.prototype.newOpenDialogType=function(){return new t.DSelect({weight:1,value:t.EShapeActionValueOpenDialogType.TEXT,menu:{items:this.newOpenDialogTypeMenuItems()}})},n.prototype.newOpenDialogTypeMenuItems=function(){var e=this.themeShape,n=[{value:t.EShapeActionValueOpenDialogType.TEXT,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.TEXT)}},{value:t.EShapeActionValueOpenDialogType.INTEGER,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.INTEGER)}},{value:t.EShapeActionValueOpenDialogType.REAL,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.REAL)}},{value:t.EShapeActionValueOpenDialogType.BOOLEAN,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.BOOLEAN)}},{value:t.EShapeActionValueOpenDialogType.DATE,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.DATE)}},{value:t.EShapeActionValueOpenDialogType.TIME,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.TIME)}},{value:t.EShapeActionValueOpenDialogType.DATETIME,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.DATETIME)}}];return t.EShapeActionOpenDialogExtensions.each((function(t){n.push({value:t.type,text:{value:t.label}})})),n},Object.defineProperty(n.prototype,"openDialogTypeLayout",{get:function(){var t;return null!==(t=this._openDialogTypeLayout)&&void 0!==t?t:this._openDialogTypeLayout=this.newLabeled(null,this.openDialogType)},enumerable:!1,configurable:!0}),n.prototype.onChangeOpenDialogTypeLayout=function(e){var n=this.openDialogTypeLayout;e===t.EShapeActionValueType.OPEN&&this.openType.value===t.EShapeActionValueOpenType.DIALOG?n.show():n.hide()},Object.defineProperty(n.prototype,"changeTextType",{get:function(){var t;return null!==(t=this._changeTextType)&&void 0!==t?t:this._changeTextType=this.newChangeTextType()},enumerable:!1,configurable:!0}),n.prototype.newChangeTextType=function(){var e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueChangeTextType.TEXT,menu:{items:[{value:t.EShapeActionValueChangeTextType.TEXT,text:{value:e.toChangeTextTypeLabel(t.EShapeActionValueChangeTextType.TEXT)}},{value:t.EShapeActionValueChangeTextType.NUMBER,text:{value:e.toChangeTextTypeLabel(t.EShapeActionValueChangeTextType.NUMBER)}}]}})},Object.defineProperty(n.prototype,"changeTextTypeLayout",{get:function(){var t;return null!==(t=this._changeTextTypeLayout)&&void 0!==t?t:this._changeTextTypeLayout=this.newLabeled(null,this.changeTextType)},enumerable:!1,configurable:!0}),n.prototype.onChangeChangeTextTypeLayout=function(e){var n=this.changeTextTypeLayout;e===t.EShapeActionValueType.CHANGE_TEXT?n.show():n.hide()},Object.defineProperty(n.prototype,"miscType",{get:function(){var t;return null!==(t=this._miscType)&&void 0!==t?t:this._miscType=this.newMiscType()},enumerable:!1,configurable:!0}),n.prototype.newMiscType=function(){return new t.DSelect({weight:1,value:t.EShapeActionValueMiscType.INPUT_TEXT,menu:{items:this.newMiscTypeMenuItems()}})},n.prototype.newMiscTypeMenuItems=function(){var e=this.themeShape,n=[{value:t.EShapeActionValueMiscType.INPUT_TEXT,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.INPUT_TEXT)}},{value:t.EShapeActionValueMiscType.INPUT_INTEGER,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.INPUT_INTEGER)}},{value:t.EShapeActionValueMiscType.INPUT_REAL,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.INPUT_REAL)}},{value:t.EShapeActionValueMiscType.EMIT_EVENT,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.EMIT_EVENT)}},{value:t.EShapeActionValueMiscType.WRITE_BOTH,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.WRITE_BOTH)}},{value:t.EShapeActionValueMiscType.WRITE_LOCAL,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.WRITE_LOCAL)}},{value:t.EShapeActionValueMiscType.WRITE_REMOTE,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.WRITE_REMOTE)}},{value:t.EShapeActionValueMiscType.HTML_ELEMENT,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.HTML_ELEMENT)}},{value:t.EShapeActionValueMiscType.EXECUTE,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.EXECUTE)}}];return t.EShapeActionMiscExtensions.each((function(t){n.push({value:t.type,text:{value:t.label}})})),n},Object.defineProperty(n.prototype,"miscTypeLayout",{get:function(){var t;return null!==(t=this._miscTypeLayout)&&void 0!==t?t:this._miscTypeLayout=this.newLabeled(null,this.miscType)},enumerable:!1,configurable:!0}),n.prototype.onChangeMiscTypeLayout=function(e){var n=this.miscTypeLayout;e===t.EShapeActionValueType.MISC?n.show():n.hide()},Object.defineProperty(n.prototype,"onInputAction",{get:function(){var t;return null!==(t=this._onInputAction)&&void 0!==t?t:this._onInputAction=this.newOnInputAction()},enumerable:!1,configurable:!0}),n.prototype.newOnInputAction=function(){var e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueOnInputAction.WRITE_REMOTE,menu:{items:[{value:t.EShapeActionValueOnInputAction.EMIT_EVENT,text:{value:e.toOnInputActionLabel(t.EShapeActionValueOnInputAction.EMIT_EVENT)}},{value:t.EShapeActionValueOnInputAction.WRITE_BOTH,text:{value:e.toOnInputActionLabel(t.EShapeActionValueOnInputAction.WRITE_BOTH)}},{value:t.EShapeActionValueOnInputAction.WRITE_LOCAL,text:{value:e.toOnInputActionLabel(t.EShapeActionValueOnInputAction.WRITE_LOCAL)}},{value:t.EShapeActionValueOnInputAction.WRITE_REMOTE,text:{value:e.toOnInputActionLabel(t.EShapeActionValueOnInputAction.WRITE_REMOTE)}}]}})},Object.defineProperty(n.prototype,"onInputActionLayout",{get:function(){var t;return null!==(t=this._onInputActionLayout)&&void 0!==t?t:this._onInputActionLayout=this.newLabeled(null,this.onInputAction)},enumerable:!1,configurable:!0}),n.prototype.onChangeOnInputActionLayout=function(e){var n=this.onInputActionLayout;if(e===t.EShapeActionValueType.OPEN)switch(this.openType.value){case t.EShapeActionValueOpenType.DIALOG_TEXT:case t.EShapeActionValueOpenType.DIALOG_INTEGER:case t.EShapeActionValueOpenType.DIALOG_REAL:case t.EShapeActionValueOpenType.DIALOG_BOOLEAN:n.show();break;case t.EShapeActionValueOpenType.DIALOG:var i=this.openDialogType.value;null==i||t.EShapeActionValueOpenDialogType.EXTENSION<=i?n.hide():n.show();break;default:n.hide()}else if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.INPUT_TEXT:case t.EShapeActionValueMiscType.INPUT_INTEGER:case t.EShapeActionValueMiscType.INPUT_REAL:n.show();break;default:n.hide()}else n.hide()},Object.defineProperty(n.prototype,"whenType",{get:function(){var t;return null!==(t=this._whenType)&&void 0!==t?t:this._whenType=this.newWhenType()},enumerable:!1,configurable:!0}),n.prototype.newWhenType=function(){var e=this.themeShape;return new t.DSelect({weight:1,value:t.UtilHtmlElementWhen.FOCUSED,menu:{items:[{value:t.UtilHtmlElementWhen.CLICKED,text:{value:e.toHtmlElementWhenLabel(t.UtilHtmlElementWhen.CLICKED)}},{value:t.UtilHtmlElementWhen.DOUBLE_CLICKED,text:{value:e.toHtmlElementWhenLabel(t.UtilHtmlElementWhen.DOUBLE_CLICKED)}},{value:t.UtilHtmlElementWhen.FOCUSED,text:{value:e.toHtmlElementWhenLabel(t.UtilHtmlElementWhen.FOCUSED)}},{value:t.UtilHtmlElementWhen.ALWAYS,text:{value:e.toHtmlElementWhenLabel(t.UtilHtmlElementWhen.ALWAYS)}}]}})},Object.defineProperty(n.prototype,"whenTypeLayout",{get:function(){var t;return null!==(t=this._whenTypeLayout)&&void 0!==t?t:this._whenTypeLayout=this.newLabeled(this.theme.getSelectWhenLabel(),this.whenType)},enumerable:!1,configurable:!0}),n.prototype.toWhenTypeValue=function(e){switch(e){case t.UtilHtmlElementWhen.CLICKED:return'"CLICKED"';case t.UtilHtmlElementWhen.DOUBLE_CLICKED:return'"DOUBLE_CLICKED"';case t.UtilHtmlElementWhen.FOCUSED:return'"FOCUSED"';case t.UtilHtmlElementWhen.ALWAYS:return'"ALWAYS"'}return'"FOCUSED"'},n.prototype.toWhenType=function(e){switch(e){case'"CLICKED"':return t.UtilHtmlElementWhen.CLICKED;case'"DOUBLE_CLICKED"':return t.UtilHtmlElementWhen.DOUBLE_CLICKED;case'"FOCUSED"':return t.UtilHtmlElementWhen.FOCUSED;case'"ALWAYS"':return t.UtilHtmlElementWhen.ALWAYS}return t.UtilHtmlElementWhen.FOCUSED},n.prototype.onChangeWhenTypeLayout=function(e){var n=this.whenTypeLayout;if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.INPUT_TEXT:case t.EShapeActionValueMiscType.INPUT_INTEGER:case t.EShapeActionValueMiscType.INPUT_REAL:case t.EShapeActionValueMiscType.HTML_ELEMENT:case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:n.show();break;default:n.hide()}else n.hide()},Object.defineProperty(n.prototype,"gestureType",{get:function(){var t;return null!==(t=this._gestureType)&&void 0!==t?t:this._gestureType=this.newGestureType()},enumerable:!1,configurable:!0}),n.prototype.newGestureType=function(){var e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueGestureType.SHAPE,menu:{items:[{value:t.EShapeActionValueGestureType.SHAPE,text:{value:e.toGestureTypeLabel(t.EShapeActionValueGestureType.SHAPE)}},{value:t.EShapeActionValueGestureType.LAYER,text:{value:e.toGestureTypeLabel(t.EShapeActionValueGestureType.LAYER)}}]}})},Object.defineProperty(n.prototype,"gestureTypeLayout",{get:function(){var t;return null!==(t=this._gestureTypeLayout)&&void 0!==t?t:this._gestureTypeLayout=this.newLabeled("",this.gestureType)},enumerable:!1,configurable:!0}),n.prototype.onChangeGestureTypeLayout=function(e){var n=this.gestureTypeLayout;e===t.EShapeActionValueType.GESTURE?n.show():n.hide()},Object.defineProperty(n.prototype,"gestureOperationType",{get:function(){var t;return null!==(t=this._gestureOperationType)&&void 0!==t?t:this._gestureOperationType=this.newGestureOperationType()},enumerable:!1,configurable:!0}),n.prototype.newGestureOperationType=function(){var e=this.themeShape;return new t.DSelectMultiple({weight:1,values:this.fromGestureOperationType(t.EShapeActionValueGestureOperationType.ALL),menu:{items:[{value:t.EShapeActionValueGestureOperationType.DRAG,text:{value:e.toGestureOperationTypeLabel(t.EShapeActionValueGestureOperationType.DRAG)},check:!0},{value:t.EShapeActionValueGestureOperationType.PINCH,text:{value:e.toGestureOperationTypeLabel(t.EShapeActionValueGestureOperationType.PINCH)},check:!0}]}})},n.prototype.toGestureOperationType=function(e){for(var n=t.EShapeActionValueGestureOperationType.NONE,i=0,o=e.length;i<o;++i)n|=e[i];return n},n.prototype.fromGestureOperationType=function(e){var n=[];return e&t.EShapeActionValueGestureOperationType.DRAG&&n.push(t.EShapeActionValueGestureOperationType.DRAG),e&t.EShapeActionValueGestureOperationType.PINCH&&n.push(t.EShapeActionValueGestureOperationType.PINCH),n},Object.defineProperty(n.prototype,"gestureOperationTypeLayout",{get:function(){var t;return null!==(t=this._gestureOperationTypeLayout)&&void 0!==t?t:this._gestureOperationTypeLayout=this.newLabeled("",this.gestureOperationType)},enumerable:!1,configurable:!0}),n.prototype.onChangeGestureOperationTypeLayout=function(e){var n=this.gestureOperationTypeLayout;e===t.EShapeActionValueType.GESTURE?n.show():n.hide()},Object.defineProperty(n.prototype,"selectLayer",{get:function(){var t;return null!==(t=this._selectLayer)&&void 0!==t?t:this._selectLayer=this.newSelectLayer()},enumerable:!1,configurable:!0}),n.prototype.newSelectLayer=function(){return new t.DSelectMultiple({weight:1})},n.prototype.newSelectLayerMenuItemOptions=function(){var t,e=null===(t=this.options)||void 0===t?void 0:t.diagram;if(null!=e){var n=e.canvas;if(null!=n){for(var i=[],o=n.layer.children,r=o.length-1;0<=r;--r){var a=o[r];i.push({value:r,text:{value:a.name},check:!0})}return i}}return[]},Object.defineProperty(n.prototype,"selectLayerLayout",{get:function(){var t;return null!==(t=this._selectLayerLayout)&&void 0!==t?t:this._selectLayerLayout=this.newLabeled(this.theme.getSelectLayerLabel(),this.selectLayer)},enumerable:!1,configurable:!0}),n.prototype.onChangeSelectLayerLayout=function(e){var n=this.selectLayerLayout;e===t.EShapeActionValueType.SHOW_HIDE&&this.showHideType.value===t.EShapeActionValueShowHideType.LAYER?n.show():n.hide()},Object.defineProperty(n.prototype,"condition",{get:function(){var t;return null!==(t=this._condition)&&void 0!==t?t:this._condition=this.newCondition()},enumerable:!1,configurable:!0}),n.prototype.newCondition=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputConditionLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeCondition=function(e){var n=this.condition;if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.INPUT_TEXT:case t.EShapeActionValueMiscType.INPUT_INTEGER:case t.EShapeActionValueMiscType.INPUT_REAL:case t.EShapeActionValueMiscType.HTML_ELEMENT:case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:n.hide();break;default:n.show()}else n.show()},Object.defineProperty(n.prototype,"interval",{get:function(){var t;return null!==(t=this._interval)&&void 0!==t?t:this._interval=this.newInterval()},enumerable:!1,configurable:!0}),n.prototype.newInterval=function(){var e=this;return new t.DInputInteger({weight:1,text:{value:1e3},min:0,step:100,on:{enter:function(){e.ok()}}})},Object.defineProperty(n.prototype,"intervalLayout",{get:function(){var t;return null!==(t=this._intervalLayout)&&void 0!==t?t:this._intervalLayout=this.newIntervalLayout()},enumerable:!1,configurable:!0}),n.prototype.newIntervalLayout=function(){var e=this.theme;return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabel(e.getInputIntervalLabel()),this.interval,new t.DText({width:60,text:{value:e.getInputIntervalUnitLabel(),align:{horizontal:t.DAlignHorizontal.LEFT}}})]})},n.prototype.onChangeIntervalLayout=function(e){var n=this.intervalLayout;e===t.EShapeActionValueType.BLINK?n.show():n.hide()},Object.defineProperty(n.prototype,"size",{get:function(){var t;return null!==(t=this._size)&&void 0!==t?t:this._size=this.newSize()},enumerable:!1,configurable:!0}),n.prototype.newSize=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputSizeLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeSize=function(e){var n=this.size;e===t.EShapeActionValueType.TRANSFORM&&this.transformType.value===t.EShapeActionValueTransformType.RESIZE?n.show():n.hide()},Object.defineProperty(n.prototype,"amount",{get:function(){var t;return null!==(t=this._amount)&&void 0!==t?t:this._amount=this.newAmount()},enumerable:!1,configurable:!0}),n.prototype.newAmount=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputAmountLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeAmount=function(e){var n=this.amount;if(e===t.EShapeActionValueType.TRANSFORM){var i=this.transformType.value;i===t.EShapeActionValueTransformType.MOVE||i===t.EShapeActionValueTransformType.ROTATE?n.show():n.hide()}else n.hide()},Object.defineProperty(n.prototype,"contents",{get:function(){var t;return null!==(t=this._contents)&&void 0!==t?t:this._contents=this.newContents()},enumerable:!1,configurable:!0}),n.prototype.newContents=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputValueLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeContents=function(e){var n=this.contents;if(e===t.EShapeActionValueType.CHANGE_TEXT)n.show();else if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.WRITE_BOTH:case t.EShapeActionValueMiscType.WRITE_LOCAL:case t.EShapeActionValueMiscType.WRITE_REMOTE:n.show();break;default:n.hide()}else n.hide()},Object.defineProperty(n.prototype,"initialization",{get:function(){var t;return null!==(t=this._initialization)&&void 0!==t?t:this._initialization=this.newInitialization()},enumerable:!1,configurable:!0}),n.prototype.newInitialization=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputInitializationLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeInitialization=function(e){var n=this.initialization;if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.HTML_ELEMENT:case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:n.show();break;default:n.hide()}else n.hide()},Object.defineProperty(n.prototype,"pointerEventsLayout",{get:function(){var t;return null!==(t=this._pointerEventsLayout)&&void 0!==t?t:this._pointerEventsLayout=this.newLabeled(null,this.pointerEvents)},enumerable:!1,configurable:!0}),n.prototype.onChangePointerEventsLayout=function(e){var n=this.pointerEventsLayout;if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.HTML_ELEMENT:case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:n.show();break;default:n.hide()}else n.hide()},Object.defineProperty(n.prototype,"pointerEvents",{get:function(){var t;return null!==(t=this._pointerEvents)&&void 0!==t?t:this._pointerEvents=this.newPointerEvents()},enumerable:!1,configurable:!0}),n.prototype.newPointerEvents=function(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckPointEventsLabel(),align:{horizontal:"LEFT"}}})},Object.defineProperty(n.prototype,"targetName",{get:function(){var t;return null!==(t=this._targetName)&&void 0!==t?t:this._targetName=this.newTargetName()},enumerable:!1,configurable:!0}),n.prototype.newTargetName=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputTargetNameLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeTargetName=function(e){var n=this.targetName;e===t.EShapeActionValueType.EMIT_EVENT||e===t.EShapeActionValueType.CHANGE_CURSOR?n.show():n.hide()},Object.defineProperty(n.prototype,"color",{get:function(){var t;return null!==(t=this._color)&&void 0!==t?t:this._color=this.newColor()},enumerable:!1,configurable:!0}),n.prototype.newColor=function(){var e=new t.DButtonColor({weight:1});return e.dialog.on("open",(function(){var t=e.dialog.new,n=e.dialog.current;t.color=n.color,t.alpha=n.alpha})),e},Object.defineProperty(n.prototype,"colorLayout",{get:function(){var t;return null!==(t=this._colorLayout)&&void 0!==t?t:this._colorLayout=this.newColorLayout()},enumerable:!1,configurable:!0}),n.prototype.newColorLayout=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getButtonColorLabel()}}),this.color,new t.DLayoutSpace({width:60})]})},n.prototype.onChangeColorLayout=function(e){var n=this.colorLayout;if(e===t.EShapeActionValueType.CHANGE_COLOR){var i=this.changeColorTarget.value;i===t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA||i===t.EShapeActionValueChangeColorTarget.COLOR||i===t.EShapeActionValueChangeColorTarget.ALPHA?n.show():n.hide()}else if(e===t.EShapeActionValueType.BLINK){var o=this.blinkType.value;o===t.EShapeActionValueBlinkType.COLOR_FILL||o===t.EShapeActionValueBlinkType.COLOR_STROKE?n.show():n.hide()}else n.hide()},Object.defineProperty(n.prototype,"target",{get:function(){var t;return null!==(t=this._target)&&void 0!==t?t:this._target=this.newTarget()},enumerable:!1,configurable:!0}),n.prototype.newTarget=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputTargetLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeTarget=function(e){var n=this.target;if(e===t.EShapeActionValueType.OPEN)n.show();else if(e===t.EShapeActionValueType.MISC){var i=this.miscType.value;null==i?n.show():i===t.EShapeActionValueMiscType.HTML_ELEMENT||i===t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS||t.EShapeActionValueMiscType.EXTENSION<=i?n.hide():n.show()}else n.hide()},Object.defineProperty(n.prototype,"argument",{get:function(){var t;return null!==(t=this._argument)&&void 0!==t?t:this._argument=this.newArgument()},enumerable:!1,configurable:!0}),n.prototype.newArgument=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputArgumentLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeArgument=function(e){var n=this.argument;if(e===t.EShapeActionValueType.OPEN)if(this.openType.value===t.EShapeActionValueOpenType.DIALOG){var i=this.openDialogType.value;null==i?n.hide():t.EShapeActionValueOpenDialogType.EXTENSION<=i?n.show():n.hide()}else n.hide();else if(e===t.EShapeActionValueType.MISC){var o=this.miscType.value;null!=o&&t.EShapeActionValueMiscType.EXTENSION<=o?n.show():n.hide()}else n.hide()},Object.defineProperty(n.prototype,"colorCode",{get:function(){var t;return null!==(t=this._colorCode)&&void 0!==t?t:this._colorCode=this.newColorCode()},enumerable:!1,configurable:!0}),n.prototype.newColorCode=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputColorCodeLabel()}},input:{weight:1,text:{value:""},on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeColorCode=function(e){var n=this.colorCode;e===t.EShapeActionValueType.CHANGE_COLOR&&this.changeColorTarget.value===t.EShapeActionValueChangeColorTarget.CODE?n.show():n.hide()},Object.defineProperty(n.prototype,"alphaCode",{get:function(){var t;return null!==(t=this._alphaCode)&&void 0!==t?t:this._alphaCode=this.newAlphaCode()},enumerable:!1,configurable:!0}),n.prototype.newAlphaCode=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,on:{enter:function(){e.ok()}}},label:{width:60,text:{value:this.theme.getInputAlphaCodeLabel()}},space:{width:60}})},n.prototype.onChangeAlphaCode=function(e){var n=this.alphaCode;e===t.EShapeActionValueType.CHANGE_COLOR&&this.changeColorTarget.value===t.EShapeActionValueChangeColorTarget.CODE?n.show():n.hide()},Object.defineProperty(n.prototype,"brightness",{get:function(){var t;return null!==(t=this._brightness)&&void 0!==t?t:this._brightness=this.newBrightness()},enumerable:!1,configurable:!0}),n.prototype.newBrightness=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,on:{enter:function(){e.ok()}}},label:{width:60,text:{value:this.theme.getInputBrightnessLabel()}},space:{width:60}})},n.prototype.onChangeBrightness=function(e){var n=this.brightness;e===t.EShapeActionValueType.CHANGE_COLOR&&this.changeColorTarget.value===t.EShapeActionValueChangeColorTarget.BRIGHTNESS?n.show():n.hide()},Object.defineProperty(n.prototype,"blend",{get:function(){var t;return null!==(t=this._blend)&&void 0!==t?t:this._blend=this.newBlend()},enumerable:!1,configurable:!0}),n.prototype.newBlend=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputBlendLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeBlend=function(e){var n=this.blend;if(e===t.EShapeActionValueType.CHANGE_COLOR){var i=this.changeColorTarget.value;i===t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA||i===t.EShapeActionValueChangeColorTarget.COLOR||i===t.EShapeActionValueChangeColorTarget.ALPHA||i===t.EShapeActionValueChangeColorTarget.CODE?n.show():n.hide()}else n.hide()},Object.defineProperty(n.prototype,"initial",{get:function(){var t;return null!==(t=this._initial)&&void 0!==t?t:this._initial=this.newInitial()},enumerable:!1,configurable:!0}),n.prototype.newInitial=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputInitialLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeInitial=function(e){var n=this.initial;if(e===t.EShapeActionValueType.OPEN)if(this.openType.value===t.EShapeActionValueOpenType.DIALOG)switch(this.openDialogType.value){case t.EShapeActionValueOpenDialogType.TEXT:case t.EShapeActionValueOpenDialogType.INTEGER:case t.EShapeActionValueOpenDialogType.REAL:case t.EShapeActionValueOpenDialogType.BOOLEAN:case t.EShapeActionValueOpenDialogType.DATE:case t.EShapeActionValueOpenDialogType.TIME:case t.EShapeActionValueOpenDialogType.DATETIME:n.show();break;default:n.hide()}else n.hide();else n.hide()},Object.defineProperty(n.prototype,"step",{get:function(){var t;return null!==(t=this._step)&&void 0!==t?t:this._step=this.newStep()},enumerable:!1,configurable:!0}),n.prototype.newStep=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputStepLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeStep=function(e){var n=this.step;if(e===t.EShapeActionValueType.OPEN)if(this.openType.value===t.EShapeActionValueOpenType.DIALOG)switch(this.openDialogType.value){case t.EShapeActionValueOpenDialogType.INTEGER:case t.EShapeActionValueOpenDialogType.REAL:n.show();break;default:n.hide()}else n.hide();else n.hide()},Object.defineProperty(n.prototype,"min",{get:function(){var t;return null!==(t=this._min)&&void 0!==t?t:this._min=this.newMin()},enumerable:!1,configurable:!0}),n.prototype.newMin=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputMinLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeMin=function(e){var n=this.min;if(e===t.EShapeActionValueType.OPEN)if(this.openType.value===t.EShapeActionValueOpenType.DIALOG)switch(this.openDialogType.value){case t.EShapeActionValueOpenDialogType.INTEGER:case t.EShapeActionValueOpenDialogType.REAL:n.show();break;default:n.hide()}else n.hide();else n.hide()},Object.defineProperty(n.prototype,"max",{get:function(){var t;return null!==(t=this._max)&&void 0!==t?t:this._max=this.newMax()},enumerable:!1,configurable:!0}),n.prototype.newMax=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputMaxLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},n.prototype.onChangeMax=function(e){var n=this.max;if(e===t.EShapeActionValueType.OPEN)if(this.openType.value===t.EShapeActionValueOpenType.DIALOG)switch(this.openDialogType.value){case t.EShapeActionValueOpenDialogType.INTEGER:case t.EShapeActionValueOpenDialogType.REAL:n.show();break;default:n.hide()}else n.hide();else n.hide()},Object.defineProperty(n.prototype,"scaleLayout",{get:function(){var t;return null!==(t=this._scaleLayout)&&void 0!==t?t:this._scaleLayout=this.newScaleLayout()},enumerable:!1,configurable:!0}),n.prototype.newScaleLayout=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getInputScaleLabel()}}),this.scaleMin,this.scaleMax,new t.DLayoutSpace({width:60})]})},n.prototype.onChangeScaleLayout=function(e){var n=this.scaleLayout;e===t.EShapeActionValueType.GESTURE?n.show():n.hide()},Object.defineProperty(n.prototype,"scaleMin",{get:function(){var t;return null!==(t=this._scaleMin)&&void 0!==t?t:this._scaleMin=this.newScaleMin()},enumerable:!1,configurable:!0}),n.prototype.newScaleMin=function(){var e=this;return new t.DInputReal({weight:1,on:{enter:function(){e.ok()}}})},Object.defineProperty(n.prototype,"scaleMax",{get:function(){var t;return null!==(t=this._scaleMax)&&void 0!==t?t:this._scaleMax=this.newScaleMax()},enumerable:!1,configurable:!0}),n.prototype.newScaleMax=function(){var e=this;return new t.DInputReal({weight:1,on:{enter:function(){e.ok()}}})},Object.defineProperty(n.prototype,"checkBringToFront",{get:function(){var t;return null!==(t=this._checkBringToFront)&&void 0!==t?t:this._checkBringToFront=this.newCheckBringToFront()},enumerable:!1,configurable:!0}),n.prototype.newCheckBringToFront=function(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckBringToFrontLabel(),align:{horizontal:"LEFT"}}})},Object.defineProperty(n.prototype,"checkBringToFrontLayout",{get:function(){var t;return null!==(t=this._checkBringToFrontLayout)&&void 0!==t?t:this._checkBringToFrontLayout=this.newLabeled(null,this.checkBringToFront)},enumerable:!1,configurable:!0}),n.prototype.onChangeCheckBringToFrontLayout=function(e){var n=this.checkBringToFrontLayout;e===t.EShapeActionValueType.SHOW_HIDE&&this.showHideType.value===t.EShapeActionValueShowHideType.LAYER?n.show():n.hide()},Object.defineProperty(n.prototype,"inNewWindow",{get:function(){var t;return null!==(t=this._inNewWindow)&&void 0!==t?t:this._inNewWindow=this.newInNewWindow()},enumerable:!1,configurable:!0}),n.prototype.newInNewWindow=function(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckInNewWindowLabel(),align:{horizontal:"LEFT"}}})},Object.defineProperty(n.prototype,"inNewWindowLayout",{get:function(){var t;return null!==(t=this._inNewWindowLayout)&&void 0!==t?t:this._inNewWindowLayout=this.newLabeled(null,this.inNewWindow)},enumerable:!1,configurable:!0}),n.prototype.onChangeInNewWindowLayout=function(e){var n=this.inNewWindowLayout;e===t.EShapeActionValueType.OPEN?this.openType.value===t.EShapeActionValueOpenType.DIALOG?n.hide():n.show():n.hide()},Object.defineProperty(n.prototype,"extension",{get:function(){var t;return null!==(t=this._extension)&&void 0!==t?t:this._extension=new ze(this,this.condition,this.content)},enumerable:!1,configurable:!0}),n.prototype.onChange=function(){var t=this.select.value;this.onChangeAlphaCode(t),this.onChangeAmount(t),this.onChangeBlend(t),this.onChangeBlinkTypeLayout(t),this.onChangeBrightness(t),this.onChangeChangeColorTargetLayout(t),this.onChangeChangeColorTypeLayout(t),this.onChangeChangeTextTypeLayout(t),this.onChangeCondition(t),this.onChangeColorCode(t),this.onChangeColorLayout(t),this.onChangeInitial(t),this.onChangeStep(t),this.onChangeMin(t),this.onChangeMax(t),this.onChangeIntervalLayout(t),this.onChangeMiscTypeLayout(t),this.onChangeMoveTypeLayout(t),this.onChangeOnInputActionLayout(t),this.onChangeWhenTypeLayout(t),this.onChangeGestureTypeLayout(t),this.onChangeGestureOperationTypeLayout(t),this.onChangeSelectLayerLayout(t),this.onChangeOpenTypeLayout(t),this.onChangeOpenDialogTypeLayout(t),this.onChangeOriginXLayout(t),this.onChangeOriginYLayout(t),this.onChangeResizeTypeLayout(t),this.onChangeRotateTypeLayout(t),this.onChangeShowHideTypeLayout(t),this.onChangeSize(t),this.onChangeTarget(t),this.onChangeArgument(t),this.onChangeTargetName(t),this.onChangeContents(t),this.onChangeInitialization(t),this.onChangePointerEventsLayout(t),this.onChangeTransformTypeLayout(t),this.onChangeScaleLayout(t),this.onChangeCheckBringToFrontLayout(t),this.onChangeInNewWindowLayout(t),this.extension.onChange(t)},n.prototype.reset=function(){return this.select.value=t.EShapeActionValueType.SHOW_HIDE,this.showHideType.value=t.EShapeActionValueShowHideType.SHAPE,this.blinkType.value=t.EShapeActionValueBlinkType.VISIBILITY,this.transformType.value=t.EShapeActionValueTransformType.MOVE,this.changeColorType.values=[t.EShapeActionValueChangeColorType.FILL],this.changeColorTarget.value=t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA,this.resizeType.value=t.EShapeActionValueTransformResizeType.RELATIVE_SIZE,this.originY.value=.5,this.originX.value=.5,this.moveType.value=t.EShapeActionValueTransformMoveType.RELATIVE_X,this.rotateType.value=t.EShapeActionValueTransformRotateType.RELATIVE,this.openType.value=t.EShapeActionValueOpenType.DIAGRAM,this.openDialogType.value=t.EShapeActionValueOpenDialogType.TEXT,this.changeTextType.value=t.EShapeActionValueChangeTextType.TEXT,this.miscType.value=t.EShapeActionValueMiscType.INPUT_TEXT,this.onInputAction.value=t.EShapeActionValueOnInputAction.WRITE_REMOTE,this.whenType.value=t.UtilHtmlElementWhen.FOCUSED,this.gestureType.value=t.EShapeActionValueGestureType.SHAPE,this.gestureOperationType.values=this.fromGestureOperationType(t.EShapeActionValueGestureOperationType.ALL),this.selectLayer.values=[],this.selectLayer.menu=new t.DMenu({fit:!0,items:this.newSelectLayerMenuItemOptions()}),this.condition.input.value="",this.size.input.value="",this.amount.input.value="",this.contents.input.value="",this.initialization.input.value="",this.pointerEvents.state.isActive=!0,this.targetName.input.value="",this.interval.value=1e3,this.color.value.color=16777215,this.color.value.alpha=1,this.target.input.value="",this.argument.input.value="",this.colorCode.input.value="",this.alphaCode.input.value="",this.brightness.input.value="",this.blend.input.value="",this.initial.input.value="",this.step.input.value="",this.min.input.value="",this.max.input.value="",this.scaleMin.value=.05,this.scaleMax.value=20,this.checkBringToFront.state.isActive=!1,this.inNewWindow.state.isActive=!1,this.extension.reset(),this.onChange(),this},Object.defineProperty(n.prototype,"value",{get:function(){var e,n,i,o,r=this.select.value,a=this.condition.input.value;if(null!=r)switch(r){case t.EShapeActionValueType.SHOW_HIDE:switch(this.showHideType.value){case t.EShapeActionValueShowHideType.SHAPE:case null:return new t.EShapeActionValueShowHideShape(a);case t.EShapeActionValueShowHideType.LAYER:return new t.EShapeActionValueShowHideLayer(a,this.selectLayer.values.slice(0),this.checkBringToFront.state.isActive)}break;case t.EShapeActionValueType.BLINK:var l=this.blinkType.value||t.EShapeActionValueBlinkType.VISIBILITY,u=this.interval.value,s=this.color.value;return new t.EShapeActionValueBlink(l,a,u,s.color,s.alpha);case t.EShapeActionValueType.CHANGE_COLOR:var p=t.EShapeActionValueChangeColorTypes.pack(this.changeColorType.values),h=this.changeColorTarget.value||t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA;switch(h){case t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA:case t.EShapeActionValueChangeColorTarget.COLOR:case t.EShapeActionValueChangeColorTarget.ALPHA:var c=this.color.value;return new t.EShapeActionValueChangeColor(p,a,h,c.color,c.alpha,this.blend.input.value);case t.EShapeActionValueChangeColorTarget.CODE:return new t.EShapeActionValueChangeColorCode(p,a,this.colorCode.input.value,this.alphaCode.input.value,this.blend.input.value);case t.EShapeActionValueChangeColorTarget.BRIGHTNESS:return new t.EShapeActionValueChangeColorBrightness(p,a,this.brightness.input.value)}break;case t.EShapeActionValueType.TRANSFORM:var d=this.transformType.value,g=this.originX.value,f=this.originY.value;switch(d){case t.EShapeActionValueTransformType.RESIZE:var y=this.resizeType.value||t.EShapeActionValueTransformResizeType.RELATIVE_SIZE;return new t.EShapeActionValueTransformResize(y,a,g,f,this.size.input.value);case t.EShapeActionValueTransformType.MOVE:var v=this.moveType.value||t.EShapeActionValueTransformMoveType.RELATIVE_X;return new t.EShapeActionValueTransformMove(v,a,this.amount.input.value);case t.EShapeActionValueTransformType.ROTATE:var b=this.rotateType.value||t.EShapeActionValueTransformRotateType.RELATIVE;return new t.EShapeActionValueTransformRotate(b,a,g,f,this.amount.input.value)}break;case t.EShapeActionValueType.CHANGE_TEXT:var m=this.changeTextType.value||t.EShapeActionValueChangeTextType.TEXT;return new t.EShapeActionValueChangeText(m,a,this.contents.input.value);case t.EShapeActionValueType.OPEN:var _=null!==(e=this.openType.value)&&void 0!==e?e:t.EShapeActionValueOpenType.DIAGRAM;switch(_){case t.EShapeActionValueOpenType.DIALOG:var S=null!==(n=this.openDialogType.value)&&void 0!==n?n:t.EShapeActionValueOpenDialogType.TEXT;switch(S){case t.EShapeActionValueOpenDialogType.INTEGER:case t.EShapeActionValueOpenDialogType.REAL:return new t.EShapeActionValueOpenDialog(a,this.target.input.value,null!==(i=this.onInputAction.value)&&void 0!==i?i:t.EShapeActionValueOnInputAction.EMIT_EVENT,this.initial.input.value,this.step.input.value,this.min.input.value,this.max.input.value,S);case t.EShapeActionValueOpenDialogType.TEXT:case t.EShapeActionValueOpenDialogType.BOOLEAN:case t.EShapeActionValueOpenDialogType.DATE:case t.EShapeActionValueOpenDialogType.TIME:case t.EShapeActionValueOpenDialogType.DATETIME:return new t.EShapeActionValueOpenDialog(a,this.target.input.value,null!==(o=this.onInputAction.value)&&void 0!==o?o:t.EShapeActionValueOnInputAction.EMIT_EVENT,this.initial.input.value,"","","",S);default:return new t.EShapeActionValueOpenDialogExtension(a,this.target.input.value,this.argument.input.value,S)}case t.EShapeActionValueOpenType.DIAGRAM:case t.EShapeActionValueOpenType.PAGE:return new t.EShapeActionValueOpen(_,a,this.target.input.value,this.inNewWindow.state.isActive);default:return new t.EShapeActionValueOpenExtension(_,a,this.target.input.value,this.inNewWindow.state.isActive)}case t.EShapeActionValueType.EMIT_EVENT:return new t.EShapeActionValueEmitEvent(a,this.targetName.input.value);case t.EShapeActionValueType.CHANGE_CURSOR:return new t.EShapeActionValueChangeCursor(a,this.targetName.input.value);case t.EShapeActionValueType.GESTURE:return new t.EShapeActionValueGesture(a,this.gestureType.value||t.EShapeActionValueGestureType.SHAPE,this.toGestureOperationType(this.gestureOperationType.values),this.scaleMin.value,this.scaleMax.value);case t.EShapeActionValueType.MISC:var w=this.miscType.value||t.EShapeActionValueMiscType.INPUT_TEXT;switch(w){case t.EShapeActionValueMiscType.INPUT_TEXT:case t.EShapeActionValueMiscType.INPUT_REAL:case t.EShapeActionValueMiscType.INPUT_INTEGER:return new t.EShapeActionValueMiscInput(w,this.toWhenTypeValue(this.whenType.value),this.target.input.value,this.onInputAction.value||t.EShapeActionValueOnInputAction.EMIT_EVENT);case t.EShapeActionValueMiscType.EMIT_EVENT:return new t.EShapeActionValueMiscEmitEvent(a,this.target.input.value);case t.EShapeActionValueMiscType.WRITE_BOTH:case t.EShapeActionValueMiscType.WRITE_LOCAL:case t.EShapeActionValueMiscType.WRITE_REMOTE:return new t.EShapeActionValueMiscWrite(w,a,this.target.input.value,this.contents.input.value);case t.EShapeActionValueMiscType.HTML_ELEMENT:return this.pointerEvents.state.isActive?new t.EShapeActionValueMiscHtmlElement(w,this.toWhenTypeValue(this.whenType.value),this.initialization.input.value):new t.EShapeActionValueMiscHtmlElement(t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS,this.toWhenTypeValue(this.whenType.value),this.initialization.input.value);case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:return new t.EShapeActionValueMiscHtmlElement(w,this.toWhenTypeValue(this.whenType.value),this.initialization.input.value);case t.EShapeActionValueMiscType.EXECUTE:return new t.EShapeActionValueMiscExecute(a,this.target.input.value);default:if(t.EShapeActionValueMiscType.EXTENSION<=w)return new t.EShapeActionValueMiscExtension(w,a,this.argument.input.value)}break;default:return this.extension.value}return null},set:function(e){if(this.selectLayer.menu=new t.DMenu({fit:!0,items:this.newSelectLayerMenuItemOptions()}),null!=e){if(this.select.value=e.type,e instanceof t.EShapeActionValueShowHide)this.condition.input.value=e.condition,this.showHideType.value=t.EShapeActionValueShowHideType.SHAPE;else if(e instanceof t.EShapeActionValueShowHideShape)this.condition.input.value=e.condition,this.showHideType.value=e.subtype;else if(e instanceof t.EShapeActionValueShowHideLayer)this.condition.input.value=e.condition,this.showHideType.value=e.subtype,this.selectLayer.values=e.layers.slice(0),this.checkBringToFront.state.isActive=e.bringToFront;else if(e instanceof t.EShapeActionValueBlink)this.condition.input.value=e.condition,this.blinkType.value=e.subtype,this.interval.value=e.interval,this.color.value.color=e.color,this.color.value.alpha=e.alpha;else if(e instanceof t.EShapeActionValueChangeColor)this.condition.input.value=e.condition,this.changeColorType.values=t.EShapeActionValueChangeColorTypes.unpack(e.subtype),this.changeColorTarget.value=e.target,this.color.value.color=e.color,this.color.value.alpha=e.alpha,this.blend.input.value=e.blend;else if(e instanceof t.EShapeActionValueChangeColorCode)this.condition.input.value=e.condition,this.changeColorType.values=t.EShapeActionValueChangeColorTypes.unpack(e.subtype),this.changeColorTarget.value=t.EShapeActionValueChangeColorTarget.CODE,this.colorCode.input.value=e.color,this.alphaCode.input.value=e.alpha,this.blend.input.value=e.blend;else if(e instanceof t.EShapeActionValueChangeColorBrightness)this.condition.input.value=e.condition,this.changeColorType.values=t.EShapeActionValueChangeColorTypes.unpack(e.subtype),this.changeColorTarget.value=t.EShapeActionValueChangeColorTarget.BRIGHTNESS,this.brightness.input.value=e.brightness;else if(e instanceof t.EShapeActionValueTransformResize)this.condition.input.value=e.condition,this.transformType.value=t.EShapeActionValueTransformType.RESIZE,this.resizeType.value=e.opetype,this.originX.value=e.originX,this.originY.value=e.originY,this.size.input.value=e.amount;else if(e instanceof t.EShapeActionValueTransformMove)this.condition.input.value=e.condition,this.transformType.value=t.EShapeActionValueTransformType.MOVE,this.moveType.value=e.opetype,this.amount.input.value=e.amount;else if(e instanceof t.EShapeActionValueTransformRotate)this.condition.input.value=e.condition,this.transformType.value=t.EShapeActionValueTransformType.ROTATE,this.rotateType.value=e.opetype,this.originX.value=e.originX,this.originY.value=e.originY,this.amount.input.value=e.amount;else if(e instanceof t.EShapeActionValueChangeText)this.condition.input.value=e.condition,this.changeTextType.value=e.subtype,this.contents.input.value=e.value;else if(e instanceof t.EShapeActionValueOpen)this.condition.input.value=e.condition,this.openType.value=e.subtype,this.target.input.value=e.target,this.inNewWindow.state.isActive=e.inNewWindow;else if(e instanceof t.EShapeActionValueOpenDialog)this.condition.input.value=e.condition,this.openType.value=e.subtype,this.target.input.value=e.target,this.onInputAction.value=e.onInputAction,this.initial.input.value=e.initial,this.step.input.value=e.step,this.min.input.value=e.min,this.max.input.value=e.max,this.openDialogType.value=e.dialogType;else if(e instanceof t.EShapeActionValueOpenDialogExtension)this.condition.input.value=e.condition,this.openType.value=e.subtype,this.target.input.value=e.target,this.argument.input.value=e.argument,this.openDialogType.value=e.dialogType;else if(e instanceof t.EShapeActionValueOpenExtension)this.condition.input.value=e.condition,this.openType.value=e.subtype,this.target.input.value=e.target,this.inNewWindow.state.isActive=e.inNewWindow;else if(e instanceof t.EShapeActionValueEmitEvent)this.condition.input.value=e.condition,this.targetName.input.value=e.name;else if(e instanceof t.EShapeActionValueChangeCursor)this.condition.input.value=e.condition,this.targetName.input.value=e.name;else if(e instanceof t.EShapeActionValueGesture)this.condition.input.value=e.condition,this.gestureType.value=e.subtype,this.gestureOperationType.values=this.fromGestureOperationType(e.operationType),this.scaleMin.value=e.scaleMin,this.scaleMax.value=e.scaleMax;else if(e instanceof t.EShapeActionValueMisc)switch(e.subtype){case t.EShapeActionValueMiscType.INPUT_TEXT:case t.EShapeActionValueMiscType.INPUT_REAL:case t.EShapeActionValueMiscType.INPUT_INTEGER:this.miscType.value=e.subtype,this.whenType.value=this.toWhenType(e.condition),this.target.input.value=e.target,this.onInputAction.value=e.onInputAction,this.contents.input.value=e.value;break;case t.EShapeActionValueMiscType.HTML_ELEMENT:this.miscType.value=t.EShapeActionValueMiscType.HTML_ELEMENT,this.whenType.value=this.toWhenType(e.condition),this.target.input.value=e.target,this.onInputAction.value=e.onInputAction,this.initialization.input.value=e.value,this.pointerEvents.state.isActive=!0;break;case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:this.miscType.value=t.EShapeActionValueMiscType.HTML_ELEMENT,this.whenType.value=this.toWhenType(e.condition),this.target.input.value=e.target,this.onInputAction.value=e.onInputAction,this.initialization.input.value=e.value,this.pointerEvents.state.isActive=!1;break;default:this.condition.input.value=e.condition,this.miscType.value=e.subtype,this.target.input.value=e.target,this.onInputAction.value=e.onInputAction,this.contents.input.value=e.value}else e instanceof t.EShapeActionValueMiscExecute?(this.miscType.value=t.EShapeActionValueMiscType.EXECUTE,this.condition.input.value=e.condition,this.target.input.value=e.target):e instanceof t.EShapeActionValueMiscExtension?(this.miscType.value=t.EShapeActionValueMiscType.EXTENSION,this.condition.input.value=e.condition,this.argument.input.value=e.argument):this.extension.value=e;this.onChange()}},enumerable:!1,configurable:!0}),n.prototype.getResolvedValue=function(){return this.value},n.prototype.getType=function(){return"EDialogAction"},n}(t.DDialogLayered),vi=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.newContentChildren=function(n,i){var o=e.prototype.newContentChildren.call(this,n,i);return o.push(this.inputSource,this.inputDestination,this.inputInitial,new t.DLayoutSpace({height:6}),this.table),o},Object.defineProperty(n.prototype,"inputSource",{get:function(){var t=this._inputSource;return null==t&&(t=this.newInputSource(),this._inputSource=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputSource=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,on:{input:function(t){e.onInputSourceChanged(t)},enter:function(){e.ok()}}},label:{width:60,text:{value:this.theme.getInputSourceLabel()}},space:{width:60}})},n.prototype.onInputSourceChanged=function(t){this._newSource=t,this.updateRows()},Object.defineProperty(n.prototype,"inputDestination",{get:function(){var t=this._inputDestination;return null==t&&(t=this.newInputDestination(),this._inputDestination=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputDestination=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,text:{value:""},on:{input:function(t){e.onInputDestinationChanged(t)},enter:function(){e.ok()}}},label:{width:60,text:{value:this.theme.getInputDestinationLabel()}},space:{width:60}})},n.prototype.onInputDestinationChanged=function(t){this._newDestination=t,this.updateRows()},Object.defineProperty(n.prototype,"inputInitial",{get:function(){var t=this._inputInitial;return null==t&&(t=this.newInputInitial(),this._inputInitial=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputInitial=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,text:{value:""},on:{enter:function(){e.ok()}}},label:{width:60,text:{value:this.theme.getInputInitialLabel()}},space:{width:60}})},Object.defineProperty(n.prototype,"table",{get:function(){var t=this._table;return null==t&&(t=this.newTable(),this._table=t),t},enumerable:!1,configurable:!0}),n.prototype.newTable=function(){return new t.DTable({width:"padding",height:300,columns:this.newColumnOptions()})},n.prototype.newColumnOptions=function(){var t=this.theme;return[{type:"TEXT",label:t.getTableColumnDataIdLabel(),editable:!1,sortable:!0,getter:function(t){return t.id}},{type:"TEXT",label:t.getTableColumnMappedToLabel(),editable:!1,sortable:!0,getter:function(t){return t.mappedId}}]},n.prototype.set=function(t,e){var n=!1;return void 0!==t&&(null!=t?(this.inputSource.input.value=t[0],this.inputDestination.input.value=t[1],this.inputInitial.input.value=t[2],this._newSource=t[0],this._newDestination=t[1]):(this.inputSource.input.value="",this.inputDestination.input.value="",this.inputInitial.input.value="",this._newSource="",this._newDestination=""),n=!0),void 0!==e&&(this._ids=this.toIds(e),n=!0),n&&this.updateRows(),this},Object.defineProperty(n.prototype,"value",{get:function(){return[this.inputSource.input.value.trim(),this.inputDestination.input.value.trim(),this.inputInitial.input.value.trim()]},set:function(t){this.set(t)},enumerable:!1,configurable:!0}),n.prototype.getResolvedValue=function(){return this.value},n.prototype.toIds=function(t){var e=[];if(null!=t){var n=new Set;this.newIds(t.children,n),n.forEach((function(t){e.push(t)})),e.sort()}return e},n.prototype.newIds=function(e,n){for(var i=0,o=e.length;i<o;++i){for(var r=e[i],a=r.data,l=0,u=a.size();l<u;++l){var s=a.get(l);s&&s.scope!==t.EShapeDataValueScope.PRIVATE&&n.add(s.id)}var p=r.children;0<p.length&&this.newIds(p,n)}},Object.defineProperty(n.prototype,"onUpdateRowsBound",{get:function(){var t=this._onUpdateRowsBound;return null==t&&(t=this.newOnUpdateRowsBound(),this._onUpdateRowsBound=t),t},enumerable:!1,configurable:!0}),n.prototype.newOnUpdateRowsBound=function(){var t=this;return function(){t.onUpdateRows()}},n.prototype.onUpdateRows=function(){this._onUpdateRowsTimeout=void 0,this._isRowsDirty&&(this._isRowsDirty=!1,this.table.data.clearAndAddAll(this.newRows()),this._onUpdateRowsTimeout=window.setTimeout(this.onUpdateRowsBound,100))},n.prototype.newRows=function(){var e=this._ids;if(null==e||e.length<=0)return[];var n=this._mapper,i=this._newSource;void 0!==n&&this._lastSource===i||(this._lastSource=i,n=null!=i&&0<i.trim().length?new t.EShapeDataMapperImpl(i):null);var o=this._destinations,r=this._newDestination;void 0!==o&&this._lastDestination===r||(this._lastDestination=r,o=t.EShapeDataMapperImpl.split(r));var a=[];if(null!=n){var l=new t.EShapeDataValueImpl;l.initial="";for(var u=0,s=e.length;u<s;++u){var p=e[u];l.id=p,n.map(l,o,"")&&a.push({id:p,mappedId:l.id})}}else for(u=0,s=e.length;u<s;++u)p=e[u],a.push({id:p,mappedId:p});return a},n.prototype.updateRows=function(){this._isRowsDirty=!0,null==this._onUpdateRowsTimeout&&this.onUpdateRows()},n.prototype.getType=function(){return"EDialogDataMappingValue"},n}(t.DDialogLayered),bi=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.newContentChildren=function(t,n){var i=e.prototype.newContentChildren.call(this,t,n);return i.push(this.layoutType,this.layoutScope,this.inputId,this.inputAs,this.inputInitial,this.layoutInterval,this.inputFormat,this.layoutRangeType,this.inputRangeFrom,this.inputRangeTo,this.inputCapacity,this.layoutOrder),i},Object.defineProperty(n.prototype,"inputId",{get:function(){var t=this._inputId;return null==t&&(t=this.newInputId(),this._inputId=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputId=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,on:{enter:function(){e.ok()}}},label:{width:60,text:{value:this.theme.getInputIdLabel()}},space:{width:60}})},Object.defineProperty(n.prototype,"inputAs",{get:function(){var t=this._inputAs;return null==t&&(t=this.newInputAs(),this._inputAs=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputAs=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,on:{enter:function(){e.ok()}}},label:{width:60,text:{value:this.theme.getInputAsLabel()}},space:{width:60}})},Object.defineProperty(n.prototype,"layoutType",{get:function(){var t=this._layoutType;return null==t&&(t=this.newLayoutType(),this._layoutType=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutType=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getSelectTypeLabel()}}),this.selectType,new t.DLayoutSpace({width:60})]})},Object.defineProperty(n.prototype,"selectType",{get:function(){var t=this,e=this._selectType;return null==e&&((e=this.newSelectType()).on("change",(function(){t.onChange()})),this._selectType=e),e},enumerable:!1,configurable:!0}),n.prototype.newSelectType=function(){return new t.DSelect({weight:1,value:t.EShapeDataValueType.NUMBER,menu:{items:this.newSelectTypeItems()}})},n.prototype.newSelectTypeItems=function(){var e=this.theme,n=[{value:t.EShapeDataValueType.BOOLEAN,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.BOOLEAN)}},{value:t.EShapeDataValueType.BOOLEAN_ARRAY,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.BOOLEAN_ARRAY)}},{value:t.EShapeDataValueType.NUMBER,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.NUMBER)}},{value:t.EShapeDataValueType.NUMBER_ARRAY,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.NUMBER_ARRAY)}},{value:t.EShapeDataValueType.STRING,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.STRING)}},{value:t.EShapeDataValueType.STRING_ARRAY,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.STRING_ARRAY)}},{value:t.EShapeDataValueType.OBJECT,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.OBJECT)}},{value:t.EShapeDataValueType.OBJECT_ARRAY,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.OBJECT_ARRAY)}},{value:t.EShapeDataValueType.TICKER,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.TICKER)}}];return t.EShapeDataValueExtensions.each((function(t){n.push({value:t.type,text:{value:t.label}})})),n},Object.defineProperty(n.prototype,"layoutScope",{get:function(){var t=this._layoutScope;return null==t&&(t=this.newLayoutScope(),this._layoutScope=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutScope=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getSelectScopeLabel()}}),this.selectScope,new t.DLayoutSpace({width:60})]})},Object.defineProperty(n.prototype,"selectScope",{get:function(){var t=this._selectScope;return null==t&&(t=this.newSelectScope(),this._selectScope=t),t},enumerable:!1,configurable:!0}),n.prototype.newSelectScope=function(){var e=this.theme;return new t.DSelect({weight:1,value:t.EShapeDataValueScope.PUBLIC,menu:{items:[{value:t.EShapeDataValueScope.PUBLIC,text:{value:e.getSelectScopeValueLabel(t.EShapeDataValueScope.PUBLIC)}},{value:t.EShapeDataValueScope.PROTECTED,text:{value:e.getSelectScopeValueLabel(t.EShapeDataValueScope.PROTECTED)}},{value:t.EShapeDataValueScope.PRIVATE,text:{value:e.getSelectScopeValueLabel(t.EShapeDataValueScope.PRIVATE)}}]}})},Object.defineProperty(n.prototype,"inputInitial",{get:function(){var t=this._inputInitial;return null==t&&(t=this.newInputInitial(),this._inputInitial=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputInitial=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,text:{value:""},on:{enter:function(){e.ok()}}},label:{width:60,text:{value:this.theme.getInputInitialLabel()}},space:{width:60}})},Object.defineProperty(n.prototype,"layoutInterval",{get:function(){var t=this._layoutInterval;return null==t&&(t=this.newLayoutInterval(),this._layoutInterval=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutInterval=function(){var e=this.theme;return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:e.getInputIntervalLabel()}}),this.inputInterval,new t.DInputLabel({width:60,text:{value:e.getInputIntervalUnitLabel(),align:{horizontal:"LEFT"}}})]})},Object.defineProperty(n.prototype,"inputInterval",{get:function(){var t=this._inputInterval;return null==t&&(t=this.newInputInterval(),this._inputInterval=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputInterval=function(){var e=this;return new t.DInputInteger({weight:1,text:{value:1e3},step:1,min:0,on:{enter:function(){e.ok()}}})},Object.defineProperty(n.prototype,"inputFormat",{get:function(){var t=this._inputFormat;return null==t&&(t=this.newInputFormat(),this._inputFormat=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputFormat=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,text:{value:""},on:{enter:function(){e.ok()}}},label:{width:60,text:{value:this.theme.getInputFormatLabel()}},space:{width:60}})},Object.defineProperty(n.prototype,"layoutRangeType",{get:function(){var t=this._layoutRangeType;return null==t&&(t=this.newLayoutRangeType(),this._layoutRangeType=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutRangeType=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getSelectRangeTypeLabel()}}),this.selectRangeType,new t.DLayoutSpace({width:60})]})},Object.defineProperty(n.prototype,"selectRangeType",{get:function(){var t=this,e=this._selectRangeType;return null==e&&((e=this.newSelectRangeType()).on("change",(function(){t.onChange()})),this._selectRangeType=e),e},enumerable:!1,configurable:!0}),n.prototype.newSelectRangeType=function(){var e=this.theme;return new t.DSelect({weight:1,value:t.EShapeDataValueRangeType.NONE,menu:{items:[{value:t.EShapeDataValueRangeType.NONE,text:{value:e.getSelectRangeTypeValueLabel(t.EShapeDataValueRangeType.NONE)}},{value:t.EShapeDataValueRangeType.FROM,text:{value:e.getSelectRangeTypeValueLabel(t.EShapeDataValueRangeType.FROM)}},{value:t.EShapeDataValueRangeType.TO,text:{value:e.getSelectRangeTypeValueLabel(t.EShapeDataValueRangeType.TO)}},{value:t.EShapeDataValueRangeType.FROM_TO,text:{value:e.getSelectRangeTypeValueLabel(t.EShapeDataValueRangeType.FROM_TO)}}]}})},Object.defineProperty(n.prototype,"inputRangeFrom",{get:function(){var t=this._inputRangeFrom;return null==t&&(t=this.newInputRangeFrom(),this._inputRangeFrom=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputRangeFrom=function(){var e=this;return new t.DInputRealAndLabel({width:"padding",height:"auto",visible:!1,input:{weight:1,text:{value:0},on:{enter:function(){e.ok()}}},label:{width:90,text:{value:this.theme.getInputRangeFromLabel()}},space:{width:90}})},Object.defineProperty(n.prototype,"inputRangeTo",{get:function(){var t=this._inputRangeTo;return null==t&&(t=this.newInputRangeTo(),this._inputRangeTo=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputRangeTo=function(){var e=this;return new t.DInputRealAndLabel({width:"padding",height:"auto",visible:!1,input:{weight:1,text:{value:1},on:{enter:function(){e.ok()}}},label:{width:90,text:{value:this.theme.getInputRangeToLabel()}},space:{width:90}})},Object.defineProperty(n.prototype,"inputCapacity",{get:function(){var t=this._inputCapacity;return null==t&&(t=this.newInputCapacity(),this._inputCapacity=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputCapacity=function(){var e=this;return new t.DInputIntegerAndLabel({width:"padding",height:"auto",input:{weight:1,text:{value:0},on:{enter:function(){e.ok()}}},label:{width:60,text:{value:this.theme.getInputCapacityLabel()}},space:{width:60}})},Object.defineProperty(n.prototype,"layoutOrder",{get:function(){var t=this._layoutOrder;return null==t&&(t=this.newLayoutOrder(),this._layoutOrder=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutOrder=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getSelectOrderLabel()}}),this.selectOrder,new t.DLayoutSpace({width:60})]})},Object.defineProperty(n.prototype,"selectOrder",{get:function(){var t=this._selectOrder;return null==t&&(t=this.newSelectOrder(),this._selectOrder=t),t},enumerable:!1,configurable:!0}),n.prototype.newSelectOrder=function(){var e=this,n=this.theme;return new t.DSelect({weight:1,value:t.EShapeDataValueOrder.ASCENDING,menu:{items:[{value:t.EShapeDataValueOrder.ASCENDING,text:{value:n.getSelectOrderValueLabel(t.EShapeDataValueOrder.ASCENDING)}},{value:t.EShapeDataValueOrder.DESCENDING,text:{value:n.getSelectOrderValueLabel(t.EShapeDataValueOrder.DESCENDING)}}]},on:{init:function(t){e._selectOrder=t}}})},n.prototype.onChange=function(){var e=this.selectType.value;switch(e){case t.EShapeDataValueType.BOOLEAN:case t.EShapeDataValueType.BOOLEAN_ARRAY:case t.EShapeDataValueType.NUMBER:case t.EShapeDataValueType.NUMBER_ARRAY:case t.EShapeDataValueType.STRING:case t.EShapeDataValueType.STRING_ARRAY:case t.EShapeDataValueType.OBJECT:case t.EShapeDataValueType.OBJECT_ARRAY:if(this.layoutScope.show(),this.inputId.show(),this.inputAs.show(),this.inputInitial.show(),this.layoutInterval.hide(),this.inputFormat.show(),e===t.EShapeDataValueType.NUMBER){this.layoutRangeType.show();var n=this.selectRangeType.value;null!=n&&n&t.EShapeDataValueRangeType.FROM?this.inputRangeFrom.show():this.inputRangeFrom.hide(),null!=n&&n&t.EShapeDataValueRangeType.TO?this.inputRangeTo.show():this.inputRangeTo.hide()}else this.layoutRangeType.hide(),this.inputRangeFrom.hide(),this.inputRangeTo.hide();break;case t.EShapeDataValueType.TICKER:this.layoutScope.hide(),this.inputId.hide(),this.inputAs.show(),this.inputInitial.hide(),this.layoutInterval.show(),this.inputFormat.hide(),this.layoutRangeType.hide(),this.inputRangeFrom.hide(),this.inputRangeTo.hide();break;default:this.layoutScope.hide(),this.inputId.hide(),this.inputAs.show(),this.inputInitial.hide(),this.layoutInterval.hide(),this.inputFormat.hide(),this.layoutRangeType.hide(),this.inputRangeFrom.hide(),this.inputRangeTo.hide()}},n.prototype.reset=function(){return this.selectType.value=t.EShapeDataValueType.NUMBER,this.selectScope.value=t.EShapeDataValueScope.PUBLIC,this.inputId.input.value="",this.inputAs.input.value="",this.inputInitial.input.value="",this.inputInterval.value=1e3,this.inputFormat.input.value="",this.selectRangeType.value=t.EShapeDataValueRangeType.NONE,this.inputRangeFrom.input.value=0,this.inputRangeTo.input.value=1,this.inputCapacity.input.value=0,this.selectOrder.value=t.EShapeDataValueOrder.ASCENDING,this.onChange(),this},Object.defineProperty(n.prototype,"value",{get:function(){var e,n,i,o,r=new t.EShapeDataValueImpl,a=null!==(e=this.selectType.value)&&void 0!==e?e:t.EShapeDataValueType.NUMBER,l=null!==(n=this.selectScope.value)&&void 0!==n?n:t.EShapeDataValueScope.PUBLIC,u=null!==(i=this.selectOrder.value)&&void 0!==i?i:t.EShapeDataValueOrder.ASCENDING;switch(r.type=a,a){case t.EShapeDataValueType.BOOLEAN:case t.EShapeDataValueType.BOOLEAN_ARRAY:case t.EShapeDataValueType.NUMBER:case t.EShapeDataValueType.NUMBER_ARRAY:case t.EShapeDataValueType.STRING:case t.EShapeDataValueType.STRING_ARRAY:case t.EShapeDataValueType.OBJECT:case t.EShapeDataValueType.OBJECT_ARRAY:r.scope=l,r.id=this.inputId.input.value.trim(),r.as=this.inputAs.input.value.trim(),r.initial=this.inputInitial.input.value.trim(),r.format=this.inputFormat.input.value.trim(),a===t.EShapeDataValueType.NUMBER?(r.range.type=null!==(o=this.selectRangeType.value)&&void 0!==o?o:t.EShapeDataValueRangeType.NONE,r.range.from=this.inputRangeFrom.input.value,r.range.to=this.inputRangeTo.input.value):(r.range.type=t.EShapeDataValueRangeType.NONE,r.range.from=0,r.range.to=1),r.order=u;break;case t.EShapeDataValueType.TICKER:r.scope=t.EShapeDataValueScope.PUBLIC,r.id="",r.as=this.inputAs.input.value.trim(),r.initial="".concat(this.inputInterval.value),r.format="",r.range.type=t.EShapeDataValueRangeType.NONE,r.range.from=0,r.range.to=1,r.order=u;break;default:r.scope=t.EShapeDataValueScope.PUBLIC,r.id="",r.as=this.inputAs.input.value.trim(),r.initial="",r.format="",r.range.type=t.EShapeDataValueRangeType.NONE,r.range.from=0,r.range.to=1,r.order=u}return r},set:function(e){null!=e&&(this.selectType.value=e.type,this.selectScope.value=e.scope,this.inputId.input.value=e.id,this.inputAs.input.value=e.as,e.type===t.EShapeDataValueType.TICKER?(this.inputInitial.input.value="",this.inputInterval.value=this.toInterval(e.initial)):(this.inputInitial.input.value=e.initial,this.inputInterval.value=1e3),this.inputFormat.input.value=e.format,this.selectRangeType.value=e.range.type,this.inputRangeFrom.input.value=e.range.from,this.inputRangeTo.input.value=e.range.to,this.inputCapacity.input.value=e.capacity,this.selectOrder.value=e.order,this.onChange())},enumerable:!1,configurable:!0}),n.prototype.toInterval=function(t){try{var e=parseInt(t,10);if(e==e)return Math.max(0,e)}catch(t){}return 1e3},n.prototype.getResolvedValue=function(){return this.value},n.prototype.getType=function(){return"EDialogDataValue"},n}(t.DDialogLayered),mi=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.newContentChildren=function(t,n){var i=e.prototype.newContentChildren.call(this,t,n);return i.push(this.inputName,this.inputPositionLayout,this.inputSizeLayout,this.checkBackgroundLayout,this.colorBackgroundLayout,this.selectGestureLayout,this.checkVisibleLayout,this.checkInteractiveLayout),i},n.prototype.newLabel=function(e){return new t.DInputLabel({width:60,text:{value:e}})},n.prototype.newSpace=function(){return new t.DLayoutSpace({width:60})},n.prototype.newLabeled=function(e,n,i){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[null!=e?this.newLabel(e):this.newSpace(),n,i,this.newSpace()]})},Object.defineProperty(n.prototype,"inputName",{get:function(){var t=this._inputName;return null==t&&(t=this.newInputName(),this._inputName=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputName=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputNameLabel()}},input:{weight:1,text:{value:""},on:{enter:function(){e.ok()}}},space:{width:60}})},Object.defineProperty(n.prototype,"inputX",{get:function(){var t=this._inputX;return null==t&&(t=this.newInputX(),this._inputX=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputX=function(){var e=this;return new t.DInputReal({weight:1,on:{enter:function(){e.ok()}}})},Object.defineProperty(n.prototype,"inputY",{get:function(){var t=this._inputY;return null==t&&(t=this.newInputY(),this._inputY=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputY=function(){var e=this;return new t.DInputReal({weight:1,on:{enter:function(){e.ok()}}})},Object.defineProperty(n.prototype,"inputPositionLayout",{get:function(){var t=this._inputPositionLayout;return null==t&&(t=this.newLabeled(this.theme.getInputPositionLabel(),this.inputX,this.inputY),this._inputPositionLayout=t),t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputWidth",{get:function(){var t=this._inputWidth;return null==t&&(t=this.newInputWidth(),this._inputWidth=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputWidth=function(){var e=this;return new t.DInputReal({weight:1,on:{enter:function(){e.ok()}}})},Object.defineProperty(n.prototype,"inputHeight",{get:function(){var t=this._inputHeight;return null==t&&(t=this.newInputHeight(),this._inputHeight=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputHeight=function(){var e=this;return new t.DInputReal({weight:1,on:{enter:function(){e.ok()}}})},Object.defineProperty(n.prototype,"inputSizeLayout",{get:function(){var t=this._inputSizeLayout;return null==t&&(t=this.newLabeled(this.theme.getInputSizeLabel(),this.inputWidth,this.inputHeight),this._inputSizeLayout=t),t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"checkBackground",{get:function(){var t=this._checkBackground;return null==t&&(t=this.newCheckBackground(),this._checkBackground=t),t},enumerable:!1,configurable:!0}),n.prototype.newCheckBackground=function(){var e=this;return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckBackgroundLabel(),align:{horizontal:"LEFT"}},on:{active:function(){e.onCheckBackgroundChange(!0)},inactive:function(){e.onCheckBackgroundChange(!1)}}})},n.prototype.onCheckBackgroundChange=function(t){this.colorBackground.state.isDisabled=!t},Object.defineProperty(n.prototype,"checkBackgroundLayout",{get:function(){var t=this._checkBackgroundLayout;return null==t&&(t=this.newLabeled(this.theme.getTextBackgroundLabel(),this.checkBackground,null),this._checkBackgroundLayout=t),t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"colorBackground",{get:function(){var t=this._colorBackground;return null==t&&(t=this.newColorBackground(),this._colorBackground=t),t},enumerable:!1,configurable:!0}),n.prototype.newColorBackground=function(){return new t.DButtonColor({weight:1})},Object.defineProperty(n.prototype,"colorBackgroundLayout",{get:function(){var t=this._colorBackgroundLayout;return null==t&&(t=this.newLabeled(null,this.colorBackground,null),this._colorBackgroundLayout=t),t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"checkVisible",{get:function(){var t=this._checkVisible;return null==t&&(t=this.newCheckVisible(),this._checkVisible=t),t},enumerable:!1,configurable:!0}),n.prototype.newCheckVisible=function(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckVisibleLabel(),align:{horizontal:"LEFT"}}})},Object.defineProperty(n.prototype,"checkVisibleLayout",{get:function(){var t=this._checkVisibleLayout;return null==t&&(t=this.newLabeled(null,this.checkVisible,null),this._checkVisibleLayout=t),t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"checkInteractive",{get:function(){var t=this._checkInteractive;return null==t&&(t=this.newCheckInteractive(),this._checkInteractive=t),t},enumerable:!1,configurable:!0}),n.prototype.newCheckInteractive=function(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckInteractiveLabel(),align:{horizontal:"LEFT"}}})},Object.defineProperty(n.prototype,"checkInteractiveLayout",{get:function(){var t=this._checkInteractiveLayout;return null==t&&(t=this.newLabeled(null,this.checkInteractive,null),this._checkInteractiveLayout=t),t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectGesture",{get:function(){var t=this._selectGesture;return null==t&&(t=this.newSelectGesture(),this._selectGesture=t),t},enumerable:!1,configurable:!0}),n.prototype.newSelectGesture=function(){var e=this.theme;return new t.DSelectMultiple({weight:1,values:this.fromGestureOperationType(t.EShapeActionValueGestureOperationType.ALL),menu:{items:[{value:t.EShapeActionValueGestureOperationType.DRAG,text:{value:e.getSelectGestureValueLabel(t.EShapeActionValueGestureOperationType.DRAG)},check:!0},{value:t.EShapeActionValueGestureOperationType.PINCH,text:{value:e.getSelectGestureValueLabel(t.EShapeActionValueGestureOperationType.PINCH)},check:!0}]}})},n.prototype.toGestureOperationType=function(e){for(var n=t.EShapeActionValueGestureOperationType.NONE,i=0,o=e.length;i<o;++i)n|=e[i];return n},n.prototype.fromGestureOperationType=function(e){var n=[];return e&t.EShapeActionValueGestureOperationType.DRAG&&n.push(t.EShapeActionValueGestureOperationType.DRAG),e&t.EShapeActionValueGestureOperationType.PINCH&&n.push(t.EShapeActionValueGestureOperationType.PINCH),n},Object.defineProperty(n.prototype,"selectGestureLayout",{get:function(){var t=this._selectGestureLayout;return null==t&&(t=this.newLabeled(this.theme.getSelectGestureLabel(),this.selectGesture,null),this._selectGestureLayout=t),t},enumerable:!1,configurable:!0}),n.prototype.reset=function(t,e){return this.inputName.input.value="",this.inputX.value=0,this.inputY.value=0,this.inputWidth.value=t,this.inputHeight.value=e,this.checkBackground.state.isActive=!1,this.colorBackground.value.color=16777215,this.colorBackground.value.alpha=1,this.checkVisible.state.isActive=!0,this.checkInteractive.state.isActive=!0,this.selectGesture.values=[],this.onCheckBackgroundChange(!1),this},Object.defineProperty(n.prototype,"value",{get:function(){return new B(this.inputName.input.value,this.inputX.value,this.inputY.value,this.inputWidth.value,this.inputHeight.value,new A(this.checkBackground.state.isActive,this.colorBackground.value.color,this.colorBackground.value.alpha),this.checkVisible.state.isActive,this.checkInteractive.state.isActive,this.toGestureOperationType(this.selectGesture.values))},set:function(t){null!=t&&(this.inputName.input.value=t.name,this.inputX.value=t.x,this.inputY.value=t.y,this.inputWidth.value=t.width,this.inputHeight.value=t.height,this.checkBackground.state.isActive=t.background.enable,this.colorBackground.value.color=t.background.color,this.colorBackground.value.alpha=t.background.alpha,this.checkVisible.state.isActive=t.visible,this.checkInteractive.state.isActive=t.interactive,this.selectGesture.values=this.fromGestureOperationType(t.gesture),this.onCheckBackgroundChange(t.background.enable))},enumerable:!1,configurable:!0}),n.prototype.getResolvedValue=function(){return this.value},n.prototype.getType=function(){return"EDialogLayer"},n}(t.DDialogLayered),_i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.toReasonMalformedLabel=function(t){switch(t){case"uid":return"An ID";case"password":return"A password";case"description":return"A description";case"name":return"A name";case"label":return"A label";case"summary":return"A summary";default:return"Something"}},e.prototype.toReasonMalformedRange=function(t){switch(t){case"uid":case"name":default:return{lower:1,upper:32};case"password":return{lower:6,upper:32};case"description":return{lower:0,upper:256};case"label":return{lower:0,upper:16};case"summary":return{lower:0,upper:32}}},e.prototype.toReasonMalformed=function(t,e,n){var i=this.toReasonMalformedLabel(e);switch(n){case"short":case"long":var o=this.toReasonMalformedRange(e);return"Failed to save '".concat(t,"'.\n").concat(i," must be of ").concat(o.lower," to ").concat(o.upper,"\ncharacters long.");case"simple":return"Failed to save '".concat(t,"'.\n").concat(i," must contain letters (A-Za-z_)\nand digits (0-9).");case"slash":return"Failed to save '".concat(t,"'.\n").concat(i," must not contain the slash mark (/).");case"non-alphanumeric":return"Failed to save '".concat(t,"'.\n").concat(i," must contain only letters (A-Za-z_),\n")+"digits (0-9) and a sharp symbol (#).";default:return"Failed to save '".concat(t,"'.\n").concat(i," is invalid.")}},e.prototype.toReasonTarget=function(t,e,n){return null!=e?"Failed to save '".concat(t,"'.\n").concat(n," '").concat(e,"' does not exit."):"Failed to save '".concat(t,"'.\n").concat(n," is missing.")},e.prototype.toReasonTargetAt=function(t,e,n,i){return null!=e?"Failed to save.\n".concat(n," '").concat(t,"'\nrequires ").concat(i," '").concat(e,"'."):"Failed to save.\n".concat(n," '").concat(t,"'\nrequires ").concat(i,".")},e.prototype.toReason=function(t){if(null!=t)if(0<t.length&&"{"===t[0])try{var e=JSON.parse(t);switch(e.id){case"no-sensor-found":return this.toReasonTarget(e.at,e.target,"Sensor");case"no-device-model-found":return this.toReasonTarget(e.at,e.target,"Device model");case"malformed":return this.toReasonMalformed(e.at,e.target,e.reason);case"invalid-operation-mode":return"Failed to save.\nInvalid operation mode.";case"no-graphic-found":return this.toReasonTargetAt(e.at,e.target,"A graphic sensor mapping","a graphic");case"no-alarm-list-found":return this.toReasonTargetAt(e.at,e.target,"An alarm mapping","an alarm list");case"no-trend-graph-found":return this.toReasonTargetAt(e.at,e.target,"A trend graph sensor mapping","a trend graph")}}catch(t){return}else switch(t){case"duplication":return"Failed to save.\nThe name has already been used.";case"duplications":return"Failed to save.\nIDs must be unique.";case"invalid-operation-mode":return"Failed to save.\nInvalid operation mode.";case"validation":return"A validation error has occurred.";case"validation-fail":return"A validation failed."}},e.prototype.toButtonText=function(t){return"validation"===t||"validation-fail"===t||null!=t?"OK":"Save"},e.prototype.reject=function(e){t.prototype.reject.call(this,this.toReason(e));var n=this.footer;if(n){var i=n.buttonOk;i&&(i.text=this.toButtonText(e))}},e}(t.DDialogProcessing),Si=128,wi=function(){return Si},Ti=function(){var t=ke;return null==t&&(t=Ei(),ke=t),t},Ei=function(){var e=wi(),n=window.devicePixelRatio||1,i=e*n;return t.toSvgTexture('<svg xmlns="http://www.w3.org/2000/svg" height="'.concat(i,'px" width="').concat(i,'px" viewBox="0 0 24 24" fill="#000000" fill-opacity="0.05">')+'<path d="M19,5v11.17l2,2V5c0-1.1-0.9-2-2-2H5.83l2,2H19z"/><path d="M2.81,2.81L1.39,4.22L3,5.83V19c0,1.1,0.9,2,2,2h13.17l1.61,1.61l1.41-1.41L2.81,2.81z M5,19V7.83l7.07,7.07L11.25,16 L9,13l-3,4h8.17l2,2H5z"/></svg>',n)},Ci=function(n,i,o){var r=wi(),a=Ti(),l=8+r+30+8,u=new Map,s=new Set,p=function(n){if(i){var o=i(n.id);if(t.isString(o)){var r=u.get(o);if(null==r){var l=e.Texture.from(o);l.baseTexture.on("error",(function(){d(l,o)})),r=l,u.set(o,l)}return r}if(null!=o)return o}return a},h=null,c=function(){s.forEach((function(t){t.image=null})),u.forEach((function(t,e){if(t!==a){var n=t.baseTexture;t.destroy(),n&&(n.destroy(),n.off("error"))}})),u.clear()},d=function(t,e){if(t!==a&&!t.valid){s.forEach((function(e){var n=e.image.get(0);null!=n&&n.source===t&&(n.source=a)}));var n=t.baseTexture;t.destroy(),n&&(n.destroy(),n.off("error")),u.set(e,a)}};return{width:"auto",height:"auto",layout:{width:"auto",height:"auto"},content:{width:"auto",height:"auto"},list:{width:3*l,height:2*l+32,data:{toImage:p},updater:{newItem:function(e){var n=new t.DDialogSelectListItem(e,{width:l,height:l,padding:8,text:{align:{vertical:"BOTTOM",horizontal:"CENTER"}},image:{align:{vertical:"TOP",horizontal:"CENTER",with:"PADDING"},margin:{vertical:0},tint:{color:16777215,alpha:1}}});return s.add(n),n}}},controller:n,on:{open:function(){null!=h&&(window.clearTimeout(h),h=null,c()),s.forEach((function(t){var e=t.value;null!=e&&(t.image=p(e))}))},close:function(){null==h&&(h=window.setTimeout((function(){h=null,c()}),1e3))},select:o}}},Di=function(e,n,i){return new t.DDialogSelect(Ci(e,n,i))},Li=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.newContentChildren=function(n,i){var o=e.prototype.newContentChildren.call(this,n,i);return o.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:n.getSelectDirectionLabel()}}),this.selectType,new t.DLayoutSpace({width:60})]})),o.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:n.getInputPositionLabel()}}),this.inputPosition,new t.DLayoutSpace({width:60})]})),o},Object.defineProperty(n.prototype,"selectType",{get:function(){var t=this._selectType;return null==t&&(t=this.newSelectType(),this._selectType=t),t},enumerable:!1,configurable:!0}),n.prototype.newSelectType=function(){var e=this.theme;return new t.DSelect({weight:1,value:t.ESnapperTargetValueType.VERTICAL,menu:{items:[{value:t.ESnapperTargetValueType.VERTICAL,text:{value:e.getSelectDirectionValueLabel(t.ESnapperTargetValueType.VERTICAL)}},{value:t.ESnapperTargetValueType.HORIZONTAL,text:{value:e.getSelectDirectionValueLabel(t.ESnapperTargetValueType.HORIZONTAL)}}]}})},Object.defineProperty(n.prototype,"inputPosition",{get:function(){var t=this._inputPosition;return null==t&&(t=this.newInputPosition(),this._inputPosition=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputPosition=function(){var e=this;return new t.DInputReal({weight:1,text:{value:0},step:1,on:{enter:function(){e.ok()}}})},n.prototype.reset=function(){return this.selectType.value=t.ESnapperTargetValueType.VERTICAL,this.inputPosition.value=0,this},Object.defineProperty(n.prototype,"value",{get:function(){var e=this.selectType.value,n=this.inputPosition.value;return null!=e?new t.ESnapperTargetValue(e,n):null},set:function(t){null!=t&&(this.selectType.value=t.type,this.inputPosition.value=t.position)},enumerable:!1,configurable:!0}),n.prototype.getResolvedValue=function(){return this.value},n.prototype.getType=function(){return"EDialogSnap"},n}(t.DDialogLayered),Ai=function(e){function n(n){var i=e.call(this,n)||this;i._icons=n.icons;var o=n.selection;i._selection=o,i._diagram=n.diagram,i.addChild(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[i.newTextLabel(),i.buttonNew,i.buttonDelete,i.buttonBringForward,i.buttonSendBackward]})),i.addChild(i.actionList),i.addChild(i.checkInteractive),i.addChild(i.checkFocusable),i.addChild(i.labelTitle),i.addChild(i.inputTitle),i.addChild(i.labelShortcut),i.addChild(i.inputShortcut),i.addChild(i.labelCursor),i.addChild(i.dropdownCursor),o.on("change",(function(){i.onSelectionChange(o)}));var r=i.actionList;return r.data.selection.on("change",(function(){i.onListSelectionChange(r)})),i.onSelectionChange(o),i}return i(n,e),n.prototype.newTextLabel=function(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})},Object.defineProperty(n.prototype,"buttonNew",{get:function(){var t;return null!==(t=this._buttonNew)&&void 0!==t?t:this._buttonNew=this.newButtonNew()},enumerable:!1,configurable:!0}),n.prototype.newButtonNew=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.theme.getButtonNewTitle(),on:{active:function(t){e.onButtonNewActive(t)}}})},n.prototype.onButtonNewActive=function(t){var e=this;this.actionDialog.reset().open(t).then((function(t){null!=t&&e._selection.addActionValue(t)}))},Object.defineProperty(n.prototype,"buttonDelete",{get:function(){var t;return null!==(t=this._buttonDelete)&&void 0!==t?t:this._buttonDelete=this.newButtonDelete()},enumerable:!1,configurable:!0}),n.prototype.newButtonDelete=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.theme.getButtonDeleteTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var t=e.actionList.data.selection.first;null!=t&&e._selection.removeActionValue(t)}}})},n.prototype.onListSelectionChangeButtonDelete=function(t){this.buttonDelete.state.isDisabled=t.data.selection.isEmpty()},Object.defineProperty(n.prototype,"buttonBringForward",{get:function(){var t;return null!==(t=this._buttonBringForward)&&void 0!==t?t:this._buttonBringForward=this.newButtonBringForward()},enumerable:!1,configurable:!0}),n.prototype.newButtonBringForward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonBringForwardTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var t=e.actionList,n=t.data.selection.first,i=t.data.items;null!=n&&i[0]!==n&&e._selection.bringActionValueForward(n)}}})},n.prototype.onListSelectionChangeButtonBringForward=function(t){var e=t.data.selection.first,n=t.data.items;this.buttonBringForward.state.isDisabled=null==e||n[0]===e},Object.defineProperty(n.prototype,"buttonSendBackward",{get:function(){var t;return null!==(t=this._buttonSendBackward)&&void 0!==t?t:this._buttonSendBackward=this.newButtonSendBackward()},enumerable:!1,configurable:!0}),n.prototype.newButtonSendBackward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonSendBackwardTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var t=e.actionList,n=t.data.selection.first,i=t.data.items;null!=n&&i[i.length-1]!==n&&e._selection.sendActionValueBackward(n)}}})},n.prototype.onListSelectionChangeButtonSendBackward=function(t){var e=t.data.selection.first,n=t.data.items;this.buttonSendBackward.state.isDisabled=null==e||n[n.length-1]===e},Object.defineProperty(n.prototype,"actionDialog",{get:function(){var t;return null!==(t=this._actionDialog)&&void 0!==t?t:this._actionDialog=this.newActionDialog()},enumerable:!1,configurable:!0}),n.prototype.newActionDialog=function(){return new yi({icons:this._icons,diagram:this._diagram})},Object.defineProperty(n.prototype,"actionList",{get:function(){var t;return null!==(t=this._actionList)&&void 0!==t?t:this._actionList=this.newActionList()},enumerable:!1,configurable:!0}),n.prototype.newActionList=function(){var e=this,n=new t.DList({width:"padding",weight:1,data:{toLabel:function(t){return t.toLabel()}},updater:{newItem:function(i){return new t.DListItem(i,{image:{tint:{color:null}},on:{dblclick:function(t,i,o){e.onActionListDblClick(t,i,o,n)},set:function(t,n,i){e.onActionListSet(i,t)},unset:function(t){e.onActionListUnset(t)}}})}}});return n},n.prototype.onActionListDblClick=function(t,e,n,i){var o=this,r=n.value;if(null!=r){var a=this.actionDialog;a.reset(),a.value=r,a.open(n).then((function(){var t=a.value;null!=t&&o._selection.replaceActionValue(r,t,i)}))}},n.prototype.onActionListSet=function(e,n){if(n instanceof t.EShapeActionValueChangeColor){var i=e.image.get(0);if(null!=i){var o=t.DThemes.get("DButtonColor");i.source=o.getImageSource(e.state),i.tint.color=n.color}}else e.image=null},n.prototype.onActionListUnset=function(t){t.image=null},n.prototype.onSelectionChangeActionList=function(t){var e=t.last(),n=this.actionList;n.data.items=null!=e?e.action.values:[],this.onListSelectionChange(n)},Object.defineProperty(n.prototype,"checkInteractive",{get:function(){var t;return null!==(t=this._checkInteractive)&&void 0!==t?t:this._checkInteractive=this.newCheckInteractive()},enumerable:!1,configurable:!0}),n.prototype.newCheckInteractive=function(){var e=this;return new t.DButtonCheckRight({width:"padding",text:{value:this.theme.getCheckInteractiveLabel()},padding:0,background:{color:null},on:{active:function(){e._selection.setInteractive(!0)},inactive:function(){e._selection.setInteractive(!1)}}})},n.prototype.onSelectionChangeCheckInteractive=function(t){var e=t.last(),n=this.checkInteractive;null!=e?(n.state.isActive=e.interactive,n.state.isDisabled=!1):n.state.isDisabled=!0},Object.defineProperty(n.prototype,"checkFocusable",{get:function(){var t;return null!==(t=this._checkFocusable)&&void 0!==t?t:this._checkFocusable=this.newCheckFocusable()},enumerable:!1,configurable:!0}),n.prototype.newCheckFocusable=function(){var e=this;return new t.DButtonCheckRight({width:"padding",text:{value:this.theme.getCheckFocusableLabel()},padding:0,background:{color:null},on:{active:function(){e._selection.setFocusable(!0)},inactive:function(){e._selection.setFocusable(!1)}}})},n.prototype.onSelectionChangeCheckFocusable=function(t){var e=t.last(),n=this.checkFocusable;null!=e?(n.state.isActive=e.state.isFocusable,n.state.isDisabled=!1):n.state.isDisabled=!0},Object.defineProperty(n.prototype,"labelShortcut",{get:function(){var t;return null!==(t=this._labelShortcut)&&void 0!==t?t:this._labelShortcut=this.newLabelShortcut()},enumerable:!1,configurable:!0}),n.prototype.newLabelShortcut=function(){return new t.DText({width:"padding",text:{value:this.theme.getInputShortcutLabel()}})},Object.defineProperty(n.prototype,"inputShortcut",{get:function(){var t;return null!==(t=this._inputShortcut)&&void 0!==t?t:this._inputShortcut=this.newInputShortcut()},enumerable:!1,configurable:!0}),n.prototype.newInputShortcut=function(){var e=this;return new t.DInputText({width:"padding",on:{change:function(t){e._selection.setShortcut(e.toNormalizedShortcut(t))}}})},n.prototype.toNormalizedShortcut=function(t){var e=t.trim();if(0<e.length)return e},n.prototype.onSelectionChangeInputShortcut=function(t){var e;this.inputShortcut.value=(null===(e=t.last())||void 0===e?void 0:e.shortcut)||""},Object.defineProperty(n.prototype,"labelTitle",{get:function(){var t;return null!==(t=this._labelTitle)&&void 0!==t?t:this._labelTitle=this.newLabelTitle()},enumerable:!1,configurable:!0}),n.prototype.newLabelTitle=function(){return new t.DText({width:"padding",text:{value:this.theme.getInputTitleLabel()}})},Object.defineProperty(n.prototype,"inputTitle",{get:function(){var t;return null!==(t=this._inputTitle)&&void 0!==t?t:this._inputTitle=this.newInputTitle()},enumerable:!1,configurable:!0}),n.prototype.newInputTitle=function(){var e=this;return new t.DInputText({width:"padding",on:{change:function(t){e._selection.setTitle(e.toNormalizedTitle(t))}}})},n.prototype.toNormalizedTitle=function(t){if(0<t.trim().length)return t},n.prototype.onSelectionChangeInputTitle=function(t){var e;this.inputTitle.value=(null===(e=t.last())||void 0===e?void 0:e.title)||""},Object.defineProperty(n.prototype,"labelCursor",{get:function(){var t;return null!==(t=this._labelCursor)&&void 0!==t?t:this._labelCursor=this.newLabelCursor()},enumerable:!1,configurable:!0}),n.prototype.newLabelCursor=function(){return new t.DText({width:"padding",text:{value:this.theme.getDropdownCursorLabel()}})},Object.defineProperty(n.prototype,"dropdownCursor",{get:function(){var t;return null!==(t=this._dropdownCursor)&&void 0!==t?t:this._dropdownCursor=this.newDropdownCursor()},enumerable:!1,configurable:!0}),n.prototype.newDropdownCursor=function(){var e=this;return new t.DDropdown({width:"padding",menu:{width:"auto",column:3,fit:!1,items:this.newDropdownCursorMenuItems()},on:{select:function(t){var n;e.dropdownCursor.text=null!==(n=e.cursors.get(t))&&void 0!==n?n:t,e._selection.setCursor(t)}}})},n.prototype.newDropdownCursorMenuItems=function(){var t=[];return this.cursors.forEach((function(e,n){t.push({width:200,value:n,text:{value:e}})})),t},Object.defineProperty(n.prototype,"cursors",{get:function(){var t;return null!==(t=this._cursors)&&void 0!==t?t:this._cursors=this.theme.getCursors()},enumerable:!1,configurable:!0}),n.prototype.onSelectionChangeDropdownCursor=function(t){var e,n,i,o=null!==(n=null===(e=t.last())||void 0===e?void 0:e.cursor)&&void 0!==n?n:"";this.dropdownCursor.text=null!==(i=this.cursors.get(o))&&void 0!==i?i:o},n.prototype.onSelectionChange=function(t){this.state.isDisabled=t.isEmpty(),this.onSelectionChangeActionList(t),this.onSelectionChangeCheckInteractive(t),this.onSelectionChangeCheckFocusable(t),this.onSelectionChangeInputShortcut(t),this.onSelectionChangeInputTitle(t),this.onSelectionChangeDropdownCursor(t)},n.prototype.onListSelectionChange=function(t){this.onListSelectionChangeButtonDelete(t),this.onListSelectionChangeButtonBringForward(t),this.onListSelectionChangeButtonSendBackward(t)},n.prototype.getType=function(){return"EEditorAction"},n}(t.DLayoutVertical),Bi=function(e){function n(t){var n=e.call(this,t)||this,i=t.canvas;return n._canvas=t.canvas,n.onDefaultChange(i),n}return i(n,e),n.prototype.onDefaultChange=function(e){var n=e.category,i=n.default,o=n.items,r=this.layoutCategory;if(null!=i&&0<o.length){for(var a=[],l=0,u=o.length;l<u;++l){var s=o[l];a.push({value:s.id,text:{value:s.label}})}var p=this.selectCategory;p.menu=new t.DMenu({fit:!0,items:a}),p.value=n.default,r.state.isEnabled=n.writable,r.show()}else r.hide()},n.prototype.newContentChildren=function(t,n){var i=e.prototype.newContentChildren.call(this,t,n);return i.push(this.layoutName,this.layoutLabel,this.layoutWidth,this.layoutHeight,this.layoutCategory,this.layoutSummary,this.layoutDescription,this.layoutBackground),i},Object.defineProperty(n.prototype,"layoutName",{get:function(){var t=this._layoutName;return null==t&&(t=this.newLayoutName(),this._layoutName=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutName=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",label:{text:{value:this.theme.getInputNameLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},Object.defineProperty(n.prototype,"layoutLabel",{get:function(){var t=this._layoutLabel;return null==t&&(t=this.newLayoutLabel(),this._layoutLabel=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutLabel=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",label:{text:{value:this.theme.getInputLabelLabel()}},input:{weight:1,on:{enter:function(){e.ok()}}},space:{width:60}})},Object.defineProperty(n.prototype,"layoutWidth",{get:function(){var t=this._layoutWidth;return null==t&&(t=this.newLayoutWidth(),this._layoutWidth=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutWidth=function(){var e=this;return new t.DInputIntegerAndLabel({width:"padding",label:{text:{value:this.theme.getInputWidthLabel()}},input:{weight:1,min:1,on:{enter:function(){e.ok()}}},space:{width:60}})},Object.defineProperty(n.prototype,"layoutHeight",{get:function(){var t=this._layoutHeight;return null==t&&(t=this.newLayoutHeight(),this._layoutHeight=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutHeight=function(){var e=this;return new t.DInputIntegerAndLabel({width:"padding",label:{text:{value:this.theme.getInputHeightLabel()}},input:{weight:1,min:1,on:{enter:function(){e.ok()}}},space:{width:60}})},Object.defineProperty(n.prototype,"layoutCategory",{get:function(){var t=this._layoutCategory;return null==t&&(t=this.newLayoutCategory(),this._layoutCategory=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutCategory=function(){return new t.DLayoutHorizontal({width:"padding",visible:!1,children:[new t.DInputLabel({text:{value:this.theme.getSelectCategoryLabel()}}),this.selectCategory,new t.DLayoutSpace({width:60})]})},Object.defineProperty(n.prototype,"selectCategory",{get:function(){var t=this._selectCategory;return null==t&&(t=this.newSelectCategory(),this._selectCategory=t),t},enumerable:!1,configurable:!0}),n.prototype.newSelectCategory=function(){return new t.DSelect({weight:1})},Object.defineProperty(n.prototype,"layoutSummary",{get:function(){var t=this._layoutSummary;return null==t&&(t=this.newLayoutSummary(),this._layoutSummary=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutSummary=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelSummary(),this.inputSummary,new t.DLayoutSpace({width:60})]})},n.prototype.newLabelSummary=function(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputSummaryLabel()}})},Object.defineProperty(n.prototype,"inputSummary",{get:function(){var t=this._inputSummary;return null==t&&(t=this.newInputSummary(),this._inputSummary=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputSummary=function(){return new t.DInputTextArea({weight:1,height:60})},Object.defineProperty(n.prototype,"layoutDescription",{get:function(){var t=this._layoutDescription;return null==t&&(t=this.newLayoutDescription(),this._layoutDescription=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutDescription=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelDescription(),this.inputDescription,new t.DLayoutSpace({width:60})]})},n.prototype.newLabelDescription=function(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputDescriptionLabel()}})},Object.defineProperty(n.prototype,"inputDescription",{get:function(){var t=this._inputDescription;return null==t&&(t=this.newInputDescription(),this._inputDescription=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputDescription=function(){return new t.DInputTextArea({weight:1,height:100})},Object.defineProperty(n.prototype,"layoutBackground",{get:function(){var t=this._layoutBackground;return null==t&&(t=this.newLayoutBackground(),this._layoutBackground=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutBackground=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelBackground(),this.inputBackground,new t.DLayoutSpace({width:60})]})},n.prototype.newLabelBackground=function(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputBackgroundLabel()}})},Object.defineProperty(n.prototype,"inputBackground",{get:function(){var t=this._inputBackground;return null==t&&(t=this.newInputBackground(),this._inputBackground=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputBackground=function(){var e=new t.DButtonColor({weight:1});return e.dialog.on("open",(function(){var t=e.dialog,n=t.new,i=t.current;n.color=i.color,n.alpha=i.alpha})),e},n.prototype.reset=function(e){var n=null==e?void 0:e.canvas;if(null!=n){var i=n.background,o=i.color,r=i.alpha;this.value={name:n.name,label:n.label,width:n.width,height:n.height,category:n.category,summary:n.summary,description:n.description,background:{color:t.isNumber(o)?o:16777215,alpha:t.isNumber(r)?r:1}}}else{var a=this._canvas;this.value={name:a.name,label:a.label,width:a.width,height:a.height,category:a.category.default,summary:a.summary,description:a.description,background:{color:a.background.color,alpha:a.background.alpha}}}return this},Object.defineProperty(n.prototype,"value",{get:function(){return{name:this.layoutName.input.value,label:this.layoutLabel.input.value,width:this.layoutWidth.input.value,height:this.layoutHeight.input.value,category:this.selectCategory.value,summary:this.inputSummary.value,description:this.inputDescription.value,background:this.inputBackground.value}},set:function(t){var e,n;this.layoutName.input.value=t.name,this.layoutLabel.input.value=t.label,this.layoutWidth.input.value=t.width,this.layoutHeight.input.value=t.height,this.selectCategory.value=null!==(n=null!==(e=t.category)&&void 0!==e?e:this._canvas.category.default)&&void 0!==n?n:null,this.inputSummary.value=t.summary,this.inputDescription.value=t.description,this.inputBackground.value.color=t.background.color,this.inputBackground.value.alpha=t.background.alpha},enumerable:!1,configurable:!0}),n.prototype.getResolvedValue=function(){return this.value},n.prototype.getType=function(){return"EDialogCanvas"},n}(t.DDialogLayered),Oi=function(e){function n(n){var i=e.call(this,function(t){var e,n,i,o,r;return null!==(e=t.width)&&void 0!==e||(t.width=200),null!==(n=t.height)&&void 0!==n||(t.height=30),null!==(i=t.padding)&&void 0!==i||(t.padding=0),null!==(o=t.corner)&&void 0!==o||(t.corner={mask:"BOTTOM"}),null!==(r=t.shadow)&&void 0!==r||(t.shadow="WEAK"),t}(n))||this;i._icons=n.icons;var o=n.diagram;return i._diagram=o,o.on("change",(function(){var t=o.canvas;null!=t&&(i.inputName.value=t.name)})),o.on("set",(function(t){i.inputName.value=t.name,i.show()})),o.on("unset",(function(t){i.hide()})),i._canvas=n.canvas,i.addChild(new t.DLayoutHorizontal({x:"padding",y:"padding",width:"padding",height:"padding",margin:0,children:[i.inputName,i.buttonEditor]})),i.hide(),i}return i(n,e),Object.defineProperty(n.prototype,"inputName",{get:function(){var t=this._inputName;return null==t&&(t=this.newInputName(),this._inputName=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputName=function(){var e=this;return new t.DInputText({weight:1,background:{color:null},border:{color:null},corner:{mask:t.DCornerMask.ALL&~t.DCornerMask.TOP_LEFT},on:{change:function(t){e.onInputNameChange(t)}}})},n.prototype.onInputNameChange=function(e){var n=this._diagram,i=n.canvas;null!=i&&i.name!==e&&t.DControllers.getCommandController().push(new c(n,i,e))},Object.defineProperty(n.prototype,"buttonEditor",{get:function(){var t=this._buttonEditor;return null==t&&(t=this.newButtonEditor(),this._buttonEditor=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonEditor=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_canvas},on:{active:function(t){e.onButtonEditorActive(t)}}})},n.prototype.onButtonEditorActive=function(e){var n=this;this.dialogEditor.then((function(i){var o=n._diagram;i.reset(o).open(e).then((function(e){var n=o.canvas;null!=n&&t.DControllers.getCommandController().push(new r(o,n,e.name,e.label,e.width,e.height,e.category,e.summary,e.description,e.background.color,e.background.alpha))}))}))},Object.defineProperty(n.prototype,"dialogEditor",{get:function(){var t=this._dialogEditor;return null==t&&(t=this.newDialogEditor(),this._dialogEditor=t),t},enumerable:!1,configurable:!0}),n.prototype.newDialogEditor=function(){return this._canvas.get().then((function(t){return new Bi({canvas:t})}))},n.prototype.render=function(t){var n=this._diagram.canvas;if(null!=n){var i=n.position;this.position.set(i.x,i.y-this.height),this.updateTransform()}e.prototype.render.call(this,t)},n.prototype.getType=function(){return"EEditorCanvas"},n}(t.DBoard),Pi=function(t){return"".concat(+t.toFixed(2))},Ii=function(t){return Pi(t/Math.PI*180)},xi=function(t){return parseFloat(t)/180*Math.PI},Ri=function(n){function o(t){var i=n.call(this,t)||this;i._icons=t.icons,i._selection=t.selection,i._workRectangle=new e.Rectangle,i._updateInputShape=null,i._updateInputId=null,i._isUpdateInputShapeChanged=!1,i._renderInputsBound=function(){i.renderInputs()},i.addChild(i.newTextLabel()),i.addChild(i.inputId),i.addChild(i.inputPositionX),i.addChild(i.inputPositionY),i.addChild(i.inputPositionLeft),i.addChild(i.inputPositionTop),i.addChild(i.inputSizeX),i.addChild(i.inputSizeY),i.addChild(i.inputRotation),i.addChild(i.inputSkew),i.addChild(i.layoutAlignHorizontally),i.addChild(i.layoutAlignVertically);var o=i._selection;return o.on("change",(function(){i.onSelectionChange(o)})),i.onSelectionChange(o),i}return i(o,n),o.prototype.newTextLabel=function(){return new t.DText({width:"100%",text:{value:this.theme.getLabel()}})},Object.defineProperty(o.prototype,"inputId",{get:function(){var t=this._inputId;return null==t&&(t=this.newInputId(),this._inputId=t),t},enumerable:!1,configurable:!0}),o.prototype.newInputId=function(){var e=this;return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputIdLabel()}},input:{weight:1,on:{change:function(t){e._selection.setId(t)}}}})},Object.defineProperty(o.prototype,"inputPositionX",{get:function(){var t=this._inputPositionX;return null==t&&(t=this.newInputPositionX(),this._inputPositionX=t),t},enumerable:!1,configurable:!0}),o.prototype.newInputPositionX=function(){var e=this;return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputPositionXLabel()}},input:{weight:1,step:1,text:{value:0,formatter:Pi},on:{input:function(t){e._selection.setPositionX(t)}}}})},Object.defineProperty(o.prototype,"inputPositionY",{get:function(){var t=this._inputPositionY;return null==t&&(t=this.newInputPositionY(),this._inputPositionY=t),t},enumerable:!1,configurable:!0}),o.prototype.newInputPositionY=function(){var e=this;return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputPositionYLabel()}},input:{weight:1,step:1,text:{value:0,formatter:Pi},on:{input:function(t){e._selection.setPositionY(t)}}}})},Object.defineProperty(o.prototype,"inputPositionLeft",{get:function(){var t=this._inputPositionLeft;return null==t&&(t=this.newInputPositionLeft(),this._inputPositionLeft=t),t},enumerable:!1,configurable:!0}),o.prototype.newInputPositionLeft=function(){var e=this;return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputPositionLeftLabel()}},input:{weight:1,step:1,text:{value:0,formatter:Pi},on:{input:function(t){e._selection.setPositionLeft(t)}}}})},Object.defineProperty(o.prototype,"inputPositionTop",{get:function(){var t=this._inputPositionTop;return null==t&&(t=this.newInputPositionTop(),this._inputPositionTop=t),t},enumerable:!1,configurable:!0}),o.prototype.newInputPositionTop=function(){var e=this;return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputPositionTopLabel()}},input:{weight:1,step:1,text:{value:0,formatter:Pi},on:{input:function(t){e._selection.setPositionTop(t)}}}})},Object.defineProperty(o.prototype,"inputSizeX",{get:function(){var t=this._inputSizeX;return null==t&&(t=this.newInputSizeX(),this._inputSizeX=t),t},enumerable:!1,configurable:!0}),o.prototype.newInputSizeX=function(){var e=this;return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputSizeXLabel()}},input:{weight:1,step:1,text:{value:0,formatter:Pi},on:{input:function(t){e._selection.setSizeX(t)}}}})},Object.defineProperty(o.prototype,"inputSizeY",{get:function(){var t=this._inputSizeY;return null==t&&(t=this.newInputSizeY(),this._inputSizeY=t),t},enumerable:!1,configurable:!0}),o.prototype.newInputSizeY=function(){var e=this;return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputSizeYLabel()}},input:{weight:1,step:1,text:{value:0,formatter:Pi},on:{input:function(t){e._selection.setSizeY(t)}}}})},Object.defineProperty(o.prototype,"inputRotation",{get:function(){var t=this._inputRotation;return null==t&&(t=this.newInputRotation(),this._inputRotation=t),t},enumerable:!1,configurable:!0}),o.prototype.newInputRotation=function(){var e=this;return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputRotationLabel()}},input:{weight:1,step:1,text:{value:0,formatter:Ii},editing:{unformatter:xi},on:{input:function(t){e._selection.setRotation(t)}}}})},Object.defineProperty(o.prototype,"inputSkew",{get:function(){var t=this._inputSkew;return null==t&&(t=this.newInputSkew(),this._inputSkew=t),t},enumerable:!1,configurable:!0}),o.prototype.newInputSkew=function(){var e=this;return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputSkewLabel()}},input:{weight:1,step:1,text:{value:0,formatter:Ii},editing:{unformatter:xi},on:{input:function(t){e._selection.setSkew(t)}}}})},Object.defineProperty(o.prototype,"layoutAlignHorizontally",{get:function(){var t=this._layoutAlignHorizontally;return null==t&&(t=this.newLayoutAlignHorizontally(),this._layoutAlignHorizontally=t),t},enumerable:!1,configurable:!0}),o.prototype.newLayoutAlignHorizontally=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonAlignLeft,this.buttonAlignCenter,this.buttonAlignRight,this.buttonDistributeHorizontally,this.buttonDistributeVertically,this.buttonLock,new t.DLayoutSpace({weight:1})]})},Object.defineProperty(o.prototype,"layoutAlignVertically",{get:function(){var t=this._layoutAlignVertically;return null==t&&(t=this.newLayoutAlignVertically(),this._layoutAlignVertically=t),t},enumerable:!1,configurable:!0}),o.prototype.newLayoutAlignVertically=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonAlignTop,this.buttonAlignMiddle,this.buttonAlignBottom,this.buttonRotateLeft,this.buttonRotateRight,new t.DLayoutSpace({weight:1})]})},Object.defineProperty(o.prototype,"buttonAlignLeft",{get:function(){var t=this._buttonAlignLeft;return null==t&&(t=this.newButtonAlignLeft(),this._buttonAlignLeft=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonAlignLeft=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_left},title:this.theme.getButtonAlignLeftTitle(),on:{active:function(){var t=e._selection;t.saveForTranslate(),t.alignLeft()}}})},Object.defineProperty(o.prototype,"buttonAlignCenter",{get:function(){var t=this._buttonAlignCenter;return null==t&&(t=this.newButtonAlignCenter(),this._buttonAlignCenter=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonAlignCenter=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_center},title:this.theme.getButtonAlignCenterTitle(),on:{active:function(){var t=e._selection;t.saveForTranslate(),t.alignCenter()}}})},Object.defineProperty(o.prototype,"buttonAlignRight",{get:function(){var t=this._buttonAlignRight;return null==t&&(t=this.newButtonAlignRight(),this._buttonAlignRight=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonAlignRight=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_right},title:this.theme.getButtonAlignRightTitle(),on:{active:function(){var t=e._selection;t.saveForTranslate(),t.alignRight()}}})},Object.defineProperty(o.prototype,"buttonAlignTop",{get:function(){var t=this._buttonAlignTop;return null==t&&(t=this.newButtonAlignTop(),this._buttonAlignTop=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonAlignTop=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_top},title:this.theme.getButtonAlignTopTitle(),on:{active:function(){var t=e._selection;t.saveForTranslate(),t.alignTop()}}})},Object.defineProperty(o.prototype,"buttonAlignMiddle",{get:function(){var t=this._buttonAlignMiddle;return null==t&&(t=this.newButtonAlignMiddle(),this._buttonAlignMiddle=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonAlignMiddle=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_middle},title:this.theme.getButtonAlignMiddleTitle(),on:{active:function(){var t=e._selection;t.saveForTranslate(),t.alignMiddle()}}})},Object.defineProperty(o.prototype,"buttonAlignBottom",{get:function(){var t=this._buttonAlignBottom;return null==t&&(t=this.newButtonAlignBottom(),this._buttonAlignBottom=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonAlignBottom=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_bottom},title:this.theme.getButtonAlignBottomTitle(),on:{active:function(){var t=e._selection;t.saveForTranslate(),t.alignBottom()}}})},Object.defineProperty(o.prototype,"buttonDistributeHorizontally",{get:function(){var t=this._buttonDistributeHorizontally;return null==t&&(t=this.newButtonDistributeHorizontally(),this._buttonDistributeHorizontally=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonDistributeHorizontally=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_distribute_horizontally},title:this.theme.getButtonDistributeHorizontallyTitle(),on:{active:function(){var t=e._selection;t.saveForTranslate(),t.distributeHorizontally()}}})},Object.defineProperty(o.prototype,"buttonDistributeVertically",{get:function(){var t=this._buttonDistributeVertically;return null==t&&(t=this.newButtonDistributeVertically(),this._buttonDistributeVertically=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonDistributeVertically=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_distribute_vertically},title:this.theme.getButtonDistributeVerticallyTitle(),on:{active:function(){var t=e._selection;t.saveForTranslate(),t.distributeVertically()}}})},Object.defineProperty(o.prototype,"buttonRotateLeft",{get:function(){var t=this._buttonRotateLeft;return null==t&&(t=this.newButtonRotateLeft(),this._buttonRotateLeft=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonRotateLeft=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_rotate_left},title:this.theme.getButtonRotateLeftTitle(),on:{active:function(){var t=e._selection;t.prepareRotate()&&(t.saveForRotate(),t.rotate(-.5*Math.PI),t.finalize())}}})},Object.defineProperty(o.prototype,"buttonRotateRight",{get:function(){var t=this._buttonRotateRight;return null==t&&(t=this.newButtonRotateRight(),this._buttonRotateRight=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonRotateRight=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_rotate_right},title:this.theme.getButtonRotateRightTitle(),on:{active:function(){var t=e._selection;t.prepareRotate()&&(t.saveForRotate(),t.rotate(.5*Math.PI),t.finalize())}}})},Object.defineProperty(o.prototype,"buttonLock",{get:function(){var t=this._buttonLock;return null==t&&(t=this.newButtonLock(),this._buttonLock=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonLock=function(){var e=this;return new t.DButtonCheck({theme:"EButtonEditorLock",on:{active:function(){e._selection.lockCapability(t.EShapeCapability.COORDINATE)},inactive:function(){e._selection.unlockCapability(t.EShapeCapability.COORDINATE)}}})},o.prototype.onSelectionChange=function(e){var n=e.last();this.state.isDisabled=null==n;var i=t.EShapeCapabilities.contains(n,t.EShapeCapability.POSITION);this.inputPositionX.state.isEnabled=i,this.inputPositionY.state.isEnabled=i,this.inputPositionLeft.state.isEnabled=i,this.inputPositionTop.state.isEnabled=i,this.inputRotation.state.isEnabled=t.EShapeCapabilities.contains(n,t.EShapeCapability.ROTATION),this.inputSizeX.state.isEnabled=t.EShapeCapabilities.contains(n,t.EShapeCapability.WIDTH),this.inputSizeY.state.isEnabled=t.EShapeCapabilities.contains(n,t.EShapeCapability.HEIGHT),this.inputSkew.state.isEnabled=t.EShapeCapabilities.contains(n,t.EShapeCapability.SKEW),this.buttonLock.state.isActive=this.isLocked(n),this.updateInputs(e.get())},o.prototype.isLocked=function(e){if(null==e)return!1;var n=e.getCapability();if(null==n)return!1;var i=t.EShapeCapability.COORDINATE;return!!(n.locked&i)},o.prototype.renderInputs=function(){if(this._updateInputId=null,this._isUpdateInputShapeChanged){this._isUpdateInputShapeChanged=!1;var t=this._updateInputShape;if(null!=t){var e=t.transform,n=e.position,i=t.size;this.inputId.input.value=t.id,this.inputPositionX.input.value=n.x,this.inputPositionY.input.value=n.y,this.inputSizeX.input.value=i.x,this.inputSizeY.input.value=i.y,this.inputRotation.input.value=e.rotation,this.inputSkew.input.value=e.skew.x;var o=this._workRectangle;t.getBoundsLocal(!1,o),this.inputPositionLeft.input.value=o.x,this.inputPositionTop.input.value=o.y}this._updateInputId=window.setTimeout(this._renderInputsBound,100)}},o.prototype.updateInputs=function(t){var e=0<t.length?t[t.length-1]:null;this._updateInputShape=e,this._isUpdateInputShapeChanged=!0,null==this._updateInputId&&this.renderInputs()},o.prototype.getType=function(){return"EEditorCoordinate"},o}(t.DLayoutVertical),ki=function(e){function n(n){var i=e.call(this,n)||this,o=n.selection;i._selection=o,i._icons=n.icons,i.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[i.newTextLabel(),i.buttonNew,i.buttonDelete,i.buttonBringForward,i.buttonSendBackward]})),i.addChild(i.listDataMappingValue),o.on("change",(function(){i.onSelectionChange(o)}));var r=i.listDataMappingValue;return r.selection.on("change",(function(){i.onListDataMappingValueSelectionChange(r)})),i.onSelectionChange(o),i}return i(n,e),n.prototype.newTextLabel=function(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})},Object.defineProperty(n.prototype,"buttonNew",{get:function(){var t=this._buttonNew;return null==t&&(t=this.newButtonNew(),this._buttonNew=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonNew=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.theme.getButtonNewTitle(),on:{active:function(t){e.onButtonNewActive(t)}}})},n.prototype.onButtonNewActive=function(t){var e=this;this.dialogDataMappingValue.set(null,this._selection.last()).open(t).then((function(t){null!=t&&e._selection.addDataMappingValue(t)}))},Object.defineProperty(n.prototype,"buttonDelete",{get:function(){var t=this._buttonDelete;return null==t&&(t=this.newButtonDelete(),this._buttonDelete=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonDelete=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.theme.getButtonDeleteTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var t=e.listDataMappingValue.selection.first;null!=t&&e._selection.removeDataMappingValue(t)}}})},n.prototype.onListDataMappingValueSelectionChangeButtonDelete=function(t){this.buttonDelete.state.isDisabled=t.data.selection.isEmpty()},Object.defineProperty(n.prototype,"buttonBringForward",{get:function(){var t=this._buttonBringForward;return null==t&&(t=this.newButtonBringForward(),this._buttonBringForward=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonBringForward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonBringForwardTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var t=e.listDataMappingValue,n=t.data.selection.first,i=t.data.items;null!=n&&i[0]!==n&&e._selection.bringDataMappingValueForward(n)}}})},n.prototype.onListDataMappingValueSelectionChangeButtonBringForward=function(t){var e=t.data.selection.first,n=t.data.items;this.buttonBringForward.state.isDisabled=null==e||n[0]===e},Object.defineProperty(n.prototype,"buttonSendBackward",{get:function(){var t=this._buttonSendBackward;return null==t&&(t=this.newButtonSendBackward(),this._buttonSendBackward=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonSendBackward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonSendBackwardTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var t=e.listDataMappingValue,n=t.data.selection.first,i=t.data.items;null!=n&&i[i.length-1]!==n&&e._selection.sendDataMappingValueBackward(n)}}})},n.prototype.onListDataMappingValueSelectionChangeButtonSendBackward=function(t){var e=t.data.selection.first,n=t.data.items;this.buttonSendBackward.state.isDisabled=null==e||n[n.length-1]===e},Object.defineProperty(n.prototype,"dialogDataMappingValue",{get:function(){var t=this._dialogDataMappingValue;return null==t&&(t=this.newDialogDataMappingValue(),this._dialogDataMappingValue=t),t},enumerable:!1,configurable:!0}),n.prototype.newDialogDataMappingValue=function(){return new vi},Object.defineProperty(n.prototype,"listDataMappingValue",{get:function(){var t=this._listDataMappingValue;return null==t&&(t=this.newListDataMappingValue(),this._listDataMappingValue=t),t},enumerable:!1,configurable:!0}),n.prototype.newListDataMappingValue=function(){var e=this,n=new t.DList({width:"padding",weight:1,data:{toLabel:function(t){var e=t[0],n=t[1],i=t[2];return 0<n.length?0<i.length?"".concat(e," -> ").concat(n,", ").concat(i):"".concat(e," -> ").concat(n):0<i.length?"".concat(e," -> ").concat(i):"".concat(e)}},updater:{newItem:function(i){return new t.DListItem(i,{on:{dblclick:function(t,i,o){e.onListDataMappingValueDblClick(t,i,o,n)}}})}}});return n},n.prototype.onListDataMappingValueDblClick=function(t,e,n,i){var o=this,r=n.value;null!=r&&this.dialogDataMappingValue.set(r,this._selection.last()).open(n).then((function(t){null!=t&&o._selection.replaceDataMappingValue(r,t,i)}))},n.prototype.onSelectionChangeListDataMappingValue=function(t){var e,n,i=this.listDataMappingValue;i.data.items=(null===(n=null===(e=t.last())||void 0===e?void 0:e.data.getMapping())||void 0===n?void 0:n.values)||[],this.onListDataMappingValueSelectionChange(i)},n.prototype.onSelectionChange=function(e){this.state.isDisabled=!t.EShapeCapabilities.contains(e.last(),t.EShapeCapability.DATA_MAPPING),this.onSelectionChangeListDataMappingValue(e)},n.prototype.onListDataMappingValueSelectionChange=function(t){this.onListDataMappingValueSelectionChangeButtonDelete(t),this.onListDataMappingValueSelectionChangeButtonBringForward(t),this.onListDataMappingValueSelectionChangeButtonSendBackward(t)},n.prototype.getType=function(){return"EEditorDataMapping"},n}(t.DLayoutVertical),Vi=function(e){function n(n){var i=e.call(this,n)||this,o=n.selection;i._selection=o,i._icons=n.icons,i.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[i.newTextLabel(),i.buttonNew,i.buttonDelete,i.buttonBringForward,i.buttonSendBackward]})),i.addChild(i.listDataValue),o.on("change",(function(){i.onSelectionChange(o)}));var r=i.listDataValue;return r.selection.on("change",(function(){i.onListDataValueSelectionChange(r)})),i.onSelectionChange(o),i}return i(n,e),n.prototype.newTextLabel=function(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})},Object.defineProperty(n.prototype,"buttonNew",{get:function(){var t=this._buttonNew;return null==t&&(t=this.newButtonNew(),this._buttonNew=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonNew=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.theme.getButtonNewTitle(),on:{active:function(t){e.onButtonNewActive(t)}}})},n.prototype.onButtonNewActive=function(t){var e=this;this.dialogDataValue.reset().open(t).then((function(t){null!=t&&e._selection.addDataValue(t)}))},Object.defineProperty(n.prototype,"buttonDelete",{get:function(){var t=this._buttonDelete;return null==t&&(t=this.newButtonDelete(),this._buttonDelete=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonDelete=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.theme.getButtonDeleteTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var t=e.listDataValue.selection.first;null!=t&&e._selection.removeDataValue(t)}}})},n.prototype.onListDataValueSelectionChangeButtonDelete=function(t){this.buttonDelete.state.isDisabled=t.data.selection.isEmpty()},Object.defineProperty(n.prototype,"buttonBringForward",{get:function(){var t=this._buttonBringForward;return null==t&&(t=this.newButtonBringForward(),this._buttonBringForward=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonBringForward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonBringForwardTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var t=e.listDataValue,n=t.data.selection.first,i=t.data.items;null!=n&&i[0]!==n&&e._selection.bringDataValueForward(n)}}})},n.prototype.onListDataValueSelectionChangeButtonBringForward=function(t){var e=t.data.selection.first,n=t.data.items;this.buttonBringForward.state.isDisabled=null==e||n[0]===e},Object.defineProperty(n.prototype,"buttonSendBackward",{get:function(){var t=this._buttonSendBackward;return null==t&&(t=this.newButtonSendBackward(),this._buttonSendBackward=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonSendBackward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonSendBackwardTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var t=e.listDataValue,n=t.data.selection.first,i=t.data.items;null!=n&&i[i.length-1]!==n&&e._selection.sendDataValueBackward(n)}}})},n.prototype.onListDataValueSelectionChangeButtonSendBackward=function(t){var e=t.data.selection.first,n=t.data.items;this.buttonSendBackward.state.isDisabled=null==e||n[n.length-1]===e},Object.defineProperty(n.prototype,"dialogDataValue",{get:function(){var t=this._dialogDataValue;return null==t&&(t=this.newDialogDataValue(),this._dialogDataValue=t),t},enumerable:!1,configurable:!0}),n.prototype.newDialogDataValue=function(){return new bi},Object.defineProperty(n.prototype,"listDataValue",{get:function(){var t=this._listDataValue;return null==t&&(t=this.newListDataValue(),this._listDataValue=t),t},enumerable:!1,configurable:!0}),n.prototype.newListDataValue=function(){var e=this,n=new t.DList({width:"padding",weight:1,data:{toLabel:function(e){var n=e.type,i=e.as,o=0<i.length?"".concat(i,": "):"";switch(n){case t.EShapeDataValueType.BOOLEAN:case t.EShapeDataValueType.BOOLEAN_ARRAY:case t.EShapeDataValueType.NUMBER:case t.EShapeDataValueType.NUMBER_ARRAY:case t.EShapeDataValueType.STRING:case t.EShapeDataValueType.STRING_ARRAY:case t.EShapeDataValueType.OBJECT:case t.EShapeDataValueType.OBJECT_ARRAY:return o+e.id;case t.EShapeDataValueType.TICKER:return o+"Ticker ".concat(e.initial," ms");default:var r=t.EShapeDataValueExtensions.get(n);return r?o+r.label:o+"Unknown"}}},updater:{newItem:function(i){return new t.DListItem(i,{on:{dblclick:function(t,i,o){e.onListDataValueDblClick(t,i,o,n)}}})}}});return n},n.prototype.onListDataValueDblClick=function(t,e,n,i){var o=this,r=n.value;if(null!=r){var a=this.dialogDataValue;a.value=r,a.open(n).then((function(t){null!=t&&o._selection.replaceDataValue(r,t,i)}))}},n.prototype.onSelectionChangeListDataValue=function(t){var e,n=this.listDataValue;n.data.items=(null===(e=t.last())||void 0===e?void 0:e.data.values)||[],this.onListDataValueSelectionChange(n)},n.prototype.onSelectionChange=function(t){this.state.isDisabled=t.isEmpty(),this.onSelectionChangeListDataValue(t)},n.prototype.onListDataValueSelectionChange=function(t){this.onListDataValueSelectionChangeButtonDelete(t),this.onListDataValueSelectionChangeButtonBringForward(t),this.onListDataValueSelectionChangeButtonSendBackward(t)},n.prototype.getType=function(){return"EEditorData"},n}(t.DLayoutVertical),Mi=function(e){function n(t,n,i,o,r){var a=e.call(this,o,r)||this;return a._iconsEye=t,a._iconsEyeSlash=n,a._iconsWork=i,a}return i(n,e),n.prototype.onSelect=function(t,n){if(null!=t){var i=this._iconsWork;if("data"in t&&(this.toLocal(t.data.global,void 0,i),i.x<=this._iconsEye.width+this.padding.getLeft()))return void this.emit("eyeclick",t,n,this)}e.prototype.onSelect.call(this,t,n)},n.prototype.onDblClick=function(n,i){var o=t.UtilPointerEvent.toGlobal(n,i,this._iconsWork),r=this.toLocal(o,void 0,o);return this._iconsEye.width+this.padding.getLeft()<r.x?e.prototype.onDblClick.call(this,n,i):(this.emit("eyedblclick",n,i,this),!1)},n}(t.DListItem),Ni=function(n){function o(t){var e=n.call(this,t)||this;return e._icons=t.icons,e._diagram=t.diagram,e._selection=t.selection,e._isInitialized=!1,e._canvas=null,e}return i(o,n),o.prototype.show=function(){return n.prototype.show.call(this),this.onShow(),this},o.prototype.onShow=function(){this._isInitialized||(this._isInitialized=!0,this.initLayout()),this.onCanvasChange(this._diagram.canvas,!0)},o.prototype.initLayout=function(){var e=this;this.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[this.newTextLabel(),this.buttonNew,this.buttonDelete,this.buttonBringForward,this.buttonSendBackward]})),this.addChild(this.list);var n=this._diagram;n.on("set",(function(t){e.isShown()&&e.onCanvasChange(t,!1)})),n.on("ready",(function(){e.isShown()&&e.onLayerChange()})),n.on("unset",(function(){e.isShown()&&e.onCanvasChange(null,!1)}))},o.prototype.newTextLabel=function(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})},Object.defineProperty(o.prototype,"onLayerChangeBound",{get:function(){var t=this,e=this._onLayerChangeBound;return null==e&&(e=function(){t.onLayerChange()},this._onLayerChangeBound=e),e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"dialog",{get:function(){var t=this._dialog;return null==t&&(t=this.newDialog(),this._dialog=t),t},enumerable:!1,configurable:!0}),o.prototype.newDialog=function(){return new mi},Object.defineProperty(o.prototype,"buttonNew",{get:function(){var t=this._buttonNew;return null==t&&(t=this.newButtonNew(),this._buttonNew=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonNew=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.theme.getButtonNewTitle(),on:{active:function(t){e.onButtonNewActive(t)}}})},o.prototype.onButtonNewActive=function(e){var n=this,i=this._canvas;i&&this.dialog.reset(i.width,i.height).open(e).then((function(e){e&&t.DControllers.getCommandController().push(new P(e,i.layer,n._selection))}))},Object.defineProperty(o.prototype,"buttonDelete",{get:function(){var t=this._buttonDelete;return null==t&&(t=this.newButtonDelete(),this._buttonDelete=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonDelete=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.theme.getButtonDeleteTitle(),on:{active:function(){var n=e._canvas;if(n){var i=n.layer,o=i.size(),r=i.active;1<o&&r&&t.DControllers.getCommandController().push(new I(r,n.layer,e._selection))}}}})},Object.defineProperty(o.prototype,"buttonBringForward",{get:function(){var t=this._buttonBringForward;return null==t&&(t=this.newButtonBringForward(),this._buttonBringForward=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonBringForward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonBringForwardTitle(),on:{active:function(){var n=e._canvas;if(n){var i=n.layer,o=i.active;if(o){var r=i.children.indexOf(o);t.DControllers.getCommandController().push(new L(r,i))}}}}})},Object.defineProperty(o.prototype,"buttonSendBackward",{get:function(){var t=this._buttonSendBackward;return null==t&&(t=this.newButtonSendBackward(),this._buttonSendBackward=t),t},enumerable:!1,configurable:!0}),o.prototype.newButtonSendBackward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonSendBackwardTitle(),on:{active:function(){var n=e._canvas;if(n){var i=n.layer,o=i.active;if(o){var r=i.children.indexOf(o);t.DControllers.getCommandController().push(new x(r,i))}}}}})},Object.defineProperty(o.prototype,"list",{get:function(){var t=this._list;return null==t&&(t=this.newList(),this._list=t),t},enumerable:!1,configurable:!0}),o.prototype.newList=function(){var n=this,i=this._icons,o=i.eye,r=i.eye_slash,a=new e.Point,l=new t.DList({x:"padding",width:"padding",weight:1,data:{selection:{on:{change:function(){n.onListSelectionChange()}}},toImage:function(t){return t.visible?o:r}},updater:{newItem:function(t){return new Mi(o,r,a,t,{on:{eyeclick:function(t,e,n){e&&(e.visible?(e.visible=!1,n.image=r):(e.visible=!0,n.image=o))},dblclick:function(t,e,i){n.onListDblClick(t,e,i,l)}}})}},on:{keydown:function(e){if(t.UtilKeyboardEvent.isDeleteKey(e)){var i=n._canvas;if(i){var o=i.layer,r=o.size(),a=o.active;1<r&&a&&t.DControllers.getCommandController().push(new I(a,o,n._selection))}}}}});return l},o.prototype.onListDblClick=function(e,n,i,o){var r=this._canvas;if(r){var a=r.layer.active;if(a){var l=B.from(a),u=this.dialog;u.value=l,u.open(i).then((function(e){e&&!e.isEqual(l)&&t.DControllers.getCommandController().push(new O(a,e,r.layer))}))}}},o.prototype.onListLayerChange=function(){var t=this.list,e=this._canvas;if(e){for(var n=e.layer,i=n.children,o=n.active,r=t.data.items,a=0,l=i.length;a<l;++a)r[a]=i[l-1-a];r.length=i.length,t.update(!0),null!=o?t.data.selection.clearAndAdd(o):t.data.selection.clear()}else t.data.items=[]},o.prototype.onListSelectionChange=function(){var e=this.list.data.selection.first;if(e){var n=this._canvas;if(n&&n.layer.active!==e){var i=this._selection;if(!i.isEmpty()){var o=i.store();if(i.clear()){var r=i.store();t.DControllers.getCommandController().push(new _e(o,r,i))}}n.layer.active=e}}},o.prototype.onCanvasChange=function(t,e){var n=this._canvas;if(t!==this._canvas){var i=this.onLayerChangeBound;null!=n&&n.layer.off("change",i),this._canvas=t,null!=t?(this.state.isDisabled=!1,t.layer.on("change",i)):this.state.isDisabled=!0,this.onLayerChange()}else e&&this.onLayerChange()},o.prototype.isActiveDeletable=function(t){return!!t&&1<t.layer.size()},o.prototype.isActiveNotLast=function(t){if(t){var e=t.layer,n=e.children,i=e.active;if(i)return i!==n[n.length-1]}return!1},o.prototype.isActiveNotFirst=function(t){if(t){var e=t.layer,n=e.children,i=e.active;if(i)return i!==n[0]}return!1},o.prototype.onLayerChange=function(){var t=this._canvas;this.state.isEnabled=null!=t,this.buttonDelete.state.isEnabled=this.isActiveDeletable(t),this.buttonSendBackward.state.isEnabled=this.isActiveNotFirst(t),this.buttonBringForward.state.isEnabled=this.isActiveNotLast(t),this.onListLayerChange(),this._selection.updateModifier()},o.prototype.getType=function(){return"EEditorLayer"},o}(t.DLayoutVertical),Fi=function(){return null!=Ve?Ve:Ve=t.DThemes.get("FShapeType")},ji=function(e){var n=e.id;if(0<n.length)return n;var i=e.type;if(t.EShapeType.EXTENSION<=i){var o=Ge.get(i);if(o&&"name"in o){var r=o.name;if(null!=r)return r}return Fi().getLabel(i)}return i===t.EShapeType.EMBEDDED&&e instanceof t.EShapeEmbedded?e.name:Fi().getLabel(i)},zi=function(e){if(t.EShapeType.EXTENSION<=e){var n=Ge.get(e);if(n&&"name"in n){var i=n.name;if(null!=i)return i}return Fi().getLabel(e)}return Fi().getLabel(e)},Hi=function(e){function n(n){var i,o=e.call(this,n)||this,r=n.selection;o._selection=r,o._icons=n.icons,o._finder=n.finder,o._interval=null!==(i=n.interval)&&void 0!==i?i:333;var a=n.diagram;return o._diagram=a,o.state.isDisabled=null==a.canvas,a.on("unset",(function(){o.list.data.clear(),o.state.isDisabled=!0})),a.on("set",(function(){o.state.isDisabled=!1})),o.addChild(o.newTextLabel()),null!=o._finder?o.addChild(o.inputSearch):(o.addChild(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:o.theme.getInputIdLabel()}}),o.inputId]})),o.addChild(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:o.theme.getSelectTypeLabel()}}),o.selectType]})),o.addChild(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:o.theme.getSelectStateLabel()}}),o.selectState]})),o.addChild(o.buttonExecute)),o.addChild(o.list),o}return i(n,e),n.prototype.newTextLabel=function(){return new t.DText({x:"padding",width:"padding",text:{value:this.theme.getLabel()}})},Object.defineProperty(n.prototype,"inputSearch",{get:function(){var t;return null!==(t=this._inputSearch)&&void 0!==t?t:this._inputSearch=this.newInputSearch()},enumerable:!1,configurable:!0}),n.prototype.newInputSearch=function(){var e=this;return new t.DInputSearch({x:"padding",width:"padding",on:{input:function(t){e.search(t)},enter:function(t){e.search(t.value)}}})},Object.defineProperty(n.prototype,"inputId",{get:function(){var t;return null!==(t=this._inputId)&&void 0!==t?t:this._inputId=this.newInputId()},enumerable:!1,configurable:!0}),n.prototype.newInputId=function(){var e=this;return new t.DInputText({weight:1,on:{enter:function(){e.buttonExecute.activate()}}})},Object.defineProperty(n.prototype,"selectType",{get:function(){var t;return null!==(t=this._selectType)&&void 0!==t?t:this._selectType=this.newSelectType()},enumerable:!1,configurable:!0}),n.prototype.newSelectType=function(){return new t.DSelect({weight:1,value:-1,menu:{width:"auto",column:3,fit:!1,items:this.newSelectTypeMenuItems()}})},n.prototype.newSelectTypeMenuItems=function(){var e=this,n=[this.newSelectTypeMenuItem(-1,this.theme.toTypeLabel(-1)),this.newSelectTypeMenuItemShape(t.EShapeType.CIRCLE),this.newSelectTypeMenuItemShape(t.EShapeType.SEMICIRCLE),this.newSelectTypeMenuItemShape(t.EShapeType.RECTANGLE),this.newSelectTypeMenuItemShape(t.EShapeType.RECTANGLE_ROUNDED),this.newSelectTypeMenuItemShape(t.EShapeType.TRIANGLE),this.newSelectTypeMenuItemShape(t.EShapeType.TRIANGLE_ROUNDED),this.newSelectTypeMenuItemShape(t.EShapeType.LINE),this.newSelectTypeMenuItemShape(t.EShapeType.CONNECTOR_LINE),this.newSelectTypeMenuItemShape(t.EShapeType.CONNECTOR_ELBOW),this.newSelectTypeMenuItemShape(t.EShapeType.IMAGE),this.newSelectTypeMenuItemShape(t.EShapeType.GROUP),this.newSelectTypeMenuItemShape(t.EShapeType.BAR),this.newSelectTypeMenuItemShape(t.EShapeType.BUTTON),this.newSelectTypeMenuItemShape(t.EShapeType.EMBEDDED),this.newSelectTypeMenuItemShape(t.EShapeType.EMBEDDED_LAYER),this.newSelectTypeMenuItemShape(t.EShapeType.EMBEDDED_ACCEPTOR_EDGE)];return Ge.each((function(t){"type"in t&&n.push(e.newSelectTypeMenuItemShape(t.type))})),n},n.prototype.newSelectTypeMenuItem=function(t,e){return{width:200,value:t,text:{value:e}}},n.prototype.newSelectTypeMenuItemShape=function(t){return this.newSelectTypeMenuItem(t,zi(t))},n.prototype.getSelectTypeValue=function(){var t=this._selectType;if(null!=t){var e=t.value;if(null!=e&&0<=e)return e}return null},Object.defineProperty(n.prototype,"selectState",{get:function(){var t;return null!==(t=this._selectState)&&void 0!==t?t:this._selectState=this.newSelectState()},enumerable:!1,configurable:!0}),n.prototype.newSelectState=function(){var e=this.theme;return new t.DSelect({weight:1,value:-1,menu:{items:[this.newSelectStateMenuItem(-1,e),this.newSelectStateMenuItem(2,e),this.newSelectStateMenuItem(1,e),this.newSelectStateMenuItem(0,e)]}})},n.prototype.newSelectStateMenuItem=function(t,e){return{value:t,text:{value:e.toStateLabel(t)}}},n.prototype.getSelectStateValue=function(){var t=this.selectState.value;return null!=t&&0<=t?t:null},Object.defineProperty(n.prototype,"buttonExecute",{get:function(){var t;return null!==(t=this._buttonExecute)&&void 0!==t?t:this._buttonExecute=this.newButtonExecute()},enumerable:!1,configurable:!0}),n.prototype.newButtonExecute=function(){var e=this;return new t.DButtonPrimary({width:"padding",text:{value:this.theme.getButtonExecuteTitle()},image:{source:this._icons.editor_search},on:{active:function(t){e.onButtonExecuteActive(t)}}})},n.prototype.onButtonExecuteActive=function(e){var n,i,o=this.indicatorExecute;o.start();var r=[],a=this._diagram.canvas;if(null!=a){var l=this.inputId.value.trim(),u=null!==(n=this.selectType.value)&&void 0!==n?n:-1,s=null!==(i=this.selectState.value)&&void 0!==i?i:-1;a.shape.each((function(e){if(0<l.length&&e.id.indexOf(l)<0)return!0;if(-1!==u&&u!==e.type)return!0;switch(s){case 2:if(e instanceof t.EShapeConnectorLine){var n=(o=e.edge).tail.acceptor.shape,i=o.head.acceptor.shape;if(null==n||null==i)return!0}else if(e.connector.size()<=0)return!0;break;case 1:if(!(e instanceof t.EShapeConnectorLine))return!0;if(n=(o=e.edge).tail.acceptor.shape,i=o.head.acceptor.shape,null==n&&null==i||null!=n&&null!=i)return!0;break;case 0:var o;if(e instanceof t.EShapeConnectorLine){if(n=(o=e.edge).tail.acceptor.shape,i=o.head.acceptor.shape,null!=n||null!=i)return!0}else if(0<e.connector.size())return!0}return r.push(e),!0}))}this.list.data.clearAndAddAll(r),o.resolve()},Object.defineProperty(n.prototype,"indicatorExecute",{get:function(){var t;return null!==(t=this._indicatorExecute)&&void 0!==t?t:this._indicatorExecute=this.newIndicatorExecute()},enumerable:!1,configurable:!0}),n.prototype.newIndicatorExecute=function(){return new t.DIndicatorProcessing(this.buttonExecute)},n.prototype.search=function(t){var e=this,n=this._searching,i=this._searched,o=this._searchedAt;if(n!==i||null!=o&&Date.now()-o<500)this._requested=t,null==this._timeoutId&&(this._timeoutId=window.setTimeout((function(){e._timeoutId=null;var t=e._requested;null!=t&&(e._requested=void 0,e.search(t))}),500));else{var r=this._timeoutId;null!=r&&(this._timeoutId=null,window.clearTimeout(r)),this._searching=t,this.doSearch(t).then((function(t){e.list.data.clearAndAddAll(t.shapes),e._searched=t.word,e._searchedAt=Date.now()}))}},n.prototype.doSearch=function(e){var n=this._finder;if(null==n)return Promise.resolve({word:e,shapes:[]});var i=this._diagram.canvas;if(null==i)return Promise.resolve({word:e,shapes:[]});var o=e.trim();if(o.length<=0)return Promise.resolve({word:e,shapes:[]});try{var r=n(i,o);return t.isArray(r)?Promise.resolve({word:e,shapes:r}):r.then((function(t){return{word:e,shapes:t}}),(function(){return{word:e,shapes:[]}}))}catch(t){return Promise.resolve({word:e,shapes:[]})}},Object.defineProperty(n.prototype,"list",{get:function(){var t;return null!==(t=this._list)&&void 0!==t?t:this._list=this.newList()},enumerable:!1,configurable:!0}),n.prototype.newList=function(){var e=this;return new t.DList({width:"padding",weight:1,data:{toLabel:function(t){return ji(t)},toTitle:function(t){},toImage:function(t){return null}},updater:{newItem:function(n){return new t.DListItem(n,{on:{select:function(t,n){e.onListItemDown(t,n)}}})}}})},n.prototype.onListItemDown=function(e,n){var i=e;if(null!=i){var o=this._diagram.canvas,r=i.root.parent;if(null!=o&&null!=r){var a=this._selection,l=a.store();if(a.set(i)){a.focus();var u=a.store();t.DControllers.getCommandController().push(new _e(l,u,a))}else a.focus();o.layer.active!==r&&(o.layer.active=r)}else this.dialogError.open(n)}},Object.defineProperty(n.prototype,"dialogError",{get:function(){var t;return null!==(t=this._dialogError)&&void 0!==t?t:this._dialogError=this.newDialogError()},enumerable:!1,configurable:!0}),n.prototype.newDialogError=function(){return new t.DDialogMessage({message:this.theme.getDialogErrorLabel()})},Object.defineProperty(n.prototype,"dialogProcessing",{get:function(){var t;return null!==(t=this._dialogProcessing)&&void 0!==t?t:this._dialogProcessing=this.newDialogProcessing()},enumerable:!1,configurable:!0}),n.prototype.newDialogProcessing=function(){return new t.DDialogProcessing},n.prototype.getType=function(){return"EEditorSearch"},n}(t.DLayoutVertical),Gi=function(e){function n(t){var n=e.call(this,t)||this;n._icons=t.icons,n._canvas=t.canvas,n._selection=t.selection,n._isInitialized=!1;var i=t.piece;return i?(n._isPieceEnabled=i.enable,n._pieceExcluder=i.exclude,n._controller=i.controller):n._isPieceEnabled=!1,n._isChangeable=t.changeable,n}return i(n,e),n.prototype.show=function(){return e.prototype.show.call(this),this.onShow(),this},n.prototype.onShow=function(){this._isInitialized||(this._isInitialized=!0,this.initLayout()),this.onSelectionChange()},n.prototype.initLayout=function(){var e=this;new t.DLayoutVertical({parent:this.content,x:"padding",y:"padding",width:"padding",height:"auto",children:[this.layoutChangeTo,this.buttonFill,this.buttonFillColor,this.layoutTexture,this.buttonStroke,this.buttonStrokeColor,this.inputStrokeWidth,this.inputStrokeAlign,this.layoutStrokeSide,this.textCorner,this.inputCornerRadius,this.layoutCorner,this.layoutLine,this.selectLineStyle,this.selectLineType,this.layoutLineTail,this.selectLineTailType,this.layoutLineTailSize,this.buttonLineTailColor,this.inputLineTailMargin,this.layoutLineHead,this.selectLineHeadType,this.layoutLineHeadSize,this.buttonLineHeadColor,this.inputLineHeadMargin]}),this._selection.on("change",(function(){e.isShown()&&e.onSelectionChange()}))},Object.defineProperty(n.prototype,"layoutChangeTo",{get:function(){var t=this._layoutChangeTo;return void 0===t&&(t=!1!==this._isChangeable?this.newLayoutChangeTo():null,this._layoutChangeTo=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutChangeTo=function(){var e=this,n=[this.newTextChangeToLabel(),this.buttonCircle,this.buttonSemicircle,this.buttonRectangle,this.buttonRectangleRounded,this.buttonTriangle,this.buttonTriangleRounded,this.buttonLine,this.buttonLineConnector,this.buttonElbowConnector,this.buttonImage,this.buttonGraphicPiece];return di.each((function(t){n.push(e.newButtonExtensionFactory(t))})),Ge.each((function(i){if(e.isExtensionReplacable(i)){var o=i.creator;t.isFunction(o)&&n.push(e.newButtonExtension(i,o))}})),n.push(this.buttonGroup,this.buttonUngroup),new t.DLayoutVertical({width:"100%",height:"auto",column:7,children:n})},n.prototype.isExtensionReplacable=function(e){if("icon"in e){if("type"in e){var n=t.EShapeCapabilities.get(e.type);if(null!=n)return!!(n&t.EShapeCapability.REPLACING)}return!0}return!1},n.prototype.newTextChangeToLabel=function(){return new t.DText({width:"100%",text:{value:this.theme.getTextChangeToLabel()},clear:"AFTER"})},n.prototype.newButtonExtensionFactory=function(e){var n=this,i=null;return new t.DButtonAmbient({image:{source:e.icon.texture},title:this.toExtensionTitle(e),theme:"EButtonEditor",on:{active:function(t){(i=i||n.newDialogSelectExtensionFactory(e)).open(t)}}})},n.prototype.newDialogSelectExtensionFactory=function(e){var n=this;return new t.DDialogSelect({controller:e,list:{data:{toLabel:e.item.toLabel}},on:{select:function(t){e.item.toCreator(t).then((function(t){n._selection.replace(t)}))}}})},n.prototype.newButtonExtension=function(e,n){var i=this;return new t.DButtonAmbient({image:{source:e.icon.texture},title:this.toExtensionTitle(e),theme:"EButtonEditor",on:{active:function(){i._selection.replace(n)}}})},n.prototype.toExtensionTitle=function(e){var n=e.title;return t.isString(n)?n:n.change},Object.defineProperty(n.prototype,"buttonCircle",{get:function(){var t;return null!==(t=this._buttonCircle)&&void 0!==t?t:this._buttonCircle=this.newButtonCircle()},enumerable:!1,configurable:!0}),n.prototype.newButtonCircle=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.shape_circle},title:this.theme.getButtonCircleTitle(),theme:"EButtonEditor",on:{active:function(){e._selection.replace((function(e){return e.type!==t.EShapeType.CIRCLE?(new t.EShapeCircle).copy(e):null}))}}})},Object.defineProperty(n.prototype,"buttonSemicircle",{get:function(){var t;return null!==(t=this._buttonSemicircle)&&void 0!==t?t:this._buttonSemicircle=this.newButtonSemicircle()},enumerable:!1,configurable:!0}),n.prototype.newButtonSemicircle=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.shape_semicircle},title:this.theme.getButtonSemicircleTitle(),theme:"EButtonEditor",on:{active:function(){e._selection.replace((function(e){return e.type!==t.EShapeType.SEMICIRCLE?(new t.EShapeSemicircle).copy(e):null}))}}})},Object.defineProperty(n.prototype,"buttonRectangle",{get:function(){var t;return null!==(t=this._buttonRectangle)&&void 0!==t?t:this._buttonRectangle=this.newButtonRectangle()},enumerable:!1,configurable:!0}),n.prototype.newButtonRectangle=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.shape_rectangle},title:this.theme.getButtonRectangleTitle(),theme:"EButtonEditor",on:{active:function(){e._selection.replace((function(e){return e.type!==t.EShapeType.RECTANGLE?(new t.EShapeRectangle).copy(e):null}))}}})},Object.defineProperty(n.prototype,"buttonRectangleRounded",{get:function(){var t;return null!==(t=this._buttonRectangleRounded)&&void 0!==t?t:this._buttonRectangleRounded=this.newButtonRectangleRounded()},enumerable:!1,configurable:!0}),n.prototype.newButtonRectangleRounded=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.shape_rectangle_rounded},title:this.theme.getButtonRectangleRoundedTitle(),theme:"EButtonEditor",on:{active:function(){e._selection.replace((function(e){return e.type!==t.EShapeType.RECTANGLE_ROUNDED?(new t.EShapeRectangleRounded).copy(e):null}))}}})},Object.defineProperty(n.prototype,"buttonTriangle",{get:function(){var t;return null!==(t=this._buttonTriangle)&&void 0!==t?t:this._buttonTriangle=this.newButtonTriangle()},enumerable:!1,configurable:!0}),n.prototype.newButtonTriangle=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.shape_triangle},title:this.theme.getButtonTriangleTitle(),theme:"EButtonEditor",on:{active:function(){e._selection.replace((function(e){return e.type!==t.EShapeType.TRIANGLE?(new t.EShapeTriangle).copy(e):null}))}}})},Object.defineProperty(n.prototype,"buttonTriangleRounded",{get:function(){var t;return null!==(t=this._buttonTriangleRounded)&&void 0!==t?t:this._buttonTriangleRounded=this.newButtonTriangleRounded()},enumerable:!1,configurable:!0}),n.prototype.newButtonTriangleRounded=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.shape_triangle_rounded},title:this.theme.getButtonTriangleRoundedTitle(),theme:"EButtonEditor",on:{active:function(){e._selection.replace((function(e){return e.type!==t.EShapeType.TRIANGLE_ROUNDED?(new t.EShapeTriangleRounded).copy(e):null}))}}})},Object.defineProperty(n.prototype,"buttonLine",{get:function(){var t;return null!==(t=this._buttonLine)&&void 0!==t?t:this._buttonLine=this.newButtonLine()},enumerable:!1,configurable:!0}),n.prototype.newButtonLine=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.shape_line},title:this.theme.getButtonLineTitle(),theme:"EButtonEditor",on:{active:function(){e._selection.replace((function(t){return e.replaceLine(t)}))}}})},n.prototype.replaceLine=function(e){if(e.type!==t.EShapeType.LINE){if(e instanceof t.EShapeConnectorLine)return(new t.EShapeLine).copy(e);var n=e.size,i=.5*n.x,o=.5*n.y;return t.createLine([-i,-o,+i,+o],[],t.EShapeDefaults.STROKE_WIDTH,t.EShapePointsStyle.NONE).copy(e,t.EShapeCopyPart.ALL&~(t.EShapeCopyPart.SIZE|t.EShapeCopyPart.POINTS))}return null},n.prototype.isDanglingConnectorAllowed=function(){var t,e,n;return null!==(n=null===(e=null===(t=this.options)||void 0===t?void 0:t.connector)||void 0===e?void 0:e.dangling)&&void 0!==n&&n},Object.defineProperty(n.prototype,"buttonLineConnector",{get:function(){var t;return null!==(t=this._buttonLineConnector)&&void 0!==t?t:this._buttonLineConnector=this.newButtonLineConnector()},enumerable:!1,configurable:!0}),n.prototype.newButtonLineConnector=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.shape_line_connector},title:this.theme.getButtonLineConnectorTitle(),theme:"EButtonEditor",on:{active:function(){var t=e.isDanglingConnectorAllowed();e._selection.replace((function(n){return e.replaceLineConnector(n,t)}))}}})},n.prototype.replaceLineConnector=function(e,n){if(e.type!==t.EShapeType.CONNECTOR_LINE){if(e instanceof t.EShapeConnectorLine)return(new t.EShapeConnectorLine).copy(e);if(n)return this.replaceConnector(e,new t.EShapeConnectorLine)}return null},Object.defineProperty(n.prototype,"buttonElbowConnector",{get:function(){var t;return null!==(t=this._buttonElbowConnector)&&void 0!==t?t:this._buttonElbowConnector=this.newButtonElbowConnector()},enumerable:!1,configurable:!0}),n.prototype.newButtonElbowConnector=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.shape_elbow_connector},title:this.theme.getButtonElbowConnectorTitle(),theme:"EButtonEditor",on:{active:function(){var t=e.isDanglingConnectorAllowed();e._selection.replace((function(n){return e.replaceElbowConnector(n,t)}))}}})},n.prototype.replaceElbowConnector=function(e,n){if(e.type!==t.EShapeType.CONNECTOR_ELBOW){if(e instanceof t.EShapeConnectorLine)return(new t.EShapeConnectorElbow).copy(e);if(n)return this.replaceConnector(e,new t.EShapeConnectorElbow)}return null},n.prototype.replaceConnector=function(e,n){n.lock(t.EShapeLockPart.ALL),n.fill.alpha=1;var i=n.points.marker;i.tail.type=t.EShapePointsMarkerType.CIRCLE,i.head.type=t.EShapePointsMarkerType.TRIANGLE,n.copy(e,t.EShapeCopyPart.ALL&~(t.EShapeCopyPart.SIZE|t.EShapeCopyPart.POINTS|t.EShapeCopyPart.TRANSFORM));var o=e.size,r=.5*o.x,a=.5*o.y,l=e.transform.localTransform,u=l.a*r+l.c*a,s=l.b*r+l.d*a,p=l.tx,h=l.ty,c=n.edge;return c.lock(),c.tail.set(null,null,null,null,0,-u+p,-s+h,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP),c.head.set(null,null,null,null,0,+u+p,+s+h,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP),c.unlock(),n.unlock(t.EShapeLockPart.ALL,!0),n},Object.defineProperty(n.prototype,"buttonImage",{get:function(){var t;return null!==(t=this._buttonImage)&&void 0!==t?t:this._buttonImage=this.newButtonImage()},enumerable:!1,configurable:!0}),n.prototype.newButtonImage=function(){var e=this;return new t.DButtonFile({image:{source:this._icons.editor_image},as:t.DButtonFileAs.DATA_URL,title:this.theme.getButtonImageTitle(),theme:"EButtonEditor",on:{open:function(n){t.toImageElement(n).then((function(n){e._selection.replace((function(e){return new t.EShapeImage(n).copy(e,t.EShapeCopyPart.ALL&~t.EShapeCopyPart.IMAGE)}))}))}}})},Object.defineProperty(n.prototype,"buttonGraphicPiece",{get:function(){var t=this._buttonGraphicPiece;return void 0===t&&(t=this._isPieceEnabled?this.newButtonGraphicPiece():null,this._buttonGraphicPiece=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonGraphicPiece=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.graphic_piece},title:this.theme.getButtonGraphicPieceTitle(),theme:"EButtonEditor",on:{active:function(t){e.onButtonGraphicPieceActive(t)}}})},n.prototype.onButtonGraphicPieceActive=function(t){this.dialogSelectGraphicPiece.then((function(e){e.open(t)}))},Object.defineProperty(n.prototype,"dialogSelectGraphicPiece",{get:function(){var t;return null!==(t=this._dialogSelectGraphicPiece)&&void 0!==t?t:this._dialogSelectGraphicPiece=this.newDialogSelectGraphicPiece()},enumerable:!1,configurable:!0}),n.prototype.newDialogSelectGraphicPiece=function(){var t=this;return this._canvas.get().then((function(e){var n,i=t._controller;return i?i.toPieceThumbnail?((n=t.newDialogSelectGraphicPieceImage(i)).categories=e.category.items,n):((n=t.newDialogSelectGraphicPieceNoImage(i)).categories=e.category.items,n):((n=t.newDialogSelectGraphicPieceNoController()).categories=e.category.items,n)}))},n.prototype.newDialogSelectGraphicPieceNoImage=function(e){var n=this;return new t.DDialogSelect({controller:this.newDialogSelectGraphicPieceController(e),on:{select:function(t){n.onDialogSelectGraphicPieceSelect(t,e)}}})},n.prototype.newDialogSelectGraphicPieceImage=function(t){var e=this;return Di(this.newDialogSelectGraphicPieceController(t),t.toPieceThumbnail,(function(n){e.onDialogSelectGraphicPieceSelect(n,t)}))},n.prototype.newDialogSelectGraphicPieceNoController=function(){return new t.DDialogSelect({controller:{search:function(){return Promise.resolve([])}}})},n.prototype.newDialogSelectGraphicPieceController=function(t){var e=this,n=t.graphic.piece;return{search:function(t,i){return n.search(t,i).then((function(t){return e.toDialogSelectGraphicPieceResult(t)}))}}},n.prototype.toDialogSelectGraphicPieceResult=function(t){var e,n=null===(e=this._pieceExcluder)||void 0===e?void 0:e.call(this);if(null==n)return t;for(var i=[],o=0,r=t.length;o<r;++o){var a=t[o];a.id!==n&&i.push(a)}return i},n.prototype.onDialogSelectGraphicPieceSelect=function(e,n){var i=this;n.graphic.piece.get(e.id).then((function(e){t.EShapeEmbeddeds.from(e,n.graphic,t.EShapeResourceManagerDeserializationMode.EDITOR).then((function(t){i._selection.replace((function(e){return t.clone().copy(e)}))}))}))},Object.defineProperty(n.prototype,"buttonGroup",{get:function(){var t;return null!==(t=this._buttonGroup)&&void 0!==t?t:this._buttonGroup=this.newButtonGroup()},enumerable:!1,configurable:!0}),n.prototype.newButtonGroup=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.shape_group},title:this.theme.getButtonGroupTitle(),theme:"EButtonEditor",on:{active:function(){e._selection.group()}}})},Object.defineProperty(n.prototype,"buttonUngroup",{get:function(){var t;return null!==(t=this._buttonUngroup)&&void 0!==t?t:this._buttonUngroup=this.newButtonUngroup()},enumerable:!1,configurable:!0}),n.prototype.newButtonUngroup=function(){var e=this;return new t.DButtonAmbient({image:{source:this._icons.shape_ungroup},title:this.theme.getButtonUngroupTitle(),theme:"EButtonEditor",on:{active:function(){e._selection.ungroup()}}})},Object.defineProperty(n.prototype,"buttonFill",{get:function(){var t;return null!==(t=this._buttonFill)&&void 0!==t?t:this._buttonFill=this.newButtonFill()},enumerable:!1,configurable:!0}),n.prototype.newButtonFill=function(){var e=this._selection;return new t.DButtonCheckRight({width:"100%",text:{value:this.theme.getButtonFillLabel()},padding:0,background:{color:null},on:{active:function(){e.setFillEnabled(!0)},inactive:function(){e.setFillEnabled(!1)}}})},Object.defineProperty(n.prototype,"buttonFillColor",{get:function(){var t;return null!==(t=this._buttonFillColor)&&void 0!==t?t:this._buttonFillColor=this.newButtonFillColor()},enumerable:!1,configurable:!0}),n.prototype.newButtonFillColor=function(){var e=this,n=new t.DButtonColor({width:"100%",on:{change:function(t){e._selection.setFill(t.color,t.alpha)}}});return n.dialog.on("open",(function(){var t=n.dialog,e=t.new,i=t.current;e.color=i.color,e.alpha=i.alpha})),n},Object.defineProperty(n.prototype,"buttonStroke",{get:function(){var t;return null!==(t=this._buttonStroke)&&void 0!==t?t:this._buttonStroke=this.newButtonStroke()},enumerable:!1,configurable:!0}),n.prototype.newButtonStroke=function(){var e=this._selection;return new t.DButtonCheckRight({width:"100%",text:{value:this.theme.getButtonStrokeLabel()},padding:0,background:{color:null},on:{active:function(){e.setStrokeEnabled(!0)},inactive:function(){e.setStrokeEnabled(!1)}}})},Object.defineProperty(n.prototype,"buttonStrokeColor",{get:function(){var t;return null!==(t=this._buttonStrokeColor)&&void 0!==t?t:this._buttonStrokeColor=this.newButtonStrokeColor()},enumerable:!1,configurable:!0}),n.prototype.newButtonStrokeColor=function(){var e=this,n=new t.DButtonColor({width:"100%",on:{change:function(t){e._selection.setStroke(t.color,t.alpha)}}});return n.dialog.on("open",(function(){var t=n.dialog,e=t.new,i=t.current;e.color=i.color,e.alpha=i.alpha})),n},Object.defineProperty(n.prototype,"inputStrokeWidth",{get:function(){var t;return null!==(t=this._inputStrokeWidth)&&void 0!==t?t:this._inputStrokeWidth=this.newInputStrokeWidth()},enumerable:!1,configurable:!0}),n.prototype.newInputStrokeWidth=function(){var e=this;return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.theme.getInputStrokeWidthLabel()}},input:{weight:1,min:0,on:{change:function(t){e._selection.setStrokeWidth(t)}}}})},Object.defineProperty(n.prototype,"inputStrokeAlign",{get:function(){var t;return null!==(t=this._inputStrokeAlign)&&void 0!==t?t:this._inputStrokeAlign=this.newInputStrokeAlign()},enumerable:!1,configurable:!0}),n.prototype.newInputStrokeAlign=function(){var e=this;return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.theme.getInputStrokeAlignLabel()}},input:{weight:1,min:0,max:1,on:{change:function(t){e._selection.setStrokeAlign(t)}}}})},Object.defineProperty(n.prototype,"layoutStrokeSide",{get:function(){var t;return null!==(t=this._layoutStrokeSide)&&void 0!==t?t:this._layoutStrokeSide=this.newLayoutStrokeSide()},enumerable:!1,configurable:!0}),n.prototype.newLayoutStrokeSide=function(){return new t.DLayoutHorizontal({width:"100%",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonStrokeSideTop,this.buttonStrokeSideRight,this.buttonStrokeSideBottom,this.buttonStrokeSideLeft,this.buttonStrokeExpandable,this.buttonStrokeShrinkable,this.buttonStrokeScalableDotDash,new t.DLayoutSpace({weight:1})]})},Object.defineProperty(n.prototype,"buttonStrokeSideTop",{get:function(){var t;return null!==(t=this._buttonStrokeSideTop)&&void 0!==t?t:this._buttonStrokeSideTop=this.newButtonStrokeSideTop()},enumerable:!1,configurable:!0}),n.prototype.newButtonStrokeSideTop=function(){var e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_side_top},title:this.theme.getButtonStrokeSideTopTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setStrokeSide(t.EShapeStrokeSide.TOP,!0)},inactive:function(){e.setStrokeSide(t.EShapeStrokeSide.TOP,!1)}}})},Object.defineProperty(n.prototype,"buttonStrokeSideRight",{get:function(){var t;return null!==(t=this._buttonStrokeSideRight)&&void 0!==t?t:this._buttonStrokeSideRight=this.newButtonStrokeSideRight()},enumerable:!1,configurable:!0}),n.prototype.newButtonStrokeSideRight=function(){var e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_side_right},title:this.theme.getButtonStrokeSideRightTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setStrokeSide(t.EShapeStrokeSide.RIGHT,!0)},inactive:function(){e.setStrokeSide(t.EShapeStrokeSide.RIGHT,!1)}}})},Object.defineProperty(n.prototype,"buttonStrokeSideBottom",{get:function(){var t;return null!==(t=this._buttonStrokeSideBottom)&&void 0!==t?t:this._buttonStrokeSideBottom=this.newButtonStrokeSideBottom()},enumerable:!1,configurable:!0}),n.prototype.newButtonStrokeSideBottom=function(){var e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_side_bottom},title:this.theme.getButtonStrokeSideBottomTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setStrokeSide(t.EShapeStrokeSide.BOTTOM,!0)},inactive:function(){e.setStrokeSide(t.EShapeStrokeSide.BOTTOM,!1)}}})},Object.defineProperty(n.prototype,"buttonStrokeSideLeft",{get:function(){var t;return null!==(t=this._buttonStrokeSideLeft)&&void 0!==t?t:this._buttonStrokeSideLeft=this.newButtonStrokeSideLeft()},enumerable:!1,configurable:!0}),n.prototype.newButtonStrokeSideLeft=function(){var e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_side_left},title:this.theme.getButtonStrokeSideLeftTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setStrokeSide(t.EShapeStrokeSide.LEFT,!0)},inactive:function(){e.setStrokeSide(t.EShapeStrokeSide.LEFT,!1)}}})},Object.defineProperty(n.prototype,"textCorner",{get:function(){var t;return null!==(t=this._textCorner)&&void 0!==t?t:this._textCorner=this.newTextCorner()},enumerable:!1,configurable:!0}),n.prototype.newTextCorner=function(){return new t.DText({width:"100%",text:{value:this.theme.getTextCornerLabel()}})},Object.defineProperty(n.prototype,"inputCornerRadius",{get:function(){var t;return null!==(t=this._inputCornerRadius)&&void 0!==t?t:this._inputCornerRadius=this.newInputCornerRadius()},enumerable:!1,configurable:!0}),n.prototype.newInputCornerRadius=function(){var e=this;return new t.DInputReal({width:"100%",min:0,step:1,max:100,text:{formatter:function(t){return"".concat(+(100*t).toFixed(2)," %")}},editing:{formatter:function(t){return"".concat(+(100*t).toFixed(2))},unformatter:function(t){return.01*parseFloat(t)}},on:{change:function(t){e._selection.setRadius(t)}}})},Object.defineProperty(n.prototype,"layoutCorner",{get:function(){var t;return null!==(t=this._layoutCorner)&&void 0!==t?t:this._layoutCorner=this.newLayoutCorner()},enumerable:!1,configurable:!0}),n.prototype.newLayoutCorner=function(){return new t.DLayoutHorizontal({width:"100%",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonCornerTopLeft,this.buttonCornerTopRight,this.buttonCornerBottomRight,this.buttonCornerBottomLeft,new t.DLayoutSpace({weight:1})]})},Object.defineProperty(n.prototype,"buttonCornerTopLeft",{get:function(){var t;return null!==(t=this._buttonCornerTopLeft)&&void 0!==t?t:this._buttonCornerTopLeft=this.newButtonCornerTopLeft()},enumerable:!1,configurable:!0}),n.prototype.newButtonCornerTopLeft=function(){var e=this._selection;return new t.DButtonCheck({image:{source:this._icons.corner_top_left},title:this.theme.getButtonCornerTopLeftTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setCorner(t.EShapeCorner.TOP_LEFT,!0)},inactive:function(){e.setCorner(t.EShapeCorner.TOP_LEFT,!1)}}})},Object.defineProperty(n.prototype,"buttonCornerTopRight",{get:function(){var t;return null!==(t=this._buttonCornerTopRight)&&void 0!==t?t:this._buttonCornerTopRight=this.newButtonCornerTopRight()},enumerable:!1,configurable:!0}),n.prototype.newButtonCornerTopRight=function(){var e=this._selection;return new t.DButtonCheck({image:{source:this._icons.corner_top_right},title:this.theme.getButtonCornerTopRightTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setCorner(t.EShapeCorner.TOP_RIGHT,!0)},inactive:function(){e.setCorner(t.EShapeCorner.TOP_RIGHT,!1)}}})},Object.defineProperty(n.prototype,"buttonCornerBottomRight",{get:function(){var t;return null!==(t=this._buttonCornerBottomRight)&&void 0!==t?t:this._buttonCornerBottomRight=this.newButtonCornerBottomRight()},enumerable:!1,configurable:!0}),n.prototype.newButtonCornerBottomRight=function(){var e=this._selection;return new t.DButtonCheck({image:{source:this._icons.corner_bottom_right},title:this.theme.getButtonCornerBottomRightTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setCorner(t.EShapeCorner.BOTTOM_RIGHT,!0)},inactive:function(){e.setCorner(t.EShapeCorner.BOTTOM_RIGHT,!1)}}})},Object.defineProperty(n.prototype,"buttonCornerBottomLeft",{get:function(){var t;return null!==(t=this._buttonCornerBottomLeft)&&void 0!==t?t:this._buttonCornerBottomLeft=this.newButtonCornerBottomLeft()},enumerable:!1,configurable:!0}),n.prototype.newButtonCornerBottomLeft=function(){var e=this._selection;return new t.DButtonCheck({image:{source:this._icons.corner_bottom_left},title:this.theme.getButtonCornerBottomLeftTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setCorner(t.EShapeCorner.BOTTOM_LEFT,!0)},inactive:function(){e.setCorner(t.EShapeCorner.BOTTOM_LEFT,!1)}}})},Object.defineProperty(n.prototype,"layoutLine",{get:function(){var t;return null!==(t=this._layoutLine)&&void 0!==t?t:this._layoutLine=this.newLayoutLine()},enumerable:!1,configurable:!0}),n.prototype.newLayoutLine=function(){return new t.DLayoutHorizontal({width:"100%",children:[this.textLine,this.buttonLineClosed,this.buttonLineLock]})},Object.defineProperty(n.prototype,"textLine",{get:function(){var t;return null!==(t=this._textLine)&&void 0!==t?t:this._textLine=this.newTextLine()},enumerable:!1,configurable:!0}),n.prototype.newTextLine=function(){return new t.DText({weight:1,text:{value:this.theme.getTextLineLabel()}})},Object.defineProperty(n.prototype,"buttonLineLock",{get:function(){var t;return null!==(t=this._buttonLineLock)&&void 0!==t?t:this._buttonLineLock=this.newButtonLineLock()},enumerable:!1,configurable:!0}),n.prototype.newButtonLineLock=function(){var e=this;return new t.DButtonCheck({theme:"EButtonEditorLock",on:{active:function(){e._selection.lockCapability(t.EShapeCapability.LINE)},inactive:function(){e._selection.unlockCapability(t.EShapeCapability.LINE)}}})},n.prototype.isLocked=function(t,e){if(null==t)return!1;var n=t.getCapability();return null!=n&&!!(n.locked&e)},Object.defineProperty(n.prototype,"selectLineStyle",{get:function(){var t;return null!==(t=this._selectLineStyle)&&void 0!==t?t:this._selectLineStyle=this.newSelectLineStyle()},enumerable:!1,configurable:!0}),n.prototype.newSelectLineStyle=function(){var e=this,n=this.theme;return new t.DSelect({width:"100%",value:t.EShapeStrokeStyle.NONE,menu:{items:[{value:t.EShapeStrokeStyle.NONE,text:{value:n.getSelectLineStyleLabel(t.EShapeStrokeStyle.NONE)}},{value:t.EShapeStrokeStyle.DOTTED,text:{value:n.getSelectLineStyleLabel(t.EShapeStrokeStyle.DOTTED)}},{value:t.EShapeStrokeStyle.DOTTED_DENSELY,text:{value:n.getSelectLineStyleLabel(t.EShapeStrokeStyle.DOTTED_DENSELY)}},{value:t.EShapeStrokeStyle.DOTTED_LOOSELY,text:{value:n.getSelectLineStyleLabel(t.EShapeStrokeStyle.DOTTED_LOOSELY)}},{value:t.EShapeStrokeStyle.DASHED,text:{value:n.getSelectLineStyleLabel(t.EShapeStrokeStyle.DASHED)}},{value:t.EShapeStrokeStyle.DASHED_DENSELY,text:{value:n.getSelectLineStyleLabel(t.EShapeStrokeStyle.DASHED_DENSELY)}},{value:t.EShapeStrokeStyle.DASHED_LOOSELY,text:{value:n.getSelectLineStyleLabel(t.EShapeStrokeStyle.DASHED_LOOSELY)}}]},on:{change:function(n){e._selection.setLineStyle(null!=n?n:t.EShapeStrokeStyle.NONE,t.EShapeStrokeStyle.DOTTED_MASK|t.EShapeStrokeStyle.DASHED_MASK)}}})},Object.defineProperty(n.prototype,"selectLineType",{get:function(){var t;return null!==(t=this._selectLineType)&&void 0!==t?t:this._selectLineType=this.newSelectLineType()},enumerable:!1,configurable:!0}),n.prototype.newSelectLineType=function(){var e=this;return new t.DSelect({width:"100%",value:t.EShapePointsStyle.NONE,menu:{items:this.newSelectLineTypeMenuItems()},on:{change:function(n){e._selection.setPointsStyle(null!=n?n:t.EShapePointsStyle.NONE,t.EShapePointsStyle.FORMATTER_MASK)}}})},n.prototype.newSelectLineTypeMenuItems=function(){var e=[{value:t.EShapePointsStyle.NONE,text:{value:this.theme.getSelectLineTypeLabel(t.EShapePointsStyle.NONE)}}];return t.EShapePointsFormatters.each((function(n,i){e.push({value:n<<t.EShapePointsStyle.FORMATTER_SHIFT,text:{value:i.label}})})),e},Object.defineProperty(n.prototype,"buttonLineClosed",{get:function(){var t;return null!==(t=this._buttonLineClosed)&&void 0!==t?t:this._buttonLineClosed=this.newButtonLineClosed()},enumerable:!1,configurable:!0}),n.prototype.newButtonLineClosed=function(){var e=this._selection;return new t.DButtonCheck({image:{source:this._icons.line_closed},title:this.theme.getButtonLineClosedTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setPointsStyle(t.EShapePointsStyle.CLOSED,t.EShapePointsStyle.NONE)},inactive:function(){e.setPointsStyle(t.EShapePointsStyle.NONE,t.EShapePointsStyle.CLOSED)}}})},Object.defineProperty(n.prototype,"buttonStrokeExpandable",{get:function(){var t;return null!==(t=this._buttonStrokeExpandable)&&void 0!==t?t:this._buttonStrokeExpandable=this.newButtonStrokeExpandable()},enumerable:!1,configurable:!0}),n.prototype.newButtonStrokeExpandable=function(){var e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_expandable},title:this.theme.getButtonStrokeExpandableTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setStrokeStyle(t.EShapeStrokeStyle.NONE,t.EShapeStrokeStyle.NON_EXPANDING_WIDTH)},inactive:function(){e.setStrokeStyle(t.EShapeStrokeStyle.NON_EXPANDING_WIDTH,t.EShapeStrokeStyle.NONE)}}})},Object.defineProperty(n.prototype,"buttonStrokeShrinkable",{get:function(){var t;return null!==(t=this._buttonStrokeShrinkable)&&void 0!==t?t:this._buttonStrokeShrinkable=this.newButtonStrokeShrinkable()},enumerable:!1,configurable:!0}),n.prototype.newButtonStrokeShrinkable=function(){var e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_shrinkable},title:this.theme.getButtonStrokeShrinkableTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setStrokeStyle(t.EShapeStrokeStyle.NONE,t.EShapeStrokeStyle.NON_SHRINKING_WIDTH)},inactive:function(){e.setStrokeStyle(t.EShapeStrokeStyle.NON_SHRINKING_WIDTH,t.EShapeStrokeStyle.NONE)}}})},Object.defineProperty(n.prototype,"buttonStrokeScalableDotDash",{get:function(){var t;return null!==(t=this._buttonStrokeScalableDotDash)&&void 0!==t?t:this._buttonStrokeScalableDotDash=this.newButtonStrokeScalableDotDash()},enumerable:!1,configurable:!0}),n.prototype.newButtonStrokeScalableDotDash=function(){var e=this._selection;return new t.DButtonCheckRight({image:{source:this._icons.stroke_scalable_dot_dash},title:this.theme.getButtonStrokeScalableDotDashTitle(),theme:"EButtonEditorCheck",on:{active:function(){e.setStrokeStyle(t.EShapeStrokeStyle.NONE,t.EShapeStrokeStyle.NON_SCALING_DOT_AND_DASH)},inactive:function(){e.setStrokeStyle(t.EShapeStrokeStyle.NON_SCALING_DOT_AND_DASH,t.EShapeStrokeStyle.NONE)}}})},Object.defineProperty(n.prototype,"layoutLineTail",{get:function(){var t;return null!==(t=this._layoutLineTail)&&void 0!==t?t:this._layoutLineTail=this.newLayoutLineTail()},enumerable:!1,configurable:!0}),n.prototype.newLayoutLineTail=function(){return new t.DLayoutHorizontal({width:"100%",children:[this.textLineTail,this.buttonLineTailLock]})},Object.defineProperty(n.prototype,"textLineTail",{get:function(){var t;return null!==(t=this._textLineTail)&&void 0!==t?t:this._textLineTail=this.newTextLineTail()},enumerable:!1,configurable:!0}),n.prototype.newTextLineTail=function(){return new t.DText({weight:1,text:{value:this.theme.getTextLineTailLabel()}})},Object.defineProperty(n.prototype,"buttonLineTailLock",{get:function(){var t;return null!==(t=this._buttonLineTailLock)&&void 0!==t?t:this._buttonLineTailLock=this.newButtonLineTailLock()},enumerable:!1,configurable:!0}),n.prototype.newButtonLineTailLock=function(){var e=this;return new t.DButtonCheck({theme:"EButtonEditorLock",on:{active:function(){e._selection.lockCapability(t.EShapeCapability.LINE_TAIL)},inactive:function(){e._selection.unlockCapability(t.EShapeCapability.LINE_TAIL)}}})},Object.defineProperty(n.prototype,"selectLineTailType",{get:function(){var t;return null!==(t=this._selectLineTailType)&&void 0!==t?t:this._selectLineTailType=this.newSelectLineTailType()},enumerable:!1,configurable:!0}),n.prototype.newSelectLineTailType=function(){var e=this,n=this.theme;return new t.DSelect({width:"100%",value:t.EShapePointsMarkerType.NONE,menu:{items:[{value:t.EShapePointsMarkerType.NONE,text:{value:n.getSelectLineTailTypeLabel(t.EShapePointsMarkerType.NONE)}},{value:t.EShapePointsMarkerType.CIRCLE,text:{value:n.getSelectLineTailTypeLabel(t.EShapePointsMarkerType.CIRCLE)}},{value:t.EShapePointsMarkerType.TRIANGLE,text:{value:n.getSelectLineTailTypeLabel(t.EShapePointsMarkerType.TRIANGLE)}},{value:t.EShapePointsMarkerType.RECTANGLE,text:{value:n.getSelectLineTailTypeLabel(t.EShapePointsMarkerType.RECTANGLE)}}]},on:{change:function(n){e._selection.setLineTailType(null!=n?n:t.EShapePointsMarkerType.NONE)}}})},Object.defineProperty(n.prototype,"layoutLineTailSize",{get:function(){var t;return null!==(t=this._layoutLineTailSize)&&void 0!==t?t:this._layoutLineTailSize=this.newLayoutLineTailSize()},enumerable:!1,configurable:!0}),n.prototype.newLayoutLineTailSize=function(){return new t.DLayoutHorizontal({width:"100%",children:[this.inputLineTailSizeX,this.inputLineTailSizeY]})},Object.defineProperty(n.prototype,"inputLineTailSizeX",{get:function(){var t;return null!==(t=this._inputLineTailSizeX)&&void 0!==t?t:this._inputLineTailSizeX=this.newInputLineTailSizeX()},enumerable:!1,configurable:!0}),n.prototype.newInputLineTailSizeX=function(){var e=this;return new t.DInputReal({weight:1,min:0,on:{change:function(t){e._selection.setLineTailSizeX(t)}}})},Object.defineProperty(n.prototype,"inputLineTailSizeY",{get:function(){var t;return null!==(t=this._inputLineTailSizeY)&&void 0!==t?t:this._inputLineTailSizeY=this.newInputLineTailSizeY()},enumerable:!1,configurable:!0}),n.prototype.newInputLineTailSizeY=function(){var e=this;return new t.DInputReal({weight:1,min:0,on:{change:function(t){e._selection.setLineTailSizeY(t)}}})},Object.defineProperty(n.prototype,"buttonLineTailColor",{get:function(){var t;return null!==(t=this._buttonLineTailColor)&&void 0!==t?t:this._buttonLineTailColor=this.newButtonLineTailColor()},enumerable:!1,configurable:!0}),n.prototype.newButtonLineTailColor=function(){var e=this,n=new t.DButtonColor({width:"100%",on:{change:function(t){e._selection.setLineTailColor(t.color,t.alpha)}}});return n.dialog.on("open",(function(){var t=n.dialog,e=t.new,i=t.current;e.color=i.color,e.alpha=i.alpha})),n},Object.defineProperty(n.prototype,"inputLineTailMargin",{get:function(){var t;return null!==(t=this._inputLineTailMargin)&&void 0!==t?t:this._inputLineTailMargin=this.newInputLineTailMargin()},enumerable:!1,configurable:!0}),n.prototype.newInputLineTailMargin=function(){var e=this;return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.theme.getInputLineTailMarginLabel()}},input:{weight:1,on:{change:function(t){e._selection.setLineTailMargin(t)}}}})},Object.defineProperty(n.prototype,"layoutLineHead",{get:function(){var t;return null!==(t=this._layoutLineHead)&&void 0!==t?t:this._layoutLineHead=this.newLayoutLineHead()},enumerable:!1,configurable:!0}),n.prototype.newLayoutLineHead=function(){return new t.DLayoutHorizontal({width:"100%",children:[this.textLineHead,this.buttonLineHeadLock]})},Object.defineProperty(n.prototype,"textLineHead",{get:function(){var t;return null!==(t=this._textLineHead)&&void 0!==t?t:this._textLineHead=this.newTextLineHead()},enumerable:!1,configurable:!0}),n.prototype.newTextLineHead=function(){return new t.DText({weight:1,text:{value:this.theme.getTextLineHeadLabel()}})},Object.defineProperty(n.prototype,"buttonLineHeadLock",{get:function(){var t;return null!==(t=this._buttonLineHeadLock)&&void 0!==t?t:this._buttonLineHeadLock=this.newButtonLineHeadLock()},enumerable:!1,configurable:!0}),n.prototype.newButtonLineHeadLock=function(){var e=this;return new t.DButtonCheck({theme:"EButtonEditorLock",on:{active:function(){e._selection.lockCapability(t.EShapeCapability.LINE_HEAD)},inactive:function(){e._selection.unlockCapability(t.EShapeCapability.LINE_HEAD)}}})},Object.defineProperty(n.prototype,"selectLineHeadType",{get:function(){var t;return null!==(t=this._selectLineHeadType)&&void 0!==t?t:this._selectLineHeadType=this.newSelectLineHeadType()},enumerable:!1,configurable:!0}),n.prototype.newSelectLineHeadType=function(){var e=this,n=this.theme;return new t.DSelect({width:"100%",value:t.EShapePointsMarkerType.NONE,menu:{items:[{value:t.EShapePointsMarkerType.NONE,text:{value:n.getSelectLineHeadTypeLabel(t.EShapePointsMarkerType.NONE)}},{value:t.EShapePointsMarkerType.CIRCLE,text:{value:n.getSelectLineHeadTypeLabel(t.EShapePointsMarkerType.CIRCLE)}},{value:t.EShapePointsMarkerType.TRIANGLE,text:{value:n.getSelectLineHeadTypeLabel(t.EShapePointsMarkerType.TRIANGLE)}},{value:t.EShapePointsMarkerType.RECTANGLE,text:{value:n.getSelectLineHeadTypeLabel(t.EShapePointsMarkerType.RECTANGLE)}}]},on:{change:function(n){e._selection.setLineHeadType(null!=n?n:t.EShapePointsMarkerType.NONE)}}})},Object.defineProperty(n.prototype,"layoutLineHeadSize",{get:function(){var t;return null!==(t=this._layoutLineHeadSize)&&void 0!==t?t:this._layoutLineHeadSize=this.newLayoutLineHeadSize()},enumerable:!1,configurable:!0}),n.prototype.newLayoutLineHeadSize=function(){return new t.DLayoutHorizontal({width:"100%",children:[this.inputLineHeadSizeX,this.inputLineHeadSizeY]})},Object.defineProperty(n.prototype,"inputLineHeadSizeX",{get:function(){var t;return null!==(t=this._inputLineHeadSizeX)&&void 0!==t?t:this._inputLineHeadSizeX=this.newInputLineHeadSizeX()},enumerable:!1,configurable:!0}),n.prototype.newInputLineHeadSizeX=function(){var e=this;return new t.DInputReal({weight:1,min:0,on:{change:function(t){e._selection.setLineHeadSizeX(t)}}})},Object.defineProperty(n.prototype,"inputLineHeadSizeY",{get:function(){var t;return null!==(t=this._inputLineHeadSizeY)&&void 0!==t?t:this._inputLineHeadSizeY=this.newInputLineHeadSizeY()},enumerable:!1,configurable:!0}),n.prototype.newInputLineHeadSizeY=function(){var e=this;return new t.DInputReal({weight:1,min:0,on:{change:function(t){e._selection.setLineHeadSizeY(t)}}})},Object.defineProperty(n.prototype,"buttonLineHeadColor",{get:function(){var t;return null!==(t=this._buttonLineHeadColor)&&void 0!==t?t:this._buttonLineHeadColor=this.newButtonLineHeadColor()},enumerable:!1,configurable:!0}),n.prototype.newButtonLineHeadColor=function(){var e=this,n=new t.DButtonColor({width:"100%",on:{change:function(t){e._selection.setLineHeadColor(t.color,t.alpha)}}});return n.dialog.on("open",(function(){var t=n.dialog,e=t.new,i=t.current;e.color=i.color,e.alpha=i.alpha})),n},Object.defineProperty(n.prototype,"inputLineHeadMargin",{get:function(){var t;return null!==(t=this._inputLineHeadMargin)&&void 0!==t?t:this._inputLineHeadMargin=this.newInputLineHeadMargin()},enumerable:!1,configurable:!0}),n.prototype.newInputLineHeadMargin=function(){var e=this;return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.theme.getInputLineHeadMarginLabel()}},input:{weight:1,on:{change:function(t){e._selection.setLineHeadMargin(t)}}}})},Object.defineProperty(n.prototype,"layoutTexture",{get:function(){var t=this._layoutTexture;return null==t&&(t=this.newLayoutTexture(),this._layoutTexture=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutTexture=function(){return new t.DLayoutHorizontal({width:"100%",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonTextureImage,this.buttonTextureGradient,this.buttonTextureFitTo,this.buttonTextureClear,new t.DLayoutSpace({weight:1})]})},Object.defineProperty(n.prototype,"buttonTextureImage",{get:function(){var t;return null!==(t=this._buttonTextureImage)&&void 0!==t?t:this._buttonTextureImage=this.newButtonTextureImage()},enumerable:!1,configurable:!0}),n.prototype.newButtonTextureImage=function(){var e=this,n=this.theme;return new t.DButtonFile({image:{source:this._icons.editor_image},as:t.DButtonFileAs.DATA_URL,title:n.getButtonTextureImageTitle(),theme:"EButtonEditor",on:{open:function(n){t.toImageElement(n).then((function(t){e._selection.setImage(t)}))}}})},Object.defineProperty(n.prototype,"buttonTextureGradient",{get:function(){var t;return null!==(t=this._buttonTextureGradient)&&void 0!==t?t:this._buttonTextureGradient=this.newButtonTextureGradient()},enumerable:!1,configurable:!0}),n.prototype.newButtonTextureGradient=function(){var e=this,n=this.theme,i=new t.DButtonColorGradient({image:{source:this._icons.texture_gradient},text:{formatter:function(){return""}},title:n.getButtonTextureGradientTitle(),theme:"EButtonEditor",on:{change:function(n){var i=t.toGradientImageUrl(n);t.toImageElement(i).then((function(t){e._selection.setGradient(t,n.toObject())}))}}});return i.dialog.on("open",(function(){var t=e._selection.last();null!=t&&null!=t.gradient&&i.dialog.value.fromObject(t.gradient)})),i},Object.defineProperty(n.prototype,"buttonTextureFitTo",{get:function(){var t;return null!==(t=this._buttonTextureFitTo)&&void 0!==t?t:this._buttonTextureFitTo=this.newButtonTextureFitTo()},enumerable:!1,configurable:!0}),n.prototype.newButtonTextureFitTo=function(){var e=this,n=this.theme;return new t.DButton({image:{source:this._icons.texture_fit_to},title:n.getButtonTextureFitToTitle(),theme:"EButtonEditor",on:{active:function(){e._selection.fitToImage()}}})},Object.defineProperty(n.prototype,"buttonTextureClear",{get:function(){var t;return null!==(t=this._buttonTextureClear)&&void 0!==t?t:this._buttonTextureClear=this.newButtonTextureClear()},enumerable:!1,configurable:!0}),n.prototype.newButtonTextureClear=function(){var e=this,n=this.theme;return new t.DButton({image:{source:this._icons.texture_clear},title:n.getButtonTextureClearTitle(),theme:"EButtonEditor",on:{active:function(){e._selection.clearImage()}}})},n.prototype.onSelectionChange=function(){var e=this._selection;this.state.isDisabled=e.isEmpty();var n=e.last(),i=this.layoutChangeTo;i&&(i.state.isEnabled=t.EShapeCapabilities.contains(n,t.EShapeCapability.REPLACING));var o=0;if(2<=e.size())for(var r=e.get(),a=0,l=r.length;a<l&&!(t.EShapeCapabilities.contains(r[a],t.EShapeCapability.GROUPING)&&2<=(o+=1));++a);if(this.buttonGroup.state.isEnabled=2<=o,this.buttonUngroup.state.isEnabled=n instanceof t.EShapeGroup&&t.EShapeCapabilities.contains(n,t.EShapeCapability.CHILDREN)&&t.EShapeCapabilities.contains(n,t.EShapeCapability.UNGROUPING),null!=n){this.buttonFill.state.isActive=n.fill.enable;var u=n.fill,s=this.buttonFillColor;(c=s.value).color=u.color,c.alpha=u.alpha,s.state.isEnabled=u.enable}if(null!=n){var p=n.stroke,h=p.enable;this.buttonStroke.state.isActive=h;var c,d=this.buttonStrokeColor;(c=d.value).color=p.color,c.alpha=p.alpha,d.state.isEnabled=h;var g=this.inputStrokeAlign;g.input.value=p.align,g.state.isEnabled=h;var f=this.inputStrokeWidth;f.input.value=p.width,f.state.isEnabled=h;var y=p.side,v=h&&t.EShapeCapabilities.contains(n,t.EShapeCapability.STROKE_SIDE),b=this.buttonStrokeSideTop,m=this.buttonStrokeSideRight,_=this.buttonStrokeSideBottom,S=this.buttonStrokeSideLeft;b.state.isEnabled=v,m.state.isEnabled=v,_.state.isEnabled=v,S.state.isEnabled=v,b.state.isActive=!!(y&t.EShapeStrokeSide.TOP),m.state.isActive=!!(y&t.EShapeStrokeSide.RIGHT),_.state.isActive=!!(y&t.EShapeStrokeSide.BOTTOM),S.state.isActive=!!(y&t.EShapeStrokeSide.LEFT);var w=p.style,T=this.buttonStrokeExpandable,E=this.buttonStrokeShrinkable,C=this.buttonStrokeScalableDotDash;T.state.isEnabled=h,E.state.isEnabled=h,C.state.isEnabled=h,T.state.isActive=!(w&t.EShapeStrokeStyle.NON_EXPANDING_WIDTH),E.state.isActive=!(w&t.EShapeStrokeStyle.NON_SHRINKING_WIDTH),C.state.isActive=!(w&t.EShapeStrokeStyle.NON_SCALING_DOT_AND_DASH)}var D=this.layoutLine,L=this.buttonLineLock,A=this.selectLineStyle,B=this.selectLineType,O=this.buttonLineClosed,P=this.layoutLineTail,I=this.buttonLineTailLock,x=this.selectLineTailType,R=this.inputLineTailSizeX,k=this.inputLineTailSizeY,V=this.buttonLineTailColor,M=this.inputLineTailMargin,N=this.layoutLineHead,F=this.buttonLineHeadLock,j=this.selectLineHeadType,z=this.inputLineHeadSizeX,H=this.inputLineHeadSizeY,G=this.buttonLineHeadColor,U=this.inputLineHeadMargin;if(null!=n&&null!=n.points){var Y=n.points,X=t.EShapeCapabilities.contains(n,t.EShapeCapability.LINE);D.state.isEnabled=!0,L.state.isActive=this.isLocked(n,t.EShapeCapability.LINE),L.state.isEnabled=!0;var W=t.EShapeStrokeStyle.DOTTED_MASK|t.EShapeStrokeStyle.DASHED_MASK;A.value=n.stroke.style&W,A.state.isEnabled=X,B.value=Y.style&t.EShapePointsStyle.FORMATTER_MASK,B.state.isEnabled=X,O.state.isActive=!!(Y.style&t.EShapePointsStyle.CLOSED),O.state.isEnabled=X;var K=t.EShapeCapabilities.contains(n,t.EShapeCapability.LINE_TAIL);P.state.isEnabled=!0,I.state.isActive=this.isLocked(n,t.EShapeCapability.LINE_TAIL),I.state.isEnabled=!0;var Z=Y.marker.tail;x.value=Z.type,x.state.isEnabled=K,R.value=Z.size.x,R.state.isEnabled=K,k.value=Z.size.y,k.state.isEnabled=K;var q=Z.fill,J=V.value;J.color=q.color,J.alpha=q.alpha,V.state.isEnabled=q.enable&&K,n instanceof t.EShapeConnectorLine?(M.input.value=n.edge.tail.margin,M.state.isEnabled=K):M.state.isEnabled=!1;var Q=t.EShapeCapabilities.contains(n,t.EShapeCapability.LINE_HEAD);N.state.isEnabled=!0,F.state.isActive=this.isLocked(n,t.EShapeCapability.LINE_HEAD),F.state.isEnabled=!0;var $=Y.marker.head;j.value=$.type,j.state.isEnabled=Q,z.value=$.size.x,z.state.isEnabled=Q,H.value=$.size.y,H.state.isEnabled=Q;var tt=$.fill,et=G.value;et.color=tt.color,et.alpha=tt.alpha,G.state.isEnabled=tt.enable&&Q,n instanceof t.EShapeConnectorLine?(U.input.value=n.edge.head.margin,U.state.isEnabled=Q):U.state.isEnabled=!1}else D.state.isEnabled=!1,L.state.isEnabled=!1,A.state.isEnabled=!1,B.state.isEnabled=!1,O.state.isEnabled=!1,P.state.isEnabled=!1,I.state.isEnabled=!1,x.state.isEnabled=!1,R.state.isEnabled=!1,k.state.isEnabled=!1,V.state.isEnabled=!1,M.state.isEnabled=!1,N.state.isEnabled=!1,F.state.isEnabled=!1,j.state.isEnabled=!1,z.state.isEnabled=!1,H.state.isEnabled=!1,G.state.isEnabled=!1,U.state.isEnabled=!1;if(null!=n){var nt=t.EShapeCapabilities.contains(n,t.EShapeCapability.BORDER_RADIUS);this.textCorner.state.isEnabled=nt,this.inputCornerRadius.value=n.radius,this.inputCornerRadius.state.isEnabled=nt,this.layoutCorner.state.isEnabled=nt,this.buttonCornerBottomLeft.state.isActive=!!(n.corner&t.EShapeCorner.BOTTOM_LEFT),this.buttonCornerBottomRight.state.isActive=!!(n.corner&t.EShapeCorner.BOTTOM_RIGHT),this.buttonCornerTopLeft.state.isActive=!!(n.corner&t.EShapeCorner.TOP_LEFT),this.buttonCornerTopRight.state.isActive=!!(n.corner&t.EShapeCorner.TOP_RIGHT)}null!=n&&(this.buttonTextureFitTo.state.isDisabled=null==n.image,this.buttonTextureClear.state.isDisabled=null==n.image)},n.prototype.getType=function(){return"EEditorShape"},n}(t.DPane),Ui=function(e){function n(n){var i=e.call(this,n)||this;i._icons=n.icons;var o=n.diagram;i._diagram=o,i.state.isDisabled=null==o.canvas,o.on("unset",(function(){i.state.isDisabled=!0})),o.on("set",(function(){i.state.isDisabled=!1}));var r=o.snapper;i._snapper=r,r.on("change",(function(){i.onSnapperChange(r)}));var a=r.target;a.on("change",(function(){i.onSnapperTargetChange(a)}));var l=r.grid;l.on("change",(function(){i.onSnapperGridChange(l)})),i.addChild(i.buttonLabel),i.addChild(i.buttonGrid),i.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[i.buttonGridEye,i.inputGridSize]})),i.addChild(i.buttonTarget),i.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[new t.DLayoutSpace({weight:1}),i.buttonTargetNew,i.buttonTargetDelete,i.buttonTargetBringForward,i.buttonTargetSendBackward,i.buttonTargetEye,new t.DLayoutSpace({weight:1})]})),i.addChild(i.listTarget);var u=i.listTarget;return u.data.selection.on("change",(function(){i.onSelectionChange(u)})),i.onSnapperChange(r),i.onSnapperTargetChange(a),i.onSnapperGridChange(l),i.onSelectionChange(u),i}return i(n,e),Object.defineProperty(n.prototype,"buttonLabel",{get:function(){var t=this._buttonLabel;return null==t&&(t=this.newButtonLabel(),this._buttonLabel=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonLabel=function(){var e=this._diagram.snapper;return new t.DButtonCheckRight({x:"padding",width:"padding",text:{value:this.theme.getLabel()},padding:0,background:{color:null},on:{active:function(){e.enable||t.DControllers.getCommandController().push(new E(e))},inactive:function(){e.enable&&t.DControllers.getCommandController().push(new E(e))}}})},Object.defineProperty(n.prototype,"buttonTarget",{get:function(){var t=this._buttonTarget;return null==t&&(t=this.newButtonTarget(),this._buttonTarget=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonTarget=function(){var e=this;return new t.DButtonCheckRight({x:"padding",width:"padding",text:{value:this.theme.getButtonTargetLabel()},padding:0,background:{color:null},on:{active:function(){var n=e._snapper;n.target.enable||t.DControllers.getCommandController().push(new T(n))},inactive:function(){var n=e._snapper;n.target.enable&&t.DControllers.getCommandController().push(new T(n))}}})},Object.defineProperty(n.prototype,"buttonTargetNew",{get:function(){var t=this._buttonTargetNew;return null==t&&(t=this.newButtonTargetNew(),this._buttonTargetNew=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonTargetNew=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.theme.getButtonTargetNewTitle(),on:{active:function(t){e.onButtonTargetNewActive(t)}}})},n.prototype.onButtonTargetNewActive=function(e){var n=this;this.dialogTarget.reset().open(e).then((function(e){null!=e&&t.DControllers.getCommandController().push(new f(n._snapper,e))}))},Object.defineProperty(n.prototype,"buttonTargetDelete",{get:function(){var t=this._buttonTargetDelete;return null==t&&(t=this.newButtonTargetDelete(),this._buttonTargetDelete=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonTargetDelete=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.theme.getButtonTargetDeleteTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var n=e.listTarget,i=n.data.selection.first;if(null!=i){var o=n.data.items.indexOf(i);0<=o&&t.DControllers.getCommandController().push(new y(e._snapper,o,i))}}}})},Object.defineProperty(n.prototype,"buttonTargetBringForward",{get:function(){var t=this._buttonTargetBringForward;return null==t&&(t=this.newButtonTargetBringForward(),this._buttonTargetBringForward=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonTargetBringForward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonTargetBringForwardTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var n=e.listTarget,i=n.data.selection.first,o=n.data.items;if(null!=i&&o[0]!==i){var r=o.indexOf(i);0<=r&&t.DControllers.getCommandController().push(new g(e._snapper,r))}}}})},Object.defineProperty(n.prototype,"buttonTargetSendBackward",{get:function(){var t=this._buttonTargetSendBackward;return null==t&&(t=this.newButtonTargetSendBackward(),this._buttonTargetSendBackward=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonTargetSendBackward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonTargetSendBackwardTitle(),state:t.DBaseState.DISABLED,on:{active:function(){var n=e._snapper,i=e.listTarget,o=i.data.selection.first,r=i.data.items;if(null!=o&&r[r.length]!==o){var a=r.indexOf(o);0<=a&&t.DControllers.getCommandController().push(new S(n,a))}}}})},Object.defineProperty(n.prototype,"buttonTargetEye",{get:function(){var t=this._buttonTargetEye;return null==t&&(t=this.newButtonTargetEye(),this._buttonTargetEye=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonTargetEye=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.eye},title:this.theme.getButtonTargetEyeTitle(),on:{active:function(){t.DControllers.getCommandController().push(new w(e._snapper))}}})},Object.defineProperty(n.prototype,"dialogTarget",{get:function(){var t=this._dialogTarget;return null==t&&(t=this.newDialogTarget(),this._dialogTarget=t),t},enumerable:!1,configurable:!0}),n.prototype.newDialogTarget=function(){return new Li},Object.defineProperty(n.prototype,"listTarget",{get:function(){var t=this._listTarget;return null==t&&(t=this.newListTarget(),this._listTarget=t),t},enumerable:!1,configurable:!0}),n.prototype.newListTarget=function(){var e=this,n=this.theme,i=new t.DList({x:"padding",width:"padding",weight:1,data:{toLabel:function(t){return n.getListTargetItemLabel(t)}},updater:{newItem:function(n){return new t.DListItem(n,{on:{dblclick:function(t,n,o){e.onListTargetDblClick(t,n,o,i)}}})}}});return i},n.prototype.onListTargetDblClick=function(e,n,i,o){var r=this,a=i.value;if(null!=a&&0<=o.data.items.indexOf(a)){var l=this.dialogTarget;l.value=a,l.open(i).then((function(e){null!=e&&t.DControllers.getCommandController().push(new _(r._snapper,a,e,o))}))}},Object.defineProperty(n.prototype,"buttonGrid",{get:function(){var t=this._buttonGrid;return null==t&&(t=this.newButtonGrid(),this._buttonGrid=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonGrid=function(){var e=this;return new t.DButtonCheckRight({x:"padding",width:"padding",text:{value:this.theme.getButtonGridLabel()},padding:0,background:{color:null},on:{active:function(){var n=e._snapper;n.grid.enable||t.DControllers.getCommandController().push(new m(n))},inactive:function(){var n=e._snapper;n.grid.enable&&t.DControllers.getCommandController().push(new m(n))}}})},Object.defineProperty(n.prototype,"buttonGridEye",{get:function(){var t=this._buttonGridEye;return null==t&&(t=this.newButtonGridEye(),this._buttonGridEye=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonGridEye=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.eye},title:this.theme.getButtonGridEyeTitle(),on:{active:function(){t.DControllers.getCommandController().push(new b(e._snapper))}}})},Object.defineProperty(n.prototype,"inputGridSize",{get:function(){var t=this._inputGridSize;return null==t&&(t=this.newInputGridSize(),this._inputGridSize=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputGridSize=function(){var e=this;return new t.DInputRealAndLabel({weight:1,label:{text:{value:this.theme.getInputGridSizeLabel()}},input:{weight:1,text:{value:10},min:2,on:{change:function(n){t.DControllers.getCommandController().push(new v(e._snapper,n))}}}})},n.prototype.onSnapperChange=function(t){this.buttonLabel.state.isActive=t.enable},n.prototype.onSnapperTargetChange=function(t){this.buttonTarget.state.isActive=t.enable;var e=this._icons;this.buttonTargetEye.image=t.visible?e.eye:e.eye_slash;var n=this.listTarget;n.data.items=t.values,this.onSelectionChange(n)},n.prototype.onSnapperGridChange=function(t){this.buttonGrid.state.isActive=t.enable;var e=this._icons;this.buttonGridEye.image=t.visible?e.eye:e.eye_slash,this.inputGridSize.input.value=t.size},n.prototype.onSelectionChange=function(t){this.buttonTargetDelete.state.isDisabled=t.data.selection.isEmpty();var e=t.data.selection.first,n=t.data.items;this.buttonTargetBringForward.state.isDisabled=null==e||n[0]===e,this.buttonTargetSendBackward.state.isDisabled=null==e||n[n.length-1]===e},n.prototype.getType=function(){return"EEditorSnap"},n}(t.DLayoutVertical),Yi=function(e){function n(n){var i=e.call(this,n)||this;i._fromShapeTextRegEx=/\\+n|\n/g,i._toShapeTextRegEx=/\\+n/g;var o=n.selection;i._selection=o;var r=n.icons;i._icons=r;var a=i.theme;return new t.DLayoutVertical({parent:i.content,x:"padding",y:"padding",width:"padding",height:"auto",children:[i.newLabel(a.getLabel()),i.inputText,i.newLabel(a.getTextFontLabel()),i.dropdownFontFamily,i.buttonFontColor,new t.DLayoutHorizontal({width:"100%",height:"auto",children:[i.inputFontSize,i.buttonFontSizeDecrease,i.buttonFontSizeIncrease,i.buttonFontItalic,i.buttonFontBold]}),i.buttonOutline,i.buttonOutlineColor,i.inputOutlineWidth,i.newLabel(a.getTextAlignLabel()),new t.DLayoutVertical({width:"100%",height:"auto",column:7,children:[i.buttonAlignOutsideLeft,i.buttonAlignLeft,i.buttonAlignCenter,i.buttonAlignRight,i.buttonAlignOutsideRight,i.buttonAlignOutsideTop,i.buttonAlignTop,i.buttonAlignMiddle,i.buttonAlignBottom,i.buttonAlignOutsideBottom,i.buttonDirectionLeftToRight,i.buttonDirectionTopToBottom,i.buttonDirectionBottomToTop,i.buttonDirectionRightToLeft]}),i.buttonClipping,i.buttonFitting,i.newLabel(a.getTextSpacingLabel()),new t.DLayoutHorizontal({width:"100%",children:[i.inputSpacingHorizontal,i.inputSpacingVertical]}),i.newLabel(a.getTextPaddingLabel()),new t.DLayoutHorizontal({width:"100%",children:[i.inputPaddingHorizontal,i.inputPaddingVertical]}),i.newLabel(a.getTextOffsetLabel()),new t.DLayoutHorizontal({width:"100%",children:[i.inputOffsetHorizontal,i.inputOffsetVertical]})]}),o.on("change",(function(){i.onSelectionChange(o)})),i.onSelectionChange(o),i}return i(n,e),n.prototype.newLabel=function(e){return new t.DText({width:"100%",text:{value:e}})},Object.defineProperty(n.prototype,"inputText",{get:function(){var t=this._inputText;return null==t&&(t=this.newInputText(),this._inputText=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputText=function(){var e=this;return new t.DInputTextArea({width:"100%",height:this.theme.getInputTextHeight(),text:{value:""},on:{input:function(t){e._selection.setText(t)}}})},Object.defineProperty(n.prototype,"dropdownFontFamily",{get:function(){var t=this._dropdownFontFamily;return null==t&&(t=this.newDropdownFontFamily(),this._dropdownFontFamily=t),t},enumerable:!1,configurable:!0}),n.prototype.newDropdownFontFamily=function(){var e=this;return new t.DDropdown({width:"100%",text:{value:this.fontFamilies.get("auto")},menu:{width:"auto",column:3,fit:!1,items:this.newDropdownFontFamilyMenuItems()},on:{select:function(t){var n;e.dropdownFontFamily.text=null!==(n=e.fontFamilies.get(t))&&void 0!==n?n:t,e._selection.setTextFamily(t)}}})},n.prototype.newDropdownFontFamilyMenuItems=function(){var t=[];return this.fontFamilies.forEach((function(e,n){t.push({width:200,value:n,text:{value:e}})})),t},Object.defineProperty(n.prototype,"fontFamilies",{get:function(){var t=this._fontFamilies;return null==t&&(t=this.theme.getFontFamilies(),this._fontFamilies=t),t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"buttonFontColor",{get:function(){var t=this._buttonFontColor;return null==t&&(t=this.newButtonFontColor(),this._buttonFontColor=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonFontColor=function(){var e=this,n=new t.DButtonColor({width:"100%",on:{change:function(t){e._selection.setTextColor(t.color,t.alpha)}}});return n.dialog.on("open",(function(){var t=n.dialog,e=t.new,i=t.current;e.color=i.color,e.alpha=i.alpha})),n},Object.defineProperty(n.prototype,"inputFontSize",{get:function(){var t=this._inputFontSize;return null==t&&(t=this.newInputFontSize(),this._inputFontSize=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputFontSize=function(){var e=this;return new t.DInputReal({weight:1,text:{value:0},min:0,on:{input:function(t){e._selection.setTextSize(t)}}})},Object.defineProperty(n.prototype,"buttonFontSizeDecrease",{get:function(){var t=this._buttonFontSizeDecrease;return null==t&&(t=this.newButtonFontSizeDecrease(),this._buttonFontSizeDecrease=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonFontSizeDecrease=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_font_size_decrease},title:this.theme.getButtonFontSizeDecreaseTitle(),on:{active:function(){e._selection.setTextSizeDelta(-1)}}})},Object.defineProperty(n.prototype,"buttonFontSizeIncrease",{get:function(){var t=this._buttonFontSizeIncrease;return null==t&&(t=this.newButtonFontSizeIncrease(),this._buttonFontSizeIncrease=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonFontSizeIncrease=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_font_size_increase},title:this.theme.getButtonFontSizeIncreaseTitle(),on:{active:function(){e._selection.setTextSizeDelta(1)}}})},Object.defineProperty(n.prototype,"buttonFontItalic",{get:function(){var t=this._buttonFontItalic;return null==t&&(t=this.newButtonFontItalic(),this._buttonFontItalic=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonFontItalic=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.italic},toggle:!0,title:this.theme.getButtonFontItalicTitle(),on:{active:function(){e._selection.setTextStyle(t.EShapeTextStyle.ITALIC)},inactive:function(){e._selection.setTextStyle(t.EShapeTextStyle.NORMAL)}}})},Object.defineProperty(n.prototype,"buttonFontBold",{get:function(){var t=this._buttonFontBold;return null==t&&(t=this.newButtonFontBold(),this._buttonFontBold=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonFontBold=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.bold},toggle:!0,title:this.theme.getButtonFontBoldTitle(),on:{active:function(){e._selection.setTextWeight(t.EShapeTextWeight.BOLD)},inactive:function(){e._selection.setTextWeight(t.EShapeTextWeight.NORMAL)}}})},Object.defineProperty(n.prototype,"buttonOutline",{get:function(){var t=this._buttonOutline;return null==t&&(t=this.newButtonOutline(),this._buttonOutline=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonOutline=function(){var e=this;return new t.DButtonCheckRight({width:"100%",text:{value:this.theme.getButtonOutlineLabel()},padding:0,background:{color:null},on:{active:function(){e._selection.setTextOutlineEnabled(!0)},inactive:function(){e._selection.setTextOutlineEnabled(!1)}}})},Object.defineProperty(n.prototype,"buttonOutlineColor",{get:function(){var t=this._buttonOutlineColor;return null==t&&(t=this.newButtonOutlineColor(),this._buttonOutlineColor=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonOutlineColor=function(){var e=this,n=new t.DButtonColor({width:"100%",on:{change:function(t){e._selection.setTextOutlineColor(t.color,t.alpha)}}});return n.dialog.on("open",(function(){var t=n.dialog,e=t.new,i=t.current;e.color=i.color,e.alpha=i.alpha})),n},Object.defineProperty(n.prototype,"inputOutlineWidth",{get:function(){var t;return null!==(t=this._inputOutlineWidth)&&void 0!==t?t:this._inputOutlineWidth=this.newInputOutlineWidth()},enumerable:!1,configurable:!0}),n.prototype.newInputOutlineWidth=function(){var e=this;return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.theme.getInputOutlineWidthLabel()}},input:{weight:1,min:0,step:1,max:100,on:{change:function(t){e._selection.setTextOutlineWidth(.01*t)}}}})},Object.defineProperty(n.prototype,"buttonAlignOutsideLeft",{get:function(){var t=this._buttonAlignOutsideLeft;return null==t&&(t=this.newButtonAlignOutsideLeft(),this._buttonAlignOutsideLeft=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonAlignOutsideLeft=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_outside_left},title:this.theme.getButtonAlignOutsideLeftTitle(),on:{active:function(){e._selection.setTextAlignHorizontal(t.EShapeTextAlignHorizontal.OUTSIDE_LEFT)}}})},Object.defineProperty(n.prototype,"buttonAlignLeft",{get:function(){var t=this._buttonAlignLeft;return null==t&&(t=this.newButtonAlignLeft(),this._buttonAlignLeft=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonAlignLeft=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_left},title:this.theme.getButtonAlignLeftTitle(),on:{active:function(){e._selection.setTextAlignHorizontal(t.EShapeTextAlignHorizontal.LEFT)}}})},Object.defineProperty(n.prototype,"buttonAlignCenter",{get:function(){var t=this._buttonAlignCenter;return null==t&&(t=this.newButtonAlignCenter(),this._buttonAlignCenter=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonAlignCenter=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_center},title:this.theme.getButtonAlignCenterTitle(),on:{active:function(){e._selection.setTextAlignHorizontal(t.EShapeTextAlignHorizontal.CENTER)}}})},Object.defineProperty(n.prototype,"buttonAlignRight",{get:function(){var t=this._buttonAlignRight;return null==t&&(t=this.newButtonAlignRight(),this._buttonAlignRight=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonAlignRight=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_right},title:this.theme.getButtonAlignRightTitle(),on:{active:function(){e._selection.setTextAlignHorizontal(t.EShapeTextAlignHorizontal.RIGHT)}}})},Object.defineProperty(n.prototype,"buttonAlignOutsideRight",{get:function(){var t=this._buttonAlignOutsideRight;return null==t&&(t=this.newButtonAlignOutsideRight(),this._buttonAlignOutsideRight=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonAlignOutsideRight=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_outside_right},title:this.theme.getButtonAlignOutsideRightTitle(),on:{active:function(){e._selection.setTextAlignHorizontal(t.EShapeTextAlignHorizontal.OUTSIDE_RIGHT)}}})},Object.defineProperty(n.prototype,"buttonAlignOutsideTop",{get:function(){var t=this._buttonAlignOutsideTop;return null==t&&(t=this.newButtonAlignOutsideTop(),this._buttonAlignOutsideTop=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonAlignOutsideTop=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_outside_top},title:this.theme.getButtonAlignOutsideTopTitle(),on:{active:function(){e._selection.setTextAlignVertical(t.EShapeTextAlignVertical.OUTSIDE_TOP)}}})},Object.defineProperty(n.prototype,"buttonAlignTop",{get:function(){var t=this._buttonAlignTop;return null==t&&(t=this.newButtonAlignTop(),this._buttonAlignTop=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonAlignTop=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_top},title:this.theme.getButtonAlignTopTitle(),on:{active:function(){e._selection.setTextAlignVertical(t.EShapeTextAlignVertical.TOP)}}})},Object.defineProperty(n.prototype,"buttonAlignMiddle",{get:function(){var t=this._buttonAlignMiddle;return null==t&&(t=this.newButtonAlignMiddle(),this._buttonAlignMiddle=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonAlignMiddle=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_middle},title:this.theme.getButtonAlignMiddleTitle(),on:{active:function(){e._selection.setTextAlignVertical(t.EShapeTextAlignVertical.MIDDLE)}}})},Object.defineProperty(n.prototype,"buttonAlignBottom",{get:function(){var t=this._buttonAlignBottom;return null==t&&(t=this.newButtonAlignBottom(),this._buttonAlignBottom=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonAlignBottom=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_bottom},title:this.theme.getButtonAlignBottomTitle(),on:{active:function(){e._selection.setTextAlignVertical(t.EShapeTextAlignVertical.BOTTOM)}}})},Object.defineProperty(n.prototype,"buttonAlignOutsideBottom",{get:function(){var t=this._buttonAlignOutsideBottom;return null==t&&(t=this.newButtonAlignOutsideBottom(),this._buttonAlignOutsideBottom=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonAlignOutsideBottom=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_outside_bottom},title:this.theme.getButtonAlignOutsideBottomTitle(),on:{active:function(){e._selection.setTextAlignVertical(t.EShapeTextAlignVertical.OUTSIDE_BOTTOM)}}})},Object.defineProperty(n.prototype,"buttonDirectionLeftToRight",{get:function(){var t=this._buttonDirectionLeftToRight;return null==t&&(t=this.newButtonDirectionLeftToRight(),this._buttonDirectionLeftToRight=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonDirectionLeftToRight=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_direction_left_to_right},title:this.theme.getButtonDirectionLeftToRightTitle(),on:{active:function(){e._selection.setTextDirection(t.EShapeTextDirection.LEFT_TO_RIGHT)}}})},Object.defineProperty(n.prototype,"buttonDirectionTopToBottom",{get:function(){var t=this._buttonDirectionTopToBottom;return null==t&&(t=this.newButtonDirectionTopToBottom(),this._buttonDirectionTopToBottom=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonDirectionTopToBottom=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_direction_top_to_bottom},title:this.theme.getButtonDirectionTopToBottomTitle(),on:{active:function(){e._selection.setTextDirection(t.EShapeTextDirection.TOP_TO_BOTTOM)}}})},Object.defineProperty(n.prototype,"buttonDirectionBottomToTop",{get:function(){var t=this._buttonDirectionBottomToTop;return null==t&&(t=this.newButtonDirectionBottomToTop(),this._buttonDirectionBottomToTop=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonDirectionBottomToTop=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_direction_bottom_to_top},title:this.theme.getButtonDirectionBottomToTopTitle(),on:{active:function(){e._selection.setTextDirection(t.EShapeTextDirection.BOTTOM_TO_TOP)}}})},Object.defineProperty(n.prototype,"buttonDirectionRightToLeft",{get:function(){var t=this._buttonDirectionRightToLeft;return null==t&&(t=this.newButtonDirectionRightToLeft(),this._buttonDirectionRightToLeft=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonDirectionRightToLeft=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.text_direction_right_to_left},title:this.theme.getButtonDirectionRightToLeftTitle(),on:{active:function(){e._selection.setTextDirection(t.EShapeTextDirection.RIGHT_TO_LEFT)}}})},Object.defineProperty(n.prototype,"buttonClipping",{get:function(){var t=this._buttonClipping;return null==t&&(t=this.newButtonClipping(),this._buttonClipping=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonClipping=function(){var e=this;return new t.DButtonCheckRight({width:"100%",text:{value:this.theme.getButtonClippingLabel()},padding:0,background:{color:null},on:{active:function(){e._selection.setTextClipping(!0)},inactive:function(){e._selection.setTextClipping(!1)}}})},Object.defineProperty(n.prototype,"buttonFitting",{get:function(){var t=this._buttonFitting;return null==t&&(t=this.newButtonFitting(),this._buttonFitting=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonFitting=function(){var e=this;return new t.DButtonCheckRight({width:"100%",text:{value:this.theme.getButtonFittingLabel()},padding:0,background:{color:null},on:{active:function(){e._selection.setTextFitting(!0)},inactive:function(){e._selection.setTextFitting(!1)}}})},Object.defineProperty(n.prototype,"inputSpacingHorizontal",{get:function(){var t=this._inputSpacingHorizontal;return null==t&&(t=this.newInputSpacingHorizontal(),this._inputSpacingHorizontal=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputSpacingHorizontal=function(){var e=this;return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:function(t){e._selection.setTextSpacingHorizontal(t)}}})},Object.defineProperty(n.prototype,"inputSpacingVertical",{get:function(){var t=this._inputSpacingVertical;return null==t&&(t=this.newInputSpacingVertical(),this._inputSpacingVertical=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputSpacingVertical=function(){var e=this;return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:function(t){e._selection.setTextSpacingVertical(t)}}})},Object.defineProperty(n.prototype,"inputPaddingHorizontal",{get:function(){var t=this._inputPaddingHorizontal;return null==t&&(t=this.newInputPaddingHorizontal(),this._inputPaddingHorizontal=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputPaddingHorizontal=function(){var e=this;return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:function(t){e._selection.setTextPaddingHorizontal(t)}}})},Object.defineProperty(n.prototype,"inputPaddingVertical",{get:function(){var t=this._inputTextPaddingVertical;return null==t&&(t=this.newInputPaddingVertical(),this._inputTextPaddingVertical=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputPaddingVertical=function(){var e=this;return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:function(t){e._selection.setTextPaddingVertical(t)}}})},Object.defineProperty(n.prototype,"inputOffsetHorizontal",{get:function(){var t=this._inputOffsetHorizontal;return null==t&&(t=this.newInputOffsetHorizontal(),this._inputOffsetHorizontal=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputOffsetHorizontal=function(){var e=this;return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:function(t){e._selection.setTextOffsetHorizontal(t)}}})},Object.defineProperty(n.prototype,"inputOffsetVertical",{get:function(){var t=this._inputOffsetVertical;return null==t&&(t=this.newInputOffsetVertical(),this._inputOffsetVertical=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputOffsetVertical=function(){var e=this;return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:function(t){e._selection.setTextOffsetVertical(t)}}})},n.prototype.onSelectionChange=function(e){var n;this.state.isDisabled=e.isEmpty();var i=e.last();if(null!=i){var o=i.text;this.inputText.value=o.value;var r=o.family;this.dropdownFontFamily.text=null!==(n=this.fontFamilies.get(r))&&void 0!==n?n:r;var a=this.buttonFontColor.value;a.color=o.color,a.alpha=o.alpha,this.inputFontSize.value=o.size,this.buttonFontItalic.state.isActive=o.style===t.EShapeTextStyle.ITALIC,this.buttonFontBold.state.isActive=o.weight===t.EShapeTextWeight.BOLD;var l=o.outline;this.buttonOutline.state.isActive=l.enable;var u=this.buttonOutlineColor,s=u.value;s.color=l.color,s.alpha=l.alpha,u.state.isDisabled=!l.enable;var p=this.inputOutlineWidth;p.input.value=100*l.width,p.state.isDisabled=!l.enable,this.buttonClipping.state.isActive=o.clipping,this.buttonFitting.state.isActive=o.fitting;var h=o.spacing;this.inputSpacingHorizontal.value=h.horizontal,this.inputSpacingVertical.value=h.vertical;var c=o.padding;this.inputPaddingHorizontal.value=c.horizontal,this.inputPaddingVertical.value=c.vertical;var d=o.offset;this.inputOffsetHorizontal.value=d.horizontal,this.inputOffsetVertical.value=d.vertical}},n.prototype.getType=function(){return"EEditorText"},n}(t.DPane),Xi=function(t,e){return t[0]-e[0]},Wi=function(e){function n(t,n){var i=e.call(this)||this;return i._parent=t,i._selection=n,i}return i(n,e),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"indices",{get:function(){var t=this._selection,e=[];return this._parent.each((function(n,i){t.contains(n)&&e.push(i)})),e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rows",{get:function(){var t=this._selection,e=[];return this._parent.each((function(n,i){t.contains(n)&&e.push(n)})),e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"type",{get:function(){return t.DTableDataSelectionType.MULTIPLE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"first",{get:function(){var t=this._selection.first();return t?this.toIndex(t):null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"last",{get:function(){var t=this._selection.last();return t?this.toIndex(t):null},enumerable:!1,configurable:!0}),n.prototype.onNodeChange=function(t){},n.prototype.toggle=function(e){var n=this._parent.get(e);if(n){var i=this._selection,o=i.store();i.toggle(n),i.focus();var r=i.store();t.DControllers.getCommandController().push(new _e(o,r,i))}},n.prototype.add=function(e){var n=this._parent.get(e);if(n){var i=this._selection;if(!i.contains(n)){var o=i.store();i.toggle(n),i.focus();var r=i.store();t.DControllers.getCommandController().push(new _e(o,r,i))}}},n.prototype.toIndex=function(t){var e=null;return this._parent.each((function(n,i){return t!==n||(e=i,!1)})),e},n.prototype.addTo=function(t){var e=this._selection.last();if(null!=e){var n=this.toIndex(e);null!=n&&this.addRange(n,!1,t,!0)}},n.prototype.addRange=function(e,n,i,o){var r=[],a=this._parent,l=this._selection;if(e<i?a.each((function(t){l.contains(t)||r.push(t)}),e+(n?0:1),i+(o?1:0)):a.each((function(t){l.contains(t)||r.push(t)}),i+(o?0:1),e+(n?1:0)),0<r.length){var u=l.store();l.addAll(r),l.focus();var s=l.store();t.DControllers.getCommandController().push(new _e(u,s,l))}},n.prototype.addAll=function(e){if(0<e.length){for(var n=[],i=this._parent,o=this._selection,r=0,a=e.length;r<a;++r){var l=i.get(e[r]);l&&!o.contains(l)&&n.push(l)}if(0<n.length){var u=o.store();o.addAll(n),o.focus();var s=o.store();t.DControllers.getCommandController().push(new _e(u,s,o))}}},n.prototype.contains=function(t){var e=this._parent.get(t);return!!e&&this._selection.contains(e)},n.prototype.remove=function(e){var n=this._parent.get(e);if(n){var i=this._selection;if(i.contains(n)){var o=i.store();i.remove(n),i.focus();var r=i.store();t.DControllers.getCommandController().push(new _e(o,r,i))}}},n.prototype.clear=function(){var e=this._selection;if(!e.isEmpty()){var n=e.store();e.clear(),e.focus();var i=e.store();t.DControllers.getCommandController().push(new _e(n,i,e))}},n.prototype.clearAndAdd=function(e){var n=this._parent.get(e);if(n){var i=this._selection;if(i.contains(n))if(1<i.size()){var o=i.store();i.set(n),i.focus();var r=i.store();t.DControllers.getCommandController().push(new _e(o,r,i))}else i.focus();else o=i.store(),i.set(n),i.focus(),r=i.store(),t.DControllers.getCommandController().push(new _e(o,r,i))}},n.prototype.clearAndAddAll=function(e){var n=this._selection;if(!n.isEmpty()||0<e.length){for(var i=[],o=this._parent,r=0,a=e.length;r<a;++r){var l=o.get(e[r]);l&&i.push(l)}var u=n.store();n.clearAndAddAll(i),n.focus();var s=n.store();t.DControllers.getCommandController().push(new _e(u,s,n))}},n.prototype.shift=function(t,e){},n.prototype.size=function(){return this._selection.size()},n.prototype.isEmpty=function(){return this._selection.isEmpty()},n.prototype.each=function(t){var e=this._selection;this._parent.each((function(n,i){return!e.contains(n)||!1!==t(i)}))},n.prototype.toArray=function(){var t=this._selection,e=[];return this._parent.each((function(n,i){t.contains(n)&&e.push([i,n])})),e},n.prototype.toSortedArray=function(){return this.toArray().sort(Xi)},n.prototype.toObject=function(){var t=this._selection,e={};return this._parent.each((function(n,i){t.contains(n)&&(e[i]=n)})),e},n.prototype.toMap=function(){var t=this._selection,e=new Map;return this._parent.each((function(n,i){t.contains(n)&&e.set(i,n)})),e},n}(e.utils.EventEmitter),Ki=function(e){function n(t){var n=e.call(this,t)||this;n._icons=t.icons;var i=t.diagram;return n._diagram=i,n._selection=t.selection,n._isInitialized=!1,n._updatedParts=tt.NONE,n}return i(n,e),n.prototype.show=function(){return e.prototype.show.call(this),this.onShow(),this},n.prototype.onShow=function(){this._isInitialized||(this._isInitialized=!0,this.initLayout()),this.onSelectionChange(tt.NONE)},n.prototype.initLayout=function(){var t=this;this.addChild(this.layoutOrder),this.addChild(this.table),this._selection.on("change",(function(e){t.onSelectionChange(e)}));var e=function(){t.onLayerChange()},n=this._diagram,i=n.canvas;i?(this.state.isDisabled=!1,i.layer.on("change",e)):this.state.isDisabled=!0,n.on("set",(function(n){t.state.isDisabled=!1,n.layer.on("change",e)})),n.on("ready",(function(){t.onLayerChange()})),n.on("unset",(function(n){t.state.isDisabled=!0,t.onLayerChange(),n.layer.off("change",e)})),this.onLayerChange()},Object.defineProperty(n.prototype,"layoutOrder",{get:function(){var t;return null!==(t=this._layerOrder)&&void 0!==t?t:this._layerOrder=this.newLayoutOrder()},enumerable:!1,configurable:!0}),n.prototype.newLayoutOrder=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newTextLabel(),this.buttonBringToFront,this.buttonBringForward,this.buttonSendBackward,this.buttonSendToBack]})},n.prototype.newTextLabel=function(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})},Object.defineProperty(n.prototype,"buttonBringToFront",{get:function(){var t;return null!==(t=this._buttonBringToFront)&&void 0!==t?t:this._buttonBringToFront=this.newButtonBringToFront()},enumerable:!1,configurable:!0}),n.prototype.newButtonBringToFront=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_to_top},title:this.theme.getButtonBringToFrontTitle(),on:{active:function(){e._selection.bringToFront()}}})},Object.defineProperty(n.prototype,"buttonBringForward",{get:function(){var t;return null!==(t=this._buttonBringForward)&&void 0!==t?t:this._buttonBringForward=this.newButtonBringForward()},enumerable:!1,configurable:!0}),n.prototype.newButtonBringForward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonBringForwardTitle(),on:{active:function(){e._selection.bringForward()}}})},Object.defineProperty(n.prototype,"buttonSendBackward",{get:function(){var t;return null!==(t=this._buttonSendBackward)&&void 0!==t?t:this._buttonSendBackward=this.newButtonSendBackward()},enumerable:!1,configurable:!0}),n.prototype.newButtonSendBackward=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonSendBackwardTitle(),on:{active:function(){e._selection.sendBackward()}}})},Object.defineProperty(n.prototype,"buttonSendToBack",{get:function(){var t;return null!==(t=this._buttonSendToBack)&&void 0!==t?t:this._buttonSendToBack=this.newButtonSendToBack()},enumerable:!1,configurable:!0}),n.prototype.newButtonSendToBack=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_to_bottom},title:this.theme.getButtonSendToBackTitle(),on:{active:function(){e._selection.sendToBack()}}})},n.prototype.onSelectionChange=function(e){var n;this.isShown()?(e|=this._updatedParts,this._updatedParts=tt.NONE,e&tt.TREE?this.table.data.nodes=null===(n=this._diagram.layer)||void 0===n?void 0:n.children:e&tt.SELECTION?this.table.data.update():e&tt.PROPERTY_ID&&this.table.data.update(!0),this.layoutOrder.state.isEnabled=t.EShapeCapabilities.contains(this._selection.last(),t.EShapeCapability.ORDER_IN_LAYER)):this._updatedParts|=e},n.prototype.onLayerChange=function(){var t;this.table.data.nodes=null===(t=this._diagram.layer)||void 0===t?void 0:t.children},Object.defineProperty(n.prototype,"table",{get:function(){var t;return null!==(t=this._table)&&void 0!==t?t:this._table=this.newTable()},enumerable:!1,configurable:!0}),n.prototype.newTable=function(){var e=this;return new t.DTable({x:"padding",width:"padding",weight:1,columns:[{type:"TREE",editable:!0,getter:function(t){return ji(t)},setter:function(n,i,o){n.id!==o&&t.DControllers.getCommandController().push(new ft(e._selection,o,[n]))}}],data:new t.DTableDataTree({reverse:!0,toChildren:function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.CHILDREN)?e.children:null},selection:function(t){return new Wi(t,e._selection)}}),on:{keydown:function(n){t.UtilKeyboardEvent.isDeleteKey(n)&&(e._selection.delete(),n.preventDefault())}}})},n.prototype.getType=function(){return"EEditorTree"},n}(t.DLayoutVertical),Zi=function(e){function n(n){var i=e.call(this,n)||this,o=n.selection;i._selection=o,i._icons=n.icons,i._validator=n.validator;var r=n.diagram;return i._diagram=r,i.state.isDisabled=null==r.canvas,r.on("unset",(function(){i.list.data.clear(),i.state.isDisabled=!0})),r.on("set",(function(){i.state.isDisabled=!1})),i.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[i.newTextLabel(),i.buttonRevalidate]})),i.addChild(i.list),i}return i(n,e),n.prototype.newTextLabel=function(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})},Object.defineProperty(n.prototype,"buttonRevalidate",{get:function(){var t=this._buttonRevalidate;return null==t&&(t=this.newButtonRevalidate(),this._buttonRevalidate=t),t},enumerable:!1,configurable:!0}),n.prototype.newButtonRevalidate=function(){var e=this;return new t.DButtonAmbient({width:30,image:{source:this._icons.refresh},title:this.theme.getButtonRevalidateTitle(),on:{active:function(t){e.onButtonValidateActive(t)}}})},n.prototype.onButtonValidateActive=function(e){var n=this._validator;if(null!=n){var i=this._diagram.canvas;if(null!=i){var o=this.dialogProcessing;o.open(e);var r=this.list.data;try{var a=n(i);t.isArray(a)?(r.clearAndAddAll(a),o.resolve()):a.then((function(t){r.clearAndAddAll(t),o.resolve()}),(function(){r.clear(),o.reject()}))}catch(t){r.clear(),o.reject()}}}},Object.defineProperty(n.prototype,"list",{get:function(){var t=this._list;return null==t&&(t=this.newList(),this._list=t),t},enumerable:!1,configurable:!0}),n.prototype.newList=function(){var e=this;return new t.DList({width:"padding",weight:1,data:{toLabel:function(t){return t.message}},updater:{newItem:function(n){return new t.DListItem(n,{on:{select:function(t,n){e.onListItemDown(t,n)}}})}}})},n.prototype.onListItemDown=function(e,n){var i=e.shape;if(null!=i){var o=this._diagram.canvas,r=i.root.parent;if(null!=o&&null!=r){var a=this._selection,l=a.store();if(a.set(i)){a.focus();var u=a.store();t.DControllers.getCommandController().push(new _e(l,u,a))}else a.focus();o.layer.active!==r&&(o.layer.active=r)}else this.dialogError.open(n)}},Object.defineProperty(n.prototype,"dialogError",{get:function(){var t=this._dialogError;return null==t&&(t=this.newDialogError(),this._dialogError=t),t},enumerable:!1,configurable:!0}),n.prototype.newDialogError=function(){return new t.DDialogMessage({message:"No shapes found."})},Object.defineProperty(n.prototype,"dialogProcessing",{get:function(){var t=this._dialogProcessing;return null==t&&(t=this.newDialogProcessing(),this._dialogProcessing=t),t},enumerable:!1,configurable:!0}),n.prototype.newDialogProcessing=function(){return new t.DDialogProcessing({footer:{button:{ok:"OK",cancel:null}}})},n.prototype.getType=function(){return"EEditorValidation"},n}(t.DLayoutVertical),qi=function(){function t(){this._isSuspended=!1,this._active=null,this._activeParameter=null}return t.prototype.activate=function(t,e){var n=this._active,i=this._activeParameter;n===t&&i===e||(this._activeParameter=e,n!==t&&(n&&n.deactivate(),this._active=t,this._isSuspended||t.activate()))},t.prototype.deactivate=function(t,e){this._active===t&&this._activeParameter===e&&(this._active=null,this._activeParameter=null,t.deactivate())},t.prototype.suspend=function(){if(!this._isSuspended){this._isSuspended=!0;var t=this._active;t&&t.deactivate()}},t.prototype.resume=function(){if(this._isSuspended){this._isSuspended=!1;var t=this._active;t&&t.activate()}},t.prototype.isSuspended=function(){return this._isSuspended},t}(),Ji=function(t){function e(){var e=t.call(this)||this;return e._isActive=!1,e}return i(e,t),e.prototype.activate=function(){this._isActive||(this._isActive=!0,this.onActivate())},e.prototype.deactivate=function(){this._isActive&&(this._isActive=!1,this.onDeactivate())},e.prototype.onActivate=function(){},e.prototype.onDeactivate=function(){},e.prototype.isActive=function(){return this._isActive},e}(e.utils.EventEmitter),Qi=function(t){function n(){var n=t.call(this)||this;return n._size=new e.Point,n}return i(n,t),Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),n.prototype.update=function(){this.clear();var t=this._size,e=Math.min(0,t.x),n=Math.min(0,t.y),i=Math.abs(t.x),o=Math.abs(t.y);this.beginFill(2000880,.5),this.drawRect(e,n,i,o),this.endFill()},n}(e.Graphics);!function(t){t[t.NONE=0]="NONE",t[t.SELECT=1]="SELECT",t[t.TRANSLATE=2]="TRANSLATE",t[t.SCALE=3]="SCALE",t[t.ROTATE=4]="ROTATE"}(Me||(Me={}));var $i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(e.Container),to=function(e){function n(t){var n=e.call(this)||this;return n._modifier=t,n}return i(n,e),n.prototype.contains=function(e,n){var i=this._modifier,o=2*i.getAnchorSize(),r=.5*o,a=i.width,l=i.height,u=.5*a,s=.5*l,p=i.getAnchorRotationDistance(),h=2*i.getAnchorRotationSize();return 0-r<=e&&0-r<=n&&e<=0-r+o&&n<=0-r+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.TOP_LEFT),!0):a-r<=e&&0-r<=n&&e<=a-r+o&&n<=0-r+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.TOP_RIGHT),!0):0-r<=e&&l-r<=n&&e<=0-r+o&&n<=l-r+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.BOTTOM_LEFT),!0):a-r<=e&&l-r<=n&&e<=a-r+o&&n<=l-r+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.BOTTOM_RIGHT),!0):u-r<=e&&0-r<=n&&e<=u-r+o&&n<=0-r+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.TOP_CENTER),!0):a-r<=e&&s-r<=n&&e<=a-r+o&&n<=s-r+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.MIDDLE_RIGHT),!0):u-r<=e&&l-r<=n&&e<=u-r+o&&n<=l-r+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.BOTTOM_CENTER),!0):0-r<=e&&s-r<=n&&e<=0-r+o&&n<=s-r+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.MIDDLE_LEFT),!0):u-h<=e&&p-h<=n&&e<=u+h&&n<=p+h&&(i.setLastHitAnchor(t.ESnapperModifierAnchor.ROTATION),!0)},n}(e.Rectangle),eo=function(e){function n(n){var i=e.call(this)||this;return i.selected=!1,i.index=0,i._width=0,i._height=0,i._scaleBound=1,i._scaleBoundInverse=1,i._isAllowed=!0,i._lastHitAnchor=t.ESnapperModifierAnchor.NONE,null==n||!1!==n.editable?(i.cursor="grab",i.interactive=!0,i.hitArea=new to(i)):i.interactive=!1,i.group=!1,i._anchorBase=(new t.EShapeRectangle).attach(i),i._anchorsScale=[(new t.EShapeRectangle).attach(i),(new t.EShapeRectangle).attach(i),(new t.EShapeRectangle).attach(i),(new t.EShapeRectangle).attach(i),(new t.EShapeRectangle).attach(i),(new t.EShapeRectangle).attach(i),(new t.EShapeRectangle).attach(i),(new t.EShapeRectangle).attach(i)],i._anchorRotate=(new t.EShapeCircle).attach(i),i}return i(n,e),n.prototype.onPrerender=function(){var t=this.getParentScale(),e=this._scaleBound;.001<Math.abs(t-e)&&(this._scaleBound=t,this._scaleBoundInverse=1/t,this.update())},n.prototype.render=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this.onPrerender(),e.prototype.render.call(this,t))},n.prototype.getParentScale=function(){var t=this.parent;if(null!=t){var e=t.parent;if(null!=e)return e.scale.y}return 1},Object.defineProperty(n.prototype,"factor",{get:function(){return this._scaleBoundInverse},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),n.prototype.getLastHitAnchor=function(){return this._lastHitAnchor},n.prototype.setLastHitAnchor=function(t){var e=this._lastHitAnchor;return this._lastHitAnchor=t,e},n.prototype.getAnchorSize=function(){return 7*this._scaleBoundInverse},n.prototype.getAnchorRotationDistance=function(){return(0<=this._height?-18:18)*this._scaleBoundInverse},n.prototype.getAnchorRotationSize=function(){return 5*this._scaleBoundInverse},n.prototype.update=function(){var e=this.group?2027655:2000880,n=this._width,i=this._height,o=this._scaleBoundInverse,r=this.getAnchorSize(),a=n,l=i,u=.5*a,s=.5*l,p=this.getAnchorRotationDistance(),h=2*this.getAnchorRotationSize(),c=2*o,d=1.5*c,g=this._anchorBase;g.lock(t.EShapeLockPart.UPLOADED),g.fill.enable=!1,g.stroke.set(!0,e,.333,c,2),g.transform.position.set(.5*n,.5*i),g.size.set(n,i),g.unlock(t.EShapeLockPart.UPLOADED,!0);var f=this._anchorRotate;f.lock(t.EShapeLockPart.UPLOADED),f.stroke.enable=!1,f.fill.set(!0,e,1),f.size.set(h,h),f.transform.position.set(u,p),f.unlock(t.EShapeLockPart.UPLOADED,!0);for(var y=this._anchorsScale,v=0,b=y.length;v<b;++v){var m=y[v];m.lock(t.EShapeLockPart.UPLOADED),m.stroke.enable=!1,m.fill.set(!0,e,1),m.size.set(r,r)}for(y[0].transform.position.set(-d,-d),y[1].transform.position.set(+d+a,-d),y[2].transform.position.set(-d,+d+l),y[3].transform.position.set(+d+a,+d+l),y[4].transform.position.set(u,-d),y[5].transform.position.set(+d+a,s),y[6].transform.position.set(u,+d+l),y[7].transform.position.set(-d,s),v=0,b=y.length;v<b;++v)y[v].unlock(t.EShapeLockPart.UPLOADED,!0)},n.prototype.allow=function(){this._isAllowed=!0},n.prototype.isAllowed=function(){return this._isAllowed},n.prototype.disallow=function(){this._isAllowed=!1},n.prototype.destroy=function(){var t=this.parent;t&&t.removeChild(this)},n}(t.EShapeContainer),no=function(t){function n(){var n=t.call(this)||this;return n.tailVector=new e.Point,n.headVector=new e.Point,n}return i(n,t),n}(t.EShapeEditor),io=function(){function t(){}return t.prepare=function(t){var e=null;t.editor instanceof no?e=t.editor:(e=new no,t.editor=e);var n=e.tailVector,i=e.headVector,o=t.edge;o.tail.local.copyTo(n),o.head.local.copyTo(i);var r=t.transform.localTransform;r.applyInverse(n,n),r.applyInverse(i,i),Le.prepare(t)},t.finalize=function(t){Le.finalize(t)},t.apply=function(t,e){var n=t.editor;if(n instanceof no){var i=n.localTransform;n.internalTransformParentInverse.copyTo(i).append(e).append(n.internalTransform);var o=i.a,r=i.b,a=i.c,l=i.d,u=i.tx,s=i.ty,p=t.edge,h=p.tail,c=p.head,d=n.tailVector,g=d.x,f=d.y,y=o*g+a*f+u,v=r*g+l*f+s,b=n.headVector,m=b.x,_=b.y,S=o*m+a*_+u,w=r*m+l*_+s;p.lock(),h.local.set(y,v),c.local.set(S,w),p.unlock()}},t}(),oo=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE)?t.EShapeCapability.LINE:t.EShapeCapability.NONE},n}(Kt),ro=function(t){return t.x},ao=function(t){return t.x+.5*t.width},lo=function(t){return t.x+t.width},uo=function(t){return t.y},so=function(t){return t.y+.5*t.height},po=function(t){return t.y+t.height},ho=function(t){return t.width},co=function(t){return t.height},go=function(t){return 0},fo=function(t,e){return Math.min(t,e)},yo=function(t,e){return Math.max(t,e)},vo=function(t,e){return t+e},bo=function(t,e){return t},mo=function(t,e){return t/e},_o=function(t,e){e.x=t},So=function(t,e){e.y=t},wo=function(t,e,n,i){i.transform.position.x=t.x+e/n.x},To=function(t,e,n,i){i.transform.position.x=t.x},Eo=function(t,e,n,i){i.transform.position.x=t.x-e/n.x},Co=function(t,e,n,i){i.transform.position.y=t.y+e/n.y},Do=function(t,e,n,i){i.transform.position.y=t.y},Lo=function(t,e,n,i){i.transform.position.y=t.y-e/n.y},Ao=function(n){function r(i){var o=n.call(this)||this,r=i.diagram;o._diagram=r;var a=new eo(i.modifier);o._modifier=a;var l=new $i;return l.addChild(a),r.on("unset",(function(t){l.parent===t&&t.removeChild(l)})),o._modifierContainer=l,o._originGlobal=new e.Point,o._originLocal=new e.Point,o._rotationAxisGlobal=new e.Point,o._scale=new e.Point,o._scaleAxis0=new e.Point,o._scaleAxis1=new e.Point,o._scaleDet=1,o._scaleDetInverse=1,o._scaleTransform=new e.Matrix,o._scaleTransformInverse=new e.Matrix,o._scaleAnchor=t.ESnapperModifierAnchor.NONE,o._shapes=[],o._shapeBound=new e.Rectangle,o._shapeBoundRect=new e.Rectangle,o._alignPoint=new e.Point,o._alignRectangle=new e.Rectangle,o._shiftPoint1=new e.Point,o._shiftPoint2=new e.Point,o._transform=new e.Matrix,o._translateDelta=new e.Point,o._isUpdated=!1,o._updatedParts=tt.NONE,o._lockCount=0,o}return i(r,n),r.prototype.lock=function(){this._lockCount+=1,1===this._lockCount&&(this._isUpdated=!1,this._updatedParts=tt.NONE)},r.prototype.unlock=function(){this._lockCount-=1,0===this._lockCount&&this._isUpdated&&this.update(this._updatedParts)},r.prototype.update=function(e){var n=tt.ALL;null!=e&&(n=t.isNumber(e)?e:this.toParts(arguments)),this._lockCount<=0?(this.updateModifier(),this.emit("change",n,this)):(this._isUpdated=!0,this._updatedParts|=n)},r.prototype.toParts=function(e){if(t.isNumber(e))return e;for(var n=tt.NONE,i=0,o=e.length;i<o;++i)n|=tt[e[i]];return n},r.prototype.updateModifier=function(){var e=this._diagram,n=this._modifier;if(n.isAllowed()){var i=this._shapes,o=e.canvas,r=this._modifierContainer;if(null==o||i.length<=0)n.visible=!1,t.DApplications.update(e);else if(i.length<=1){if((T=i[0]).parent instanceof t.EShapeBase){T.updateTransform();var a=(v=T.transform.internalTransform).a,l=v.b,u=v.c,s=v.d,p=T.transform.pivot;n.position.set(a*p.x+u*p.y+v.tx,l*p.x+s*p.y+v.ty),(b=T.root.parent)?r.transform.position.copyFrom(b.transform.position):r.transform.position.set(0,0);var h=T.size.x*Math.sqrt(a*a+l*l),c=T.size.y*Math.sqrt(u*u+s*s);n.width=h,n.height=c,n.pivot.set(.5*h,.5*c);var d=Math.atan2(-u,s),g=Math.atan2(+l,a),f=.5*(g-d),y=.5*(d+g);n.rotation=y,n.skew.set(f,f)}else{var v;T.updateTransform(),a=(v=T.transform.internalTransform).a,l=v.b,u=v.c,s=v.d,p=T.transform.pivot,n.position.set(a*p.x+u*p.y+v.tx,l*p.x+s*p.y+v.ty),(b=T.root.parent)?r.transform.position.copyFrom(b.transform.position):r.transform.position.set(0,0),n.width=T.size.x,n.height=T.size.y,n.pivot.set(.5*T.size.x,.5*T.size.y),n.rotation=T.transform.rotation,n.skew.copyFrom(T.transform.skew)}n.visible=!0,n.group=t.EShapeCapabilities.contains(T,t.EShapeCapability.CHILDREN)&&0<T.children.length,r.parent!==o&&o.addChild(r),n.update(),t.DApplications.update(e)}else{var b,m=this._shapeBound,_=this._shapeBoundRect;i[0].getBoundsInternal(!1,m);for(var S=1,w=i.length;S<w;++S){var T;(T=i[S]).getBoundsInternal(!1,_),m.enlarge(_)}(b=i[0].root.parent)?r.transform.position.copyFrom(b.transform.position):r.transform.position.set(0,0),n.position.set(m.x,m.y),n.width=m.width,n.height=m.height,n.rotation=0,n.pivot.set(0,0),n.skew.set(0,0),n.visible=!0,n.group=!1,r.parent!==o&&o.addChild(r),n.update(),t.DApplications.update(e)}}else n.visible=!1,t.DApplications.update(e)},r.prototype.toggle=function(e){var n=this._shapes;if(n.length<=0){var i=e.root;i.selected=!0,n.push(i)}else{var o=n[0];if(q.isParent(e,o))o.selected=!1,t.EShapeCapabilities.contains(o,t.EShapeCapability.CHILDREN)?((h=q.toOfParent(e,o)).selected=!0,n[0]=h):n.splice(0,1);else if(o.parent===e.parent)e.selected?(e.selected=!1,n.splice(n.indexOf(e),1)):(e.selected=!0,n.push(e));else{var r=q.toSharedParent(o,e);if(o.parent===r)(h=q.toOfParent(e,r)).selected?(h.selected=!1,n.splice(n.indexOf(h),1)):(h.selected=!0,n.push(h));else{for(var a=0,l=0,u=n.length;l<u;++l){var s=n[l];s.selected=!1;var p=q.toOfParent(s,r);p.selected||(p.selected=!0,n[a]=p,a+=1)}var h;n.length=a,(h=q.toOfParent(e,r)).selected||(h.selected=!0,n.push(h))}}}this.update(tt.SELECTION)},r.prototype.addAll=function(t){var e=this._shapes,n=!1;if(0<e.length){var i=e[0];if(i.root!==i){var o=e.slice(0);e.length=0;for(var r=0,a=o.length;r<a;++r){var l=o[r];l.selected=!1;var u=l.root;u.selected||(u.selected=!0,e.push(u))}n=!0}}for(r=0,a=t.length;r<a;++r){var s=t[r];s.selected||(s.selected=!0,e.push(s),n=!0)}return n&&this.update(tt.SELECTION),n},r.prototype.clearAndAddAll=function(t){for(var e=this._shapes,n=0,i=e.length;n<i;++n)e[n].selected=!1;for(e.length=0,n=0,i=t.length;n<i;++n){var o=t[n];o.selected=!0,e.push(o)}return this.update(tt.SELECTION),!0},r.prototype.set=function(t){var e=this._shapes;if(1<e.length){for(var n=0,i=e.length;n<i;++n)e[n].selected=!1;return e.length=0,t.selected=!0,e.push(t),this.update(tt.SELECTION),!0}return 1===e.length?e[0]!==t&&(e[0].selected=!1,t.selected=!0,e[0]=t,this.update(tt.SELECTION),!0):(t.selected=!0,e.push(t),this.update(tt.SELECTION),!0)},r.prototype.get=function(){return this._shapes},r.prototype.first=function(){var t=this._shapes;return 0<t.length?t[0]:null},r.prototype.last=function(){var t=this._shapes;return 0<t.length?t[t.length-1]:null},r.prototype.swapLast=function(t,e){var n=this._shapes;if(0<n.length){var i=n[n.length-1];i===t&&(i.selected=!1,n[n.length-1]=e,e.selected=!0,this.update(tt.TREE|tt.SELECTION))}},r.prototype.remove=function(t){var e=this._shapes,n=e.indexOf(t);0<=n&&(t.selected=!1,e.splice(n,1),this.update(tt.TREE|tt.SELECTION))},r.prototype.contains=function(t){return t.selected},r.prototype.size=function(){return this._shapes.length},r.prototype.isEmpty=function(){return this._shapes.length<=0},r.prototype.clear=function(){var t=this._shapes;if(0<t.length){for(var e=0,n=t.length;e<n;++e)t[e].selected=!1;return this._shapes.length=0,this.update(tt.SELECTION),!0}return!1},r.prototype.focus=function(){if(this.isEmpty())return!1;var e=this._diagram,n=e.canvas;if(null==n)return!1;var i=n.parent;if(!(i instanceof t.DBase))return!1;var o=n.width,r=n.height,a=i.padding,l=a.getLeft(),u=a.getTop(),s=a.getRight(),p=a.getBottom(),h=l+.5*(Math.max(0,i.width-l-s)-o),c=u+.5*(Math.max(0,i.height-u-p)-r),d=this._modifier,g=this._alignPoint;g.set(.5*d.width,.5*d.height),d.toGlobal(g,g,!1),i.toLocal(g,void 0,g,!1);var f=n.position,y=.5*o-(g.x-f.x),v=.5*r-(g.y-f.y);return e.view.moveTo(h+y,c+v),!0},r.prototype.prepare=function(){var e=this._shapes;if(0<e.length){for(var n=0,i=e.length;n<i;++n){var o=e[n];o instanceof t.EShapeConnectorLine?io.prepare(o):Le.prepare(o)}return!0}return!1},r.prototype.prepareTranslateSnap=function(){var e=this._diagram;e instanceof t.DDiagramEditor&&e.snapper.prepareForTranslate(this._modifier)},r.prototype.prepareRotateSnap=function(){var e=this._diagram;e instanceof t.DDiagramEditor&&e.snapper.prepareForRotate(this._modifier)},r.prototype.prepareScaleSnap=function(){var e=this._diagram;e instanceof t.DDiagramEditor&&e.snapper.prepareForScale(this._modifier,this._scaleAnchor)},r.prototype.prepareTranslate=function(){return this.prepare()},r.prototype.prepareRotate=function(t){if(this.prepare()){var e=this._originGlobal,n=this._originLocal,i=this._modifier;if(n.set(.5*i.width,.5*i.height),e.copyFrom(n),i.updateTransform(),i.transform.localTransform.apply(n,n),i.transform.worldTransform.apply(e,e),null==t)return!0;var o=this._rotationAxisGlobal,r=t.x-e.x,a=t.y-e.y,l=Math.sqrt(r*r+a*a);if(.001<l){var u=1/l;return o.set(r*u,a*u),!0}return this.finalize(),!1}return!1},r.prototype.prepareScale=function(t){if(this.prepare()){if(this.prepareScaleOriginAndAxes(t)){var e=this._modifier,n=e.rotation,i=e.skew,o=this._originLocal,r=this._scaleTransform;return r.setTransform(0,0,0,0,1,1,n,i.x,i.y).invert(),r.apply(o,o),r.translate(-o.x,-o.y),r.copyTo(this._scaleTransformInverse).invert(),!0}return this.finalize(),!1}return!1},r.prototype.prepareScaleOriginAndAxes=function(e){var n=this._modifier;n.updateTransform();var i=n.transform.localTransform,o=n.transform.worldTransform,r=n.width,a=n.height,l=this._originGlobal,u=this._originLocal;switch(this._scaleAnchor=e,e){case t.ESnapperModifierAnchor.TOP_LEFT:return u.set(r,a),l.copyFrom(u),i.apply(u,u),o.apply(l,l),this.prepareScaleAxes(0,a,r,0,l);case t.ESnapperModifierAnchor.TOP_CENTER:return u.set(.5*r,a),l.copyFrom(u),i.apply(u,u),o.apply(l,l),this.prepareScaleAxis(.5*r,0,l);case t.ESnapperModifierAnchor.TOP_RIGHT:return u.set(0,a),l.copyFrom(u),i.apply(u,u),o.apply(l,l),this.prepareScaleAxes(r,a,0,0,l);case t.ESnapperModifierAnchor.MIDDLE_LEFT:return u.set(r,.5*a),l.copyFrom(u),i.apply(u,u),o.apply(l,l),this.prepareScaleAxis(0,.5*a,l);case t.ESnapperModifierAnchor.NONE:return u.set(.5*r,.5*a),l.copyFrom(u),i.apply(u,u),o.apply(l,l),.001<Math.abs(r)&&(this._scaleAxis0.x=r,.001<Math.abs(a)&&(this._scaleAxis0.y=a,!0));case t.ESnapperModifierAnchor.MIDDLE_RIGHT:return u.set(0,.5*a),l.copyFrom(u),i.apply(u,u),o.apply(l,l),this.prepareScaleAxis(r,.5*a,l);case t.ESnapperModifierAnchor.BOTTOM_LEFT:return u.set(r,0),l.copyFrom(u),i.apply(u,u),o.apply(l,l),this.prepareScaleAxes(0,0,r,a,l);case t.ESnapperModifierAnchor.BOTTOM_CENTER:return u.set(.5*r,0),l.copyFrom(u),i.apply(u,u),o.apply(l,l),this.prepareScaleAxis(.5*r,a,l);case t.ESnapperModifierAnchor.BOTTOM_RIGHT:return u.set(0,0),l.copyFrom(u),i.apply(u,u),o.apply(l,l),this.prepareScaleAxes(r,0,0,a,l)}return!1},r.prototype.prepareScaleAxis=function(t,e,n){var i=this._scaleAxis0;i.set(t,e),this._modifier.toGlobal(i,i,!0),i.x-=n.x,i.y-=n.y;var o=Math.sqrt(i.x*i.x+i.y*i.y);if(.001<o){var r=1/o;return i.x*=r,i.y*=r,this._scaleDet=o,this._scaleDetInverse=r,!0}return!1},r.prototype.prepareScaleAxes=function(t,e,n,i,o){var r=this._modifier.transform.worldTransform,a=this._scaleAxis0;a.set(t,e),r.apply(a,a),a.x-=o.x,a.y-=o.y;var l=this._scaleAxis1;l.set(n,i),r.apply(l,l),l.x-=o.x,l.y-=o.y;var u=a.x*l.y-a.y*l.x;return.001<Math.abs(u)&&(this._scaleDet=u,this._scaleDetInverse=1/u,!0)},r.prototype.finalize=function(){var e=this._shapes;if(0<e.length)for(var n=0,i=e.length;n<i;++n){var o=e[n];o instanceof t.EShapeConnectorLine?io.finalize(o):Le.finalize(o)}},r.prototype.saveForTranslate=function(){t.DControllers.getCommandController().push(new Vt(this))},r.prototype.saveForRotate=function(){t.DControllers.getCommandController().push(new Pt(this))},r.prototype.saveForScale=function(){t.DControllers.getCommandController().push(new nt(this))},r.prototype.alignLeft=function(){this.align(ro,ho,fo,bo,_o,wo)},r.prototype.alignCenter=function(){this.align(ao,go,vo,mo,_o,To)},r.prototype.alignRight=function(){this.align(lo,ho,yo,bo,_o,Eo)},r.prototype.alignTop=function(){this.align(uo,co,fo,bo,So,Co)},r.prototype.alignMiddle=function(){this.align(so,go,vo,mo,So,Do)},r.prototype.alignBottom=function(){this.align(po,co,yo,bo,So,Lo)},r.prototype.align=function(e,n,i,o,r,a){var l=this._diagram.canvas,u=this._shapes,s=u.length;if(l&&1<=s){var p=u[0].parent;if(p){for(var h=this._alignPoint,c=this._alignRectangle,d=!0,g=0,f=[],y=0;y<s;++y){var v=u[y];t.EShapeCapabilities.contains(v,t.EShapeCapability.POSITION)&&(v.getBounds(!1,c),d?(d=!1,g=e(c)):g=i(g,e(c)),f.push([n(c),v]))}var b=f.length;if(1<=b){b<=1&&(g=e(l.getBounds(!1,c))),g=o(g,b),h.set(0,0),r(g,h),p.toLocal(h,void 0,h);var m=l.scale;for(y=0;y<b;++y){var _=f[y];a(h,.5*_[0],m,_[1])}this.update(tt.PROPERTY)}}}},r.prototype.distributeHorizontally=function(){this.distribute(ao,ho,_o,wo)},r.prototype.distributeVertically=function(){this.distribute(so,co,So,Co)},r.prototype.distribute=function(e,n,i,o){var r=this._diagram.canvas,a=this._shapes,l=a.length;if(r&&1<=l){var u=a[0].parent;if(u){for(var s=this._alignPoint,p=this._alignRectangle,h=0,c=[],d=0;d<l;++d){var g=a[d];if(t.EShapeCapabilities.contains(g,t.EShapeCapability.POSITION)){g.getBounds(!1,p);var f=n(p);h+=f,c.push([e(p),f,g])}}var y=c.length;if(2<y){c.sort((function(t,e){return t[0]-e[0]}));var v=c[0],b=c[y-1],m=(b[0]-v[0]-(h-.5*b[1]-.5*v[1]))/(y-1);s.set(0,0),i(v[0],s),u.toLocal(s,void 0,s);for(var _=.5*v[1]+m,S=r.scale,w=(d=1,y-1);d<w;++d)g=(T=c[d])[2],o(s,_+=.5*T[1],S,g),_+=.5*T[1]+m;this.update(tt.PROPERTY)}else if(1===y){s.set(0,0),i(e(r.getBounds(!1,p)),s),u.toLocal(s,void 0,s);var T=c[0];o(s,0,r.scale,T[2]),this.update(tt.PROPERTY)}}}},r.prototype.replace=function(e){var n=this._shapes;if(0<n.length){var i=n[0].parent;i&&t.DControllers.getCommandController().push(new me(i,e,this))}},r.prototype.group=function(){var e=this._shapes;if(2<=e.length){var n=e[0].parent;n&&t.DControllers.getCommandController().push(new $(n,this))}},r.prototype.hasUngroupable=function(t){for(var e=t.length-1;0<=e;--e)if(this.isUngroupable(t[e]))return!0;return!1},r.prototype.isUngroupable=function(e){return e instanceof t.EShapeGroup&&t.EShapeCapabilities.contains(e,t.EShapeCapability.CHILDREN)&&t.EShapeCapabilities.contains(e,t.EShapeCapability.UNGROUPING)},r.prototype.ungroup=function(){var e=this._shapes;if(this.hasUngroupable(e)){var n=e[0].parent;n&&t.DControllers.getCommandController().push(new Ae(n,this))}},r.prototype.setFill=function(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new ct(this,[e,n]))},r.prototype.setFillEnabled=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new dt(this,e))},r.prototype.setStroke=function(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new Ut(this,[e,n]))},r.prototype.setStrokeWidth=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Zt(this,e))},r.prototype.setStrokeAlign=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Gt(this,e))},r.prototype.setStrokeSide=function(e,n){0<this._shapes.length&&(n?t.DControllers.getCommandController().push(new Wt(this,e)):t.DControllers.getCommandController().push(new Xt(this,e)))},r.prototype.setStrokeStyle=function(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new Kt(this,e,n))},r.prototype.setStrokeEnabled=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Yt(this,e))},r.prototype.setLineStyle=function(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new oo(this,e,n))},r.prototype.setLineTailType=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Bt(this,e))},r.prototype.setLineTailSizeX=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Lt(this,e))},r.prototype.setLineTailSizeY=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new At(this,e))},r.prototype.setLineTailColor=function(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new Ct(this,[e,n]))},r.prototype.setLineTailMargin=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Dt(this,e))},r.prototype.setLineHeadType=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Et(this,e))},r.prototype.setLineHeadSizeX=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new wt(this,e))},r.prototype.setLineHeadSizeY=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Tt(this,e))},r.prototype.setLineHeadColor=function(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new _t(this,[e,n]))},r.prototype.setLineHeadMargin=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new St(this,e))},r.prototype.setPointsStyle=function(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new Ot(this,e,n))},r.prototype.setText=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new fe(this,e))},r.prototype.setTextColor=function(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new $t(this,[e,n]))},r.prototype.setTextFamily=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ee(this,e))},r.prototype.setTextSize=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new he(this,e))},r.prototype.setTextSizeDelta=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new pe(this,e))},r.prototype.setTextWeight=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ye(this,e))},r.prototype.setTextStyle=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ge(this,e))},r.prototype.setTextAlignHorizontal=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new qt(this,e))},r.prototype.setTextAlignVertical=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Jt(this,e))},r.prototype.setTextPaddingHorizontal=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ue(this,e))},r.prototype.setTextPaddingVertical=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new se(this,e))},r.prototype.setTextOffsetHorizontal=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ie(this,e))},r.prototype.setTextOffsetVertical=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new oe(this,e))},r.prototype.setTextOutlineColor=function(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new re(this,[e,n]))},r.prototype.setTextOutlineWidth=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new le(this,e))},r.prototype.setTextOutlineEnabled=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ae(this,e))},r.prototype.setTextClipping=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Qt(this,e))},r.prototype.setTextFitting=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ne(this,e))},r.prototype.setTextSpacingHorizontal=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ce(this,e))},r.prototype.setTextSpacingVertical=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new de(this,e))},r.prototype.setTextDirection=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new te(this,e))},r.prototype.setInteractive=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new mt(this,e))},r.prototype.setFocusable=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new gt(this,e))},r.prototype.setShortcut=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Ft(this,e))},r.prototype.setTitle=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ve(this,e))},r.prototype.setCursor=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new st(this,e))},r.prototype.setRadius=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Mt(this,e))},r.prototype.setCorner=function(e,n){0<this._shapes.length&&(n?t.DControllers.getCommandController().push(new lt(this,e)):t.DControllers.getCommandController().push(new at(this,e)))},r.prototype.setImage=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new bt(this,e,void 0))},r.prototype.setGradient=function(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new bt(this,e,n))},r.prototype.fitToImage=function(){0<this._shapes.length&&t.DControllers.getCommandController().push(new vt(this))},r.prototype.clearImage=function(){0<this._shapes.length&&t.DControllers.getCommandController().push(new yt(this))},r.prototype.bringToFront=function(){var e=this._shapes;if(0<e.length){var n=e[0].parent;if(n){for(var i=n.children,o=i.length,r=[],a=o-1;0<=a;--a){var l=i[a];l.selected?(l.index=o+a,r.push(a)):l.index=a}i.sort(q.COMPARATOR_INDEX);for(var u=!1,s=(a=0,r.length);a<s;++a)o-1-a!==r[a]&&(u=!0);return u&&(n.toDirty(),t.DControllers.getCommandController().push(new Te(r,n,this)),this.update(tt.TREE)),!0}}return!1},r.prototype.bringForward=function(){var e=this._shapes;if(0<e.length){var n=e[0].parent;if(n){for(var i=!1,o=n.children,r=[],a=null,l=o.length-1;0<=l;--l){var u=o[l];u.selected?a&&(o[l]=o[l+1],o[l+1]=u,r.push(l),i=!0):a=u}return i&&(n.toDirty(),t.DControllers.getCommandController().push(new Se(r,n,this)),this.update(tt.TREE)),i}}return!1},r.prototype.sendBackward=function(){var e=this._shapes;if(0<e.length){var n=e[0].parent;if(n){for(var i=!1,o=n.children,r=[],a=null,l=0,u=o.length;l<u;++l){var s=o[l];s.selected?a&&(o[l]=o[l-1],o[l-1]=s,r.push(l),i=!0):a=s}return i&&(n.toDirty(),t.DControllers.getCommandController().push(new Ee(r,n,this)),this.update(tt.TREE)),i}}return!1},r.prototype.sendToBack=function(){var e=this._shapes;if(0<e.length){var n=e[0].parent;if(n){for(var i=n.children,o=[],r=i.length,a=0;a<r;++a){var l=i[a];l.selected?(l.index=a-r,o.push(a)):l.index=a}i.sort(q.COMPARATOR_INDEX);var u=!1;for(a=0;a<o.length;++a)a!==o[a]&&(u=!0);return u&&(n.toDirty(),t.DControllers.getCommandController().push(new De(o,n,this)),this.update(tt.TREE)),!0}}return!1},r.prototype.serialize=function(){var e=this._diagram,n=e.canvas;if(null==n)return null;var i=new t.EShapeResourceManagerSerialization,o=this._shapes;if(0<o.length){var r=o[0].root;if(null!=r){var a=r.parent;a instanceof t.DDiagramLayer&&(a.addUuid(i),a.updateUuid(i))}}for(var l=new Set,u=0,s=o.length;u<s;++u)l.add(o[u]);var p=[];for(u=0,s=o.length;u<s;++u){var h=o[u],c=h.serialize(i);if(c[16]=0,h instanceof t.EShapeConnectorLine){var d=c[29];d&t.EShapeCapability.LINE_TAIL&&(l.has(h.edge.tail.acceptor.shape)||(d&=~t.EShapeCapability.LINE_TAIL)),d&t.EShapeCapability.LINE_HEAD&&(l.has(h.edge.head.acceptor.shape)||(d&=~t.EShapeCapability.LINE_HEAD)),c[29]=d}p.push(c)}var g={version:t.DDiagramSerializedVersion,name:n.name,label:n.label,width:n.width,height:n.height,summary:n.summary,description:n.description,resources:i.resources,data:i.data,pieces:i.pieces,items:p,layers:[[e instanceof t.DDiagramEditor?e.theme.getBaseLayerLabel():"Base Layer"]]};return JSON.stringify(g)},r.prototype.deserialize=function(e){var n=this,i=this._diagram,o=i.layer;if(null!=o){var r=t.DDiagrams.parse(e);null!=r&&t.DDiagrams.toPieceData(i.controller,r.pieces,t.EShapeResourceManagerDeserializationMode.EDITOR).then((function(t){n.deserialize_(o,r,t)}))}},r.prototype.deserialize_=function(e,n,i){var o=this,r=new t.EShapeResourceManagerDeserialization(n,n.pieces,i,t.EShapeResourceManagerDeserializationMode.EDITOR,0),a=t.deserializeAll(n.items,r);a&&a.then((function(n){for(var i=o.calcShift(n,e),r=n.length,a=e.children,l=0;l<r;++l){var u=n[l];u.parent=e,u.uploaded=void 0,a.push(u)}for(e.onChildTransformChange(),e.toDirty(),l=0;l<r;++l)n[l].onAttach();o.shift(n,i),t.DControllers.getCommandController().push(new F(n,e,o,!0))}))},r.prototype.calcShift=function(t,e){if(t.length<=0)return null;var n=this._shiftPoint1,i=this._shiftPoint2,o=t[0];o.updateTransform();var r=o.transform;n.copyFrom(r.pivot),r.worldTransform.apply(n,n),e.transform.worldTransform.apply(n,n);for(var a=n.x,l=n.y,u=0;;){if(n.set(a+u,l+u),null==e.hitTestBBox(n,(function(t){if(t.type===o.type){t.updateTransform();var e=t.transform;i.copyFrom(e.pivot),e.worldTransform.apply(i,i);var n=i.x-(a+u),r=i.y-(l+u);return Math.abs(n)<=.1&&Math.abs(r)<=.1}return!1})))return n.set(a+u,l+u),e.toLocal(n,void 0,n),i.set(n.x-r.position.x,n.y-r.position.y),i;u+=10}},r.prototype.shift=function(e,n){if(!(e.length<=0||null==n))for(var i=n.x,o=n.y,r=0,a=e.length;r<a;++r){var l=e[r];if(t.EShapeCapabilities.contains(l,t.EShapeCapability.POSITION)){var u=l.transform.position;u.set(u.x+i,u.y+o)}else if(l instanceof t.EShapeConnectorLine){var s=l.edge,p=s.head,h=s.tail;if(null==p.acceptor.shape&&null==h.acceptor.shape){s.lock();var c=p.local;c.set(c.x+i,c.y+o);var d=h.local;d.set(d.x+i,d.y+o),s.unlock()}}}},r.prototype.setId=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ft(this,e))},r.prototype.addActionValue=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new R(e,this))},r.prototype.replaceActionValue=function(e,n,i){0<this._shapes.length&&t.DControllers.getCommandController().push(new M(e,n,this,i))},r.prototype.removeActionValue=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new V(e,this))},r.prototype.bringActionValueForward=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new k(e,this))},r.prototype.sendActionValueBackward=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new N(e,this))},r.prototype.addDataValue=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Y(e,this))},r.prototype.replaceDataValue=function(e,n,i){0<this._shapes.length&&t.DControllers.getCommandController().push(new K(e,n,this,i))},r.prototype.removeDataValue=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new W(e,this))},r.prototype.bringDataValueForward=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new X(e,this))},r.prototype.sendDataValueBackward=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Z(e,this))},r.prototype.addDataMappingValue=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new j(e,this))},r.prototype.replaceDataMappingValue=function(e,n,i){0<this._shapes.length&&t.DControllers.getCommandController().push(new G(e,n,this,i))},r.prototype.removeDataMappingValue=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new H(e,this))},r.prototype.bringDataMappingValueForward=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new z(e,this))},r.prototype.sendDataMappingValueBackward=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new U(e,this))},r.prototype.setPositionX=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Rt(this,e))},r.prototype.setPositionY=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new kt(this,e))},r.prototype.setPositionLeft=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new It(this,e))},r.prototype.setPositionTop=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new xt(this,e))},r.prototype.setSizeX=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new jt(this,e))},r.prototype.setSizeY=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new zt(this,e))},r.prototype.setRotation=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Nt(this,e))},r.prototype.setSkew=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Ht(this,e))},r.prototype.toInternalVector=function(t,e){var n=this._modifier;n.updateTransform();var i=n.parent.worldTransform,o=i.a,r=i.b,a=i.c,l=i.d,u=1/(o*l-a*r);return e.set((l*t.x-a*t.y)*u,(o*t.y-r*t.x)*u),e},r.prototype.translate=function(e,n,i){var o=this._shapes;if(0<o.length){var r=this._translateDelta;if(r.set(e,n),this.toInternalVector(r,r),i){var a=this._diagram;a instanceof t.DDiagramEditor&&a.snapper.toTranslationSnapped(r,r)}for(var l=this._transform.set(1,0,0,1,r.x,r.y),u=0,s=o.length;u<s;++u){var p=o[u];if(p instanceof t.EShapeConnectorLine){var h=p.edge;null==h.tail.acceptor.shape&&null==h.head.acceptor.shape&&io.apply(p,l)}else{var c=t.EShapeCapability.NONE;t.EShapeCapabilities.contains(p,t.EShapeCapability.POSITION)&&(c|=t.EShapeCapability.POSITION),c!==t.EShapeCapability.NONE&&Le.apply(p,l,c)}}this.update(tt.PROPERTY)}},r.prototype.rotateTo=function(e,n){var i=this._rotationAxisGlobal,o=this._originGlobal,r=e.x-o.x,a=e.y-o.y,l=Math.sqrt(r*r+a*a);if(.001<l){var u=1/l,s=r*u,p=a*u,h=Math.max(-1,Math.min(1,i.x*s+i.y*p)),c=0<=i.x*p-i.y*s?+Math.acos(h):-Math.acos(h);if(n){var d=this._diagram;if(d instanceof t.DDiagramEditor){var g=this._modifier.rotation;c=d.snapper.toRotationSnapped(g,c)}}this.rotate(c)}},r.prototype.rotate=function(e){var n=this._shapes;if(0<n.length){for(var i=this._originLocal,o=this._transform.identity().translate(-i.x,-i.y).rotate(e).translate(+i.x,+i.y),r=0,a=n.length;r<a;++r){var l=n[r];if(l instanceof t.EShapeConnectorLine){var u=l.edge;null==u.tail.acceptor.shape&&null==u.head.acceptor.shape&&io.apply(l,o)}else{var s=t.EShapeCapability.NONE;t.EShapeCapabilities.contains(l,t.EShapeCapability.POSITION)&&(s|=t.EShapeCapability.POSITION),t.EShapeCapabilities.contains(l,t.EShapeCapability.ROTATION)&&(s|=t.EShapeCapability.ROTATION),s!==t.EShapeCapability.NONE&&Le.apply(l,o,s)}}this.update(tt.PROPERTY)}},r.prototype.getScale=function(e,n,i,o,r){switch(i){case t.ESnapperModifierAnchor.TOP_LEFT:this.getScaleXY(e,n,o,r);break;case t.ESnapperModifierAnchor.TOP_CENTER:this.getScaleY(e,n,o,r);break;case t.ESnapperModifierAnchor.TOP_RIGHT:this.getScaleXY(e,n,o,r);break;case t.ESnapperModifierAnchor.MIDDLE_LEFT:this.getScaleX(e,n,o,r);break;case t.ESnapperModifierAnchor.NONE:var a=this._scaleAxis0,l=a.x,u=a.y,s=(l+e)/l,p=(u+n)/u;o?r.x=r.y=Math.max(s,p):r.set(s,p);break;case t.ESnapperModifierAnchor.MIDDLE_RIGHT:this.getScaleX(e,n,o,r);break;case t.ESnapperModifierAnchor.BOTTOM_LEFT:this.getScaleXY(e,n,o,r);break;case t.ESnapperModifierAnchor.BOTTOM_CENTER:this.getScaleY(e,n,o,r);break;case t.ESnapperModifierAnchor.BOTTOM_RIGHT:this.getScaleXY(e,n,o,r)}},r.prototype.getScaleX=function(t,e,n,i){var o=this.calcScale(t,e);n?i.set(o,o):i.set(o,1)},r.prototype.getScaleY=function(t,e,n,i){var o=this.calcScale(t,e);n?i.set(o,o):i.set(1,o)},r.prototype.calcScale=function(t,e){var n=this._scaleAxis0,i=n.x*t+n.y*e;return(this._scaleDet+i)*this._scaleDetInverse},r.prototype.getScaleXY=function(t,e,n,i){var o=this._scaleAxis0,r=o.x,a=o.y,l=this._scaleAxis1,u=l.x,s=l.y,p=r+u+t,h=a+s+e,c=this._scaleDetInverse,d=(+s*p-u*h)*c,g=(-a*p+r*h)*c;this.setScale(d,g,n,i)},r.prototype.setScale=function(t,e,n,i){if(n)if(0<=t)if(0<=e){var o=Math.max(t,e);i.set(o,o)}else o=Math.max(t,-e),i.set(o,-o);else 0<=e?(o=Math.max(-t,e),i.set(-o,o)):(o=Math.min(t,e),i.set(o,o));else i.set(t,e);return i},r.prototype.makeScaleTransform=function(t,e){return this._scaleTransform.copyTo(e).scale(t.x,t.y).prepend(this._scaleTransformInverse)},r.prototype.scale=function(e,n,i,o){var r=this._shapes;if(0<r.length){var a=this._scale,l=this._scaleAnchor;this.getScale(e,n,l,i,a);var u=this._transform;if(this.makeScaleTransform(a,u),o){var s=this._diagram;s instanceof t.DDiagramEditor&&s.snapper.toScaleSnapped(u,l,i,a)&&this.makeScaleTransform(a,u)}for(var p=0,h=r.length;p<h;++p){var c=r[p];if(c instanceof t.EShapeConnectorLine){var d=c.edge;null==d.tail.acceptor.shape&&null==d.head.acceptor.shape&&io.apply(c,u)}else{var g=t.EShapeCapability.NONE;t.EShapeCapabilities.contains(c,t.EShapeCapability.POSITION)&&(g|=t.EShapeCapability.POSITION),t.EShapeCapabilities.contains(c,t.EShapeCapability.WIDTH)&&(g|=t.EShapeCapability.WIDTH),t.EShapeCapabilities.contains(c,t.EShapeCapability.HEIGHT)&&(g|=t.EShapeCapability.HEIGHT),t.EShapeCapabilities.contains(c,t.EShapeCapability.ROTATION)&&(g|=t.EShapeCapability.ROTATION),t.EShapeCapabilities.contains(c,t.EShapeCapability.SKEW)&&(g|=t.EShapeCapability.SKEW),g!==t.EShapeCapability.NONE&&Le.apply(c,u,g)}}this.update(tt.PROPERTY)}},r.prototype.delete=function(e){var n=this._shapes;if(0<n.length){var i=n[0].parent;if(i){if(!1!==e){var o=J.delete(i,n,!0);if(o){var r=q.toIndices(o);t.DControllers.getCommandController().push(new Q(o,r,i,this,!0))}}else J.delete(i,n,!1);this.update(tt.TREE|tt.SELECTION)}}},r.prototype.createChildren=function(e){this.lock();for(var n=[],i=this._shapes,r=0,a=i.length;r<a;++r){var l=i[r],u=e(l);u&&n.push(new F(u,l,this,!1))}0<n.length&&(t.DControllers.getCommandController().push(new o(n,this)),this.update(tt.TREE)),this.unlock()},r.prototype.deleteChildren=function(e){this.lock();for(var n=[],i=this._shapes,r=0,a=i.length;r<a;++r){var l=i[r],u=e(l);if(u){for(var s=0,p=u.length;s<p;++s)u[s].selected=!0;var h=J.delete(l,void 0,!0);if(h){var c=q.toIndices(h);n.push(new Q(h,c,l,this,!1))}}}0<n.length&&(t.DControllers.getCommandController().push(new o(n,this)),this.update(tt.TREE)),this.unlock()},r.prototype.lockCapability=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ot(this,e))},r.prototype.unlockCapability=function(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new rt(this,e))},r.prototype.store=function(){return this._shapes.slice(0)},r.prototype.restore=function(t){for(var e=this._shapes,n=0,i=e.length;n<i;++n)e[n].selected=!1;for(e.length=0,n=0,i=t.length;n<i;++n){var o=t[n];o.selected=!0,e.push(o)}this.update(tt.SELECTION)},Object.defineProperty(r.prototype,"modifier",{get:function(){return this._modifier},enumerable:!1,configurable:!0}),r}(e.utils.EventEmitter),Bo=function(){function t(){}return t.isShapeIn=function(t,n){var i,o=t.getBounds(!1,null!==(i=this._work)&&void 0!==i?i:this._work=new e.Rectangle),r=o.x,a=o.y,l=o.width,u=o.height;return n.contains(r,a)&&n.contains(r+l,a)&&n.contains(r,a+u)&&n.contains(r+l,a+u)},t.findShapes=function(t,e,n){for(var i=t.children,o=0,r=i.length;o<r;++o){var a=i[o];this.isShapeIn(a,e)&&n.push(a)}},t}(),Oo=function(){function t(){}return t.execute=function(n,i,o){var r,a,l=null!==(r=t.OFFSETS)&&void 0!==r?r:t.OFFSETS=this.newOffsets(),u=null!==(a=t.WORK)&&void 0!==a?a:t.WORK=new e.Point,s=n.x,p=n.y;if(o){for(var h=0,c=l.length;h<c;h+=1)if(u.set(s+l[h],p+l[h+1]),null!=(d=o.hitTest(u,i)))return d}else for(h=0,c=l.length;h<c;h+=1){var d;if(u.set(s+l[h],p+l[h+1]),null!=(d=i.hitTest(u)))return d}return null},t.newOffsets=function(){return[0,0,-1,-1,1,-1,1,1,-1,1,0,-2,2,0,0,-2,-2,0,-2,-2,2,-2,2,2,-2,2,0,-4,4,0,0,-4,-4,0]},t}(),Po=function(n){function o(t){var i=n.call(this)||this;i._selection=new Ao(function(t){var e=t.selection;return{diagram:t.diagram,modifier:e&&e.modifier}}(t)),i._area=new Qi,i._diagram=t.diagram,i._applicationLayer=null,i._onDownPoint=new e.Point,i._onMovePoint=new e.Point,i._onUpPoint=new e.Point,i._areaRect=new e.Rectangle,i._mode=0,i._isFirstMove=!1,i._childSelectTime=-1,i._childSelectChild=null;var o=t.allow;return o?(i._isTransformationAllowed=!1!==o.transformation,i._isDeletionAllowed=!1!==o.deletion):(i._isTransformationAllowed=!0,i._isDeletionAllowed=!0),i._onDownBound=function(t){i.onDown(t)},i._onMoveBound=function(t){i.onMove(t)},i._onUpBound=function(t){i.onUp(t)},i._onKeydownBound=function(t){i.onKeydown(t)},i._onKeyupBound=function(t){i.onKeyup(t)},i._onDblClickBound=function(t){i.onDblClick(t)},i}return i(o,n),Object.defineProperty(o.prototype,"selection",{get:function(){return this._selection},enumerable:!1,configurable:!0}),o.prototype.onActivate=function(){var e=this._diagram;e.on(t.UtilPointerEvent.down,this._onDownBound),e.on("dblclick",this._onDblClickBound),e.on("keydown",this._onKeydownBound),e.on("keyup",this._onKeyupBound)},o.prototype.onDeactivate=function(){var e=this._diagram;e.off(t.UtilPointerEvent.down,this._onDownBound),e.off("dblclick",this._onDblClickBound),e.off("keydown",this._onKeydownBound),e.off("keyup",this._onKeyupBound)},o.prototype.onDown=function(e){var n=e.data.originalEvent;if(!n.altKey){var i=this._diagram,o=i.canvas,r=i.layer;if(o&&r){var a=n.ctrlKey||n.shiftKey;if(1===this._mode)return this._mode=0,void this.onSelectEnd(o,r,a);var l=e.data.global,u=this._onDownPoint;u.copyFrom(l);var s=this._selection,p=s.modifier,h=this.hitTest(l,p,r),c=t.DControllers.getCommandController();if(h instanceof t.EShapeBase){if(a){var d=s.store();s.toggle(h);var g=s.store();c.push(new _e(d,g,s))}else if(!s.contains(h)){var f=s.first();if(null==f)d=s.store(),s.set(h.root)&&(g=s.store(),c.push(new _e(d,g,s)));else{var y=q.toSelected(h);if(null!=y)t.EShapeCapabilities.contains(y,t.EShapeCapability.CHILDREN)&&(this._childSelectTime=Date.now(),this._childSelectChild=q.toOfParent(h,y));else{var v=q.toSharedParent(f,h);d=s.store(),s.set(q.toOfParent(h,v))&&(g=s.store(),c.push(new _e(d,g,s)))}}}this._isTransformationAllowed&&s.prepareTranslate()&&(s.prepareTranslateSnap(),this._mode=2,this._isFirstMove=!0)}else if(h===p)p.getLastHitAnchor()===t.ESnapperModifierAnchor.ROTATION?s.prepareRotate(l)&&(s.prepareRotateSnap(),this._mode=4,this._isFirstMove=!0):s.prepareScale(p.getLastHitAnchor())&&(s.prepareScaleSnap(),this._mode=3,this._isFirstMove=!0);else{var b=this._area;o.toLocal(l,void 0,u),b.x=u.x,b.y=u.y,b.size.set(0,0),b.update(),o.addChild(b),t.DApplications.update(i),this._mode=1}if(0!==this._mode){var m=this._applicationLayer;if(m){this._applicationLayer=null;var _=m.renderer.plugins.interaction;_.off(t.UtilPointerEvent.move,this._onMoveBound);var S=this._onUpBound;_.off(t.UtilPointerEvent.up,S),_.off(t.UtilPointerEvent.upoutside,S),_.off(t.UtilPointerEvent.cancel,S)}var w=t.DApplications.getLayer(i);if(w){this._applicationLayer=w;var T=w.renderer.plugins.interaction;T.on(t.UtilPointerEvent.move,this._onMoveBound),S=this._onUpBound,T.on(t.UtilPointerEvent.up,S),T.on(t.UtilPointerEvent.upoutside,S),T.on(t.UtilPointerEvent.cancel,S)}}}}},o.prototype.onMove=function(t){var e=t.data.originalEvent;if(!e.altKey){var n=this._diagram,i=n.canvas,o=n.layer,r=this._mode,a=this._applicationLayer;if(i&&o&&0!==r&&a){var l=t.data.global;a.lock();var u=this._onDownPoint;if(1===r){var s=this._area,p=i.toLocal(l,void 0,this._onMovePoint);s.x=Math.min(u.x,p.x),s.y=Math.min(u.y,p.y),s.size.set(Math.max(u.x,p.x)-s.x,Math.max(u.y,p.y)-s.y),s.update()}else{var h=l.x-u.x,c=l.y-u.y;if(1<=Math.abs(h)||1<=Math.abs(c)){var d=this._isFirstMove;this._isFirstMove=!1,this._childSelectChild=null;var g=this._selection;switch(g.modifier.disallow(),r){case 2:d&&g.saveForTranslate(),g.translate(h,c,!0);break;case 4:d&&g.saveForRotate(),g.rotateTo(l,!0);break;case 3:d&&g.saveForScale();var f=e.shiftKey;g.scale(h,c,f,!0)}}}a.unlock(),a.update()}}},o.prototype.hitTest=function(e,n,i){if(this._isTransformationAllowed&&n.visible){var o=t.DApplications.getLayer(i);if(o){var r=o.renderer.plugins.interaction,a=Oo.execute(e,n,r);if(null!=a)return a}}return i.visible?Oo.execute(e,i):null},o.prototype.onSelectEnd=function(e,n,i){var o=this._area,r=this._selection,a=t.DControllers.getCommandController();if(0<o.size.x&&0<o.size.y){var l=o.getBounds(!1,this._areaRect),u=[];if(Bo.findShapes(n,l,u),i){if(0<u.length){var s=r.store();if(r.addAll(u)){var p=r.store();a.push(new _e(s,p,r))}}}else(0<u.length||!r.isEmpty())&&(s=r.store(),r.clearAndAddAll(u)&&(p=r.store(),a.push(new _e(s,p,r))))}else i||r.isEmpty()||(s=r.store(),r.clear()&&(p=r.store(),a.push(new _e(s,p,r))));e.removeChild(o),t.DApplications.update(n)},o.prototype.onUp=function(e){var n=this._diagram,i=n.canvas,o=n.layer,r=this._mode,a=this._applicationLayer;if(a){this._applicationLayer=null;var l=a.renderer.plugins.interaction;l.off(t.UtilPointerEvent.move,this._onMoveBound);var u=this._onUpBound;l.off(t.UtilPointerEvent.up,u),l.off(t.UtilPointerEvent.upoutside,u),l.off(t.UtilPointerEvent.cancel,u)}if(i&&o&&0!==r)if(this._mode=0,1===r){var s=e.data.originalEvent,p=s.ctrlKey||s.shiftKey;this.onSelectEnd(i,o,p)}else{var h=this._selection;h.finalize();var c=this._childSelectChild;if(null!=c&&(this._childSelectChild=null,Date.now()-this._childSelectTime<333)){var d=h.store();if(h.set(c)){var g=h.store();t.DControllers.getCommandController().push(new _e(d,g,h))}}h.modifier.allow(),h.updateModifier(),a&&a.update()}},o.prototype.getRotateAmount=function(t){return Math.PI*(t.ctrlKey?1:15)/180},o.prototype.getScaleAmount=function(t){return t.ctrlKey?1:10},o.prototype.getTranslateAmount=function(t){return t.ctrlKey?1:10},o.prototype.onKeydown=function(e){var n=this._selection;if(n.isEmpty()||(this._isTransformationAllowed&&(t.UtilKeyboardEvent.isArrowUpKey(e)?(e.shiftKey?n.prepareScale(t.ESnapperModifierAnchor.NONE)&&(n.saveForScale(),n.scale(0,this.getScaleAmount(e),!1,!1),n.finalize()):n.prepareTranslate()&&(n.saveForTranslate(),n.translate(0,-this.getTranslateAmount(e),!1),n.finalize()),e.preventDefault()):t.UtilKeyboardEvent.isArrowRightKey(e)?(e.altKey?n.prepareRotate()&&(n.saveForRotate(),n.rotate(this.getRotateAmount(e)),n.finalize()):e.shiftKey?n.prepareScale(t.ESnapperModifierAnchor.NONE)&&(n.saveForScale(),n.scale(this.getScaleAmount(e),0,!1,!1),n.finalize()):n.prepareTranslate()&&(n.saveForTranslate(),n.translate(this.getTranslateAmount(e),0,!1),n.finalize()),e.preventDefault()):t.UtilKeyboardEvent.isArrowDownKey(e)?(e.shiftKey?n.prepareScale(t.ESnapperModifierAnchor.NONE)&&(n.saveForScale(),n.scale(0,-this.getScaleAmount(e),!1,!1),n.finalize()):n.prepareTranslate()&&(n.saveForTranslate(),n.translate(0,this.getTranslateAmount(e),!1),n.finalize()),e.preventDefault()):t.UtilKeyboardEvent.isArrowLeftKey(e)&&(e.altKey?n.prepareRotate()&&(n.saveForRotate(),n.rotate(-this.getRotateAmount(e)),n.finalize()):e.shiftKey?n.prepareScale(t.ESnapperModifierAnchor.NONE)&&(n.saveForScale(),n.scale(-this.getScaleAmount(e),0,!1,!1),n.finalize()):n.prepareTranslate()&&(n.saveForTranslate(),n.translate(-this.getTranslateAmount(e),0,!1),n.finalize()),e.preventDefault())),this._isDeletionAllowed&&t.UtilKeyboardEvent.isDeleteKey(e)&&(n.delete(),e.preventDefault())),t.UtilKeyboardEvent.isSelectAllKey(e)){var i=n.first(),o=null==i?this._diagram.layer:i.parent;if(null!=o){var r=o.children;if(0<r.length){var a=n.store();if(e.altKey){for(var l=new Set,u=0,s=a.length;u<s;++u)l.add(a[u].type);var p=[];for(u=0,s=r.length;u<s;++u){var h=r[u];(h.selected||l.has(h.type))&&p.push(h)}n.clearAndAddAll(p)&&t.DControllers.getCommandController().push(new _e(a,p,n))}else n.clearAndAddAll(r)&&(p=n.store(),t.DControllers.getCommandController().push(new _e(a,p,n)))}}}},o.prototype.onKeyup=function(t){},o.prototype.onDblClick=function(t){var e=this._selection.last();null!=e&&this.emit("edit",e,this)},o}(Ji),Io=function(e){function n(n){var i=e.call(this)||this;return i._edge=n,i._circles=i.newCircles(),i._foundEdges=[],i._radius=2*t.EShapeDefaults.SIZE_X,i._scaleBound=1,i._scaleBoundInverse=1,i._type=t.EShapeAcceptorEdgeType.TAIL,i._x=0,i._y=0,i._ox=0,i._oy=0,i._isDirty=!1,i._isBegan=!1,i._doUpdateBound=function(){i._timeout=null,i._isDirty&&(i._isDirty=!1,i._isBegan&&(i.visible=!0,i.doUpdate()))},i}return i(n,e),n.prototype.newCircles=function(){for(var e=[],n=t.EShapeDefaults.STROKE_COLOR,i=t.EShapeDefaults.STROKE_ALPHA,o=0;o<64;++o){var r=new t.EShapeCircle;r.stroke.set(!1),r.fill.set(!0,n,i),r.visible=!1,r.attach(this),e.push(r)}return e},n.prototype.begin=function(t){t.addChild(this);var e=t.layer.active;if(null!=e){var n=e.transform.position;this._ox=n.x,this._oy=n.y}else this._ox=0,this._oy=0;this.visible=!1,this._isBegan=!0},n.prototype.end=function(){var t=this.parent;null!=t&&t.removeChild(this),this.visible=!1,this._isBegan=!1},n.prototype.onPrerender=function(){var t=this.getParentScale(),e=this._scaleBound;if(.001<Math.abs(t-e)){this._scaleBound=t,this._scaleBoundInverse=1/t;for(var n=this.getCircleSize(),i=this._circles,o=0,r=i.length;o<r;++o)i[o].size.set(n,n)}},n.prototype.render=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this.onPrerender(),e.prototype.render.call(this,t))},n.prototype.getParentScale=function(){var t=this.parent;return null!=t?t.scale.y:1},n.prototype.getCircleSize=function(){return 10*Math.min(1,this._scaleBoundInverse)},n.prototype.update=function(t,e,n){this._isBegan&&(this._type=t,this._x=e,this._y=n,null==this._timeout?(this.visible=!0,this.doUpdate(),this._timeout=window.setTimeout(this._doUpdateBound,100)):this._isDirty=!0)},n.prototype.doUpdate=function(){var e=this._radius,n=this._circles,i=n.length,o=this._foundEdges;this._edge.findAll(this._type,this._x,this._y,e,i,o);for(var r=o.length,a=this._ox,l=this._oy,u=this.getCircleSize(),s=Math.min(i,r),p=e*e,h=0;h<s;++h){var c=o[h],d=c.center,g=n[h];g.lock(t.EShapeLockPart.UPLOADED),g.transform.position.set(a+d.x,l+d.y),g.size.set(u,u),g.fill.alpha=.5*Math.max(0,1-c.distance/p),g.visible=!0,g.unlock(t.EShapeLockPart.UPLOADED,!0)}for(h=s;h<i;++h)n[h].visible=!1;t.DApplications.update(this)},n}(t.EShapeContainer),xo=10,Ro=function(){function n(t,e){this._diagram=t,this._canvasMode=e,this._renderer=new Io(this),this._work=new Set}return n.prototype.begin=function(t,e){this.clear(),this._shape=e,null!=t&&this._renderer.begin(t)},n.prototype.end=function(){this._renderer.end(),this.clear()},n.prototype.update=function(t,e,n){this._renderer.update(t,e,n)},n.prototype.show=function(){this._renderer.visible=!0},n.prototype.hide=function(){this._renderer.visible=!1},Object.defineProperty(n.prototype,"edges",{get:function(){var t=this._edges;return null==t&&(t=this.newEdges(),this._edges=t),t},enumerable:!1,configurable:!0}),n.prototype.newEdges=function(){var t=new Map,e=this._diagram.layer;if(e){var n=0,i=0;if(this._canvasMode){var o=e.transform.position;n=o.x,i=o.y}var r=this._shape;if(null!=r){var a=r.parent;null!=a&&this.addAll(a.children,n,i,t)}else this.addAll(e.children,n,i,t)}return t},n.prototype.addAll=function(n,i,o,r){for(var a=this,l=function(l,s){var p=n[l];if(!(p instanceof t.EShapeConnectorLine)){var h=p.size,c=h.x,d=h.y,g=p.transform,f=g.internalTransform,y=f.a,v=f.b,b=f.c,m=f.d,_=g.pivot,S=_.x,w=_.y,T=new e.Matrix(y*c,v*c,b*d,m*d,f.tx+i+(y*S+b*w),f.ty+o+(v*S+m*w));if(t.EShapeAcceptors.get(p.type).each(p,(function(t,e){a.add(T,e,t,p,r)})),t.EShapeCapabilities.contains(p,t.EShapeCapability.CHILDREN)){var E=p.children;E&&u.addAll(E,i,o,r)}}},u=this,s=0,p=n.length;s<p;++s)l(s)},n.prototype.add=function(t,n,i,o,r){var a=i.size,l=a.x,u=a.y,s=i.x,p=i.y,h=t.a,c=t.b,d=t.c,g=t.d,f=t.tx,y=t.ty,v=h*s+d*p+f,b=c*s+g*p+y,m={shape:o,id:n,x:null,y:null,acceptor:i,matrix:t,local:new e.Point(v,b),center:new e.Point(v,b),distance:0};if(0===l&&0===u){var _=this.toGridIndex(v),S=this.toGridIndex(b),w=this.toCoordinate(_,S);null==(J=r.get(w))?r.set(w,[m]):J.push(m)}else for(var T=.5*l,E=.5*u,C=s-T,D=p-E,L=s+T,A=p-E,B=s+T,O=p+E,P=s-T,I=p+E,x=h*C+d*D,R=c*C+g*D,k=h*L+d*A,V=c*L+g*A,M=h*B+d*O,N=c*B+g*O,F=h*P+d*I,j=c*P+g*I,z=Math.min(x,k,M,F)+f,H=Math.min(R,V,N,j)+y,G=Math.max(x,k,M,F)+f,U=Math.max(R,V,N,j)+y,Y=Math.floor(z/xo),X=Math.floor(H/xo),W=Math.ceil(G/xo),K=Math.ceil(U/xo),Z=Y;Z<=W;++Z)for(var q=X;q<=K;++q){var J;w=this.toCoordinate(Z,q),null==(J=r.get(w))?r.set(w,[m]):J.push(m)}},n.prototype.toCoordinate=function(t,e){return t%1024+(e%1024<<10)},n.prototype.toGridIndex=function(t){return Math.round(t/xo)},n.prototype.find=function(t,e,n){for(var i=null,o=0,r=this.edges,a=-10;a<=xo;a+=xo)for(var l=-10;l<=xo;l+=xo){var u=this.toGridIndex(e+a),s=this.toGridIndex(n+l),p=r.get(this.toCoordinate(u,s));if(null!=p)for(var h=0,c=p.length;h<c;++h){var d=p[h],g=d.acceptor;if(g.type&t){var f=g.size,y=f.x,v=f.y;if(0===y&&0===v)(X=(U=e-(G=d.center).x)*U+(Y=n-G.y)*Y)<=100&&(null==i||X<o)&&(i=d,o=X);else{var b=d.matrix,m=b.a,_=b.b,S=b.c,w=b.d,T=b.tx,E=b.ty,C=m*w-S*_;if(1e-7<Math.abs(C)){var D=1/C,L=e-T,A=n-E,B=(+w*L-S*A)*D,O=(-_*L+m*A)*D,P=.5*y,I=.5*v,x=g.x,R=g.y,k=x-P,V=R-I,M=x+P,N=R+I,F=Math.min(M,Math.max(k,B)),j=Math.min(N,Math.max(V,O)),z=m*F+S*j+T,H=_*F+w*j+E;(X=(U=e-z)*U+(Y=n-H)*Y)<=100&&(null==i||X<o)&&((i=d).x=F,i.y=j,i.local.set(z,H),o=X)}else{var G,U,Y,X;(X=(U=e-(G=d.center).x)*U+(Y=n-G.y)*Y)<=100&&(null==i||X<o)&&(i=d,o=X)}}}}}return i},n.prototype.findAll=function(t,e,n,i,o,r){var a=this.edges,l=(i=Math.ceil(i/xo)*xo)*i,u=this._work;u.clear(),this.findAllS1(t,e,n,0,0,a,l,u);for(var s=xo;s<=i&&u.size<o;s+=xo)this.findAllS2(t,e,n,a,l,s,u);var p=-1;return u.forEach((function(t){r[++p]=t})),r.length=u.size,r.sort(this.compare),r},n.prototype.findAllS2=function(t,e,n,i,o,r,a){for(var l=-r;l<=r;l+=xo)this.findAllS1(t,e,n,l,-r,i,o,a),this.findAllS1(t,e,n,l,+r,i,o,a);for(var u=-r+xo,s=r-xo;u<=s;u+=xo)this.findAllS1(t,e,n,-r,u,i,o,a),this.findAllS1(t,e,n,+r,u,i,o,a)},n.prototype.findAllS1=function(t,e,n,i,o,r,a,l){var u=this.toGridIndex(e+i),s=this.toGridIndex(n+o),p=r.get(this.toCoordinate(u,s));if(p)for(var h=0,c=p.length;h<c;++h){var d=p[h];if(d.acceptor.type&t){var g=d.local,f=e-g.x,y=n-g.y,v=f*f+y*y;v<=a&&(d.distance=v,l.add(d))}}},n.prototype.compare=function(t,e){var n=t.distance,i=e.distance;return n<i?-1:n>i?1:0},n.prototype.clear=function(){this._edges=void 0},n}(),ko={OFF:-1,TAIL:0,HEAD:1,DONE:2},Vo=function(n){function o(t){var i=n.call(this)||this;return i._options=t,i._selection=t.selection,i._diagram=t.diagram,i._edge=new Ro(t.diagram,!1),i._newShape=t.newShape||function(){return i.newShape()},i._phase=ko.OFF,i._work=new e.Point,i._onDownBound=function(t){i.onDown(t)},i._onMoveBound=function(t){i.onMove(t)},i._onUpBound=function(t){i.onUp(t)},i._onKeyDownBound=function(t){i.onKeyDown(t)},i._onSetBound=function(t){i.onSet(t)},i._onUnsetBound=function(t){i.onUnset(t)},i}return i(o,n),o.prototype.onActivate=function(){this._phase=ko.TAIL;var e=this._diagram,n=t.DApplications.getLayer(e);if(n){var i=n.renderer.plugins.interaction;e.on(t.UtilPointerEvent.down,this._onDownBound),e.on(t.UtilPointerEvent.move,this._onMoveBound);var o=this._onUpBound;i.on(t.UtilPointerEvent.up,o),i.on(t.UtilPointerEvent.upoutside,o),i.on(t.UtilPointerEvent.cancel,o),e.on("keydown",this._onKeyDownBound),e.on("set",this._onSetBound),e.on("unset",this._onUnsetBound)}this._edge.begin(e.canvas,null);var r=this._selection;r.modifier.disallow(),r.updateModifier()},o.prototype.onDeactivate=function(){var e=this._diagram,n=t.DApplications.getLayer(e);if(n){var i=n.renderer.plugins.interaction;e.off(t.UtilPointerEvent.down,this._onDownBound),e.off(t.UtilPointerEvent.move,this._onMoveBound);var o=this._onUpBound;i.off(t.UtilPointerEvent.up,o),i.off(t.UtilPointerEvent.upoutside,o),i.off(t.UtilPointerEvent.cancel,o),e.off("keydown",this._onKeyDownBound),e.off("set",this._onSetBound),e.off("unset",this._onUnsetBound)}this._edge.end();var r=this._selection;r.modifier.allow(),r.updateModifier();var a=this._connector;null!=a&&(this._connector=void 0,a.detach(),a.destroy()),this._phase=ko.OFF},o.prototype.onSet=function(t){this._edge.begin(t,null)},o.prototype.onUnset=function(t){this._edge.end();var e=this._connector;null!=e&&(this._connector=void 0,e.detach(),e.destroy()),this._phase=ko.TAIL},o.prototype.onDown=function(t){if(!t.data.originalEvent.altKey)switch(this._phase){case ko.OFF:break;case ko.TAIL:this.onTail(t)&&(this._phase=ko.HEAD);break;case ko.HEAD:this.onHead(t)&&(this._phase=ko.DONE)}},o.prototype.onMove=function(t){if(!t.data.originalEvent.altKey)switch(this._phase){case ko.OFF:break;case ko.TAIL:this.onTail(t);break;case ko.HEAD:this.onHead(t)}},o.prototype.onUp=function(t){this.onDone()},o.prototype.onTail=function(e){var n=this._diagram,i=n.layer;if(i){var o=this._connector,r=e.data.global,a=i.toLocal(r,void 0,this._work),l=this._edge.find(t.EShapeAcceptorEdgeType.TAIL,a.x,a.y);if(this._edge.update(t.EShapeAcceptorEdgeType.TAIL,a.x,a.y),this.isTailAccepted(o,a,l))return null==o&&((o=this._newShape()).fill.alpha=1,this._connector=o,o.attach(i)),this.onTailAccepted(o,a,l),t.DApplications.update(n),!0;if(null!=o)return this.onTailUnaccepted(o,a),t.DApplications.update(n),!1}return!1},o.prototype.isDanglingEdgeAllowed=function(){var t;return null!==(t=this._options.dangling)&&void 0!==t&&t},o.prototype.isTailAccepted=function(t,e,n){return null!=n||this.isDanglingEdgeAllowed()},o.prototype.getTailType=function(){return t.EShapePointsMarkerType.CIRCLE},o.prototype.onTailAccepted=function(e,n,i){e.points.marker.tail.type=this.getTailType(),null!=i?(e.edge.tail.set(i.shape,i.id,i.x,i.y,0,i.local.x,i.local.y,void 0,void 0,i.acceptor.side),e.edge.head.local.copyFrom(i.local)):(e.edge.tail.set(null,null,null,null,0,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP),e.edge.head.local.copyFrom(n))},o.prototype.onTailUnaccepted=function(e,n){e.points.marker.tail.type=t.EShapePointsMarkerType.NONE,e.edge.tail.set(null,null,null,null,0,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP),e.edge.head.local.copyFrom(n)},o.prototype.newShape=function(){var e=new t.EShapeConnectorLine;return e.fill.alpha=1,e},o.prototype.onHead=function(e){var n=this._diagram,i=n.layer;if(i){var o=this._connector;if(o){var r=e.data.global,a=i.toLocal(r,void 0,this._work),l=this._edge.find(t.EShapeAcceptorEdgeType.HEAD,a.x,a.y);return this._edge.update(t.EShapeAcceptorEdgeType.HEAD,a.x,a.y),this.isHeadAccepted(o,a,l)?(this.onHeadAccepted(o,a,l),t.DApplications.update(n),!0):(this.onHeadUnaccepted(o,a),t.DApplications.update(n),!1)}}return!1},o.prototype.isHeadAccepted=function(t,e,n){return null==n?this.isDanglingEdgeAllowed():!this.isSameAcceptor(t.edge.tail.acceptor,n)},o.prototype.isSameAcceptor=function(t,e){return t.shape===e.shape&&t.edge===e.id&&t.x===e.x&&t.y===e.y},o.prototype.getHeadType=function(){return t.EShapePointsMarkerType.TRIANGLE},o.prototype.onHeadAccepted=function(e,n,i){e.points.marker.head.type=this.getHeadType(),null!=i?e.edge.head.set(i.shape,i.id,i.x,i.y,10,i.local.x,i.local.y,void 0,void 0,i.acceptor.side):e.edge.head.set(null,null,null,null,10,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP)},o.prototype.onHeadUnaccepted=function(e,n){e.points.marker.head.type=t.EShapePointsMarkerType.NONE,e.edge.head.set(null,null,null,null,0,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP)},o.prototype.onDone=function(){if(this._phase===ko.DONE){this._phase=ko.OFF;var e=this._connector;if(e){this._connector=void 0;var n=this._diagram.layer;n?(e.edge.attach(),t.DControllers.getCommandController().push(new F([e],n,this._selection,!0))):(e.detach(),e.destroy()),this.emit("done",this)}}},o.prototype.onCancel=function(){var t=this._connector;null!=t&&(this._connector=void 0,t.detach(),t.destroy()),this._phase!==ko.OFF&&(this._phase=ko.OFF,this.emit("cancel",this))},o.prototype.onKeyDown=function(e){t.UtilKeyboardEvent.isCancelKey(e)&&this.onCancel()},o}(Ji),Mo=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.newShape=function(){var e=new t.EShapeConnectorElbow;return e.fill.alpha=1,e},n}(Vo),No=function(n){function o(t){var i=n.call(this)||this;return i._options=t,i._selection=t.selection,i._diagram=t.diagram,i._isNewPoint=!1,i._onDownPoint=new e.Point,i._onMovePoint=new e.Point,i._onDownBound=function(t){i.onDown(t)},i._onMoveBound=function(t){i.onMove(t)},i._onDblClickBound=function(){i.onDblClick()},i._onKeydownBound=function(t){i.onKeydown(t)},i}return i(o,n),o.prototype.onActivate=function(){var e=this._diagram;e.on(t.UtilPointerEvent.down,this._onDownBound),e.on(t.UtilPointerEvent.move,this._onMoveBound),e.on("dblclick",this._onDblClickBound),e.on("keydown",this._onKeydownBound);var n=this._selection;n.modifier.disallow(),n.updateModifier()},o.prototype.onDeactivate=function(){var e=this._diagram;e.off(t.UtilPointerEvent.down,this._onDownBound),e.off(t.UtilPointerEvent.move,this._onMoveBound),e.off("dblclick",this._onDblClickBound),e.off("keydown",this._onKeydownBound),this.onCancel();var n=this._selection;n.modifier.allow(),n.updateModifier()},o.prototype.onDown=function(e){if(!e.data.originalEvent.altKey){var n=this._diagram,i=n.canvas,o=n.layer;if(i&&o&&(this._isNewPoint=!0,null==this._line)){var r=this._onDownPoint;i.toLocal(e.data.global,void 0,r),n.snapper.toSnapped(r,r),o.transform.localTransform.applyInverse(r,r);var a=t.createLine([r.x,r.y],[],t.EShapeDefaults.STROKE_WIDTH,t.EShapePointsStyle.NONE);a.attach(o),this._line=a}}},o.prototype.onMove=function(e){var n=e.data.originalEvent;if(!n.altKey){var i=this._line;if(i){var o=this._diagram,r=o.canvas;if(r){var a=i.points.values;this._isNewPoint&&(this._isNewPoint=!1,a.push(0,0));var l=this._onMovePoint;r.toLocal(e.data.global,void 0,l),o.snapper.toSnapped(l,l);var u=i.parent;u&&u.transform.localTransform.applyInverse(l,l);var s=i.transform.position,p=l.x-s.x,h=l.y-s.y,c=a.length;if(n.shiftKey&&4<=c){var d=a[c-4],g=a[c-3],f=p-d,y=h-g,v=.25*Math.PI,b=Math.round(Math.atan2(y,f)/v)*v,m=0|Math.sqrt(f*f+y*y);a[c-2]=d+m*Math.cos(b),a[c-1]=g+m*Math.sin(b)}else a[c-2]=0|p,a[c-1]=0|h;i.points.values=a,t.DApplications.update(o)}}}},o.prototype.toValues=function(t){for(var e=t.transform.position,n=e.x,i=e.y,o=t.points.values,r=[],a=NaN,l=NaN,u=0,s=o.length;u<s;u+=2){var p=o[u+0],h=o[u+1];a===p&&l===h||(r.push(n+p,i+h),a=p,l=h)}return r},o.prototype.add=function(e){var n=this._diagram.layer;if(n&&4<=e.length){var i=t.createLine(e,[],t.EShapeDefaults.STROKE_WIDTH,t.EShapePointsStyle.NONE);i.attach(n),t.DControllers.getCommandController().push(new F([i],n,this._selection,!0))}},o.prototype.onDblClick=function(){var e=this._line;e&&(this._line=void 0,e.detach(),this.add(this.toValues(e)),t.DApplications.update(this._diagram),this.emit("done",this))},o.prototype.onCancel=function(){var t=this._line;t&&(t.points.values.length-=2,this.onDblClick())},o.prototype.onKeydown=function(e){t.UtilKeyboardEvent.isCancelKey(e)&&this.onCancel()},o}(Ji),Fo=function(n){function o(t,i){var o=n.call(this)||this;return o._selection=t,o._diagram=i,o._applicationLayer=null,o._onDownPoint=new e.Point,o._onMovePoint=new e.Point,o._shape=null,o._creator=void 0,o._onDownBound=function(t){o.onDown(t)},o._onMoveBound=function(t){o.onMove(t)},o._onUpBound=function(t){o.onUp(t)},o}return i(o,n),Object.defineProperty(o.prototype,"shape",{get:function(){return this._creator},set:function(t){this._creator=t},enumerable:!1,configurable:!0}),o.prototype.onActivate=function(){this._diagram.on(t.UtilPointerEvent.down,this._onDownBound)},o.prototype.onDeactivate=function(){this._diagram.off(t.UtilPointerEvent.down,this._onDownBound),this.onDone()},o.prototype.onDown=function(e){var n=e.data.originalEvent;if(!n.altKey){var i=this._selection,o=this._diagram,r=o.layer,a=this._creator;if(null!=r&&null!=a&&null==this._shape){var l=r.toLocal(e.data.global,void 0,this._onDownPoint);o.snapper.toSnapped(l,l),this._onMovePoint.copyFrom(l);var u=this._shape=a();t.toResized(u,l,l,n.ctrlKey,n.shiftKey),u.attach(r),i.modifier.disallow(),t.DControllers.getCommandController().push(new F([u],r,this._selection,!0));var s=this._applicationLayer;if(s){this._applicationLayer=null;var p=s.renderer.plugins.interaction;p.off(t.UtilPointerEvent.move,this._onMoveBound);var h=this._onUpBound;p.off(t.UtilPointerEvent.up,h),p.off(t.UtilPointerEvent.upoutside,h),p.off(t.UtilPointerEvent.cancel,h)}var c=t.DApplications.getLayer(o);if(c){this._applicationLayer=c;var d=c.renderer.plugins.interaction;d.on(t.UtilPointerEvent.move,this._onMoveBound),h=this._onUpBound,d.on(t.UtilPointerEvent.up,h),d.on(t.UtilPointerEvent.upoutside,h),d.on(t.UtilPointerEvent.cancel,h)}}}},o.prototype.onMove=function(e){var n=e.data.originalEvent;if(!n.altKey){var i=this._shape;if(i){var o=this._diagram,r=o.layer,a=this._selection,l=this._applicationLayer;if(r&&l){l.lock();var u=this._onDownPoint,s=r.toLocal(e.data.global,void 0,this._onMovePoint);o.snapper.toSnapped(s,s),t.toResized(i,u,s,n.ctrlKey,n.shiftKey),a.update("PROPERTY"),l.unlock(),l.update()}}}},o.prototype.onUp=function(t){this.onDone()},o.prototype.onDone=function(){var e=this._shape;if(e){this._shape=null;var n=this._selection,i=this._onDownPoint,o=this._onMovePoint,r=this._applicationLayer;if(r){this._applicationLayer=null;var a=r.renderer.plugins.interaction;a.off(t.UtilPointerEvent.move,this._onMoveBound);var l=this._onUpBound;a.off(t.UtilPointerEvent.up,l),a.off(t.UtilPointerEvent.upoutside,l),a.off(t.UtilPointerEvent.cancel,l),r.lock(),i.x===o.x&&i.y===o.y&&(o.set(i.x+100,i.y+100),t.toResized(e,i,o,!1,!1)),n.modifier.allow(),n.update("PROPERTY"),r.unlock(),r.update()}this.emit("done",this)}},o}(Ji),jo=function(e){function n(n){var i=e.call(this)||this;return i._parent=n,i._capability=t.EShapeCapability.LINE_TAIL|t.EShapeCapability.LINE_HEAD,i}return i(n,e),Object.defineProperty(n.prototype,"capability",{get:function(){return this._capability},set:function(t){this._capability=t},enumerable:!1,configurable:!0}),n.prototype.contains=function(e,n){var i,o=this._parent;if(o.isEditing())return!0;for(var r=o.points,a=o.closed,l=this._capability,u=!!(l&t.EShapeCapability.LINE_TAIL),s=!!(l&t.EShapeCapability.LINE_HEAD),p=2*o.getAnchorSize(),h=p*p,c=2*h,d=u?0:1,g=r.length-(s?0:1);d<g;++d){var f=r[d],y=f.x-e,v=f.y-n;if(y*y+v*v<c)return o.setLastHitAnchor(d),!0}for(d=0,g=r.length-1;d<g;++d){var b=r[d+0],m=r[d+1];if(0<=(i=this.calcHitPoint(e,n,b.x,b.y,m.x,m.y,h)))return o.setLastHitSegment(d,i),!0}return u&&s&&a&&(b=r[r.length-1],m=r[0],0<=(i=this.calcHitPoint(e,n,b.x,b.y,m.x,m.y,h)))?(o.setLastHitSegment(r.length-1,i),!0):(o.setLastHitSegment(-1,-1),!1)},n.prototype.calcHitPoint=function(t,e,n,i,o,r,a){var l=o-n,u=r-i,s=t-n,p=e-i,h=l*l+u*u,c=l*s+u*p,d=s*s+p*p;if(1e-4<h){var g=Math.max(0,Math.min(1,c/h));if(h*g*g-2*c*g+d<a)return g}return-1},n}(e.Rectangle),zo=function(n){function o(i){var o=n.call(this)||this;return o._options=i,o._selection=i.selection,o._diagram=i.diagram,o._onDownPoint=new e.Point,o._points=[],o._pointsStyle=t.EShapePointsStyle.NONE,o._onMovePoint=new e.Point,o._isEditing=!1,o._isEdited=!1,o._isActive=!1,o._shape=null,o._capability=t.EShapeCapability.LINE_TAIL|t.EShapeCapability.LINE_HEAD,o._scaleBound=1,o._scaleBoundInverse=1,o._lastHitAnchor=-1,o._lastHitSegment=-1,o._lastHitSegmentPosition=-1,o._targetCopy=new e.Point,o._target=null,o._targetIndex=-1,o._onDownBound=function(t){o.onDown(t)},o._onMoveBound=function(t){o.onMove(t)},o._onUpBound=function(t){o.onUp(t)},o._onKeydownBound=function(t){o.onKeydown(t)},o._onSetBound=function(t){o.onSet(t)},o._onUnsetBound=function(t){o.onUnset(t)},o.cursor="grab",o.interactive=!0,o.hitArea=new jo(o),o._unformatted={length:0,plength:0,values:[],segments:[],style:t.EShapePointsStyle.NONE},o._formatted={length:0,plength:0,values:[],segments:[],style:t.EShapePointsStyle.NONE},o}return i(o,n),o.prototype.onPrerender=function(){var t=this.getParentScale(),e=this._scaleBound;.001<Math.abs(t-e)&&(this._scaleBound=t,this._scaleBoundInverse=1/t,this.reshape())},o.prototype.getParentScale=function(){var t=this.parent;return null!=t?t.scale.y:1},o.prototype.render=function(t){this.onPrerender(),n.prototype.render.call(this,t)},o.prototype.getAnchorSize=function(){return 6*this._scaleBoundInverse},o.prototype.activate=function(){this._isActive||(this._isActive=!0,this.onActivate())},o.prototype.onActivate=function(){this._isEditing=!1,this._isEdited=!1,this._target=null,this._targetIndex=-1;var e=this._diagram,n=t.DApplications.getLayer(e);if(n){var i=n.renderer.plugins.interaction;e.on(t.UtilPointerEvent.down,this._onDownBound),i.on(t.UtilPointerEvent.move,this._onMoveBound);var o=this._onUpBound;i.on(t.UtilPointerEvent.up,o),i.on(t.UtilPointerEvent.upoutside,o),i.on(t.UtilPointerEvent.cancel,o),e.on("keydown",this._onKeydownBound),e.on("set",this._onSetBound),e.on("unset",this._onUnsetBound)}var r=this._selection;r.modifier.disallow(),r.updateModifier()},o.prototype.deactivate=function(){this._isActive&&(this._isActive=!1,this.onDeactivate())},o.prototype.onDeactivate=function(){this._isEditing=!1,this._isEdited=!1,this._target=null,this._targetIndex=-1,this.shape=null;var e=this._diagram,n=t.DApplications.getLayer(e);if(n){var i=n.renderer.plugins.interaction;e.off(t.UtilPointerEvent.down,this._onDownBound),i.off(t.UtilPointerEvent.move,this._onMoveBound);var o=this._onUpBound;i.off(t.UtilPointerEvent.up,o),i.off(t.UtilPointerEvent.upoutside,o),i.off(t.UtilPointerEvent.cancel,o),e.off("keydown",this._onKeydownBound),e.off("set",this._onSetBound),e.off("unset",this._onUnsetBound)}var r=this._selection;r.modifier.allow(),r.updateModifier()},o.prototype.onSet=function(t){},o.prototype.onUnset=function(t){this.onCancel()},o.prototype.isActive=function(){return this._isActive},o.prototype.isEditing=function(){return this._isEditing},Object.defineProperty(o.prototype,"points",{get:function(){return this._points},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"closed",{get:function(){return!!(this._pointsStyle&t.EShapePointsStyle.CLOSED)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"shape",{get:function(){return this._shape},set:function(e){var n,i;if(this._shape!==e){this._shape=e;var o=this.toCapability(e);if(this.hitArea.capability=o,this._capability=o,this._isEdited=!1,null==e){this._points=[],this._pointsStyle=t.EShapePointsStyle.NONE,this._formatter=void 0;var r=this.parent;r&&(r.removeChild(this),t.DApplications.update(this))}else{var a=e.points;if(a){e.updateTransform(),this._points=this.toPoints(e,a,this.toTransform(e));var l=a.style;this._pointsStyle=l,this._formatter=null!==(n=a.formatter)&&void 0!==n?n:null===(i=t.EShapePointsFormatters.find(l))||void 0===i?void 0:i.formatter}else this._points=[],this._pointsStyle=t.EShapePointsStyle.NONE,this._formatter=void 0;this.reshape();var u=this._diagram.canvas;u&&u.addChild(this)}}},enumerable:!1,configurable:!0}),o.prototype.toTransform=function(t){var n,i=null!==(n=this._workTransform)&&void 0!==n?n:this._workTransform=new e.Matrix;i.copyFrom(t.transform.internalTransform);var o=t.root.parent;return o&&i.prepend(o.transform.localTransform),i},o.prototype.toPoints=function(t,n,i){for(var o=[],r=n.values,a=0,l=r.length;a<l;a+=2){var u=new e.Point(r[a+0],r[a+1]);o.push(i.apply(u,u))}return o},o.prototype.setLastHitAnchor=function(e){this._lastHitAnchor===e&&-1===this._lastHitSegment||(this._lastHitAnchor=e,this._lastHitSegment=-1,this._lastHitSegmentPosition=-1,this.reshape(),t.DApplications.update(this))},o.prototype.setLastHitSegment=function(e,n){this._lastHitSegmentPosition=n,-1===this._lastHitAnchor&&this._lastHitSegment===e||(this._lastHitAnchor=-1,this._lastHitSegment=e,this.reshape(),t.DApplications.update(this))},o.prototype.reshape=function(){var e=this,n=this._points,i=n.length,o=this._pointsStyle,r=this._formatter,a=!!(o&t.EShapePointsStyle.CLOSED),l=this._capability,u=!!(l&t.EShapeCapability.LINE_TAIL),s=!!(l&t.EShapeCapability.LINE_HEAD);if(e.clear(),0<i){var p=this.getAnchorSize(),h=.5*p,c=2000880,d=15953703,g=this._lastHitAnchor,f=this._lastHitSegment;if(null!=r){for(var y=this._unformatted,v=y.values,b=y.segments,m=0,_=0;m<i;m+=1,_+=2){var S=n[m];v[_]=S.x,v[_+1]=S.y}var w=this._formatted;r(i,v,b,o,w);var T=w.values;if(e.lineStyle(h,11184810,.5),0<T.length){e.moveTo(T[0],T[1]),m=2;for(var E=T.length;m<E;m+=2)e.lineTo(T[m],T[m+1])}}for(m=0,E=i-1;m<E;++m){var C=n[m],D=n[m+1],L=f===m?d:c;e.lineStyle(h,L,1),e.moveTo(C.x,C.y),e.lineTo(D.x,D.y)}u&&s&&a&&(C=n[m=n.length-1],D=n[0],L=f===m?d:c,e.lineStyle(h,L,1),e.moveTo(C.x,C.y),e.lineTo(D.x,D.y));var A=this._targetIndex;for(m=u?0:1,E=i-(s?0:1);m<E;++m)S=n[m],L=g===m||A===m?d:c,e.lineStyle(h,L,1),e.beginFill(L,1),e.drawRect(S.x-h,S.y-h,p,p),e.endFill()}},o.prototype.replace=function(){var e=this._shape,n=this._points;if(e&&e.parent&&2<=n.length){var i=this.toValues(n,e);if(2<i.length){var o=this.newShape(i,[],this._pointsStyle,e);t.DControllers.getCommandController().push(new be(o,e,e.parent,this._selection))}}},o.prototype.toValues=function(t,e){e.updateTransform();for(var n=this.toTransform(e).invert(),i=[],o=n.a,r=n.b,a=n.c,l=n.d,u=n.tx,s=n.ty,p=NaN,h=NaN,c=0,d=t.length;c<d;++c){var g=t[c],f=g.x,y=g.y;if(p!==f||h!==y){var v=o*f+a*y+u,b=r*f+l*y+s;i.push(v,b),p=v,h=b}}return i},o.prototype.onDown=function(n){if(n.target===this){if(n.data.originalEvent.altKey)return;var i=this._diagram.canvas;if(null!=i&&!this._isEditing){var o=this._lastHitAnchor,r=this._points,a=this._onDownPoint;if(0<=o&&o<r.length)this._isEditing=!0,i.toLocal(n.data.global,void 0,a),this._target=r[o],this._targetCopy.copyFrom(this._target),this._targetIndex=o,this.onTargetChange(o,a),this.reshape(),t.DApplications.update(this);else{var l=this._lastHitSegment;if(0<=l){this._lastHitSegment=-1,this._isEditing=!0,i.toLocal(n.data.global,void 0,a);var u=r[l+0],s=r[l<r.length-1?l+1:0],p=this._lastHitSegmentPosition,h=1-p,c=h*u.x+p*s.x,d=h*u.y+p*s.y,g=new e.Point(c,d);r.splice(l+1,0,g),this._target=g,this._targetCopy.copyFrom(g),this._targetIndex=l+1,this.onTargetChange(this._targetIndex,a),this.reshape(),t.DApplications.update(this)}}}}else this.onDone()},o.prototype.onTargetChange=function(t,e){},o.prototype.onMove=function(e){if(this._isEditing){var n=e.data.originalEvent;if(n.altKey)return;var i=this._diagram,o=i.canvas,r=this._target,a=this._targetCopy;if(o&&r){this._isEdited=!0;var l=this._onDownPoint,u=o.toLocal(e.data.global,void 0,this._onMovePoint);if(r.set(a.x+u.x-l.x,a.y+u.y-l.y),this.toSnapped(r,i,r),n.shiftKey){var s=this._points,p=this._targetIndex,h=0<p?p-1:p+1;if(0<=h&&h<s.length){var c=s[h],d=r.x-c.x,g=r.y-c.y,f=.25*Math.PI,y=Math.round(Math.atan2(g,d)/f)*f,v=Math.sqrt(d*d+g*g);r.set(c.x+v*Math.cos(y),c.y+v*Math.sin(y))}}this.onTargetMove(u),this.reshape(),t.DApplications.update(this)}}else this.onTargetNotMove(e)},o.prototype.onTargetMove=function(t){},o.prototype.onTargetNotMove=function(t){},o.prototype.toSnapped=function(t,e,n){e.snapper.toSnapped(t,n)},o.prototype.onUp=function(t){this._isEditing&&(this._isEditing=!1,this._target=null)},o.prototype.onDone=function(){this._isEditing=!1,this._isEdited&&(this._isEdited=!1,this.replace()),this.emit("done",this)},o.prototype.onCancel=function(){this._isEditing=!1,this._isEdited=!1;var e=this.parent;e&&(e.removeChild(this),t.DApplications.update(this)),this.emit("cancel",this)},o.prototype.onKeydown=function(e){if(t.UtilKeyboardEvent.isCancelKey(e))this.onDone();else if(t.UtilKeyboardEvent.isDeleteKey(e)){var n=this._targetIndex,i=this._points;0<=n&&n<i.length&&2<i.length&&(this._isEdited=!0,i.splice(n,1),n===i.length&&(this._targetIndex-=1,this.onTargetChange(this._targetIndex,null)),this.reshape(),t.DApplications.update(this))}},o}(e.Graphics),Ho=function(n){function o(t){var i=n.call(this,t)||this;return i._edge=new Ro(i._diagram,!0),i._work=new e.Point,i}return i(o,n),o.prototype.toCapability=function(e){var n=t.EShapeCapability.NONE;return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)&&(n|=t.EShapeCapability.LINE_TAIL),t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)&&(n|=t.EShapeCapability.LINE_HEAD),n},o.prototype.onActivate=function(){this._edge.begin(this._diagram.canvas,this._shape),this._edgeTail=void 0,this._edgeHead=void 0,n.prototype.onActivate.call(this)},o.prototype.onDeactivate=function(){this._edge.end(),this._edgeTail=void 0,this._edgeHead=void 0,n.prototype.onDeactivate.call(this)},o.prototype.onTargetChange=function(e,n){if(0===e)(i=this._edge).show(),null!=n&&i.update(t.EShapeAcceptorEdgeType.TAIL,n.x,n.y);else if(e===this._points.length-1){var i;(i=this._edge).show(),null!=n&&i.update(t.EShapeAcceptorEdgeType.HEAD,n.x,n.y)}else this._edge.hide()},o.prototype.onTargetMove=function(e){var n=this._targetIndex;0===n?this._edge.update(t.EShapeAcceptorEdgeType.TAIL,e.x,e.y):n===this._points.length-1&&this._edge.update(t.EShapeAcceptorEdgeType.HEAD,e.x,e.y)},o.prototype.onTargetNotMove=function(e){var n=this._targetIndex;if(0===n){if(o=this._diagram.canvas){var i=o.toLocal(e.data.global,void 0,this._onMovePoint);this._edge.update(t.EShapeAcceptorEdgeType.TAIL,i.x,i.y)}}else if(n===this._points.length-1){var o;(o=this._diagram.canvas)&&(i=o.toLocal(e.data.global,void 0,this._onMovePoint),this._edge.update(t.EShapeAcceptorEdgeType.HEAD,i.x,i.y))}},o.prototype.toSnapped=function(e,n,i){var o,r=this._targetIndex;0===r?(null!=(o=this._edge.find(t.EShapeAcceptorEdgeType.TAIL,e.x,e.y))&&i.copyFrom(o.local),this._edgeTail=o):r===this._points.length-1?(null!=(o=this._edge.find(t.EShapeAcceptorEdgeType.HEAD,e.x,e.y))&&i.copyFrom(o.local),this._edgeHead=o):n.snapper.toSnapped(e,i)},o.prototype.toPoints=function(n,i,o){var r=[];if(n instanceof t.EShapeConnectorLine){var a=n.edge,l=a.tail.local,u=a.head.local,s=n.transform.position,p=s.x,h=s.y,c=l.x-p,d=l.y-h,g=u.x-p,f=u.y-h,y=new e.Point(c,d);r.push(o.apply(y,y));var v=n.body.values,b=v.length;if(0<b)for(var m=.5*(g+c),_=.5*(f+d),S=g-c,w=f-d,T=Math.atan2(w,S),E=Math.sqrt(S*S+w*w),C=Math.cos(T)*E,D=Math.sin(T)*E,L=0;L<b;L+=2){var A=v[L+0],B=v[L+1],O=m+C*A-D*B,P=_+C*B+D*A,I=new e.Point(O,P);r.push(o.apply(I,I))}var x=new e.Point(g,f);r.push(o.apply(x,x))}return r},o.prototype.newShape=function(e,n,i,o){var r=t.toPointsBoundary(e,[0,0,0,0]),a=.5*(r[2]+r[0]),l=.5*(r[3]+r[1]),u=r[2]-r[0],s=r[3]-r[1],p=o.clone(),h=p.transform,c=h.position,d=c.x,g=c.y;p.lock(t.EShapeLockPart.UPLOADED),c.set(d+a,g+l),h.scale.set(1,1),h.rotation=0,h.skew.set(0,0),p.points.toFitted(u,s),p.size.set(u,s),p.edge.lock(),p.body.set(t.EShapeConnectorBodies.from(e,0,0));var f=this._work;2<=e.length?f.set(d+e[0],g+e[1]):f.set(d,g);var y=this._edgeTail;if(void 0!==y&&this.isTailAccepted(p,f,y)&&this.onTailAccepted(p,f,y),2<=e.length){var v=e.length;f.set(d+e[v-2],g+e[v-1])}else f.set(d,g);var b=this._edgeHead;return void 0!==b&&this.isHeadAccepted(p,f,b)&&this.onHeadAccepted(p,f,b),p.edge.unlock(),p.unlock(t.EShapeLockPart.UPLOADED,!0),p},o.prototype.isDanglingEdgeAllowed=function(){var t;return null!==(t=this._options.dangling)&&void 0!==t&&t},o.prototype.isTailAccepted=function(t,e,n){return null!=n||this.isDanglingEdgeAllowed()},o.prototype.onTailAccepted=function(e,n,i){null!=i?e.edge.tail.set(i.shape,i.id,i.x,i.y,void 0,void 0,void 0,void 0,void 0,i.acceptor.side):e.edge.tail.set(null,null,null,null,void 0,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP)},o.prototype.isHeadAccepted=function(t,e,n){return null!=n||this.isDanglingEdgeAllowed()},o.prototype.onHeadAccepted=function(e,n,i){null!=i?e.edge.head.set(i.shape,i.id,i.x,i.y,void 0,void 0,void 0,void 0,void 0,i.acceptor.side):e.edge.head.set(null,null,null,null,void 0,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP)},o}(zo),Go=function(e){function n(t){return e.call(this,t)||this}return i(n,e),n.prototype.toCapability=function(e){return t.EShapeCapability.LINE_TAIL|t.EShapeCapability.LINE_HEAD},n.prototype.newShape=function(e,n,i,o){for(var r=t.toPointsBoundary(e,[0,0,0,0]),a=.5*(r[2]+r[0]),l=.5*(r[3]+r[1]),u=r[2]-r[0],s=r[3]-r[1],p=o.clone(),h=p.transform.position,c=h.x,d=h.y,g=o.transform.localTransform,f=g.a*a+g.c*l,y=g.b*a+g.d*l,v=[],b=0,m=e.length;b<m;b+=2)v.push(e[b+0]-a,e[b+1]-l);p.lock(t.EShapeLockPart.UPLOADED),p.transform.position.set(c+f,d+y),p.size.set(u,s);var _=p.points;return _&&_.set(v,n,i),p.unlock(t.EShapeLockPart.UPLOADED,!0),p},n}(zo),Uo={send:function(t,e){var n=!1,i=function(t){return function(){n||(n=!0,e.error(t,o))}},o=new XMLHttpRequest;o.open(t,e.url,!0),o.onload=function(){if(!n){n=!0;var t=o.status;200<=t&&t<300||0===t||304===t||1223===t?e.success(o.responseText,o):e.error(o.statusText,o)}};var r=i("error");o.onerror=r,o.onabort=i("abort");var a=e.headers;if(null!=a)for(var l in a){var u=a[l];null!=u&&o.setRequestHeader(l,u)}o.setRequestHeader("X-Requested-With","XMLHttpRequest");var s=e.timeout;null!=s&&(o.timeout=s,o.ontimeout=i("timeout"),0<s&&setTimeout((function(){o.abort()}),s));try{var p=e.data;null!=p?o.send(p):o.send()}catch(t){r()}}},Yo=function(){function e(t){this._options=t}return e.prototype.get=function(){var t;return null!==(t=this._promise)&&void 0!==t?t:this._promise=this.fetch()},e.prototype.fetch=function(){var t=this;return Promise.all([this.doFetch()]).then((function(e){var n=e[0];return t.toFetched(n)}))},e.prototype.doFetch=function(){var e=this._options;return t.isFunction(e)?e():e},e.prototype.toFetched=function(e){var n=t.DThemes.get("EEditorCanvas");if(null!=e){var i=this.toItems(n,e);return{default:this.toDefault(i,n,e),items:i,writable:this.toWritable(n,e)}}return{default:n.getDefaultCategory(),items:[],writable:n.isCategoryWritable()}},e.prototype.toItems=function(t,e){var n=[],i=e.items;if(null!=i)for(var o=0,r=i.length;o<r;++o){var a=i[o],l=t.toCategoryId(a),u=t.toCategoryLabel(a);n.push({id:l,label:u})}return n},e.prototype.toDefault=function(t,e,n){return null!=n.default?n.default:0<t.length?t[0].id:e.getDefaultCategory()},e.prototype.toWritable=function(t,e){var n;return null!==(n=e.writable)&&void 0!==n?n:t.isCategoryWritable()},e}(),Xo=function(){function e(t){this._category=new Yo(null==t?void 0:t.category),this._options=t}return e.prototype.get=function(){var t;return null!==(t=this._promise)&&void 0!==t?t:this._promise=this.fetch()},e.prototype.fetch=function(){var t=this;return this._category.get().then((function(e){return t.toDefault(e)}))},e.prototype.toDefault=function(e){var n,i,o,r,a,l,u,s,p,h,c=t.DThemes.get("EEditorCanvas"),d=this._options;return null!=d?{name:null!==(n=d.name)&&void 0!==n?n:c.getDefaultName(),label:null!==(i=d.label)&&void 0!==i?i:c.getDefaultLabel(),width:null!==(o=d.width)&&void 0!==o?o:c.getDefaultWidth(),height:null!==(r=d.height)&&void 0!==r?r:c.getDefaultHeight(),category:e,summary:null!==(a=d.summary)&&void 0!==a?a:c.getDefaultSummary(),description:null!==(l=d.description)&&void 0!==l?l:c.getDefaultDescription(),background:{color:null!==(s=null===(u=d.background)||void 0===u?void 0:u.color)&&void 0!==s?s:c.getDefaultBackgroundColor(),alpha:null!==(h=null===(p=d.background)||void 0===p?void 0:p.alpha)&&void 0!==h?h:c.getDefaultBackgroundAlpha()}}:{name:c.getDefaultName(),label:c.getDefaultLabel(),width:c.getDefaultWidth(),height:c.getDefaultHeight(),category:e,summary:c.getDefaultSummary(),description:c.getDefaultDescription(),background:{color:c.getDefaultBackgroundColor(),alpha:c.getDefaultBackgroundAlpha()}}},e}(),Wo=function(){function t(t){this.parent=t,this.mappings={}}return t.prototype.set=function(t){this.mappings=t;var e=this.parent,n=e.data;for(var i in t){var o=t[i];o&&n.set(i,o.value,o.time,o.state)}e.update()},t.prototype.retain=function(t){for(var e={},n=this.mappings,i=0,o=t.length;i<o;++i){var r=t[i];r in n&&(e[r]=n[r])}this.set(e)},t}(),Ko=function(){function e(){}return e.getFormatter=function(){return null==e.DATE_FORMATTER&&(e.DATE_FORMATTER=t.NumberFormatters.create("%Y%M%D%H%m%s")),e.DATE_FORMATTER},e.format=function(t){return this.getFormatter().format(t,1)},e.DATE_FORMATTER=null,e}(),Zo=function(e){function n(t){var n=e.call(this,t)||this,i=t.diagram;return n._diagram=i,n.state.isDisabled=null==i.canvas,i.on("unset",(function(){n.state.isDisabled=!0})),i.on("set",(function(){n.state.isDisabled=!1})),n._canvas=t.canvas,n.content.addChild(n.newLayout()),n}return i(n,e),n.prototype.newLayout=function(){return new t.DLayoutVertical({x:"padding",y:"padding",width:"padding",height:"auto",children:this.newLayoutItems()})},n.prototype.newLayoutItems=function(){return[this.newTextLabel(),this.newLayoutName(),this.newLayoutLabel(),this.newLayoutWidth(),this.newLayoutHeight(),this.newLayoutCategory(),this.newLayoutSummary(),this.newLayoutDescription(),this.newLayoutBackground()]},n.prototype.newTextLabel=function(){return new t.DText({width:"100%",text:{value:this.theme.getLabel()}})},n.prototype.newLayoutName=function(){var e=this._diagram,n=new t.DInputTextAndLabel({width:"100%",label:{text:{value:this.theme.getInputNameLabel()}},input:{weight:1,on:{change:function(n){var i=e.canvas;null!=i&&i.name!==n&&t.DControllers.getCommandController().push(new c(e,i,n))}}}}),i=function(){var t=e.canvas;null!=t&&(n.input.value=t.name)};return i(),e.on("change",i),e.on("set",(function(t){n.input.value=t.name})),n},n.prototype.newLayoutLabel=function(){var e=this._diagram,n=new t.DInputTextAndLabel({width:"100%",label:{text:{value:this.theme.getInputLabelLabel()}},input:{weight:1,on:{change:function(n){var i=e.canvas;null!=i&&i.label!==n&&t.DControllers.getCommandController().push(new h(e,i,n))}}}}),i=function(){var t=e.canvas;null!=t&&(n.input.value=t.label)};return i(),e.on("change",i),e.on("set",(function(t){n.input.value=t.label})),n},n.prototype.newLayoutWidth=function(){var e=this._diagram,n=new t.DInputIntegerAndLabel({width:"100%",label:{text:{value:this.theme.getInputWidthLabel()}},input:{weight:1,min:1,on:{change:function(n){var i=e.canvas;null!=i&&i.width!==n&&t.DControllers.getCommandController().push(new D(e,i,n))}}}}),i=function(){var t=e.canvas;null!=t&&(n.input.value=t.width)};return i(),e.on("change",i),e.on("set",(function(t){n.input.value=t.width})),n},n.prototype.newLayoutHeight=function(){var e=this._diagram,n=new t.DInputIntegerAndLabel({width:"100%",label:{text:{value:this.theme.getInputHeightLabel()}},input:{weight:1,min:1,on:{change:function(n){var i=e.canvas;null!=i&&i.height!==n&&t.DControllers.getCommandController().push(new p(e,i,n))}}}}),i=function(){var t=e.canvas;null!=t&&(n.input.value=t.height)};return i(),e.on("change",i),e.on("set",(function(t){n.input.value=t.height})),n},n.prototype.newLayoutBackground=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelBackground(),this.newInputBackground()]})},n.prototype.newLabelBackground=function(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputBackgroundLabel()}})},n.prototype.newInputBackground=function(){var e=this._diagram,n=new t.DButtonColor({weight:1,on:{change:function(n){t.DControllers.getCommandController().push(new a(e,n.color,n.alpha))}}});n.dialog.on("open",(function(){var t=n.dialog,e=t.new,i=t.current;e.color=i.color,e.alpha=i.alpha}));var i=function(){var i=n.value,o=e.canvas;if(null!=o){var r=o.background,a=r.color,l=r.alpha;i.color=t.isNumber(a)?a:16777215,i.alpha=t.isNumber(l)?l:1}};return i(),e.on("change",i),e.on("set",i),n},n.prototype.newLayoutCategory=function(){var e=this,n=this.newLabelCategory(),i=this.newSelectCategory(),o=new t.DLayoutHorizontal({width:"padding",height:"auto",visible:!1,children:[n,i]});return this._canvas.get().then((function(t){e.onCanvasValueFetched(t,o,i)})),o},n.prototype.onCanvasValueFetched=function(e,n,i){var o=e.category,r=o.default,a=o.items;if(null!=r&&0<a.length){for(var l=[],u=0,s=a.length;u<s;++u){var p=a[u];l.push({value:p.id,text:{value:p.label}})}i.menu=new t.DMenu({fit:!0,items:l}),i.value=r;var h=this._diagram,c=function(){var t,n=h.canvas;null!=n&&(i.value=null!==(t=n.category)&&void 0!==t?t:e.category.default)};c(),h.on("change",c),h.on("set",(function(t){var n;i.value=null!==(n=t.category)&&void 0!==n?n:e.category.default})),n.state.isEnabled=o.writable,n.show()}else i.value=null,n.hide()},n.prototype.newLabelCategory=function(){return new t.DInputLabel({width:60,text:{value:this.theme.getSelectCategoryLabel()}})},n.prototype.newSelectCategory=function(){var e=this;return new t.DSelect({weight:1,on:{change:function(n){var i=e._diagram,o=i.canvas;null!=o&&o.category!==n&&t.DControllers.getCommandController().push(new l(i,o,n))}}})},n.prototype.newLayoutSummary=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelSummary(),this.newInputSummary()]})},n.prototype.newLabelSummary=function(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputSummaryLabel()}})},n.prototype.newInputSummary=function(){var e=this._diagram,n=new t.DInputTextArea({weight:1,height:60,on:{change:function(n){var i=e.canvas;null!=i&&i.summary!==n&&t.DControllers.getCommandController().push(new C(e,i,n))}}}),i=function(){var t=e.canvas;null!=t&&(n.value=t.summary)};return i(),e.on("change",i),e.on("set",(function(t){n.value=t.summary})),n},n.prototype.newLayoutDescription=function(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelDescription(),this.newInputDescription()]})},n.prototype.newLabelDescription=function(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputDescriptionLabel()}})},n.prototype.newInputDescription=function(){var e=this._diagram,n=new t.DInputTextArea({weight:1,height:100,on:{change:function(n){var i=e.canvas;null!=i&&i.description!==n&&t.DControllers.getCommandController().push(new s(e,i,n))}}}),i=function(){var t=e.canvas;null!=t&&(n.value=t.description)};return i(),e.on("change",i),e.on("set",(function(t){n.value=t.description})),n},n.prototype.getType=function(){return"EEditorCanvasLegacy"},n}(t.DPane),qo=function(){function n(e){var n,i,o;this._options=e;var r=this.toTheme(e);this._theme=r,this._margin=null!==(n=e.margin)&&void 0!==n?n:r.getMargin();var a=e.piece;this._isPieceEnabled=null===(i=null==a?void 0:a.enable)||void 0===i||i,this._toPieceId=null!==(o=null==a?void 0:a.toId)&&void 0!==o?o:function(){return null},this._isEditable=!1!==e.editable,this._icons=this.toIcons(r),this._validation=this.toValidation(e),this._search=this.toSearch(e),this._controller=e.controller,this._canvas=new Xo(e.canvas),this._application=new t.DApplication(e.application),this._editorButtonGroup=null,this.init()}return Object.defineProperty(n.prototype,"application",{get:function(){return this._application},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"controller",{get:function(){return this._controller},enumerable:!1,configurable:!0}),n.prototype.toIcons=function(t){var e=t.getIconBuilder();Ge.merge(e),di.merge(e);var n=e.build();return Ge.build(n),di.build(n),n},n.prototype.toValidation=function(t){var e=t.validation;return null!=e?{validator:e.validator,force:!0===e.force}:{validator:void 0,force:!1}},n.prototype.toSearch=function(t){var e=t.search;return null!=e?{finder:e.finder}:{finder:void 0}},n.prototype.init=function(){this.initDiagram(),this.initHeader(),this.initTools(),this.initEditors(),this.initCopyAndPaste(),this.initShortcut()},n.prototype.initDiagram=function(){var e=this.diagram;this.getDiagramContainer().addChild(e),t.DControllers.setDocumentController(e)},n.prototype.initHeader=function(){var t=this.newHeader(this._options);t&&(this.getHeaderContainer().addChild(t),this._header=t)},n.prototype.initTools=function(){this.getToolButtonLayoutContainer().addChild(this.newToolButtonLayout()),this.toolShapeButtonSelect.activate(),this.toolShapeButtonGroup.disable()},n.prototype.initEditors=function(){this.getEditorLayoutContainer().addChild(this.newEditorLayout()),this.isEditorCanvasCompatible()||this.diagram.addChild(this.editorCanvas),this.editorButtonCoordinate.activate()},n.prototype.initCopyAndPaste=function(){var e=this;(new t.UtilClipboard).on("copy",(function(t){var n=e.toolShapeSelect.selection.serialize();null!=n&&t.setData("text",n)})).on("cut",(function(t){var n=e.toolShapeSelect.selection.serialize();null!=n&&(t.setData("text",n),e.toolShapeSelect.selection.delete())})).on("paste",(function(t){var n=t.getData("text");e.toolShapeSelect.selection.deserialize(n)}))},n.prototype.initShortcut=function(){this.initShortcutShape(),this.initShortcutTree()},n.prototype.initShortcutShape=function(){var e=this,n=t.DThemes.get("EEditorShape"),i=n.getButtonGroupShortcut();null!=i&&t.UtilKeyboardEvent.on(this.diagram,i,(function(t){e.toolShapeSelect.selection.group()}));var o=n.getButtonUngroupShortcut();null!=o&&t.UtilKeyboardEvent.on(this.diagram,o,(function(t){e.toolShapeSelect.selection.ungroup()}))},n.prototype.initShortcutTree=function(){var e=this,n=t.DThemes.get("EEditorTree"),i=n.getButtonBringToFrontShortcut();null!=i&&t.UtilKeyboardEvent.on(this.diagram,i,(function(t){e.toolShapeSelect.selection.bringToFront()}));var o=n.getButtonBringForwardShortcut();null!=o&&t.UtilKeyboardEvent.on(this.diagram,o,(function(t){e.toolShapeSelect.selection.bringForward()}));var r=n.getButtonSendBackwardShortcut();null!=r&&t.UtilKeyboardEvent.on(this.diagram,r,(function(t){e.toolShapeSelect.selection.sendBackward()}));var a=n.getButtonSendToBackShortcut();null!=a&&t.UtilKeyboardEvent.on(this.diagram,a,(function(t){e.toolShapeSelect.selection.sendToBack()}))},n.prototype.newHeader=function(t){var e=t.header;if(null!=e){var n=e(this.newToolFileButtons());if(n){var i=this._margin;return n.x=i,n.y=i,n.setWidth((function(t){return t-2*i})),n}}return null},n.prototype.getHeaderContainer=function(){return this._application.stage},Object.defineProperty(n.prototype,"toolFileButtonCreate",{get:function(){var t;return null!==(t=this._toolFileButtonCreate)&&void 0!==t?t:this._toolFileButtonCreate=this.newToolFileButtonCreate()},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonCreate=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.new},title:n.getToolFileButtonCreateTitle(),shortcut:n.getToolFileButtonCreateShortcut(),theme:n.getToolFileButtonTheme(),state:this._isEditable?void 0:t.DBaseState.DISABLED,on:{active:function(t){e.onToolFileButtonCreateActive(t)}}})},n.prototype.onToolFileButtonCreateActive=function(t){var e=this;this.diagram.isChanged()?this.dialogDiscard.open(t).then((function(){e.dialogCreate.then((function(e){e.reset().open(t)}))})):this.dialogCreate.then((function(e){e.reset().open(t)}))},Object.defineProperty(n.prototype,"toolFileButtonOpen",{get:function(){var t;return null!==(t=this._toolFileButtonOpen)&&void 0!==t?t:this._toolFileButtonOpen=this.newToolFileButtonOpen()},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonOpen=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.open},title:n.getToolFileButtonOpenTitle(),shortcut:n.getToolFileButtonOpenShortcut(),theme:n.getToolFileButtonTheme(),on:{active:function(t){e.onToolFileButtonOpenActive(t)}}})},n.prototype.onToolFileButtonOpenActive=function(t){var e=this;this.diagram.isChanged()?this.dialogDiscard.open(t).then((function(){e.dialogSelect.then((function(e){e.open(t)}))})):this.dialogSelect.then((function(e){e.open(t)}))},Object.defineProperty(n.prototype,"toolFileButtonSave",{get:function(){var t;return null!==(t=this._toolFileButtonSave)&&void 0!==t?t:this._toolFileButtonSave=this.newToolFileButtonSave()},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonSave=function(){var e=this,n=this._theme,i=new t.DButton({image:{source:this._icons.save},title:n.getToolFileButtonSaveTitle(),shortcut:n.getToolFileButtonSaveShortcut(),theme:n.getToolFileButtonTheme(),state:t.DBaseState.DISABLED,on:{active:function(){e.onToolFileButtonSaveActive()}}});if(this._isEditable){var o=this.diagram;o.on("change",(function(){i.state.isDisabled=!o.isChanged()}))}return i},n.prototype.onToolFileButtonSaveActive=function(){this.validate().then((function(){t.DControllers.getCommandController().push(new t.DCommandSave)}))},n.prototype.validate=function(){var e=this,n=this._validation,i=n.validator;if(null!=i&&n.force){var o=this.diagram.canvas;if(o)try{var r=i(o);if(null!=r){var a=this.dialogSaveProcessing;if(a.open(this.toolFileButtonSave),t.isArray(r)){if(0<r.length){this.editorValidation.list.data.clearAndAddAll(r);var l=this.editorButtonValidation;return l.state.isActive||l.activate(),a.reject("validation"),Promise.reject()}return Promise.resolve()}return r.then((function(t){if(0<t.length){e.editorValidation.list.data.clearAndAddAll(t);var n=e.editorButtonValidation;return n.state.isActive||n.activate(),a.reject("validation"),Promise.reject()}return Promise.resolve()}),(function(){return a.reject("validation-fail"),Promise.reject()}))}}catch(t){var u=this.dialogSaveProcessing;return u.open(this.toolFileButtonSave),u.reject("validation-fail"),Promise.reject()}}return Promise.resolve()},Object.defineProperty(n.prototype,"toolFileButtonSaveAs",{get:function(){var t;return null!==(t=this._toolFileButtonSaveAs)&&void 0!==t?t:this._toolFileButtonSaveAs=this.newToolFileButtonSaveAs()},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonSaveAs=function(){var e=this,n=this._theme,i=new t.DButton({image:{source:this._icons.save_as},title:n.getToolFileButtonSaveAsTitle(),shortcut:n.getToolFileButtonSaveAsShortcut(),theme:n.getToolFileButtonTheme(),state:t.DBaseState.DISABLED,on:{active:function(){e.onToolFileButtonSaveAsActive()}}});if(this._isEditable){var o=this.diagram;o.on("set",(function(){i.state.isDisabled=!1})),o.on("unset",(function(){i.state.isDisabled=!0}))}return i},n.prototype.onToolFileButtonSaveAsActive=function(){var t=this;this.validate().then((function(){t.dialogSaveAs.open(t.toolFileButtonSaveAs)}))},Object.defineProperty(n.prototype,"toolFileButtonUpload",{get:function(){var t;return null!==(t=this._toolFileButtonUpload)&&void 0!==t?t:this._toolFileButtonUpload=this.newToolFileButtonUpload()},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonUpload=function(){var e=this,n=this._theme,i=new t.DButtonFile({image:{source:this._icons.upload},title:n.getToolFileButtonUploadTitle(),shortcut:n.getToolFileButtonUploadShortcut(),theme:n.getToolFileButtonTheme(),as:t.DButtonFileAs.TEXT,checker:function(){return!e.diagram.isChanged()||e.dialogDiscard.open(i)},on:{open:function(t){e.onToolFileButtonUploadOpen(t)}}});return i},n.prototype.onToolFileButtonUploadOpen=function(e){var n=t.DDiagrams.parse(e);null!=n&&(n.id=void 0,this.diagram.set(n))},Object.defineProperty(n.prototype,"toolFileButtonDownload",{get:function(){var t;return null!==(t=this._toolFileButtonDownload)&&void 0!==t?t:this._toolFileButtonDownload=this.newToolFileButtonDownload()},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonDownload=function(){var e=this,n=this._theme,i=new t.DButton({image:{source:this._icons.download},title:n.getToolFileButtonDownloadTitle(),shortcut:n.getToolFileButtonDownloadShortcut(),theme:n.getToolFileButtonTheme(),state:t.DBaseState.DISABLED,on:{active:function(){e.onToolFileButtonDownloadActive()}}}),o=this.diagram;return o.on("set",(function(){i.state.isDisabled=!1})),o.on("unset",(function(){i.state.isDisabled=!0})),i},n.prototype.onToolFileButtonDownloadActive=function(){var e=this.diagram.serialize();null!=e&&t.UtilFileDownloader.download("".concat(e.name,".json"),JSON.stringify(e))},Object.defineProperty(n.prototype,"toolFileButtonUndo",{get:function(){var t;return null!==(t=this._toolFileButtonUndo)&&void 0!==t?t:this._toolFileButtonUndo=this.newToolFileButtonUndo()},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonUndo=function(){var e=this._theme;return new t.DButtonUndo({title:e.getToolFileButtonUndoTitle(),shortcut:e.getToolFileButtonUndoShortcut(),theme:e.getToolFileButtonTheme(),image:{source:this._icons.undo}})},Object.defineProperty(n.prototype,"toolFileButtonRedo",{get:function(){var t;return null!==(t=this._toolFileButtonRedo)&&void 0!==t?t:this._toolFileButtonRedo=this.newToolFileButtonRedo()},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonRedo=function(){var e=this._theme;return new t.DButtonRedo({title:e.getToolFileButtonRedoTitle(),shortcut:e.getToolFileButtonRedoShortcut(),theme:e.getToolFileButtonTheme(),image:{source:this._icons.redo}})},Object.defineProperty(n.prototype,"toolFileButtonDelete",{get:function(){var t;return null!==(t=this._toolFileButtonDelete)&&void 0!==t?t:this._toolFileButtonDelete=this.newToolFileButtonDelete()},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonDelete=function(){var e=this,n=this._theme,i=new t.DButton({image:{source:this._icons.delete},title:n.getToolFileButtonDeleteTitle(),shortcut:n.getToolFileButtonDeleteShortcut(),theme:n.getToolFileButtonTheme(),state:t.DBaseState.DISABLED,on:{active:function(t){e.onToolFileButtonDelete(t)}}});if(this._isEditable){var o=this.diagram;o.on("set",(function(){i.state.isDisabled=!1})),o.on("unset",(function(){i.state.isDisabled=!0}))}return i},n.prototype.onToolFileButtonDelete=function(t){this.dialogDelete.open(t)},Object.defineProperty(n.prototype,"toolShapeButtonGroup",{get:function(){var t;return null!==(t=this._toolShapeButtonGroup)&&void 0!==t?t:this._toolShapeButtonGroup=this.newToolShapeButtonGroup()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonGroup=function(){var e=new t.DButtonGroup,n=this.diagram;return n.on("set",(function(){e.enable()})),n.on("unset",(function(){e.disable()})),e},Object.defineProperty(n.prototype,"toolShapeButtonSelect",{get:function(){var t;return null!==(t=this._toolShapeButtonSelect)&&void 0!==t?t:this._toolShapeButtonSelect=this.newToolShapeButtonSelect()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonSelect=function(){var e=this,n=this._theme;return new t.DButton({group:this.toolShapeButtonGroup,toggle:!0,title:n.getToolShapeButtonSelectTitle(),theme:n.getToolShapeButtonTheme(),image:{source:this._icons.select},on:{active:function(){e.onToolShapeButtonSelectActive()},inactive:function(){e.onToolShapeButtonSelectInactive()}}})},n.prototype.onToolShapeButtonSelectActive=function(){this.toolGroup.activate(this.toolShapeSelect)},n.prototype.onToolShapeButtonSelectInactive=function(){this.toolGroup.deactivate(this.toolShapeSelect)},n.prototype.newToolShapeButtonCreate=function(e,n,i){var o=this;return new t.DButton({group:this.toolShapeButtonGroup,toggle:!0,title:e,theme:this._theme.getToolShapeButtonTheme(),image:{source:this._icons[n]},on:{active:function(){o.onToolShapeButtonCreateActive(i)},inactive:function(){o.onToolShapeButtonCreateInactive()}}})},n.prototype.onToolShapeButtonCreateActive=function(t){var e=this.toolShapeCreate;e.shape=function(){return new t},this.toolGroup.activate(e,t)},n.prototype.onToolShapeButtonCreateInactive=function(){this.toolGroup.deactivate(this.toolShapeCreate)},Object.defineProperty(n.prototype,"toolShapeButtonCircle",{get:function(){var t;return null!==(t=this._toolShapeButtonCircle)&&void 0!==t?t:this._toolShapeButtonCircle=this.newToolShapeButtonCircle()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonCircle=function(){var e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonCircleTitle(),"shape_circle",t.EShapeCircle)},Object.defineProperty(n.prototype,"toolShapeButtonSemicircle",{get:function(){var t;return null!==(t=this._toolShapeButtonSemicircle)&&void 0!==t?t:this._toolShapeButtonSemicircle=this.newToolShapeButtonSemicircle()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonSemicircle=function(){var e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonSemicircleTitle(),"shape_semicircle",t.EShapeSemicircle)},Object.defineProperty(n.prototype,"toolShapeButtonRectangle",{get:function(){var t;return null!==(t=this._toolShapeButtonRectangle)&&void 0!==t?t:this._toolShapeButtonRectangle=this.newToolShapeButtonRectangle()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonRectangle=function(){var e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonRectangleTitle(),"shape_rectangle",t.EShapeRectangle)},Object.defineProperty(n.prototype,"toolShapeButtonRectangleRounded",{get:function(){var t;return null!==(t=this._toolShapeButtonRectangleRounded)&&void 0!==t?t:this._toolShapeButtonRectangleRounded=this.newToolShapeButtonRectangleRounded()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonRectangleRounded=function(){var e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonRectangleRoundedTitle(),"shape_rectangle_rounded",t.EShapeRectangleRounded)},Object.defineProperty(n.prototype,"toolShapeButtonTriangle",{get:function(){var t;return null!==(t=this._toolShapeButtonTriangle)&&void 0!==t?t:this._toolShapeButtonTriangle=this.newToolShapeButtonTriangle()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonTriangle=function(){var e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonTriangleTitle(),"shape_triangle",t.EShapeTriangle)},Object.defineProperty(n.prototype,"toolShapeButtonTriangleRounded",{get:function(){var t;return null!==(t=this._toolShapeButtonTriangleRounded)&&void 0!==t?t:this._toolShapeButtonTriangleRounded=this.newToolShapeButtonTriangleRounded()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonTriangleRounded=function(){var e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonTriangleRoundedTitle(),"shape_triangle_rounded",t.EShapeTriangleRounded)},Object.defineProperty(n.prototype,"toolShapeButtonLine",{get:function(){var t;return null!==(t=this._toolShapeButtonLine)&&void 0!==t?t:this._toolShapeButtonLine=this.newToolShapeButtonLine()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonLine=function(){var e=this,n=this._theme,i=new t.DButton({group:this.toolShapeButtonGroup,toggle:!0,title:n.getToolShapeButtonLineTitle(),theme:n.getToolShapeButtonTheme(),image:{source:this._icons.shape_line},on:{active:function(){e.onToolShapeButtonLineActive()},inactive:function(){e.onToolShapeButtonLineInactive()}}});return this.toolShapeSelect.on("edit",(function(n){if(n instanceof t.EShapeLine){var i=e.toolShapeEditLine;i.shape=n,e.toolGroup.activate(i)}})),i},n.prototype.onToolShapeButtonLineActive=function(){this.toolGroup.activate(this.toolShapeCreateLine)},n.prototype.onToolShapeButtonLineInactive=function(){this.toolGroup.deactivate(this.toolShapeCreateLine)},Object.defineProperty(n.prototype,"toolShapeButtonLineConnector",{get:function(){var t;return null!==(t=this._toolShapeButtonLineConnector)&&void 0!==t?t:this._toolShapeButtonLineConnector=this.newToolShapeButtonLineConnector()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonLineConnector=function(){var e=this,n=this._theme,i=new t.DButton({group:this.toolShapeButtonGroup,toggle:!0,title:n.getToolShapeButtonLineConnectorTitle(),theme:n.getToolShapeButtonTheme(),image:{source:this._icons.shape_line_connector},on:{active:function(){e.onToolShapeButtonLineConnectorActive()},inactive:function(){e.onToolShapeButtonLineConnectorInactive()}}});return this.toolShapeSelect.on("edit",(function(n){if(n instanceof t.EShapeConnectorLine){var i=e.toolShapeEditLineConnector;i.shape=n,e.toolGroup.activate(i)}})),i},n.prototype.onToolShapeButtonLineConnectorActive=function(){this.toolGroup.activate(this.toolShapeCreateLineConnector)},n.prototype.onToolShapeButtonLineConnectorInactive=function(){this.toolGroup.deactivate(this.toolShapeCreateLineConnector)},Object.defineProperty(n.prototype,"toolShapeButtonElbowConnector",{get:function(){var t;return null!==(t=this._toolShapeButtonElbowConnector)&&void 0!==t?t:this._toolShapeButtonElbowConnector=this.newToolShapeButtonElbowConnector()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonElbowConnector=function(){var e=this,n=this._theme,i=new t.DButton({group:this.toolShapeButtonGroup,toggle:!0,title:n.getToolShapeButtonElbowConnectorTitle(),theme:n.getToolShapeButtonTheme(),image:{source:this._icons.shape_elbow_connector},on:{active:function(){e.onToolShapeButtonElbowConnectorActive()},inactive:function(){e.onToolShapeButtonElbowConnectorInactive()}}});return this.toolShapeSelect.on("edit",(function(n){if(n instanceof t.EShapeConnectorLine){var i=e.toolShapeEditLineConnector;i.shape=n,e.toolGroup.activate(i)}})),i},n.prototype.onToolShapeButtonElbowConnectorActive=function(){this.toolGroup.activate(this.toolShapeCreateElbowConnector)},n.prototype.onToolShapeButtonElbowConnectorInactive=function(){this.toolGroup.deactivate(this.toolShapeCreateElbowConnector)},Object.defineProperty(n.prototype,"toolShapeButtonImage",{get:function(){var t;return null!==(t=this._toolShapeButtonImage)&&void 0!==t?t:this._toolShapeButtonImage=this.newToolShapeButtonImage()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonImage=function(){var e=this,n=this._theme;return new t.DButtonFile({group:this.toolShapeButtonGroup,title:n.getToolShapeButtonImageTitle(),theme:n.getToolShapeButtonTheme(),as:t.DButtonFileAs.DATA_URL,image:{source:this._icons.editor_image},on:{open:function(t){e.onToolShapeButtonImageOpen(t)}}})},n.prototype.onToolShapeButtonImageOpen=function(e){var n=this,i=this.diagram,o=i.layer,r=i.canvas;null!=r&&null!=o&&t.createImage(e).then((function(e){e.transform.position.set(.5*r.width,.5*r.height),e.attach(o),t.DControllers.getCommandController().push(new F([e],o,n.toolShapeSelect.selection,!0))}))},Object.defineProperty(n.prototype,"toolShapeButtonGraphicPiece",{get:function(){var t;return null!==(t=this._toolShapeButtonGraphicPiece)&&void 0!==t?t:this._toolShapeButtonGraphicPiece=this.newToolShapeButtonGraphicPiece()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeButtonGraphicPiece=function(){var e=this,n=this._theme;return new t.DButton({group:this.toolShapeButtonGroup,title:n.getToolShapeButtonGraphicPieceTitle(),theme:n.getToolShapeButtonTheme(),image:{source:this._icons.graphic_piece},on:{active:function(t){e.onToolShapeButtonGraphicPieceActive(t)}}})},n.prototype.onToolShapeButtonGraphicPieceActive=function(t){this.dialogSelectPiece.then((function(e){e.open(t)}))},n.prototype.newToolShapeButtonExtensionFactory=function(e){var n=this,i=null;return new t.DButton({group:this.toolShapeButtonGroup,title:this.toExtensionTitle(e),theme:this._theme.getToolShapeButtonTheme(),image:{source:e.icon.texture},on:{active:function(t){(null!=i?i:i=n.newDialogSelectExtensionFactory(e)).open(t)}}})},n.prototype.newToolShapeButtonExtension=function(e){var n=this,i=null,o=new t.DButton({group:this.toolShapeButtonGroup,title:this.toExtensionTitle(e),theme:this._theme.getToolShapeButtonTheme(),toggle:!0,image:{source:e.icon.texture},on:{active:function(){null==i&&(i=n.toExtensionCreatorOrTool(e)),n.onToolShapeButtonExtensionActive(i)},inactive:function(){null==i&&(i=n.toExtensionCreatorOrTool(e)),n.onToolShapeButtonExtensionInactive(i)}}});if("type"in e){var r=e.updater;if(null!=r){var a=e.type,l=null;this.toolShapeSelect.on("edit",(function(t){t.type===a&&(null==l&&(l=n.toExtensionUpdater(r)),l.shape=t,n.toolGroup.activate(l))}))}}return o},n.prototype.toExtensionUpdater=function(e){var n=this,i=(t.isFunction(e)?e:e.tool)(this.toolShapeSelect.selection,this.diagram);return i.on("done",(function(){n.toolGroup.activate(n.toolShapeSelect)})),i.on("cancel",(function(){n.toolGroup.activate(n.toolShapeSelect)})),i},n.prototype.toExtensionCreatorOrTool=function(e){var n=this,i=e.creator;if(t.isFunction(i))return i;var o=i.tool(this.toolShapeSelect.selection,this.diagram);return o.on("done",(function(){n.toolShapeButtonSelect.activate()})),o.on("cancel",(function(){n.toolShapeButtonSelect.activate()})),o},n.prototype.onToolShapeButtonExtensionActive=function(e){var n=this.toolGroup;if(t.isFunction(e)){var i=this.toolShapeCreate;i.shape=e,n.activate(i,e)}else n.activate(e)},n.prototype.onToolShapeButtonExtensionInactive=function(e){var n=this.toolGroup;t.isFunction(e)?n.deactivate(this.toolShapeCreate,e):n.deactivate(e)},n.prototype.toExtensionTitle=function(e){var n=e.title;return t.isString(n)?n:n.create},n.prototype.newDialogSelectExtensionFactory=function(e){var n=this;return new t.DDialogSelect({controller:e,list:{data:{toLabel:e.item.toLabel}},on:{select:function(t){n.onDialogSelectExtensionFactorySelect(t,e)}}})},n.prototype.onDialogSelectExtensionFactorySelect=function(e,n){var i=this,o=this.diagram,r=o.layer,a=o.canvas;a&&r&&n.item.toCreator(e).then((function(e){var n=e();n.transform.position.set(.5*a.width,.5*a.height),n.attach(r),t.DControllers.getCommandController().push(new F([n],r,i.toolShapeSelect.selection,!0))}))},n.prototype.newToolFileButtons=function(){return[this.toolFileButtonCreate,this.toolFileButtonOpen,this.toolFileButtonSave,this.toolFileButtonSaveAs,this.toolFileButtonUpload,this.toolFileButtonDownload,this.toolFileButtonUndo,this.toolFileButtonRedo,this.toolFileButtonDelete]},n.prototype.newToolShapeButtons=function(){var t=[this.toolShapeButtonSelect,this.toolShapeButtonLine,this.toolShapeButtonCircle,this.toolShapeButtonSemicircle,this.toolShapeButtonRectangle,this.toolShapeButtonRectangleRounded,this.toolShapeButtonTriangle,this.toolShapeButtonTriangleRounded,this.toolShapeButtonLineConnector,this.toolShapeButtonElbowConnector,this.toolShapeButtonImage];return this._isPieceEnabled&&t.push(this.toolShapeButtonGraphicPiece),t},n.prototype.newToolShapeButtonsExtension=function(){var t=this,e=[];return Ge.each((function(n){"icon"in n&&e.push(t.newToolShapeButtonExtension(n))})),di.each((function(n){e.push(t.newToolShapeButtonExtensionFactory(n))})),e},n.prototype.getToolButtonLayoutContainer=function(){return this._application.stage},n.prototype.newToolButtonLayout=function(){var e=this._margin;return new t.DLayoutVertical({x:e,y:this.getToolButtonLayoutY(e),theme:"EButtonToolLayout",children:this.newToolButtons()})},n.prototype.getToolButtonLayoutY=function(t){var e=this._header;return null!=e?t+e.height+t:t},n.prototype.newToolButtons=function(){var e=this._toolFileButtonCreate;return null==e||null==e.parent?this.newToolFileButtons().concat(new t.DLayoutSpace({height:10})).concat(this.newToolShapeButtons()).concat(this.newToolShapeButtonsExtension()):this.newToolShapeButtons().concat(this.newToolShapeButtonsExtension())},Object.defineProperty(n.prototype,"editorButtonGroup",{get:function(){var t;return null!==(t=this._editorButtonGroup)&&void 0!==t?t:this._editorButtonGroup=this.newEditorButtonGroup()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonGroup=function(){},Object.defineProperty(n.prototype,"editorButtonCoordinate",{get:function(){var t;return null!==(t=this._editorButtonCoordinate)&&void 0!==t?t:this._editorButtonCoordinate=this.newEditorButtonCoordinate()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonCoordinate=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_coordinate},title:n.getEditorButtonCoordinateTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorCoordinate.show()},inactive:function(){e.editorCoordinate.hide()}}})},Object.defineProperty(n.prototype,"editorCoordinate",{get:function(){var t;return null!==(t=this._editorCoordinate)&&void 0!==t?t:this._editorCoordinate=this.newEditorCoordinate()},enumerable:!1,configurable:!0}),n.prototype.newEditorCoordinate=function(){return this.initEditor(0,new Ri({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons}))},n.prototype.initEditor=function(e,n){return n.zIndex=e,n.parent.sortChildren(),n.interactive=!0,n instanceof t.DBase&&(n.state.isFocusable=!1),n},Object.defineProperty(n.prototype,"editorButtonShape",{get:function(){var t;return null!==(t=this._editorButtonShape)&&void 0!==t?t:this._editorButtonShape=this.newEditorButtonShape()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonShape=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_shape},title:n.getEditorButtonShapeTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorShape.show()},inactive:function(){e.editorShape.hide()}}})},Object.defineProperty(n.prototype,"editorShape",{get:function(){var t;return null!==(t=this._editorShape)&&void 0!==t?t:this._editorShape=this.newEditorShape()},enumerable:!1,configurable:!0}),n.prototype.newEditorShape=function(){var t=this;return this.initEditor(1,new Gi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,canvas:this._canvas,content:{theme:"EEditorPaneContent"},piece:{enable:this._isPieceEnabled,controller:this._options.controller,exclude:function(){return t._toPieceId(t.diagram)}},connector:{dangling:this.isDanglingConnectorAllowed()}}))},Object.defineProperty(n.prototype,"editorButtonText",{get:function(){var t;return null!==(t=this._editorButtonText)&&void 0!==t?t:this._editorButtonText=this.newEditorButtonText()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonText=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_text},title:n.getEditorButtonTextTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorText.show()},inactive:function(){e.editorText.hide()}}})},Object.defineProperty(n.prototype,"editorText",{get:function(){var t;return null!==(t=this._editorText)&&void 0!==t?t:this._editorText=this.newEditorText()},enumerable:!1,configurable:!0}),n.prototype.newEditorText=function(){return this.initEditor(2,new Yi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,content:{theme:"EEditorPaneContent"}}))},Object.defineProperty(n.prototype,"editorButtonData",{get:function(){var t;return null!==(t=this._editorButtonData)&&void 0!==t?t:this._editorButtonData=this.newEditorButtonData()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonData=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_data},title:n.getEditorButtonDataTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorData.show()},inactive:function(){e.editorData.hide()}}})},Object.defineProperty(n.prototype,"editorData",{get:function(){var t;return null!==(t=this._editorData)&&void 0!==t?t:this._editorData=this.newEditorData()},enumerable:!1,configurable:!0}),n.prototype.newEditorData=function(){return this.initEditor(3,new Vi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons}))},Object.defineProperty(n.prototype,"editorButtonDataMapping",{get:function(){var t;return null!==(t=this._editorButtonDataMapping)&&void 0!==t?t:this._editorButtonDataMapping=this.newEditorButtonDataMapping()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonDataMapping=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_data_mapping},title:n.getEditorButtonDataMappingTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorDataMapping.show()},inactive:function(){e.editorDataMapping.hide()}}})},Object.defineProperty(n.prototype,"editorDataMapping",{get:function(){var t;return null!==(t=this._editorDataMapping)&&void 0!==t?t:this._editorDataMapping=this.newEditorDataMapping()},enumerable:!1,configurable:!0}),n.prototype.newEditorDataMapping=function(){return this.initEditor(4,new ki({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons}))},Object.defineProperty(n.prototype,"editorButtonAction",{get:function(){var t;return null!==(t=this._editorButtonAction)&&void 0!==t?t:this._editorButtonAction=this.newEditorButtonAction()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonAction=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_action},title:n.getEditorButtonActionTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorAction.show()},inactive:function(){e.editorAction.hide()}}})},Object.defineProperty(n.prototype,"editorAction",{get:function(){var t;return null!==(t=this._editorAction)&&void 0!==t?t:this._editorAction=this.newEditorAction()},enumerable:!1,configurable:!0}),n.prototype.newEditorAction=function(){return this.initEditor(5,new Ai({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram}))},Object.defineProperty(n.prototype,"editorButtonTree",{get:function(){var t;return null!==(t=this._editorButtonTree)&&void 0!==t?t:this._editorButtonTree=this.newEditorButtonTree()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonTree=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_tree},title:n.getEditorButtonTreeTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorTree.show()},inactive:function(){e.editorTree.hide()}}})},Object.defineProperty(n.prototype,"editorTree",{get:function(){var t;return null!==(t=this._editorTree)&&void 0!==t?t:this._editorTree=this.newEditorTree()},enumerable:!1,configurable:!0}),n.prototype.newEditorTree=function(){return this.initEditor(6,new Ki({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram}))},Object.defineProperty(n.prototype,"editorButtonLayer",{get:function(){var t;return null!==(t=this._editorButtonLayer)&&void 0!==t?t:this._editorButtonLayer=this.newEditorButtonLayer()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonLayer=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_layer},title:n.getEditorButtonLayerTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorLayer.show()},inactive:function(){e.editorLayer.hide()}}})},Object.defineProperty(n.prototype,"editorLayer",{get:function(){var t;return null!==(t=this._editorLayer)&&void 0!==t?t:this._editorLayer=this.newEditorLayer()},enumerable:!1,configurable:!0}),n.prototype.newEditorLayer=function(){return this.initEditor(7,new Ni({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram}))},Object.defineProperty(n.prototype,"editorButtonSnap",{get:function(){var t;return null!==(t=this._editorButtonSnap)&&void 0!==t?t:this._editorButtonSnap=this.newEditorButtonSnap()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonSnap=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_snap},title:n.getEditorButtonSnapTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorSnap.show()},inactive:function(){e.editorSnap.hide()}}})},Object.defineProperty(n.prototype,"editorSnap",{get:function(){var t;return null!==(t=this._editorSnap)&&void 0!==t?t:this._editorSnap=this.newEditorSnap()},enumerable:!1,configurable:!0}),n.prototype.newEditorSnap=function(){return this.initEditor(8,new Ui({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram}))},Object.defineProperty(n.prototype,"editorButtonValidation",{get:function(){var t;return null!==(t=this._editorButtonValidation)&&void 0!==t?t:this._editorButtonValidation=this.newEditorButtonValidation()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonValidation=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_validation},title:n.getEditorButtonValidationTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorValidation.show()},inactive:function(){e.editorValidation.hide()}}})},Object.defineProperty(n.prototype,"editorValidation",{get:function(){var t;return null!==(t=this._editorValidation)&&void 0!==t?t:this._editorValidation=this.newEditorValidation()},enumerable:!1,configurable:!0}),n.prototype.newEditorValidation=function(){return this.initEditor(9,new Zi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram,validator:this._validation.validator}))},Object.defineProperty(n.prototype,"editorButtonSearch",{get:function(){var t;return null!==(t=this._editorButtonSearch)&&void 0!==t?t:this._editorButtonSearch=this.newEditorButtonSearch()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonSearch=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_search},title:n.getEditorButtonSearchTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorSearch.show()},inactive:function(){e.editorSearch.hide()}}})},Object.defineProperty(n.prototype,"editorSearch",{get:function(){var t;return null!==(t=this._editorSearch)&&void 0!==t?t:this._editorSearch=this.newEditorSearch()},enumerable:!1,configurable:!0}),n.prototype.newEditorSearch=function(){return this.initEditor(9,new Hi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram,finder:this._search.finder,interval:this._search.interval}))},Object.defineProperty(n.prototype,"editorCanvas",{get:function(){var t;return null!==(t=this._editorCanvas)&&void 0!==t?t:this._editorCanvas=this.newEditorCanvas()},enumerable:!1,configurable:!0}),n.prototype.newEditorCanvas=function(){return new Oi({icons:this._icons,diagram:this.diagram,canvas:this._canvas})},n.prototype.isEditorCanvasCompatible=function(){var t,e;return!!(null===(e=null===(t=this._options.compatibility)||void 0===t?void 0:t.editor)||void 0===e?void 0:e.canvas)},Object.defineProperty(n.prototype,"editorButtonCanvasLegacy",{get:function(){var t;return null!==(t=this._editorButtonCanvasLegacy)&&void 0!==t?t:this._editorButtonCanvasLegacy=this.newEditorButtonCanvasLegacy()},enumerable:!1,configurable:!0}),n.prototype.newEditorButtonCanvasLegacy=function(){var e=this,n=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_canvas_legacy},title:n.getEditorButtonCanvasLegacyTitle(),theme:n.getEditorButtonTheme(),on:{active:function(){e.editorCanvasLegacy.show()},inactive:function(){e.editorCanvasLegacy.hide()}}})},Object.defineProperty(n.prototype,"editorCanvasLegacy",{get:function(){var t;return null!==(t=this._editorCanvasLegacy)&&void 0!==t?t:this._editorCanvasLegacy=this.newEditorCanvasLegacy()},enumerable:!1,configurable:!0}),n.prototype.newEditorCanvasLegacy=function(){return this.initEditor(10,new Zo({parent:this.editorContainer,diagram:this.diagram,canvas:this._canvas,content:{theme:"EEditorPaneContent"}}))},n.prototype.newEditorButtonExtension=function(e,n){var i=this,o=null,r=new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:e.icon.texture},title:n.title,theme:this._theme.getEditorButtonTheme(),visible:!1,on:{active:function(){null!=o||(o=i.newEditorExtension(n)),o.show()},inactive:function(){o&&o.hide()}}});return this.toolShapeSelect.selection.on("change",(function(){i.onEditorButtonExtensionSelectionChange(r,e.type)})),r},n.prototype.newEditorExtension=function(t){return this.initEditor(11,new t.constructor({parent:this.editorContainer,selection:this.toolShapeSelect.selection,diagram:this.diagram,icons:this._icons,content:{theme:"EEditorPaneContent"},theme:t.theme}))},n.prototype.onEditorButtonExtensionSelectionChange=function(t,e){var n=this.toolShapeSelect.selection.last(),i=this._editorButtonExtensionLast;if(null!=n&&n.type===e&&i!==t){var o=!1;null!=i&&(i.hide(),i.state.isActive&&(i.activate(),o=!0)),t.show(),this._editorButtonExtensionLast=t,o&&!t.state.isActive&&t.activate()}},Object.defineProperty(n.prototype,"viewButtonZoomOut",{get:function(){var t;return null!==(t=this._viewButtonZoomOut)&&void 0!==t?t:this._viewButtonZoomOut=this.newViewButtonZoomOut()},enumerable:!1,configurable:!0}),n.prototype.newViewButtonZoomOut=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_out},title:n.getViewButtonZoomOutTitle(),shortcut:n.getViewButtonZoomOutShortcut(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.zoomOut()}}})},Object.defineProperty(n.prototype,"viewButtonZoomIn",{get:function(){var t;return null!==(t=this._viewButtonZoomIn)&&void 0!==t?t:this._viewButtonZoomIn=this.newViewButtonZoomIn()},enumerable:!1,configurable:!0}),n.prototype.newViewButtonZoomIn=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_in},title:n.getViewButtonZoomInTitle(),shortcut:n.getViewButtonZoomInShortcut(),shortcuts:n.getViewButtonZoomInShortcuts(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.zoomIn()}}})},Object.defineProperty(n.prototype,"viewButtonDragAndPinch",{get:function(){var t;return null!==(t=this._viewButtonDragAndPinch)&&void 0!==t?t:this._viewButtonDragAndPinch=this.newViewButtonDragAndPinch()},enumerable:!1,configurable:!0}),n.prototype.newViewButtonDragAndPinch=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.camera},toggle:!0,title:n.getViewButtonDragAndPinchTitle(),shortcut:n.getViewButtonDragAndPinchShortcut(),theme:n.getViewButtonTheme(),on:{active:function(){e.toolGroup.suspend()},inactive:function(){e.toolGroup.resume()}}})},Object.defineProperty(n.prototype,"viewButtonReset",{get:function(){var t;return null!==(t=this._viewButtonReset)&&void 0!==t?t:this._viewButtonReset=this.newViewButtonReset()},enumerable:!1,configurable:!0}),n.prototype.newViewButtonReset=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_reset},title:n.getViewButtonResetTitle(),shortcut:n.getViewButtonResetShortcut(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.reset()}}})},Object.defineProperty(n.prototype,"viewButtonFit",{get:function(){var t;return null!==(t=this._viewButtonFit)&&void 0!==t?t:this._viewButtonFit=this.newViewButtonFit()},enumerable:!1,configurable:!0}),n.prototype.newViewButtonFit=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_fit},title:n.getViewButtonFitTitle(),shortcut:n.getViewButtonFitShortcut(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.fit()}}})},n.prototype.newEditorButtons=function(){var e=this,n=[this.editorButtonCoordinate,this.editorButtonShape,this.editorButtonText,this.editorButtonData,this.editorButtonDataMapping,this.editorButtonAction,this.editorButtonTree,this.editorButtonLayer,this.editorButtonSnap];return null!=this._validation.validator&&n.push(this.editorButtonValidation),n.push(this.editorButtonSearch),this.isEditorCanvasCompatible()&&n.push(this.editorButtonCanvasLegacy),Ge.each((function(t){if("editor"in t){var i=e.toEditorExtentionConstructorOptions(t);i&&n.push(e.newEditorButtonExtension(t,i))}})),n.push(new t.DLayoutSpace({weight:1}),this.viewButtonZoomOut,this.viewButtonZoomIn,this.viewButtonDragAndPinch,this.viewButtonReset,this.viewButtonFit),n},n.prototype.toEditorExtentionConstructorOptions=function(e){var n,i,o=e.editor;return t.isFunction(o)?{constructor:o,title:e.name||"",theme:"EEditorPane"}:o.constructor?{constructor:o.constructor,title:null!==(n=o.title)&&void 0!==n?n:e.name||"",theme:null!==(i=o.theme)&&void 0!==i?i:"EEditorPane"}:void 0},Object.defineProperty(n.prototype,"editorContainer",{get:function(){var t;return null!==(t=this._editorContainer)&&void 0!==t?t:this._editorContainer=this.newEditorContainer()},enumerable:!1,configurable:!0}),n.prototype.newEditorContainer=function(){return new t.DLayoutHorizontal({width:"auto",height:"padding"})},n.prototype.getEditorLayoutContainer=function(){return this._application.stage},n.prototype.newEditorLayout=function(){var e=this,n=this._margin,i=this.getToolButtonLayoutY(n);return new t.DLayoutHorizontal({x:function(t,e){return t-e-n},y:i,width:"auto",height:function(t){return t-i-n},theme:"EEditorLayout",children:[this.editorContainer,this.newEditorButtonLayout()],on:{resize:function(t,n){e.onEditorLayoutResized(t,n)}}})},n.prototype.newEditorButtonLayout=function(){return new t.DLayoutVertical({theme:"EEditorButtonLayout",children:this.newEditorButtons()})},n.prototype.onEditorLayoutResized=function(t,e){var n=this.diagram,i=n.theme,o=n.padding,r=this._margin,a=o.getLeft()-o.getRight();o.left=i.getPaddingLeft()+r+65,o.right=i.getPaddingRight()+r+t;var l=n.canvas;if(null!=l){var u=o.getLeft()-o.getRight();l.position.x+=.5*(u-a)}},Object.defineProperty(n.prototype,"toolShapeSelect",{get:function(){var t;return null!==(t=this._toolShapeSelect)&&void 0!==t?t:this._toolShapeSelect=this.newToolShapeSelect()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeSelect=function(){var t=this.diagram,e=new Po({diagram:t});return t.on("set",(function(){e.selection.clear()})),t.on("unset",(function(){e.selection.clear()})),e},Object.defineProperty(n.prototype,"toolShapeCreate",{get:function(){var t;return null!==(t=this._toolShapeCreate)&&void 0!==t?t:this._toolShapeCreate=this.newToolShapeCreate()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeCreate=function(){var t=this,e=new Fo(this.toolShapeSelect.selection,this.diagram);return e.on("done",(function(){t.toolShapeButtonSelect.activate()})),e},Object.defineProperty(n.prototype,"toolShapeCreateLine",{get:function(){var t;return null!==(t=this._toolShapeCreateLine)&&void 0!==t?t:this._toolShapeCreateLine=this.newToolShapeCreateLine()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeCreateLine=function(){var t=this,e=new No({selection:this.toolShapeSelect.selection,diagram:this.diagram});return e.on("done",(function(){t.toolShapeButtonSelect.activate()})),e.on("cancel",(function(){t.toolShapeButtonSelect.activate()})),e},Object.defineProperty(n.prototype,"toolShapeCreateLineConnector",{get:function(){var t;return null!==(t=this._toolShapeCreateLineConnector)&&void 0!==t?t:this._toolShapeCreateLineConnector=this.newToolShapeCreateLineConnector()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeCreateLineConnector=function(){var t=this,e=new Vo({selection:this.toolShapeSelect.selection,diagram:this.diagram,dangling:this.isDanglingConnectorAllowed()});return e.on("done",(function(){t.toolShapeButtonSelect.activate()})),e.on("cancel",(function(){t.toolShapeButtonSelect.activate()})),e},Object.defineProperty(n.prototype,"toolShapeCreateElbowConnector",{get:function(){var t;return null!==(t=this._toolShapeCreateElbowConnector)&&void 0!==t?t:this._toolShapeCreateElbowConnector=this.newToolShapeCreateElbowConnector()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeCreateElbowConnector=function(){var t=this,e=new Mo({selection:this.toolShapeSelect.selection,diagram:this.diagram,dangling:this.isDanglingConnectorAllowed()});return e.on("done",(function(){t.toolShapeButtonSelect.activate()})),e.on("cancel",(function(){t.toolShapeButtonSelect.activate()})),e},n.prototype.isDanglingConnectorAllowed=function(){var t;return null===(t=this._options.connector)||void 0===t?void 0:t.dangling},Object.defineProperty(n.prototype,"toolShapeEditLine",{get:function(){var t;return null!==(t=this._toolShapeEditLine)&&void 0!==t?t:this._toolShapeEditLine=this.newToolShapeEditLine()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeEditLine=function(){var t=this,e=new Go({selection:this.toolShapeSelect.selection,diagram:this.diagram});return e.on("done",(function(){t.toolGroup.activate(t.toolShapeSelect)})),e.on("cancel",(function(){t.toolGroup.activate(t.toolShapeSelect)})),e},Object.defineProperty(n.prototype,"toolShapeEditLineConnector",{get:function(){var t;return null!==(t=this._toolShapeEditLineConnector)&&void 0!==t?t:this._toolShapeEditLineConnector=this.newToolShapeEditLineConnector()},enumerable:!1,configurable:!0}),n.prototype.newToolShapeEditLineConnector=function(){var t=this,e=new Ho({selection:this.toolShapeSelect.selection,diagram:this.diagram,dangling:this.isDanglingConnectorAllowed()});return e.on("done",(function(){t.toolGroup.activate(t.toolShapeSelect)})),e.on("cancel",(function(){t.toolGroup.activate(t.toolShapeSelect)})),e},Object.defineProperty(n.prototype,"toolGroup",{get:function(){var t;return null!==(t=this._toolGroup)&&void 0!==t?t:this._toolGroup=this.newToolGroup()},enumerable:!1,configurable:!0}),n.prototype.newToolGroup=function(){return new qi},Object.defineProperty(n.prototype,"diagram",{get:function(){var t;return null!==(t=this._diagram)&&void 0!==t?t:this._diagram=this.newDiagram()},enumerable:!1,configurable:!0}),n.prototype.newDiagram=function(){return new t.DDiagramEditor(this.toDiagramOptions(this._options))},n.prototype.getDiagramContainer=function(){return this._application.stage},n.prototype.toDiagramOptions=function(e){var n,i,o,r,a,l,u,s,p,h,c,d,g,f,y,v,b,m,_,S,w,T,E,C,D,L,A,B,O,P,I,x=this,R=e.diagram||{};null!==(n=R.controller)&&void 0!==n||(R.controller=this._controller.graphic),null!==(i=R.x)&&void 0!==i||(R.x=0),null!==(o=R.y)&&void 0!==o||(R.y=0),null!==(r=R.width)&&void 0!==r||(R.width="100%"),null!==(a=R.height)&&void 0!==a||(R.height="100%");var k=null!==(l=R.outline)&&void 0!==l?l:R.outline={};null!==(u=k.color)&&void 0!==u||(k.color=null);var V=null!==(s=R.view)&&void 0!==s?s:R.view={},M=null!==(p=V.gesture)&&void 0!==p?p:V.gesture={};null!==(h=M.modifier)&&void 0!==h||(M.modifier=t.UtilGestureModifier.ALT);var N=null!==(c=M.checker)&&void 0!==c?c:M.checker={};null!==(d=N.start)&&void 0!==d||(N.start=function(e,n){return t.UtilGestureModifiers.match(e,n)||x.toolGroup.isSuspended()}),null!==(g=N.move)&&void 0!==g||(N.move=function(e,n){return t.UtilGestureModifiers.match(e,n)||x.diagram.state.isGesturing});var F=null!==(f=V.zoom)&&void 0!==f?f:V.zoom={},j=null!==(y=F.dblclick)&&void 0!==y?y:F.dblclick={};null!==(v=j.checker)&&void 0!==v||(j.checker=function(t,e){return x.toolGroup.isSuspended()});var z=null!==(b=V.on)&&void 0!==b?b:V.on={};null!==(m=z.gesturestart)&&void 0!==m||(z.gesturestart=function(){x.onDiagramViewOnStart()}),null!==(_=z.transformstart)&&void 0!==_||(z.transformstart=function(){x.onDiagramViewOnStart()}),null!==(S=z.wheeltranslationstart)&&void 0!==S||(z.wheeltranslationstart=function(){x.onDiagramViewOnStart()}),null!==(w=V.constraint)&&void 0!==w||(V.constraint=function(t,e,n,i,o){x.onDiagramViewConstraint(t,e,n,i,o)});var H=R.thumbnail;(null==H?void 0:H.enable)&&(null!==(T=H.size)&&void 0!==T||(H.size=2*wi()));var G=null!==(E=R.on)&&void 0!==E?E:R.on={};null!==(C=G.saving)&&void 0!==C||(G.saving=function(){x.onDiagramSaving(x._toolFileButtonSave)}),null!==(D=G.saved)&&void 0!==D||(G.saved=function(t){x.onDiagramSaved(t,x._toolFileButtonSave)}),null!==(L=G.deleting)&&void 0!==L||(G.deleting=function(){x.onDiagramDeleting(x._toolFileButtonDelete)}),null!==(A=G.deleted)&&void 0!==A||(G.deleted=function(t){x.onDiagramDeleted(t,x._toolFileButtonDelete)});var U=null!==(B=R.snapshot)&&void 0!==B?B:R.snapshot={},Y=null!==(O=U.on)&&void 0!==O?O:U.on={};return null!==(P=Y.taking)&&void 0!==P||(Y.taking=function(){x.onDiagramSnapshotTaking()}),null!==(I=Y.took)&&void 0!==I||(Y.took=function(){x.onDiagramSnapshotTook()}),R},n.prototype.onDiagramViewOnStart=function(){var t,n,i=this._diagram;if(null!=i){var o=null!==(t=this._localBoundsDiagram)&&void 0!==t?t:this._localBoundsDiagram=new e.Rectangle,r=i.padding,a=r.getLeft()-65-this._margin,l=r.getTop(),u=i.width-r.getRight(),s=i.height-r.getBottom();o.x=a,o.y=l,o.width=Math.max(0,u-a),o.height=Math.max(0,s-l);var p=i.canvas;if(null!=p){var h=null!==(n=this._localBoundsCanvas)&&void 0!==n?n:this._localBoundsCanvas=new e.Rectangle;p.getLocalBounds(h)}}},n.prototype.onDiagramViewConstraint=function(t,e,n,i,o){var r=this._localBoundsDiagram,a=this._localBoundsCanvas;null!=r&&null!=a&&(t.position.set(Math.max(r.x-(a.x+a.width)*i,Math.min(r.x+r.width-a.x*i,e)),Math.max(r.y-(a.y+a.height)*o,Math.min(r.y+r.height-a.y*o,n))),t.scale.set(i,o))},n.prototype.onDiagramSaving=function(t){this.dialogSaveProcessing.open(t)},n.prototype.onDiagramSaved=function(t,e){var n=this,i=this.dialogSaveProcessing;null==t?i.resolve():("duplication"===t&&i.once("close",(function(){n.dialogSaveAs.open(e)})),i.reject(t))},n.prototype.onDiagramDeleting=function(t){this.dialogDeleteProcessing.open(t)},n.prototype.onDiagramDeleted=function(t,e){var n=this.dialogDeleteProcessing;null==t?n.resolve():n.reject(t)},n.prototype.onDiagramSnapshotTaking=function(){this.toolShapeSelect.selection.modifier.renderable=!1},n.prototype.onDiagramSnapshotTook=function(){this.toolShapeSelect.selection.modifier.renderable=!0},Object.defineProperty(n.prototype,"dialogSaveProcessing",{get:function(){var t;return null!==(t=this._dialogSaveProcessing)&&void 0!==t?t:this._dialogSaveProcessing=this.newDialogSaveProcessing()},enumerable:!1,configurable:!0}),n.prototype.newDialogSaveProcessing=function(){return new _i},Object.defineProperty(n.prototype,"dialogDeleteProcessing",{get:function(){var t;return null!==(t=this._dialogDeleteProcessing)&&void 0!==t?t:this._dialogDeleteProcessing=this.newDialogDeleteProcessing()},enumerable:!1,configurable:!0}),n.prototype.newDialogDeleteProcessing=function(){return new _i},Object.defineProperty(n.prototype,"dialogSaveAs",{get:function(){var t;return null!==(t=this._dialogSaveAs)&&void 0!==t?t:this._dialogSaveAs=this.newDialogSaveAs()},enumerable:!1,configurable:!0}),n.prototype.newDialogSaveAs=function(){return new t.DDialogSaveAs},Object.defineProperty(n.prototype,"dialogCreate",{get:function(){var t;return null!==(t=this._dialogCreate)&&void 0!==t?t:this._dialogCreate=this.newDialogCreate()},enumerable:!1,configurable:!0}),n.prototype.newDialogCreate=function(){var t=this;return this._canvas.get().then((function(e){return new Bi({canvas:e,on:{ok:function(e,n){t.onDialogCreateOk(e,n)}}})}))},n.prototype.onDialogCreateOk=function(e,n){var i=this;this.diagram.create(e).then((function(e){t.DControllers.getCommandController().push(new u(i.diagram,e))}))},Object.defineProperty(n.prototype,"dialogDiscard",{get:function(){var t;return null!==(t=this._dialogDiscard)&&void 0!==t?t:this._dialogDiscard=this.newDialogDiscard()},enumerable:!1,configurable:!0}),n.prototype.newDialogDiscard=function(){return new t.DDialogConfirmDiscard},Object.defineProperty(n.prototype,"dialogSelect",{get:function(){var t;return null!==(t=this._dialogSelect)&&void 0!==t?t:this._dialogSelect=this.newDialogSelect()},enumerable:!1,configurable:!0}),n.prototype.newDialogSelect=function(){var t=this;return this._canvas.get().then((function(e){var n,i,o;return(null===(i=null===(n=t._options.diagram)||void 0===n?void 0:n.thumbnail)||void 0===i?void 0:i.enable)?((o=t.newDialogSelectImage()).categories=e.category.items,o):((o=t.newDialogSelectNoImage()).categories=e.category.items,o)}))},n.prototype.newDialogSelectNoImage=function(){var e=this;return new t.DDialogSelect({controller:this._controller.graphic,on:{select:function(t){e.onDialogSelectSelect(t)}}})},n.prototype.onDialogSelectSelect=function(e){var n=this;this.diagram.open(e.id).then((function(e){t.DControllers.getCommandController().push(new d(n.diagram,e))}))},n.prototype.newDialogSelectImage=function(){var t=this;return Di(this._options.controller.graphic,this._controller.toThumbnail,(function(e){t.onDialogSelectSelect(e)}))},Object.defineProperty(n.prototype,"dialogSelectPiece",{get:function(){var t;return null!==(t=this._dialogSelectPiece)&&void 0!==t?t:this._dialogSelectPiece=this.newDialogSelectPiece()},enumerable:!1,configurable:!0}),n.prototype.newDialogSelectPiece=function(){var t=this;return this._canvas.get().then((function(e){var n,i,o;return(null===(i=null===(n=t._options.diagram)||void 0===n?void 0:n.thumbnail)||void 0===i?void 0:i.enable)?((o=t.newDialogSelectPieceImage()).categories=e.category.items,o):((o=t.newDialogSelectPieceNoImage()).categories=e.category.items,o)}))},n.prototype.newDialogSelectPieceNoImage=function(){var e=this;return new t.DDialogSelect({controller:this.newDialogSelectPieceController(),on:{select:function(t){e.onDialogSelectPieceSelect(t)}}})},n.prototype.newDialogSelectPieceImage=function(){var t=this;return Di(this.newDialogSelectPieceController(),this._options.controller.toPieceThumbnail,(function(e){t.onDialogSelectPieceSelect(e)}))},n.prototype.newDialogSelectPieceController=function(){var t=this,e=this._options.controller.graphic.piece;return{search:function(n,i){return e.search(n,i).then((function(e){return t.toDialogSelectPieceResult(e)}))}}},n.prototype.toDialogSelectPieceResult=function(t){var e=this._toPieceId(this.diagram);if(null==e)return t;for(var n=[],i=0,o=t.length;i<o;++i){var r=t[i];r.id!==e&&n.push(r)}return n},n.prototype.onDialogSelectPieceSelect=function(e){var n=this,i=this.diagram,o=i.layer,r=i.canvas;if(r&&o){var a=this._options.controller.graphic;a.piece.get(e.id).then((function(e){t.EShapeEmbeddeds.from(e,a,t.EShapeResourceManagerDeserializationMode.EDITOR).then((function(e){e.transform.position.set(.5*r.width,.5*r.height),e.attach(o),t.DControllers.getCommandController().push(new F([e],o,n.toolShapeSelect.selection,!0))}))}))}},Object.defineProperty(n.prototype,"dialogDelete",{get:function(){var t;return null!==(t=this._dialogDelete)&&void 0!==t?t:this._dialogDelete=this.newDialogDelete()},enumerable:!1,configurable:!0}),n.prototype.newDialogDelete=function(){var e=this;return new t.DDialogConfirmDelete({on:{ok:function(t,n){e.onDialogDeleteOk(n)}}})},n.prototype.onDialogDeleteOk=function(e){this.diagram.delete().then((function(){t.DControllers.getCommandController().clear()}))},n.prototype.toTheme=function(e){var n=null==e?void 0:e.theme;return n?t.isString(n)?t.DThemes.getInstance().get(n):n:this.getThemeDefault()},n.prototype.getThemeDefault=function(){return t.DThemes.getInstance().get(this.getType())},n.prototype.getType=function(){return"FGraphicEditor"},n}(),Jo=function(){function n(n){var i,o,r=this;this._options=n;var a=this.toTheme(n);this._theme=a,this._controller=n.controller,this._category=new Yo(null===(i=n.canvas)||void 0===i?void 0:i.category),this._icons=a.getIconBuilder().build();var l=null!==(o=n.margin)&&void 0!==o?o:a.getMargin();this._margin=l,this._isEditable=!1!==n.editable,this._isChanged=!1,this._onDiagramMoveBound=function(t){r.onDiagramMove(t)},this._onDiagramUpBound=function(t){r.onDiagramUp(t)},this._onDiagramDownPoint=new e.Point,this._onDiagramMovePoint=new e.Point,this._selectAreaRect=new e.Rectangle,this._selectMode=0,this._childSelectTime=0,this._childSelectChild=null,this._isSelectSuspended=!1,this._expressionMap=new Map,this._appliedValues=new Map,this._isMappingsDirty=!1;var u=new t.DApplication(n.application);this._application=u,u.stage.addChild(this.newPanes(n)),this.onChange();var s=function(){r._isMappingsDirty&&(r._isMappingsDirty=!1,r.onMappingsChange()),setTimeout(s,100)};s()}return Object.defineProperty(n.prototype,"application",{get:function(){return this._application},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"controller",{get:function(){return this._controller},enumerable:!1,configurable:!0}),n.prototype.newHeader=function(t){var e=t.header;if(e){var n=e();if(n){var i=this._margin;return n.x=i,n.y=i,n.setWidth((function(t){return t})),n}}return null},n.prototype.newPanes=function(e){var n=this._margin;return new t.DLayoutVertical({x:n,y:n,width:function(t){return t-2*n},height:function(t){return t-2*n},margin:n,children:[this.newHeader(e),new t.DLayoutHorizontal({weight:1,width:"padding",margin:.5*this._margin,children:[this.leftPane,this.rightPane]})]})},Object.defineProperty(n.prototype,"leftPane",{get:function(){var t=this._paneLeft;return null==t&&(t=this.newLeftPane(),this._paneLeft=t),t},enumerable:!1,configurable:!0}),n.prototype.newLeftPane=function(){return new t.DBoard({weight:1,height:"padding",shadow:"WEAK",children:[this.diagram,this.toolFileButtonGraphicOpen,this.layoutViewButton]})},Object.defineProperty(n.prototype,"toolFileButtonGraphicOpen",{get:function(){var t=this._toolFileButtonGraphicOpen;return null==t&&(t=this.newToolFileButtonGraphicOpen(),this._toolFileButtonGraphicOpen=t),t},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonGraphicOpen=function(){var e=this,n=this._theme,i=.5*this._margin;return new t.DButton({x:i,y:i,image:{source:this._icons.open},title:n.getToolFileButtonGraphicOpenTitle(),shortcut:n.getToolFileButtonGraphicOpenShortcut(),theme:n.getToolFileButtonGraphicTheme(),on:{active:function(t){e.onToolFileButtonGraphicOpenActive(t)}}})},n.prototype.onToolFileButtonGraphicOpenActive=function(t){var e=this;this.isChanged?this.dialogDiscard.open(t).then((function(){e.dialogSelectGraphic.then((function(e){e.open(t)}))})):this.dialogSelectGraphic.then((function(e){e.open(t)}))},Object.defineProperty(n.prototype,"layoutViewButton",{get:function(){var t=this._layoutViewButton;return null==t&&(t=this.newLayoutViewButton(),this._layoutViewButton=t),t},enumerable:!1,configurable:!0}),n.prototype.newLayoutViewButton=function(){var e=.5*this._margin,n=function(t,n){return t-n-e};return new t.DLayoutHorizontal({x:n,y:n,width:"auto",height:"auto",margin:0,padding:0,children:this.newViewButtons()})},n.prototype.newViewButtons=function(){return[this.viewButtonZoomOut,this.viewButtonZoomIn,this.viewButtonDragAndPinch,this.viewButtonReset,this.viewButtonFit]},Object.defineProperty(n.prototype,"viewButtonZoomOut",{get:function(){var t=this._viewButtonZoomOut;return null==t&&(t=this.newViewButtonZoomOut(),this._viewButtonZoomOut=t),t},enumerable:!1,configurable:!0}),n.prototype.newViewButtonZoomOut=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_out},title:n.getViewButtonZoomOutTitle(),shortcut:n.getViewButtonZoomOutShortcut(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.zoomOut()}}})},Object.defineProperty(n.prototype,"viewButtonZoomIn",{get:function(){var t=this._viewButtonZoomIn;return null==t&&(t=this.newViewButtonZoomIn(),this._viewButtonZoomIn=t),t},enumerable:!1,configurable:!0}),n.prototype.newViewButtonZoomIn=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_in},title:n.getViewButtonZoomInTitle(),shortcut:n.getViewButtonZoomInShortcut(),shortcuts:n.getViewButtonZoomInShortcuts(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.zoomIn()}}})},Object.defineProperty(n.prototype,"viewButtonReset",{get:function(){var t=this._viewButtonReset;return null==t&&(t=this.newViewButtonReset(),this._viewButtonReset=t),t},enumerable:!1,configurable:!0}),n.prototype.newViewButtonReset=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_reset},title:n.getViewButtonResetTitle(),shortcut:n.getViewButtonResetShortcut(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.reset()}}})},Object.defineProperty(n.prototype,"viewButtonDragAndPinch",{get:function(){var t=this._viewButtonDragAndPinch;return null==t&&(t=this.newViewButtonDragAndPinch(),this._viewButtonDragAndPinch=t),t},enumerable:!1,configurable:!0}),n.prototype.newViewButtonDragAndPinch=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.camera},toggle:!0,title:n.getViewButtonDragAndPinchTitle(),shortcut:n.getViewButtonDragAndPinchShortcut(),theme:n.getViewButtonTheme(),on:{active:function(){e._isSelectSuspended=!0},inactive:function(){e._isSelectSuspended=!1}}})},Object.defineProperty(n.prototype,"viewButtonFit",{get:function(){var t=this._viewButtonFit;return null==t&&(t=this.newViewButtonFit(),this._viewButtonFit=t),t},enumerable:!1,configurable:!0}),n.prototype.newViewButtonFit=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_fit},title:n.getViewButtonFitTitle(),shortcut:n.getViewButtonFitShortcut(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.fit()}}})},Object.defineProperty(n.prototype,"rightPane",{get:function(){var t=this._paneRight;return null==t&&(t=this.newRightPane(),this._paneRight=t),t},enumerable:!1,configurable:!0}),n.prototype.newRightPane=function(){return new t.DLayoutVertical({width:400,height:"padding",margin:.5*this._margin,children:[new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.toolFileButtonCreate,this.toolFileButtonOpen,this.toolFileButtonSave,this.toolFileButtonDelete]}),this.inputName,new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.tableFilterInput,this.toolFileButtonUpload,this.toolFileButtonDownload]}),this.table]})},Object.defineProperty(n.prototype,"dialogProcessing",{get:function(){var t=this._dialogProcessing;return null==t&&(t=this.newDialogProcessing(),this._dialogProcessing=t),t},enumerable:!1,configurable:!0}),n.prototype.newDialogProcessing=function(){return new _i},Object.defineProperty(n.prototype,"dialogDelete",{get:function(){var t=this._dialogConfirmDelete;return null==t&&(t=this.newDialogDelete(),this._dialogConfirmDelete=t),t},enumerable:!1,configurable:!0}),n.prototype.newDialogDelete=function(){var e=this;return new t.DDialogConfirmDelete({on:{ok:function(){var t=e._tester;t&&(null!=t.id&&e._controller.graphicTester.delete(t.id),e.tester=void 0)}}})},Object.defineProperty(n.prototype,"tableFilterInput",{get:function(){var t=this._tableFilterInput;return null==t&&(t=this.newTableFilterInput(),this._tableFilterInput=t),t},enumerable:!1,configurable:!0}),n.prototype.newTableFilterInput=function(){var e=this;return new t.DInputSearch({weight:1,on:{input:function(t){var n=t.trim();e.tableFilter.word=n;var i=e.table.data.filter;0<n.length?i.apply():i.unapply()}}})},Object.defineProperty(n.prototype,"toolFileButtonCreate",{get:function(){var t=this._toolFileButtonCreate;return null==t&&(t=this.newToolFileButtonCreate(),this._toolFileButtonCreate=t),t},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonCreate=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this.icons.new},title:n.getToolFileButtonCreateTitle(),shortcut:n.getToolFileButtonCreateShortcut(),theme:n.getToolFileButtonTheme(),on:{active:function(t){e.onToolFileButtonCreateActive(t)}}})},n.prototype.onToolFileButtonCreateActive=function(t){var e=this;this.isChanged?this.dialogDiscard.open(t).then((function(){e.dialogCreate.open(t)})):this.dialogCreate.open(t)},Object.defineProperty(n.prototype,"toolFileButtonOpen",{get:function(){var t=this._toolFileButtonOpen;return null==t&&(t=this.newToolFileButtonOpen(),this._toolFileButtonOpen=t),t},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonOpen=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this.icons.open},title:n.getToolFileButtonOpenTitle(),shortcut:n.getToolFileButtonOpenShortcut(),theme:n.getToolFileButtonTheme(),on:{active:function(t){e.onToolFileButtonOpenActive(t)}}})},n.prototype.onToolFileButtonOpenActive=function(t){var e=this;this.isChanged?this.dialogDiscard.open(t).then((function(){e.dialogSelectMapping.open(t)})):this.dialogSelectMapping.open(t)},Object.defineProperty(n.prototype,"toolFileButtonUpload",{get:function(){var t=this._toolFileButtonUpload;return null==t&&(t=this.newToolFileButtonUpload(),this._toolFileButtonUpload=t),t},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonUpload=function(){var e=this,n=this._theme;return new t.DButtonFile({image:{source:this.icons.upload},title:n.getToolFileButtonUploadTitle(),shortcut:n.getToolFileButtonUploadShortcut(),theme:n.getToolFileButtonTheme(),as:t.DButtonFileAs.TEXT,on:{open:function(t,n){e.onToolFileButtonUploadOpen(t,n)}}})},n.prototype.onToolFileButtonUploadOpen=function(t,e){var n=this._tester;n&&(n.mappings=Ie(t),this.onDiagramSelectionChange(),this.toDirty(),this.toMappingsDirty())},Object.defineProperty(n.prototype,"toolFileButtonDownload",{get:function(){var t=this._toolFileButtonDownload;return null==t&&(t=this.newToolFileButtonDownload(),this._toolFileButtonDownload=t),t},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonDownload=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this.icons.download},title:n.getToolFileButtonDownloadTitle(),shortcut:n.getToolFileButtonDownloadShortcut(),theme:n.getToolFileButtonTheme(),on:{active:function(){e.onToolFileButtonDownloadActive()}}})},n.prototype.onToolFileButtonDownloadActive=function(){var e=this._graphic,n=this._tester;if(e&&n){var i=this.diagram.canvas;if(i){for(var o=i.layer.children,r=new Map,a=[],l=0,u=o.length;l<u;++l)this.toCsvRows(o[l].children,n.mappings,null,r,a);a.sort((function(t,e){return t[0]-e[0]})),t.UtilFileDownloader.download(this.getFilename(),Pe.stringify(a))}}},n.prototype.toCsvRows=function(t,e,n,i,o){for(var r=0,a=t.length;r<a;++r){var l=t[r],u=(n||l).uuid,s=e.get(u),p=l.data,h=i.get(u);null==h&&(h=new Set,i.set(u,h));for(var c=0,d=p.size();c<d;++c){var g=p.get(c);if(g){var f=g.id;if(!h.has(f)){h.add(f);var y=s&&s[f]||"";o.push([u,f,y])}}}this.toCsvRows(l.children,e,this.toDataShape(n,l),i,o)}return o},Object.defineProperty(n.prototype,"toolFileButtonSave",{get:function(){var t=this._toolFileButtonSave;return null==t&&(t=this.newToolFileButtonSave(),this._toolFileButtonSave=t),t},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonSave=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this.icons.save},title:n.getToolFileButtonSaveTitle(),shortcut:n.getToolFileButtonSaveShortcut(),theme:n.getToolFileButtonTheme(),on:{active:function(t){e.onToolFileButtonSaveActive(t)}}})},n.prototype.onToolFileButtonSaveActive=function(t){var e=this,n=this._graphic,i=this._tester;if(n&&i){i.name=this.inputName.input.value;var o=Re(i),r=this.dialogProcessing;r.open(t),this._controller.graphicTester.save(o).then((function(t){o.id=t,e.tester=xe(o),r.resolve()}),(function(t){r.reject(t)}))}},Object.defineProperty(n.prototype,"toolFileButtonDelete",{get:function(){var t=this._toolFileButtonDelete;return null==t&&(t=this.newToolFileButtonDelete(),this._toolFileButtonDelete=t),t},enumerable:!1,configurable:!0}),n.prototype.newToolFileButtonDelete=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this.icons.delete},title:n.getToolFileButtonDeleteTitle(),shortcut:n.getToolFileButtonDeleteShortcut(),theme:n.getToolFileButtonTheme(),on:{active:function(t){e.onToolFileButtonDeleteActive(t)}}})},n.prototype.onToolFileButtonDeleteActive=function(t){this.dialogDelete.open(t)},Object.defineProperty(n.prototype,"inputName",{get:function(){var t=this._inputName;return null==t&&(t=this.newInputName(),this._inputName=t),t},enumerable:!1,configurable:!0}),n.prototype.newInputName=function(){var e=this;return new t.DInputTextAndLabel({width:"100%",label:{text:{value:this._theme.getInputNameLabel()}},input:{weight:1,on:{change:function(){e.toDirty()}}}})},Object.defineProperty(n.prototype,"icons",{get:function(){return this._icons},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"diagram",{get:function(){var t=this._diagram;return null==t&&(t=this.newDiagram(),this._diagram=t),t},enumerable:!1,configurable:!0}),n.prototype.newDiagram=function(){var e=this,n=new t.DDiagram(this.toDiagramOptions(this._options));return n.on("down",(function(t,n){e.onDiagramDown(t,n)})),n.on("keydown",(function(t){e.onDiagramKeydown(t)})),n},n.prototype.toDiagramOptions=function(e){var n,i,o,r,a,l,u,s,p,h,c,d,g,f,y=this,v=e.diagram||{};null!==(n=v.controller)&&void 0!==n||(v.controller=this._controller.graphic),null!==(i=v.width)&&void 0!==i||(v.width="100%"),null!==(o=v.height)&&void 0!==o||(v.height="100%"),null!==(r=v.mask)&&void 0!==r||(v.mask=!0),null!==(a=v.ambient)&&void 0!==a||(v.ambient=!0);var b=null!==(l=v.view)&&void 0!==l?l:v.view={},m=null!==(u=b.gesture)&&void 0!==u?u:b.gesture={};null!==(s=m.modifier)&&void 0!==s||(m.modifier=t.UtilGestureModifier.ALT);var _=null!==(p=m.checker)&&void 0!==p?p:m.checker={};null!==(h=_.start)&&void 0!==h||(_.start=function(e,n){return t.UtilGestureModifiers.match(e,n)||y._isSelectSuspended}),null!==(c=_.move)&&void 0!==c||(_.move=function(e,n){var i=y._diagram;return t.UtilGestureModifiers.match(e,n)||!(!i||!i.state.isGesturing)});var S=null!==(d=b.zoom)&&void 0!==d?d:b.zoom={},w=null!==(g=S.dblclick)&&void 0!==g?g:S.dblclick={};return null!==(f=w.checker)&&void 0!==f||(w.checker=function(t,e){return y._isSelectSuspended}),v},Object.defineProperty(n.prototype,"selection",{get:function(){var t=this,e=this._selection;return null==e&&((e=new Ao({diagram:this.diagram,modifier:{editable:!1}})).on("change",(function(){t.onDiagramSelectionChange()})),this._selection=e),e},enumerable:!1,configurable:!0}),n.prototype.toDataMappingRows=function(t,e,n,i,o){for(var r=0,a=t.length;r<a;++r){for(var l=t[r],u=(n||l).uuid,s=e.get(u),p=l.data,h=0,c=p.size();h<c;++h){var d=p.get(h);if(null!=d){var g=d.id,f=s&&s[g]||"",y=i.get(g);null==y?(y={uuids:[u],id:g,value:f},i.set(g,y),o.push(y)):(y.uuids.push(u),y.value=f)}}this.toDataMappingRows(l.children,e,this.toDataShape(n,l),i,o)}return o},n.prototype.toDataShape=function(e,n){return e||(n instanceof t.EShapeEmbedded?n:null)},n.prototype.onDiagramSelectionChange=function(){var t=this._selection,e=this._tester,n=this.table;if(t&&e){var i=t.get();if(0<i.length){var o=[];this.toDataMappingRows(i,e.mappings,null,new Map,o),n.data.clearAndAddAll(o)}else n.data.clear()}else n.data.clear()},n.prototype.onDiagramDown=function(e,n){if(!this._isSelectSuspended){var i=e.data.originalEvent;if(!i.altKey){var o=n.canvas;if(o){var r=i.ctrlKey||i.shiftKey;if(1===this._selectMode)return this._selectMode=0,void this.onDiagramSelectEnd(o,r);var a=e.data.global,l=this._onDiagramDownPoint;l.copyFrom(a);var u=this.selection,s=this.hitTest(a,o);if(s instanceof t.EShapeBase){if(r)u.toggle(s);else if(!u.contains(s)){var p=u.first();if(null==p)u.set(s.root);else{var h=q.toSelected(s);if(null!=h)t.EShapeCapabilities.contains(h,t.EShapeCapability.CHILDREN)&&(this._childSelectTime=Date.now(),this._childSelectChild=q.toOfParent(s,h));else{var c=q.toSharedParent(p,s);u.set(q.toOfParent(s,c))}}}this._selectMode=2}else{var d=this.selectArea;o.toLocal(a,void 0,l),d.x=l.x,d.y=l.y,d.size.set(0,0),d.update(),o.addChild(d),t.DApplications.update(n),this._selectMode=1}var g=this._interactionManager;if(g){this._interactionManager=null,g.off(t.UtilPointerEvent.move,this._onDiagramMoveBound);var f=this._onDiagramUpBound;g.off(t.UtilPointerEvent.up,f),g.off(t.UtilPointerEvent.upoutside,f),g.off(t.UtilPointerEvent.cancel,f)}var y=t.DApplications.getLayer(n);if(y){var v=y.renderer.plugins.interaction;this._interactionManager=v,v.on(t.UtilPointerEvent.move,this._onDiagramMoveBound),f=this._onDiagramUpBound,v.on(t.UtilPointerEvent.up,f),v.on(t.UtilPointerEvent.upoutside,f),v.on(t.UtilPointerEvent.cancel,f)}}}}},Object.defineProperty(n.prototype,"selectArea",{get:function(){var t=this._selectArea;return null==t&&(t=new Qi,this._selectArea=t),t},enumerable:!1,configurable:!0}),n.prototype.onDiagramMove=function(e){if(!e.data.originalEvent.altKey){var n=this.diagram,i=n.canvas,o=n.layer,r=this._selectMode;if(i&&o&&0!==r){var a=e.data.global,l=this._onDiagramDownPoint;if(1===r){var u=this.selectArea,s=i.toLocal(a,void 0,this._onDiagramMovePoint);u.x=Math.min(l.x,s.x),u.y=Math.min(l.y,s.y),u.size.set(Math.max(l.x,s.x)-u.x,Math.max(l.y,s.y)-u.y),u.update(),t.DApplications.update(n)}else{var p=a.x-l.x,h=a.y-l.y;(1<=Math.abs(p)||1<=Math.abs(h))&&(this._childSelectChild=null)}}}},n.prototype.onDiagramUp=function(e){var n=this.diagram,i=n.canvas,o=n.layer,r=this._selectMode,a=this._interactionManager;if(a){this._interactionManager=null,a.off(t.UtilPointerEvent.move,this._onDiagramMoveBound);var l=this._onDiagramUpBound;a.off(t.UtilPointerEvent.up,l),a.off(t.UtilPointerEvent.upoutside,l),a.off(t.UtilPointerEvent.cancel,l)}if(i&&o&&0!==r)if(this._selectMode=0,1===r){var u=e.data.originalEvent,s=u.ctrlKey||u.shiftKey;this.onDiagramSelectEnd(i,s)}else{var p=this.selection,h=this._childSelectChild;null!=h&&(this._childSelectChild=null,Date.now()-this._childSelectTime<333&&p.set(h)),t.DApplications.update(n)}},n.prototype.onDiagramSelectEnd=function(e,n){var i=this.selectArea,o=this.selection;if(0<i.size.x&&0<i.size.y){for(var r=i.getBounds(!1,this._selectAreaRect),a=[],l=e.layer.children,u=l.length-1;0<=u;--u)Bo.findShapes(l[u],r,a);n?0<a.length&&o.addAll(a):(0<a.length||!o.isEmpty())&&o.clearAndAddAll(a)}else n||o.isEmpty()||o.clear();e.removeChild(i),t.DApplications.update(e)},n.prototype.hitTest=function(t,e){for(var n=e.layer.children,i=n.length-1;0<=i;--i){var o=Oo.execute(t,n[i]);if(null!=o)return o}return null},n.prototype.onDiagramKeydown=function(e){if(t.UtilKeyboardEvent.isSelectAllKey(e)){var n=this.diagram.canvas;if(null!=n){var i=this.selection;i.clear();for(var o=n.layer.children,r=0,a=o.length;r<a;++r){var l=o[r].children;0<l.length&&i.addAll(l)}}}},Object.defineProperty(n.prototype,"table",{get:function(){var t=this._table;return null==t&&(t=this.newTable(),this._table=t),t},enumerable:!1,configurable:!0}),n.prototype.newTable=function(){return new t.DTable({weight:1,width:"padding",columns:this.newColumnOptions(),data:{filter:this.tableFilter}})},Object.defineProperty(n.prototype,"tableFilter",{get:function(){var t=this._tableFilter;return null==t&&(t=this.newTableFilter(),this._tableFilter=t),t},enumerable:!1,configurable:!0}),n.prototype.newTableFilter=function(){return{word:"",test:function(t){var e=this.word;return e.length<=0||0<=t.id.indexOf(e)||0<=t.value[0].indexOf(e)||0<=t.value[1].indexOf(e)}}},Object.defineProperty(n.prototype,"dialogSelectGraphic",{get:function(){var t=this._dialogSelectGraphic;return null==t&&(t=this.newDialogSelectGraphic(),this._dialogSelectGraphic=t),t},enumerable:!1,configurable:!0}),n.prototype.newDialogSelectGraphic=function(){var t=this;return this._category.get().then((function(e){var n;return null!=t._options.controller.toThumbnail?((n=t.newDialogSelectGraphicImage()).categories=e.items,n):((n=t.newDialogSelectGraphicNoImage()).categories=e.items,n)}))},n.prototype.newDialogSelectGraphicNoImage=function(){var e=this;return new t.DDialogSelect({controller:this._controller.graphic,on:{select:function(t){e.onDialogSelectGraphicSelect(t)}}})},n.prototype.newDialogSelectGraphicImage=function(){var t=this;return Di(this._options.controller.graphic,this._controller.toThumbnail,(function(e){t.onDialogSelectGraphicSelect(e)}))},n.prototype.onDialogSelectGraphicSelect=function(e){var n=this;this._controller.graphic.get(e.id).then((function(e){n.graphic=t.DDiagrams.toSerialized(e)}))},Object.defineProperty(n.prototype,"graphic",{get:function(){return this._graphic},set:function(t){this._graphic=t;var e=this.diagram;null!=t?e.set(t):e.set(null),this._appliedValues.clear(),this.tester=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dialogSelectMapping",{get:function(){var t=this._dialogSelectTester;return null==t&&(t=this.newDialogSelectMapping(),this._dialogSelectTester=t),t},enumerable:!1,configurable:!0}),n.prototype.newDialogSelectMapping=function(){var e=this,n=this._controller;return new t.DDialogSelect({controller:{search:function(t){var i=e._graphic;return i?n.graphicTester.search(i.name,t):Promise.resolve([])}},on:{select:function(t){n.graphicTester.get(t.id).then((function(t){e._graphic&&(e.tester=xe(t))}))}}})},Object.defineProperty(n.prototype,"dialogDiscard",{get:function(){var e=this._dialogDiscard;return null==e&&(e=new t.DDialogConfirmDiscard,this._dialogDiscard=e),e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dialogCreate",{get:function(){var t=this._dialogCreate;return null==t&&(t=this.newDialogCreate(),this._dialogCreate=t),t},enumerable:!1,configurable:!0}),n.prototype.newDialogCreate=function(){var e=this,n=new t.DDialogInputText({on:{open:function(){n.value=e._theme.newDialogCreateTextValue()},ok:function(t){var n=e._graphic;n&&(e.tester=Be(t,n))}}});return n},Object.defineProperty(n.prototype,"tester",{get:function(){return this._tester},set:function(t){this._isChanged=!1;var e=this.inputName.input;this._tester=t,e.value=t?t.name:"",this.onDiagramSelectionChange(),this.onChange(),this.toMappingsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isNew",{get:function(){var t=this._tester;return null!=t&&null==t.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isChanged",{get:function(){return this._isChanged||this.isNew},enumerable:!1,configurable:!0}),n.prototype.onChange=function(){var t=null==this._graphic,e=null==this._tester,n=!this.isChanged,i=!this._isEditable;this.table.state.isDisabled=e,this.tableFilterInput.state.isDisabled=e,this.inputName.state.isDisabled=e||i,this.toolFileButtonCreate.state.isDisabled=t||i,this.toolFileButtonOpen.state.isDisabled=t,this.toolFileButtonUpload.state.isDisabled=e||i,this.toolFileButtonDownload.state.isDisabled=e,this.toolFileButtonSave.state.isDisabled=e||n||i,this.toolFileButtonDelete.state.isDisabled=e||i},n.prototype.evaluate=function(t){return Function("try { return (".concat(t,"); } catch( e ) { return 0; }"))()},n.prototype.onMappingsChange=function(){var e=this._tester;if(e){var n=e.mappings,i=this.diagram,o=i.canvas;if(o){for(var r=!1,a=o.layer.children,l=0,u=a.length;l<u;++l)this.applyMappings(a[l].children,n,null)&&(r=!0);r&&t.DApplications.update(i)}}},n.prototype.applyMappings=function(t,e,n){for(var i=!1,o=0,r=t.length;o<r;++o){var a=t[o],l=(n||a).uuid,u=e.get(l);if(u)for(var s=a.data,p=0,h=s.size();p<h;++p){var c=s.get(p);null!=c&&this.applyMapping(c,u[c.id])&&(i=!0)}this.applyMappings(a.children,e,this.toDataShape(n,a))&&(i=!0)}return i},n.prototype.applyMapping=function(t,e){if(null!=e){var n=this._expressionMap;if(n.has(e))return this.applyMappingIfChanged(t,n.get(e));if(0<e.length)try{var i=this.evaluate(e);return n.set(e,i),this.applyMappingIfChanged(t,i)}catch(t){}}return!1},n.prototype.applyMappingIfChanged=function(t,e){var n=this._appliedValues;return n.has(t)?n.get(t)!==e&&(n.set(t,e),t.value=e,!0):(n.set(t,e),t.value=e,!0)},n.prototype.toDirty=function(){this._isChanged||(this._isChanged=!0,this.onChange())},n.prototype.toMappingsDirty=function(){this._isMappingsDirty=!0},n.prototype.getFilename=function(){var t=this.inputName.input.value.toLowerCase(),e=Ko.format(Date.now());return"graphic-tester-".concat(t,"-").concat(e,".csv")},n.prototype.newColumnOptions=function(){var t=this,e=this._isEditable,n=this._theme;return[{type:"TEXT",label:n.getTableColumnDataLabel(),editable:!1,sortable:!0,getter:function(t){return t.id},setter:function(e,n,i){e.id=i,t.toDirty()}},{type:"TEXT",label:n.getTableColumnValueLabel(),align:"LEFT",editable:e,sortable:!0,formatter:function(t){return t||""},getter:function(t){return t.value},setter:function(e,n,i){var o=t._tester;if(o){var r=e.uuids,a=o.mappings,l=e.id;if(0<i.length)for(var u=0,s=r.length;u<s;++u){var p=r[u];null==(h=a.get(p))&&(h={},a.set(p,h)),h[l]=i}else for(u=0,s=r.length;u<s;++u){var h;p=r[u],null!=(h=a.get(p))&&delete h[l]}}e.value=i,t.toDirty(),t.toMappingsDirty()}}]},n.prototype.toTheme=function(e){var n=null==e?void 0:e.theme;return n?t.isString(n)?t.DThemes.getInstance().get(n):n:this.getThemeDefault()},n.prototype.getThemeDefault=function(){return t.DThemes.getInstance().get(this.getType())},n.prototype.getType=function(){return"FGraphicTester"},n}(),Qo=function(){function e(e){var n,i;this._options=e;var o=this.toTheme(e);this._theme=o;var r=null!==(n=e.margin)&&void 0!==n?n:o.getMargin();this._margin=r;var a=o.getIconBuilder().build();this._icons=a,this._category=new Yo(null===(i=e.canvas)||void 0===i?void 0:i.category);var l=new t.DApplication(e.application);this._application=l;var u=l.stage,s=this.diagram;u.addChild(s);var p=this.header;null!=p&&u.addChild(p);var h=e.button;null!=h&&!1===h.view||u.addChild(this.layoutViewButton)}return Object.defineProperty(e.prototype,"application",{get:function(){return this._application},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"diagram",{get:function(){var t=this._diagram;return null==t&&(t=this.newDiagram(),this._diagram=t),t},enumerable:!1,configurable:!0}),e.prototype.newDiagram=function(){var e=this._options.controller;return new t.DDiagram({x:0,y:0,width:"100%",height:"100%",outline:{color:null},controller:e.graphic,data:{mapper:this.newDataMapper(),remote:{controller:e.remote}}})},Object.defineProperty(e.prototype,"header",{get:function(){var t=this._header;return void 0===t&&(t=this.newHeader(),this._header=t),t},enumerable:!1,configurable:!0}),e.prototype.newHeader=function(){var t=this._options.header;if(null!=t){var e=t(this.newToolFileButtons());if(null!=e){var n=this._margin;return e.x=n,e.y=n,e.setWidth((function(t){return t-2*n})),e}}return null},e.prototype.newToolFileButtons=function(){var t=[],e=this._options.button;return null!=e&&!1===e.open||t.push(this.toolFileButtonGraphicOpen),t},Object.defineProperty(e.prototype,"toolFileButtonGraphicOpen",{get:function(){var t=this._toolFileButtonGraphicOpen;return null==t&&(t=this.newToolFileButtonGraphicOpen(),this._toolFileButtonGraphicOpen=t),t},enumerable:!1,configurable:!0}),e.prototype.newToolFileButtonGraphicOpen=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.open},title:n.getToolFileButtonGraphicOpenTitle(),shortcut:n.getToolFileButtonGraphicOpenShortcut(),theme:n.getToolFileButtonGraphicTheme(),on:{active:function(t){e.onToolFileButtonGraphicOpenActive(t)}}})},e.prototype.onToolFileButtonGraphicOpenActive=function(t){this.dialogSelect.then((function(e){e.open(t)}))},Object.defineProperty(e.prototype,"layoutViewButton",{get:function(){var t=this._layoutViewButton;return null==t&&(t=this.newLayoutViewButton(),this._layoutViewButton=t),t},enumerable:!1,configurable:!0}),e.prototype.newLayoutViewButton=function(){var e=this._margin,n=function(t,n){return t-n-e};return new t.DLayoutHorizontal({x:n,y:n,width:"auto",height:"auto",margin:0,children:this.newViewButtons()})},e.prototype.newViewButtons=function(){return[this.viewButtonZoomOut,this.viewButtonZoomIn,this.viewButtonReset,this.viewButtonFit]},Object.defineProperty(e.prototype,"viewButtonZoomOut",{get:function(){var t=this._viewButtonZoomOut;return null==t&&(t=this.newViewButtonZoomOut(),this._viewButtonZoomOut=t),t},enumerable:!1,configurable:!0}),e.prototype.newViewButtonZoomOut=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_out},title:n.getViewButtonZoomOutTitle(),shortcut:n.getViewButtonZoomOutShortcut(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.zoomOut()}}})},Object.defineProperty(e.prototype,"viewButtonZoomIn",{get:function(){var t=this._viewButtonZoomIn;return null==t&&(t=this.newViewButtonZoomIn(),this._viewButtonZoomIn=t),t},enumerable:!1,configurable:!0}),e.prototype.newViewButtonZoomIn=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_in},title:n.getViewButtonZoomInTitle(),shortcut:n.getViewButtonZoomInShortcut(),shortcuts:n.getViewButtonZoomInShortcuts(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.zoomIn()}}})},Object.defineProperty(e.prototype,"viewButtonReset",{get:function(){var t=this._viewButtonReset;return null==t&&(t=this.newViewButtonReset(),this._viewButtonReset=t),t},enumerable:!1,configurable:!0}),e.prototype.newViewButtonReset=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_reset},title:n.getViewButtonResetTitle(),shortcut:n.getViewButtonResetShortcut(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.reset()}}})},Object.defineProperty(e.prototype,"viewButtonFit",{get:function(){var t=this._viewButtonFit;return null==t&&(t=this.newViewButtonFit(),this._viewButtonFit=t),t},enumerable:!1,configurable:!0}),e.prototype.newViewButtonFit=function(){var e=this,n=this._theme;return new t.DButton({image:{source:this._icons.view_fit},title:n.getViewButtonFitTitle(),shortcut:n.getViewButtonFitShortcut(),theme:n.getViewButtonTheme(),on:{active:function(){e.diagram.view.fit()}}})},Object.defineProperty(e.prototype,"dialogSelect",{get:function(){var t=this._dialogSelect;return null==t&&(t=this.newDialogSelect(),this._dialogSelect=t),t},enumerable:!1,configurable:!0}),e.prototype.newDialogSelect=function(){var t=this;return this._category.get().then((function(e){var n;return null!=t._options.controller.toThumbnail?((n=t.newDialogSelectImage()).categories=e.items,n):((n=t.newDialogSelectNoImage()).categories=e.items,n)}))},e.prototype.newDialogSelectNoImage=function(){var e=this;return new t.DDialogSelect({controller:this._options.controller.graphic,on:{select:function(t){e.onDialogSelectSelect(t)}}})},e.prototype.newDialogSelectImage=function(){var t=this,e=this._options.controller;return Di(e.graphic,e.toThumbnail,(function(e){t.onDialogSelectSelect(e)}))},e.prototype.onDialogSelectSelect=function(e){var n=this;this._options.controller.graphic.get(e.id).then((function(e){n.diagram.set(t.DDiagrams.toSerialized(e))}))},e.prototype.newDataMapper=function(){},e.prototype.toTheme=function(e){var n=null==e?void 0:e.theme;return n?t.isString(n)?t.DThemes.getInstance().get(n):n:this.getThemeDefault()},e.prototype.getThemeDefault=function(){return t.DThemes.getInstance().get(this.getType())},e.prototype.getType=function(){return"FGraphicViewer"},e}(),$o={__proto__:null,ECommandChartAxisXPadding:wn,ECommandChartAxisYPadding:Tn,ECommandChartTickXMajorCount:En,ECommandChartTickXMinorCount:Cn,ECommandChartTickYMajorCount:Dn,ECommandChartTickYMinorCount:Ln,ECommandComposition:o,ECommandDocumentAll:r,ECommandDocumentBackground:a,ECommandDocumentCategory:l,ECommandDocumentCreate:u,ECommandDocumentDescription:s,ECommandDocumentHeight:p,ECommandDocumentLabel:h,ECommandDocumentName:c,ECommandDocumentOpen:d,ECommandDocumentSnapBringForward:g,ECommandDocumentSnapCreate:f,ECommandDocumentSnapDelete:y,ECommandDocumentSnapGridSize:v,ECommandDocumentSnapGridToggle:m,ECommandDocumentSnapGridToggleVisibility:b,ECommandDocumentSnapReplace:_,ECommandDocumentSnapSendBackward:S,ECommandDocumentSnapTargetToggle:T,ECommandDocumentSnapTargetToggleVisibility:w,ECommandDocumentSnapToggle:E,ECommandDocumentSummary:C,ECommandDocumentWidth:D,ECommandLayerBringForward:L,ECommandLayerChange:O,ECommandLayerCreate:P,ECommandLayerDelete:I,ECommandLayerSendBackward:x,ECommandShapeActionValueAdd:R,ECommandShapeActionValueBringForward:k,ECommandShapeActionValueRemove:V,ECommandShapeActionValueReplace:M,ECommandShapeActionValueSendBackward:N,ECommandShapeButtonLayerValueAdd:rn,ECommandShapeButtonLayerValueBringForward:an,ECommandShapeButtonLayerValueMargin:ln,ECommandShapeButtonLayerValueRemove:un,ECommandShapeButtonLayerValueReplace:sn,ECommandShapeButtonLayerValueSendBackward:pn,ECommandShapeButtonPropertyIsActive:Ze,ECommandShapeButtonPropertyIsGrouped:qe,ECommandShapeButtonPropertyIsToggle:Je,ECommandShapeCreate:F,ECommandShapeDataMappingValueAdd:j,ECommandShapeDataMappingValueBringForward:z,ECommandShapeDataMappingValueRemove:H,ECommandShapeDataMappingValueReplace:G,ECommandShapeDataMappingValueSendBackward:U,ECommandShapeDataValueAdd:Y,ECommandShapeDataValueBringForward:X,ECommandShapeDataValueRemove:W,ECommandShapeDataValueReplace:K,ECommandShapeDataValueSendBackward:Z,ECommandShapeDelete:Q,ECommandShapeGroup:$,ECommandShapeProperty:et,ECommandShapePropertyAll:nt,ECommandShapePropertyCapability:it,ECommandShapePropertyCapabilityLock:ot,ECommandShapePropertyCapabilityUnlock:rt,ECommandShapePropertyCornerOff:at,ECommandShapePropertyCornerOn:lt,ECommandShapePropertyCursor:st,ECommandShapePropertyFillColor:ct,ECommandShapePropertyFillEnable:dt,ECommandShapePropertyFocusable:gt,ECommandShapePropertyId:ft,ECommandShapePropertyImage:bt,ECommandShapePropertyImageClear:yt,ECommandShapePropertyImageFitTo:vt,ECommandShapePropertyInteractive:mt,ECommandShapePropertyLineHeadColor:_t,ECommandShapePropertyLineHeadMargin:St,ECommandShapePropertyLineHeadSizeX:wt,ECommandShapePropertyLineHeadSizeY:Tt,ECommandShapePropertyLineHeadType:Et,ECommandShapePropertyLineTailColor:Ct,ECommandShapePropertyLineTailMargin:Dt,ECommandShapePropertyLineTailSizeX:Lt,ECommandShapePropertyLineTailSizeY:At,ECommandShapePropertyLineTailType:Bt,ECommandShapePropertyPointsStyle:Ot,ECommandShapePropertyPosition:Vt,ECommandShapePropertyPositionAndRotate:Pt,ECommandShapePropertyPositionLeft:It,ECommandShapePropertyPositionTop:xt,ECommandShapePropertyPositionX:Rt,ECommandShapePropertyPositionY:kt,ECommandShapePropertyRadius:Mt,ECommandShapePropertyRecursive:pt,ECommandShapePropertyRecursiveSimple:ht,ECommandShapePropertyRotation:Nt,ECommandShapePropertyShortcut:Ft,ECommandShapePropertySizeX:jt,ECommandShapePropertySizeY:zt,ECommandShapePropertySkew:Ht,ECommandShapePropertyStrokeAlign:Gt,ECommandShapePropertyStrokeColor:Ut,ECommandShapePropertyStrokeEnable:Yt,ECommandShapePropertyStrokeSideOff:Xt,ECommandShapePropertyStrokeSideOn:Wt,ECommandShapePropertyStrokeStyle:Kt,ECommandShapePropertyStrokeWidth:Zt,ECommandShapePropertyTextAlignHorizontal:qt,ECommandShapePropertyTextAlignVertical:Jt,ECommandShapePropertyTextClipping:Qt,ECommandShapePropertyTextColor:$t,ECommandShapePropertyTextDirection:te,ECommandShapePropertyTextFamily:ee,ECommandShapePropertyTextFitting:ne,ECommandShapePropertyTextOffsetHorizontal:ie,ECommandShapePropertyTextOffsetVertical:oe,ECommandShapePropertyTextOutlineColor:re,ECommandShapePropertyTextOutlineEnable:ae,ECommandShapePropertyTextOutlineWidth:le,ECommandShapePropertyTextPaddingHorizontal:ue,ECommandShapePropertyTextPaddingVertical:se,ECommandShapePropertyTextSize:he,ECommandShapePropertyTextSizeDelta:pe,ECommandShapePropertyTextSpacingHorizontal:ce,ECommandShapePropertyTextSpacingVertical:de,ECommandShapePropertyTextStyle:ge,ECommandShapePropertyTextValue:fe,ECommandShapePropertyTextWeight:ye,ECommandShapePropertyTitle:ve,ECommandShapeReplace:me,ECommandShapeReplaceOne:be,ECommandShapeSelect:_e,ECommandShapeTableColumnValueAdd:Yn,ECommandShapeTableColumnValueBringForward:Xn,ECommandShapeTableColumnValueRemove:Wn,ECommandShapeTableColumnValueReplace:Kn,ECommandShapeTableColumnValueSendBackward:Zn,ECommandShapeTableRowHeight:qn,ECommandShapeTableRowSelectionType:Jn,ECommandShapeTreeBringForward:Se,ECommandShapeTreeBringToFront:Te,ECommandShapeTreeSendBackward:Ee,ECommandShapeTreeSendToBack:De,ECommandShapeUngroup:Ae,EDialogAction:yi,EDialogActionExtension:je,EDialogActionExtensionContainer:ze,EDialogDataMappingValue:vi,EDialogDataValue:bi,EDialogLayer:mi,EDialogLayerValue:B,EDialogLayerValueBackground:A,EDialogProcessing:_i,EDialogShapeButtonLayerValue:hn,EDialogSnap:Li,EDialogTableColumn:Qn,EEDITOR_BUTTON_COUNT:7,EEditorAction:Ai,EEditorCanvas:Oi,EEditorCoordinate:Ri,EEditorData:Vi,EEditorDataMapping:ki,EEditorLayer:Ni,EEditorLayerItem:Mi,EEditorSearch:Hi,EEditorShape:Gi,EEditorShapeButton:Qe,EEditorShapeButtonLayer:cn,EEditorShapeChartLine:Bn,EEditorShapeTable:$n,EEditorSnap:Ui,EEditorText:Yi,EEditorTree:Ki,EEditorTreeSelection:Wi,EEditorValidation:Zi,EShapeActionExtensionInputType:Fe,EShapeActionExtensions:Ne,EShapeButtonLayer:on,EShapeButtonLayerButtonValue:tn,EShapeButtonLayerButtonValueContainer:en,EShapeButtonLayerIds:nn,EShapeButtonLayers:dn,EShapeButtons:$e,EShapeChartAxes:An,EShapeChartAxis:mn,EShapeChartAxisX:vn,EShapeChartAxisY:bn,EShapeChartLine:Sn,EShapeChartLineActionRuntime:On,EShapeChartLineIds:_n,EShapeChartLineRuntime:Pn,EShapeChartLines:In,EShapeChartTick:gn,EShapeChartTickMajor:fn,EShapeChartTickMinor:yn,EShapeEmbeddedAcceptorEdges:Ke,EShapeExtensionFactories:di,EShapeExtensions:Ge,EShapeInputs:xn,EShapeTable:Un,EShapeTableActionRuntime:ti,EShapeTableBody:ii,EShapeTableBodyRuntime:ni,EShapeTableCell:Rn,EShapeTableCellActionValueChangeColor:ei,EShapeTableColumn:Fn,EShapeTableColumnValue:Nn,EShapeTableColumnValueBody:kn,EShapeTableColumnValueHeader:Vn,EShapeTableColumnValueRuntime:li,EShapeTableColumnValueType:Mn,EShapeTableHeader:si,EShapeTableHeaderRuntime:ui,EShapeTableIds:jn,EShapeTableRow:Gn,EShapeTableRowSelection:Hn,EShapeTableRowSelectionType:zn,EShapeTableRuntime:pi,EShapeTables:hi,EToolGroupImpl:qi,EToolImpl:Ji,EToolSelect:Po,EToolSelectArea:Qi,get EToolSelectMode(){return Me},EToolSelectModifier:eo,EToolSelectModifierContainer:$i,EToolSelectModifierHitArea:to,EToolSelectSelection:Ao,EToolSelectSelectionUpdatedPart:tt,EToolShapeAcceptorEdge:Ro,EToolShapeAcceptorEdgeRenderer:Io,EToolShapeCreate:Fo,EToolShapeCreateElbowConnector:Mo,EToolShapeCreateLine:No,EToolShapeCreateLineConnector:Vo,EToolShapeCreateLineConnectorPhase:ko,EToolShapeEditLine:Go,EToolShapeEditLineBase:zo,EToolShapeEditLineConnector:Ho,EToolShapeEditLineHitArea:jo,FGraphicEditor:qo,FGraphicTester:Jo,FGraphicViewer:Qo,UtilAjax:Uo,UtilCanvas:Xo,UtilCanvasCategory:Yo,UtilCsv:Pe,UtilCsvState:Oe,UtilDataValues:Wo,UtilDate:Ko,UtilHitTest:Oo,UtilShapeAreaSelect:Bo,UtilShapeConnectorTransformData:no,UtilShapeConnectorTransforms:io,UtilShapeDeleter:J,UtilShapeSearch:q,UtilShapeTransforms:Le,getDialogSelectThumbnailNotFound:Ti,getDialogSelectThumbnailSize:wi,getShapeTypeTheme:Fi,loadShapeExtensionButton:function(){$e.load()},loadShapeExtensionButtonLayer:function(){dn.load()},loadShapeExtensionChartLine:function(){In.load()},loadShapeExtensionEmbeddedAcceptorEdge:function(){Ke.load()},loadShapeExtensionInput:function(){xn.load()},loadShapeExtensionTable:function(){hi.load()},newDialogSelectWithThumbnails:Di,newDialogSelectWithThumbnailsOptions:Ci,newDialogTHumbnailNotFound:Ei,newGraphicTester:Be,setDialogSelectThumbnailSize:function(t){Si=t},toGraphicTesterObject:Ie,toGraphicTesterSerialized:xe,toGraphicTesterSimple:Re,toShapeLabel:ji,toShapeTypeLabel:zi},tr=window;tr.wcardinal=tr.wcardinal||{},tr.wcardinal.geditor=$o}(wcardinal.ui,PIXI);
//# sourceMappingURL=wcardinal-geditor.min.js.map
