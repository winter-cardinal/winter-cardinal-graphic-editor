/*
 WinterCardinal Graphic Editor v1.1.0
 Copyright (C) TOSHIBA Coorporation
 SPDX-License-Identifier: Apache-2.0

 Material Design icons by Google
 Apache license version 2.0.
*/
!function(t,e){"use strict";class n extends t.DCommandBase{constructor(t,e){super(),this._commands=t,this._selection=e}get commands(){return this._commands}get selection(){return this._selection}execute(){return!0}redo(){const t=this._selection,e=this._commands;t.lock();for(let t=0,n=e.length;t<n;++t)e[t].redo();return t.unlock(),!0}undo(){const t=this._selection;t.lock();const e=this._commands;for(let t=e.length-1;0<=t;--t)e[t].undo();return t.unlock(),!0}destroy(){const t=this._commands;for(let e=0,n=t.length;e<n;++e)t[e].destroy()}}class i extends t.DCommandBase{constructor(t,e,n,i,o,a,s,l,r,h,u){super(),this._diagram=t,this._canvas=e,this._name=n,this._label=i,this._width=o,this._height=a,this._category=s,this._summary=l,this._description=r,this._backgroundColor=h,this._backgroundAlpha=u}get diagram(){return this._diagram}get canvas(){return this._canvas}get name(){return this._name}get label(){return this._label}get width(){return this._width}get height(){return this._height}get category(){return this._category}get summary(){return this._summary}get description(){return this._description}get backgroundColor(){return this._backgroundColor}get backgroundAlpha(){return this._backgroundAlpha}execute(){return this.redo()}redo(){const e=this._canvas,n=this._name;this._name=e.name,e.name=n;const i=this._label;this._label=e.label,e.label=i;const o=this._width;this._width=e.width,e.width=o;const a=this._height;this._height=e.height,e.height=a;const s=this._category;this._category=e.category,e.category=s;const l=this._summary;this._summary=e.summary,e.summary=l;const r=this._description;this._description=e.description,e.description=r;const h=this._backgroundColor,u=this._backgroundAlpha,c=new t.DBaseStateSetImpl,p=e.background;return this._backgroundColor=p.getColor(c),this._backgroundAlpha=p.getAlpha(c),p.color=h,p.alpha=u,this._diagram.emit("change",this._diagram),!0}undo(){return this.redo()}}class o extends t.DCommandBase{constructor(t,e,n){super(),this._diagram=t,this._color=e,this._alpha=n}get diagram(){return this._diagram}get color(){return this._color}get alpha(){return this._alpha}execute(){return this.redo()}redo(){const e=this._diagram.canvas;if(null!=e){const n=e.background,i=this._color,o=this._alpha,a=new t.DBaseStateSetImpl;this._color=n.getColor(a),this._alpha=n.getAlpha(a),n.color=i,n.alpha=o,this._diagram.emit("change",this._diagram)}return!0}undo(){return this.redo()}}class a extends t.DCommandBase{constructor(t,e,n){super(),this._diagram=t,this._canvas=e,this._category=n}get diagram(){return this._diagram}get canvas(){return this._canvas}get category(){return this._category}execute(){return this.redo()}redo(){const t=this._canvas,e=this._category;return this._category=t.category,t.category=e,this._diagram.emit("change",this._diagram),!0}undo(){return this.redo()}}class s extends t.DCommandCreate{constructor(t,e){super(),this._diagram=t,this._canvas=e}get diagram(){return this._diagram}get canvas(){return this._canvas}execute(){return!0}}class l extends t.DCommandBase{constructor(t,e,n){super(),this._diagram=t,this._canvas=e,this._description=n}get diagram(){return this._diagram}get canvas(){return this._canvas}get description(){return this._description}execute(){return this.redo()}redo(){const t=this._canvas,e=this._description;return this._description=t.description,t.description=e,this._diagram.emit("change",this._diagram),!0}undo(){return this.redo()}}class r extends t.DCommandBase{constructor(t,e,n){super(),this._diagram=t,this._canvas=e,this._height=n}get diagram(){return this._diagram}get canvas(){return this._canvas}get height(){return this._height}execute(){return this.redo()}redo(){const t=this._canvas,e=this._height;return this._height=t.height,t.y=t.y+.5*(t.height-e),t.height=e,this._diagram.emit("change",this._diagram),!0}undo(){return this.redo()}}class h extends t.DCommandBase{constructor(t,e,n){super(),this._diagram=t,this._canvas=e,this._label=n}get diagram(){return this._diagram}get canvas(){return this._canvas}get label(){return this._label}execute(){return this.redo()}redo(){const t=this._canvas,e=this._label;return this._label=t.label,t.label=e,this._diagram.emit("change",this._diagram),!0}undo(){return this.redo()}}class u extends t.DCommandBase{constructor(t,e,n){super(),this._diagram=t,this._canvas=e,this._name=n}get diagram(){return this._diagram}get canvas(){return this._canvas}get name(){return this._name}execute(){return this.redo()}redo(){const t=this._canvas,e=this._name;return this._name=t.name,t.name=e,this._diagram.emit("change",this._diagram),!0}undo(){return this.redo()}}class c extends t.DCommandCreate{constructor(t,e){super(),this._diagram=t,this._canvas=e}get diagram(){return this._diagram}get canvas(){return this._canvas}execute(){return!0}}class p extends t.DCommandBase{constructor(t,e){super(),this._snapper=t,this._index=e}get snapper(){return this._snapper}get index(){return this._index}execute(){return this.redo()}redo(){const t=this._index;return this._snapper.target.swap(t-1,t),!0}undo(){return this.redo()}}class d extends t.DCommandBase{constructor(t,e){super(),this._snapper=t,this._target=e}get snapper(){return this._snapper}get target(){return this._target}execute(){return this.redo()}redo(){return this._snapper.target.add(this._target),!0}undo(){const t=this._snapper.target;return t.remove(t.size-1),!0}}class g extends t.DCommandBase{constructor(t,e,n){super(),this._snapper=t,this._index=e,this._target=n}get snapper(){return this._snapper}get index(){return this._index}get target(){return this._target}execute(){return this.redo()}redo(){return this._snapper.target.remove(this._index),!0}undo(){return this._snapper.target.add(this._target,this._index),!0}}class _ extends t.DCommandBase{constructor(t,e){super(),this._snapper=t,this._size=e}get snapper(){return this._snapper}get size(){return this._size}execute(){return this.redo()}redo(){const t=this._snapper,e=this._size;return this._size=t.grid.size,t.grid.size=e,!0}undo(){return this.redo()}}class S extends t.DCommandBase{constructor(t){super(),this._snapper=t}get snapper(){return this._snapper}execute(){return this.redo()}redo(){const t=this._snapper.grid;return t.visible=!t.visible,!0}undo(){return this.redo()}}class w extends t.DCommandBase{constructor(t){super(),this._snapper=t}get snapper(){return this._snapper}execute(){return this.redo()}redo(){const t=this._snapper.grid;return t.enable=!t.enable,!0}undo(){return this.redo()}}class m extends t.DCommandBase{constructor(t,e,n,i){super(),this._snapper=t,this._oldValue=e,this._newValue=n,this._index=t.target.values.indexOf(this._oldValue),this._list=i}get snapper(){return this._snapper}get index(){return this._index}get oldValue(){return this._oldValue}get newValue(){return this._newValue}get list(){return this._list}execute(){return this.redo()}redo(){const t=this._index;if(0<=t){const e=this._list,n=this._newValue,i=this._snapper;e.data.selection.contains(this._oldValue)?(i.target.replace(t,n),e.data.selection.clearAndAdd(n)):i.target.replace(t,n)}return!0}undo(){const t=this._index;if(0<=t){const e=this._list,n=this._oldValue,i=this._snapper;e.data.selection.contains(this._newValue)?(i.target.replace(t,n),e.data.selection.clearAndAdd(n)):i.target.replace(t,n)}return!0}}class T extends t.DCommandBase{constructor(t,e){super(),this._snapper=t,this._index=e}get snapper(){return this._snapper}get index(){return this._index}execute(){return this.redo()}redo(){const t=this._index;return this._snapper.target.swap(t,t+1),!0}undo(){return this.redo()}}class E extends t.DCommandBase{constructor(t){super(),this._snapper=t}get snapper(){return this._snapper}execute(){return this.redo()}redo(){const t=this._snapper.target;return t.visible=!t.visible,!0}undo(){return this.redo()}}class y extends t.DCommandBase{constructor(t){super(),this._snapper=t}get snapper(){return this._snapper}execute(){return this.redo()}redo(){const t=this._snapper.target;return t.enable=!t.enable,!0}undo(){return this.redo()}}class v extends t.DCommandBase{constructor(t){super(),this._snapper=t}get snapper(){return this._snapper}execute(){return this.redo()}redo(){const t=this._snapper;return t.enable=!t.enable,!0}undo(){return this.redo()}}class C extends t.DCommandBase{constructor(t,e,n){super(),this._diagram=t,this._canvas=e,this._summary=n}get diagram(){return this._diagram}get canvas(){return this._canvas}get summary(){return this._summary}execute(){return this.redo()}redo(){const t=this._canvas,e=this._summary;return this._summary=t.summary,t.summary=e,this._diagram.emit("change",this._diagram),!0}undo(){return this.redo()}}class b extends t.DCommandBase{constructor(t,e,n){super(),this._diagram=t,this._canvas=e,this._width=n}get diagram(){return this._diagram}get canvas(){return this._canvas}get width(){return this._width}execute(){return this.redo()}redo(){const t=this._canvas,e=this._width;return this._width=t.width,t.x=t.x+.5*(t.width-e),t.width=e,this._diagram.emit("change",this._diagram),!0}undo(){return this.redo()}}class D extends t.DCommandBase{constructor(t,e){super(),this._index=t,this._layerContainer=e}get index(){return this._index}get layerContainer(){return this._layerContainer}execute(){return this.redo()}redo(){const e=this._index,n=this._layerContainer,i=n.children,o=i[e];return i[e]=i[e+1],i[e+1]=o,n.onChildrenChange(e),n.emit("change",n),t.DApplications.update(n),!0}undo(){return this.redo(),!0}}class L{constructor(t,e,n){this.enable=t,this.color=e,this.alpha=n}isEqual(t){return this.enable===t.enable&&this.color===t.color&&this.alpha===t.alpha}static from(t){return new L(t.background.enable,t.background.color,t.background.alpha)}}class f{constructor(t,e,n,i,o,a,s,l,r){this.name=t,this.x=e,this.y=n,this.width=i,this.height=o,this.background=a,this.visible=s,this.interactive=l,this.gesture=r}isEqual(t){return this.name===t.name&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.background.isEqual(t.background)&&this.visible===t.visible&&this.interactive===t.interactive&&this.gesture===t.gesture}copyTo(e){e.name=this.name,e.position.set(this.x,this.y),e.width=this.width,e.height=this.height,e.background.copy(this.background);const n=e.state;n.lock(),n.set(t.EShapeLayerState.INVISIBLE,!this.visible),n.set(t.EShapeLayerState.INTERACTIVE,this.interactive);const i=this.gesture;return n.set(t.EShapeLayerState.DRAGGABLE,!!(i&t.EShapeActionValueGestureOperationType.DRAG)),n.set(t.EShapeLayerState.PINCHABLE,!!(i&t.EShapeActionValueGestureOperationType.PINCH)),n.unlock(),this}static from(e){const n=(e.state.is(t.EShapeLayerState.DRAGGABLE)?t.EShapeActionValueGestureOperationType.DRAG:t.EShapeActionValueGestureOperationType.NONE)|(e.state.is(t.EShapeLayerState.PINCHABLE)?t.EShapeActionValueGestureOperationType.PINCH:t.EShapeActionValueGestureOperationType.NONE);return new f(e.name,e.position.x,e.position.y,e.width,e.height,L.from(e),!e.state.is(t.EShapeLayerState.INVISIBLE),e.state.is(t.EShapeLayerState.INTERACTIVE),n)}}class A extends t.DCommandBase{constructor(t,e,n){super(),this._layer=t,this._layerContainer=n,this._oldValue=f.from(t),this._newValue=e}get layer(){return this._layer}get newValue(){return this._newValue}get oldValue(){return this._oldValue}get layerContainer(){return this._layerContainer}execute(){return this.redo()}redo(){this._newValue.copyTo(this._layer);const t=this._layerContainer;return t.emit("change",t),!0}undo(){this._oldValue.copyTo(this._layer);const t=this._layerContainer;return t.emit("change",t),!0}}class B extends t.DCommandBase{constructor(t,e,n){super(),this._value=t,this._layerContainer=e,this._layerActive=e.active,this._layerCreated=null,this._selection=n,this._selectionStored=null}newLayer(t,e){const n=e.create(t.name,!0);return t.copyTo(n),n}get value(){return this._value}get layerContainer(){return this._layerContainer}get layerActive(){return this._layerActive}get layerCreated(){return this._layerCreated}get selection(){return this._selection}get selectionStored(){return this._selectionStored}execute(){const t=this._selection;return t.isEmpty()?this._selectionStored=null:(this._selectionStored=t.store(),t.clear()),this._layerCreated=this.newLayer(this._value,this._layerContainer),this._layerCreated.reference+=1,!0}redo(){null!=this._selectionStored&&this._selection.clear();const t=this._layerCreated;return null!=t&&this._layerContainer.attach(t,!0),!0}undo(){const t=this._layerCreated;null!=t&&this._layerContainer.detach(t,this._layerActive);const e=this._selectionStored;return null!=e&&this._selection.restore(e),!0}destroy(){const t=this._layerCreated;null!=t&&(t.reference-=1,null==t.parent&&t.reference<=0&&t.destroy()),this._layerActive=null}}class x extends t.DCommandBase{constructor(t,e,n){super(),this._layerContainer=e,this._layerActive=e.active,this._layer=t,t.reference+=1,this._layerIndex=-1,this._selection=n,this._selectionStored=null}get layerContainer(){return this._layerContainer}get layerActive(){return this._layerActive}get layer(){return this._layer}get layerIndex(){return this._layerIndex}get selection(){return this._selection}get selectionStored(){return this._selectionStored}execute(){const t=this._layer,e=this._layerContainer,n=this._selection;return t!==e.active||n.isEmpty()?this._selectionStored=null:(this._selectionStored=n.store(),n.clear()),this._layerIndex=e.delete(t,!0),!0}redo(){return null!=this._selectionStored&&this._selection.clear(),this._layerContainer.delete(this._layer,!0),!0}undo(){return this._layerContainer.attachAt(this._layer,this._layerIndex,this._layer===this._layerActive),null!=this._selectionStored&&this._selection.restore(this._selectionStored),!0}destroy(){const t=this._layer;t.reference-=1,null==t.parent&&t.reference<=0&&t.destroy(),this._layerActive=null,this._selectionStored=null}}class I extends t.DCommandBase{constructor(t,e){super(),this._index=t,this._layerContainer=e}get index(){return this._index}get layerContainer(){return this._layerContainer}execute(){return this.redo()}redo(){const e=this._index,n=this._layerContainer,i=n.children,o=i[e];return i[e]=i[e-1],i[e-1]=o,n.onChildrenChange(e),n.emit("change",n),t.DApplications.update(n),!0}undo(){return this.redo(),!0}}class R extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._value=t}get selection(){return this._selection}get value(){return this._value}execute(){return this.redo()}redo(){const t=this._value,e=this._selection.get();for(let n=0,i=e.length;n<i;++n)e[n].action.add(t);return this._selection.update("PROPERTY"),!0}undo(){const t=this._selection.get();for(let e=0,n=t.length;e<n;++e){const n=t[e];n.action.remove(n.action.size()-1)}return this._selection.update("PROPERTY"),!0}}class O extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t,this._indices=[]}get selection(){return this._selection}get target(){return this._target}get indices(){return this._indices}execute(){const t=this._target,e=this._indices,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i],a=o.action.indexOf(t);e.push(a),0<a&&o.action.swap(a-1,a)}return this._indices=e,this._selection.update("PROPERTY"),!0}redo(){const t=this._selection.get(),e=this._indices;for(let n=0,i=t.length;n<i;++n){const i=t[n],o=e[n];0<o&&i.action.swap(o-1,o)}return this._selection.update("PROPERTY"),!0}undo(){return this.redo()}}class k extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t,this._indices=[]}get selection(){return this._selection}get target(){return this._target}get indices(){return this._indices}execute(){const t=this._target,e=this._indices,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i],a=o.action.indexOf(t);e.push(a),0<=a&&o.action.remove(a)}return this._selection.update("PROPERTY"),!0}redo(){const t=this._indices,e=this._selection.get();for(let n=0,i=e.length;n<i;++n){const i=e[n],o=t[n];0<=o&&i.action.remove(o)}return this._selection.update("PROPERTY"),!0}undo(){const t=this._target,e=this._indices,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i],a=e[i];0<=a&&o.action.add(t,a)}return this._selection.update("PROPERTY"),!0}}class P extends t.DCommandBase{constructor(t,e,n,i){super(),this._selection=n,this._oldValue=t,this._newValue=e,this._list=i,this._indices=[],this._oldValues=[]}get selection(){return this._selection}get oldValue(){return this._oldValue}get newValue(){return this._newValue}get indices(){return this._indices}get oldValues(){return this._oldValues}get list(){return this._list}execute(){const t=this._oldValue,e=this._newValue,n=this._indices,i=this._oldValues,o=this._selection.get();for(let a=0,s=o.length;a<s;++a){const s=o[a],l=s.action.indexOf(t);n.push(l),0<=l?(i.push(s.action.get(l)),s.action.set(l,e)):i.push(e)}const a=this._list;return a.data.selection.contains(t)&&a.data.selection.clearAndAdd(e),this._selection.update("PROPERTY"),!0}redo(){const t=this._newValue,e=this._indices,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=e[i];0<=o&&n[i].action.set(o,t)}const i=this._list;return i.data.selection.contains(this._oldValue)&&i.data.selection.clearAndAdd(t),this._selection.update("PROPERTY"),!0}undo(){const t=this._indices,e=this._oldValues,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=t[i];0<=o&&n[i].action.set(o,e[i])}const i=this._list;return i.data.selection.contains(this._newValue)&&i.data.selection.clearAndAdd(this._oldValue),this._selection.update("PROPERTY"),!0}}class V extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t;const n=[],i=this._selection.get();for(let e=0,o=i.length;e<o;++e){const o=i[e].action,a=o.indexOf(t);n.push(a),0<=a&&a<o.size()-1&&o.swap(a+1,a)}this._indices=n,this._selection.update("PROPERTY")}get selection(){return this._selection}get target(){return this._target}get indices(){return this._indices}execute(){return!0}redo(){const t=this._selection.get(),e=this._indices;for(let n=0,i=t.length;n<i;++n){const i=t[n].action,o=e[n];0<=o&&o<i.size()-1&&i.swap(o+1,o)}return this._selection.update("PROPERTY"),!0}undo(){return this.redo()}}class M extends t.DCommandBase{constructor(t,e,n,i){super(),this._shapes=t;for(let e=0,n=t.length;e<n;++e)t[e].reference+=1;this._parent=e,this._selection=n,this._select=i}get parent(){return this._parent}get shapes(){return this._shapes}get selection(){return this._selection}get selectionStored(){return this._selectionStored}get select(){return this._select}execute(){const t=this._selection;return t.lock(),this._select&&(this._selectionStored=t.store(),t.clearAndAddAll(this._shapes)),t.update("TREE"),t.unlock(),!0}redo(){const t=this._shapes,e=this._parent;for(let n=0,i=t.length;n<i;++n)t[n].attach(e);const n=this._selection;return n.lock(),this._select&&n.clearAndAddAll(t),n.update("TREE"),n.unlock(),!0}undo(){const t=this._shapes;for(let e=0,n=t.length;e<n;++e)t[e].detach();const e=this._selection,n=this._selectionStored;return e.lock(),this._select&&null!=n&&e.restore(n),e.update("TREE"),e.unlock(),!0}destroy(){const t=this._shapes;for(let e=0,n=t.length;e<n;++e){const n=t[e];n.reference-=1,null==n.parent&&n.reference<=0&&n.destroy()}}}class N extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._value=t}get selection(){return this._selection}get value(){return this._value}execute(){return this.redo()}redo(){const e=this._value,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i];t.EShapeCapabilities.contains(o,t.EShapeCapability.DATA_MAPPING)&&o.data.mapping.add(e)}return this._selection.update("PROPERTY"),!0}undo(){const e=this._selection.get();for(let n=0,i=e.length;n<i;++n){const i=e[n];if(t.EShapeCapabilities.contains(i,t.EShapeCapability.DATA_MAPPING)){const t=i.data.getMapping();t&&t.remove(t.size()-1)}}return this._selection.update("PROPERTY"),!0}}class F extends t.DCommandBase{constructor(e,n){super(),this._selection=n,this._target=e;const i=[],o=this._selection.get();for(let n=0,a=o.length;n<a;++n){const a=o[n];if(t.EShapeCapabilities.contains(a,t.EShapeCapability.DATA_MAPPING)){const t=a.data.getMapping();if(t){const n=t.indexOf(e);i.push(n),0<n&&t.swap(n-1,n)}else i.push(-1)}else i.push(-1)}this._indices=i,this._selection.update("PROPERTY")}get selection(){return this._selection}get target(){return this._target}get indices(){return this._indices}execute(){return!0}redo(){const t=this._selection.get(),e=this._indices;for(let n=0,i=t.length;n<i;++n){const i=t[n],o=e[n];if(0<o){const t=i.data.getMapping();t&&t.swap(o-1,o)}}return this._selection.update("PROPERTY"),!0}undo(){return this.redo()}}class z extends t.DCommandBase{constructor(e,n){super(),this._selection=n,this._target=e;const i=[],o=this._selection.get();for(let n=0,a=o.length;n<a;++n){const a=o[n];if(t.EShapeCapabilities.contains(a,t.EShapeCapability.DATA_MAPPING)){const t=a.data.getMapping();if(t){const n=t.indexOf(e);i.push(n),0<=n&&t.remove(n)}else i.push(-1)}else i.push(-1)}this._indices=i,this._selection.update("PROPERTY")}get selection(){return this._selection}get target(){return this._target}get indices(){return this._indices}execute(){return!0}redo(){const t=this._selection.get(),e=this._indices;for(let n=0,i=t.length;n<i;++n){const i=t[n],o=e[n];if(0<=o){const t=i.data.getMapping();t&&t.remove(o)}}return this._selection.update("PROPERTY"),!0}undo(){const t=this._target,e=this._selection.get(),n=this._indices;for(let i=0,o=e.length;i<o;++i){const o=e[i],a=n[i];if(0<=a){const e=o.data.getMapping();e&&e.add(t,a)}}return this._selection.update("PROPERTY"),!0}}class H extends t.DCommandBase{constructor(e,n,i,o){super(),this._selection=i,this._oldValue=e,this._newValue=n,this._list=o;const a=[],s=[],l=this._selection.get();for(let i=0,o=l.length;i<o;++i){const o=l[i];if(t.EShapeCapabilities.contains(o,t.EShapeCapability.DATA_MAPPING)){const t=o.data.getMapping();if(t){const i=t.indexOf(e);a.push(i),0<=i?(s.push(t.get(i)),t.set(i,n)):s.push(n)}else a.push(-1),s.push(n)}else a.push(-1),s.push(n)}this._indices=a,this._oldValues=s,o.data.selection.contains(e)&&o.data.selection.clearAndAdd(n),this._selection.update("PROPERTY")}get selection(){return this._selection}get oldValue(){return this._oldValue}get newValue(){return this._newValue}get indices(){return this._indices}get oldValues(){return this._oldValues}get list(){return this._list}execute(){return!0}redo(){const t=this._newValue,e=this._indices,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i],a=e[i];if(0<=a){const e=o.data.getMapping();e&&e.set(a,t)}}const i=this._list;return i.data.selection.contains(this._oldValue)&&i.data.selection.clearAndAdd(t),this._selection.update("PROPERTY"),!0}undo(){const t=this._indices,e=this._oldValues,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i],a=t[i];if(0<=a){const t=o.data.getMapping();t&&t.set(a,e[i])}}const i=this._list;return i.data.selection.contains(this._newValue)&&i.data.selection.clearAndAdd(this._oldValue),this._selection.update("PROPERTY"),!0}}class G extends t.DCommandBase{constructor(e,n){super(),this._selection=n,this._target=e;const i=[],o=this._selection.get();for(let n=0,a=o.length;n<a;++n){const a=o[n];if(t.EShapeCapabilities.contains(a,t.EShapeCapability.DATA_MAPPING)){const t=a.data.getMapping();if(t){const n=t.indexOf(e);i.push(n),0<=n&&n<t.size()-1&&t.swap(n+1,n)}else i.push(-1)}else i.push(-1)}this._indices=i,this._selection.update("PROPERTY")}get selection(){return this._selection}get target(){return this._target}get indices(){return this._indices}execute(){return!0}redo(){const t=this._selection.get(),e=this._indices;for(let n=0,i=t.length;n<i;++n){const i=t[n],o=e[n],a=i.data.getMapping();a&&0<=o&&o<a.size()-1&&a.swap(o+1,o)}return this._selection.update("PROPERTY"),!0}undo(){return this.redo()}}class U extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._value=t}get selection(){return this._selection}get value(){return this._value}execute(){return this.redo()}redo(){const t=this._value,e=this._selection.get();for(let n=0,i=e.length;n<i;++n)e[n].data.add(t);return this._selection.update("PROPERTY"),!0}undo(){const t=this._selection.get();for(let e=0,n=t.length;e<n;++e){const n=t[e];n.data.remove(n.data.size()-1)}return this._selection.update("PROPERTY"),!0}}class Y extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t;const n=[],i=this._selection.get();for(let e=0,o=i.length;e<o;++e){const o=i[e],a=o.data.indexOf(t);n.push(a),0<a&&o.data.swap(a-1,a)}this._indices=n,this._selection.update("PROPERTY")}get selection(){return this._selection}get target(){return this._target}get indices(){return this._indices}execute(){return!0}redo(){const t=this._selection.get(),e=this._indices;for(let n=0,i=t.length;n<i;++n){const i=t[n],o=e[n];0<o&&i.data.swap(o-1,o)}return this._selection.update("PROPERTY"),!0}undo(){return this.redo()}}class X extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t;const n=[],i=this._selection.get();for(let e=0,o=i.length;e<o;++e){const o=i[e],a=o.data.indexOf(t);n.push(a),0<=a&&o.data.remove(a)}this._indices=n,this._selection.update("PROPERTY")}get selection(){return this._selection}get target(){return this._target}get indices(){return this._indices}execute(){return!0}redo(){const t=this._indices,e=this._selection.get();for(let n=0,i=e.length;n<i;++n){const i=e[n],o=t[n];0<=o&&i.data.remove(o)}return this._selection.update("PROPERTY"),!0}undo(){const t=this._target,e=this._indices,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i],a=e[i];0<=a&&o.data.add(t,a)}return this._selection.update("PROPERTY"),!0}}class W extends t.DCommandBase{constructor(t,e,n,i){super(),this._selection=n,this._oldValue=t,this._newValue=e,this._list=i;const o=[],a=[],s=this._selection.get();for(let n=0,i=s.length;n<i;++n){const i=s[n],l=i.data.indexOf(t);o.push(l),0<=l?(a.push(i.data.get(l)),i.data.set(l,e)):a.push(e)}this._indices=o,this._oldValues=a,i.data.selection.contains(t)&&i.data.selection.clearAndAdd(e),this._selection.update("PROPERTY")}get selection(){return this._selection}get oldValue(){return this._oldValue}get newValue(){return this._newValue}get indices(){return this._indices}get oldValues(){return this._oldValues}get list(){return this._list}execute(){return!0}redo(){const t=this._newValue,e=this._indices,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=e[i];0<=o&&n[i].data.set(o,t)}const i=this._list;return i.data.selection.contains(this._oldValue)&&i.data.selection.clearAndAdd(t),this._selection.update("PROPERTY"),!0}undo(){const t=this._indices,e=this._oldValues,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=t[i];0<=o&&n[i].data.set(o,e[i])}const i=this._list;return i.data.selection.contains(this._newValue)&&i.data.selection.clearAndAdd(this._oldValue),this._selection.update("PROPERTY"),!0}}class K extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t;const n=[],i=this._selection.get();for(let e=0,o=i.length;e<o;++e){const o=i[e].data,a=o.indexOf(t);n.push(a),0<=a&&a<o.size()-1&&o.swap(a+1,a)}this._indices=n,this._selection.update("PROPERTY")}get selection(){return this._selection}get target(){return this._target}get indices(){return this._indices}execute(){return!0}redo(){const t=this._selection.get(),e=this._indices;for(let n=0,i=t.length;n<i;++n){const i=t[n].data,o=e[n];0<=o&&o<i.size()-1&&i.swap(o+1,o)}return this._selection.update("PROPERTY"),!0}undo(){return this.redo()}}class ${static toIndices(t){const e=[];for(let n=0,i=t.length;n<i;++n)e.push(t[n].index);return e}static toDepth(e){let n=0,i=e.parent;for(;i instanceof t.EShapeBase;)n+=1,i=i.parent;return n}static toSharedParent(e,n){if(this.toDepth(e)<this.toDepth(n)){let i=e.parent;for(;i instanceof t.EShapeBase;){if(this.isParent(n,i))return i;i=i.parent}return i}{let i=n.parent;for(;i instanceof t.EShapeBase;){if(this.isParent(e,i))return i;i=i.parent}return i}}static toOfParent(e,n){let i=e.parent;for(;i!==n&&i instanceof t.EShapeBase;)e=i,i=i.parent;return e}static isParent(e,n){let i=e.parent;for(;i instanceof t.EShapeBase;){if(i===n)return!0;i=i.parent}return!1}static toSelected(e){let n=e;for(;n instanceof t.EShapeBase;){if(n.selected)return n;n=n.parent}return null}static findChildById(t,e,n){const i=t.children;for(let t=0,o=i.length;t<o;++t){const o=i[t];if(o.id===e)return o;if(!0===n){const t=$.findChildById(o,e,n);if(null!=t)return t}}return null}static findChildByType(t,e,n){const i=t.children;for(let t=0,o=i.length;t<o;++t){const o=i[t];if(o.type===e)return o;if(!0===n){const t=$.findChildByType(o,e,n);if(null!=t)return t}}return null}static findChild(t,e,n){const i=t.children;for(let t=0,o=i.length;t<o;++t){const o=i[t];if(e(o))return o;if(!0===n){const t=$.findChild(o,e,n);if(null!=t)return t}}return null}static findChildrenByType(t,e,n,i){i=i||[];const o=t.children;for(let t=0,a=o.length;t<a;++t){const a=o[t];a.type===e&&i.push(a),!0===n&&$.findChildrenByType(a,e,n,i)}return i}static findChildren(t,e,n,i){i=i||[];const o=t.children;for(let t=0,a=o.length;t<a;++t){const a=o[t];e(a)&&i.push(a),!0===n&&$.findChildren(a,e,n,i)}return i}}$.COMPARATOR_INDEX=(t,e)=>t.index-e.index;class Z{static addAll(t,e){for(let n=0,i=t.length;n<i;++n){const i=t[n];e.add(i),this.addAll(i.children,e)}return e}static delete(t,e,n,i){var o;const a=t.children,s=a.length;null!=i||(i=null!==(o=Z.EXCEPTIONS)&&void 0!==o?o:Z.EXCEPTIONS=new Set);for(let t=0;t<s;++t){const e=a[t];e.selected?(e.index=s+t,i.add(e),this.addAll(e.children,i)):e.index=t}if(a.sort($.COMPARATOR_INDEX),!0===n){for(let n=s-1;0<=n;--n){const o=a[n];if(!o.selected){Z.EXCEPTIONS===i&&i.clear();const o=a.length-(n+1);if(0<o){const i=a.splice(n+1,o);return null!=e&&(e.length=0),t.onChildTransformChange(),t.toDirty(),i}return null!=e&&(e.length=0),null}o.index-=s,o.parent=null,o.selected=!1,o.uploaded=void 0,o.onDetach(i)}if(Z.EXCEPTIONS===i&&i.clear(),0<a.length){const n=a.splice(0,a.length);return null!=e&&(e.length=0),t.onChildTransformChange(),t.toDirty(),n}return null!=e&&(e.length=0),null}for(let n=s-1;0<=n;--n){const o=a[n];if(!o.selected)return Z.EXCEPTIONS===i&&i.clear(),a.length=n+1,null!=e&&(e.length=0),t.onChildTransformChange(),t.toDirty(),null;o.parent=null,o.selected=!1,o.uploaded=void 0,o.onDetach(i)}return Z.EXCEPTIONS===i&&i.clear(),0<a.length?(a.length=0,null!=e&&(e.length=0),t.onChildTransformChange(),t.toDirty()):null!=e&&(e.length=0),null}}class j extends t.DCommandBase{constructor(t,e,n,i,o){super(),this._shapes=t;for(let e=0,n=t.length;e<n;++e)t[e].reference+=1;this._indices=e,this._parent=n,this._selection=i,this._select=o}get parent(){return this._parent}get shapes(){return this._shapes}get indices(){return this._indices}get selection(){return this._selection}get select(){return this._select}execute(){return!0}redo(){const t=this._selection;if(this._select)t.delete(!1);else{const e=this._shapes;for(let t=0,n=e.length;t<n;++t)e[t].selected=!0;Z.delete(this._parent,void 0,!1),t.update("TREE")}return!0}undo(){const t=this._shapes,e=this._indices,n=this._parent;for(let i=0,o=t.length;i<o;++i)t[i].attach(n,e[i]);const i=this._selection;return i.lock(),this._select&&i.clearAndAddAll(t),i.update("TREE"),i.unlock(),!0}destroy(){const t=this._shapes;for(let e=0,n=t.length;e<n;++e){const n=t[e];n.reference-=1,null==n.parent&&n.reference<=0&&n.destroy()}t.length=0}}class q extends t.DCommandBase{constructor(t,e){super(),this._parent=t,this._selection=e,this._before=[],this._deleteds=[],this._indices=[],this._createds=[]}get parent(){return this._parent}get selection(){return this._selection}get before(){return this._before}get deleteds(){return this._deleteds}get indices(){return this._indices}get createds(){return this._createds}execute(){const e=this._selection;this._before=e.store(),e.lock();const n=e.get();for(let e=n.length-1;0<=e;--e){const i=n[e];t.EShapeCapabilities.contains(i,t.EShapeCapability.GROUPING)||(i.selected=!1,n.splice(e,1))}const i=this._parent,o=new Set,a=Z.delete(i,n,!0,o)||[];this._deleteds=a;for(let t=0,e=a.length;t<e;++t)a[t].reference+=1;const s=e.modifier,l=s.position.x+.5*s.width,r=s.position.y+.5*s.height,h=s.width,u=s.height,c=new t.EShapeGroup(t.EShapeResourceManagerDeserializationMode.EDITOR);c.transform.position.set(l,r),c.size.set(h,u),c.attach(i);const p=c.children;for(let e=0,n=a.length;e<n;++e){const n=a[e].clone();n.lock(t.EShapeLockPart.ALL);const i=n.transform.position;if(i.set(i.x-l,i.y-r),n instanceof t.EShapeConnectorLine){const t=n.edge,e=t.tail,i=e.acceptor,a=i.shape,s=e.local;null==a?s.set(s.x-l,s.y-r):o.has(a)||(i.shape=null,s.set(s.x-l,s.y-r));const h=t.head,u=h.acceptor,c=u.shape,p=h.local;null==c?p.set(p.x-l,p.y-r):o.has(c)||(u.shape=null,p.set(p.x-l,p.y-r))}n.parent=c,p.push(n)}t.EShapeConnectors.moveAll(a,p,a,p);for(let e=0,n=p.length;e<n;++e)p[e].unlock(t.EShapeLockPart.ALL,!0);return c.onChildTransformChange(),c.toDirty(),c.onAttach(),c.reference+=1,this._createds=[c],o.clear(),this._indices=$.toIndices(a),e.clearAndAddAll(this._createds),e.update("TREE"),e.unlock(),!0}redo(){const t=this._selection;t.lock(),t.clearAndAddAll(this._deleteds),t.delete(!1);const e=this._parent,n=this._createds;for(let t=0,i=n.length;t<i;++t)n[t].attach(e);return t.update("TREE"),t.unlock(),!0}undo(){const t=this._parent,e=this._selection;e.lock();const n=this._createds;for(let t=n.length-1;0<=t;--t)n[t].detach();const i=this._deleteds,o=this._indices;for(let e=0,n=i.length;e<n;++e)i[e].attach(t,o[e]);return this._selection.restore(this._before),e.update("TREE"),e.unlock(),!0}destroy(){this._before.length=0;const t=this._deleteds;for(let e=0,n=t.length;e<n;++e){const n=t[e];n.reference-=1,null==n.parent&&n.reference<=0&&n.destroy()}t.length=0;const e=this._createds;for(let t=0,n=e.length;t<n;++t){const n=e[t];n.reference-=1,null==n.parent&&n.reference<=0&&n.destroy()}e.length=0}}const J={NONE:0,PROPERTY:1,PROPERTY_ID:2,SELECTION:4,TREE:8,ALL:15};class Q extends t.DCommandBase{constructor(t,e,n=t.get()){super(),this._selection=t,this._shapes=[],this._capabilities=[],this._data=[],this._property=e,this._targets=n,this._isMerged=!1}get selection(){return this._selection}get shapes(){return this._shapes}get capabilities(){return this._capabilities}get data(){return this._data}toCapability(e){return t.EShapeCapability.ALL}isRecursive(){return!1}isMergeable(){return!1}isClassMergeable(t){return t.constructor===this.constructor}execute(){const t=this._shapes,e=this._capabilities,n=this._property;for(let i=0,o=t.length;i<o;++i)this.initProperty(t[i],e[i],n);return this._selection.update(this.getParts()),!0}init(e,n,i,o,a){for(let s=0,l=e.length;s<l;++s){const l=e[s];if(a&&l instanceof t.EShapeGroup)t.EShapeCapabilities.contains(l,t.EShapeCapability.CHILDREN)&&this.init(l.children,n,i,o,a);else{const e=this.toCapability(l);e!==t.EShapeCapability.NONE&&(n.push(l),o.push(this.getProperty(l,e)),i.push(e))}}}merge(t){return this.isMergeable()&&this.isClassMergeable(t)?(this._isMerged=!0,this._shapes=t.shapes,this._capabilities=t.capabilities,this._data=t.data,!0):(this.init(this._targets,this._shapes,this._capabilities,this._data,this.isRecursive()),!1)}isMerged(){return this._isMerged}redo(){const t=this._shapes,e=this._data,n=this._capabilities;for(let i=0,o=t.length;i<o;++i){const o=t[i],a=e[i],s=n[i];e[i]=this.getProperty(o,s),this.setProperty(o,s,a)}return this._selection.update(this.getParts()),!0}undo(){return this.redo()}destroy(){this._shapes.length=0,this._data.length=0}getParts(){return J.PROPERTY}}class tt extends Q{constructor(t){super(t,void 0)}toCapability(e){if(e instanceof t.EShapeConnectorLine){const n=e.edge;return null==n.tail.acceptor.shape&&null==n.head.acceptor.shape?t.EShapeCapability.ALL:t.EShapeCapability.NONE}{let n=t.EShapeCapability.NONE;return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)&&(n|=t.EShapeCapability.POSITION),t.EShapeCapabilities.contains(e,t.EShapeCapability.WIDTH)&&(n|=t.EShapeCapability.WIDTH),t.EShapeCapabilities.contains(e,t.EShapeCapability.HEIGHT)&&(n|=t.EShapeCapability.HEIGHT),t.EShapeCapabilities.contains(e,t.EShapeCapability.ROTATION)&&(n|=t.EShapeCapability.ROTATION),t.EShapeCapabilities.contains(e,t.EShapeCapability.SKEW)&&(n|=t.EShapeCapability.SKEW),n}}getProperty(e,n){if(e instanceof t.EShapeConnectorLine){const t=e.edge,n=t.tail.local,i=t.head.local;return[n.x,n.y,i.x,i.y,0,0]}{const t=e.transform,n=t.position,i=e.size,o=t.skew;return[n.x,n.y,i.x,i.y,t.rotation,o.x]}}setProperty(e,n,i){if(e instanceof t.EShapeConnectorLine){const t=e.edge;t.tail.local.set(i[0],i[1]),t.head.local.set(i[2],i[3])}else{const o=e.transform;n&t.EShapeCapability.POSITION&&o.position.set(i[0],i[1]),n&t.EShapeCapability.HEIGHT?n&t.EShapeCapability.WIDTH?e.size.set(i[2],i[3]):e.size.y=i[3]:n&t.EShapeCapability.WIDTH&&(e.size.x=i[2]),n&t.EShapeCapability.ROTATION&&(o.rotation=i[4]),n&t.EShapeCapability.SKEW&&o.skew.set(i[5],i[5])}}initProperty(t,e,n){}}class et extends Q{getProperty(e,n){const i=e.getCapability();return null!=i?i.locked:t.EShapeCapability.NONE}setProperty(e,n,i){if(i!==t.EShapeCapability.NONE)e.capability.locked=i;else{const t=e.getCapability();null!=t&&(t.locked=i)}}}class nt extends et{initProperty(t,e,n){t.capability.locked|=n}}class it extends et{initProperty(t,e,n){t.capability.locked&=~n}}class ot extends Q{getProperty(t,e){return t.corner}setProperty(t,e,n){t.corner=n}initProperty(t,e,n){t.corner&=~n}}class at extends Q{getProperty(t,e){return t.corner}setProperty(t,e,n){t.corner=n}initProperty(t,e,n){t.corner|=n}}class st extends Q{initProperty(t,e,n){this.setProperty(t,e,n)}}class lt extends st{getProperty(t,e){return t.cursor}setProperty(t,e,n){t.cursor=n}}class rt extends Q{constructor(t,e){super(t,e)}isRecursive(){return!0}}class ht extends rt{initProperty(t,e,n){this.setProperty(t,e,n)}}class ut extends ht{getProperty(t,e){return[t.fill.color,t.fill.alpha]}setProperty(t,e,n){t.fill.set(void 0,n[0],n[1])}}class ct extends ht{getProperty(t,e){return t.fill.enable}setProperty(t,e,n){t.fill.enable=n}}class pt extends st{getProperty(t,e){return t.state.isFocusable}setProperty(t,e,n){t.state.isFocusable=n}}class dt extends st{getProperty(t,e){return t.id}setProperty(t,e,n){t.id=n}getParts(){return J.PROPERTY_ID}}class gt extends Q{constructor(t){super(t,void 0)}getProperty(t,e){return t.image}setProperty(t,e,n){t.image=n}initProperty(t,e,n){t.image=void 0,t.gradient=void 0}}class _t extends rt{constructor(t){super(t,void 0)}getProperty(t,e){const n=t.size;return[n.x,n.y]}setProperty(t,e,n){t.size.set(n[0],n[1])}initProperty(t,e,n){const i=t.image;i&&t.size.set(i.width,i.height)}}class St extends Q{constructor(t,e,n){super(t,[e,n])}getProperty(t,e){return t.image}setProperty(t,e,n){t.image=n}initProperty(t,e,n){t.image=n[0],t.gradient=n[1]}}class wt extends st{getProperty(t,e){return t.interactive}setProperty(t,e,n){t.interactive=n}}class mt extends ht{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)?t.EShapeCapability.LINE_HEAD:t.EShapeCapability.NONE}getProperty(t,e){const n=t.points;if(n){const t=n.marker.head.fill;return[t.color,t.alpha]}return[0,0]}setProperty(t,e,n){const i=t.points;i&&i.marker.head.fill.set(void 0,n[0],n[1])}}class Tt extends ht{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)?t.EShapeCapability.LINE_HEAD:t.EShapeCapability.NONE}getProperty(e,n){return e instanceof t.EShapeConnectorLine?e.edge.head.margin:0}setProperty(e,n,i){e instanceof t.EShapeConnectorLine&&(e.edge.head.margin=i)}}class Et extends ht{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)?t.EShapeCapability.LINE_HEAD:t.EShapeCapability.NONE}getProperty(t,e){const n=t.points;return n?n.marker.head.size.x:0}setProperty(t,e,n){const i=t.points;i&&(i.marker.head.size.x=n)}}class yt extends ht{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)?t.EShapeCapability.LINE_HEAD:t.EShapeCapability.NONE}getProperty(t,e){const n=t.points;return n?n.marker.head.size.y:0}setProperty(t,e,n){const i=t.points;i&&(i.marker.head.size.y=n)}}class vt extends ht{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)?t.EShapeCapability.LINE_HEAD:t.EShapeCapability.NONE}getProperty(e,n){const i=e.points;return i?i.marker.head.type:t.EShapePointsMarkerType.NONE}setProperty(t,e,n){const i=t.points;i&&(i.marker.head.type=n)}}class Ct extends ht{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)?t.EShapeCapability.LINE_TAIL:t.EShapeCapability.NONE}getProperty(t,e){const n=t.points;if(n){const t=n.marker.tail.fill;return[t.color,t.alpha]}return[0,0]}setProperty(t,e,n){const i=t.points;i&&i.marker.tail.fill.set(void 0,n[0],n[1])}}class bt extends ht{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)?t.EShapeCapability.LINE_TAIL:t.EShapeCapability.NONE}getProperty(e,n){return e instanceof t.EShapeConnectorLine?e.edge.tail.margin:0}setProperty(e,n,i){e instanceof t.EShapeConnectorLine&&(e.edge.tail.margin=i)}}class Dt extends ht{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)?t.EShapeCapability.LINE_TAIL:t.EShapeCapability.NONE}getProperty(t,e){const n=t.points;return n?n.marker.tail.size.x:0}setProperty(t,e,n){const i=t.points;i&&(i.marker.tail.size.x=n)}}class Lt extends ht{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)?t.EShapeCapability.LINE_TAIL:t.EShapeCapability.NONE}getProperty(t,e){const n=t.points;return n?n.marker.tail.size.y:0}setProperty(t,e,n){const i=t.points;i&&(i.marker.tail.size.y=n)}}class ft extends ht{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)?t.EShapeCapability.LINE_TAIL:t.EShapeCapability.NONE}getProperty(e,n){const i=e.points;return i?i.marker.tail.type:t.EShapePointsMarkerType.NONE}setProperty(t,e,n){const i=t.points;i&&(i.marker.tail.type=n)}}class At extends Q{constructor(t,e,n){super(t,[e,n])}toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE)?t.EShapeCapability.LINE:t.EShapeCapability.NONE}getProperty(e,n){const i=e.points;return null!=i?i.style:t.EShapePointsStyle.NONE}setProperty(t,e,n){const i=t.points;null!=i&&(i.style=n)}initProperty(t,e,n){const i=t.points;null!=i&&(i.style=i.style&~n[1]|n[0])}}class Bt extends Q{constructor(t){super(t,void 0)}toCapability(e){if(e instanceof t.EShapeConnectorLine){const n=e.edge;return null==n.tail.acceptor.shape&&null==n.head.acceptor.shape?t.EShapeCapability.ALL:t.EShapeCapability.NONE}{let n=t.EShapeCapability.NONE;return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)&&(n|=t.EShapeCapability.POSITION),t.EShapeCapabilities.contains(e,t.EShapeCapability.ROTATION)&&(n|=t.EShapeCapability.ROTATION),n}}getProperty(e,n){if(e instanceof t.EShapeConnectorLine){const t=e.edge,n=t.tail.local,i=t.head.local;return[n.x,n.y,i.x,i.y]}{const t=e.transform,n=t.position;return[n.x,n.y,t.rotation,0]}}setProperty(e,n,i){if(e instanceof t.EShapeConnectorLine){const t=e.edge;t.tail.local.set(i[0],i[1]),t.head.local.set(i[2],i[3])}else{const o=e.transform;n&t.EShapeCapability.POSITION&&o.position.set(i[0],i[1]),n&t.EShapeCapability.ROTATION&&(o.rotation=i[2])}}initProperty(t,e,n){}}class xt extends Q{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)?t.EShapeCapability.POSITION:t.EShapeCapability.NONE}getProperty(t,e){return t.transform.position.x}setProperty(t,e,n){t.transform.position.x=n}initProperty(t,n,i){var o;const a=null!==(o=xt.WORK)&&void 0!==o?o:xt.WORK=new e.Rectangle;t.getBoundsLocal(!1,a),t.transform.position.x+=i-a.x}isMergeable(){return!0}}class It extends Q{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)?t.EShapeCapability.POSITION:t.EShapeCapability.NONE}getProperty(t,e){return t.transform.position.y}setProperty(t,e,n){t.transform.position.y=n}initProperty(t,n,i){var o;const a=null!==(o=It.WORK)&&void 0!==o?o:It.WORK=new e.Rectangle;t.getBoundsLocal(!1,a),t.transform.position.y+=i-a.y}isMergeable(){return!0}}class Rt extends st{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)?t.EShapeCapability.POSITION:t.EShapeCapability.NONE}getProperty(t,e){return t.transform.position.x}setProperty(t,e,n){t.transform.position.x=n}isMergeable(){return!0}}class Ot extends st{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)?t.EShapeCapability.POSITION:t.EShapeCapability.NONE}getProperty(t,e){return t.transform.position.y}setProperty(t,e,n){t.transform.position.y=n}isMergeable(){return!0}}class kt extends Q{constructor(t){super(t,void 0)}toCapability(e){if(e instanceof t.EShapeConnectorLine){const n=e.edge;return null==n.tail.acceptor.shape&&null==n.head.acceptor.shape?t.EShapeCapability.POSITION:t.EShapeCapability.NONE}return t.EShapeCapabilities.contains(e,t.EShapeCapability.POSITION)?t.EShapeCapability.POSITION:t.EShapeCapability.NONE}getProperty(e,n){if(e instanceof t.EShapeConnectorLine){const t=e.edge,n=t.tail.local,i=t.head.local;return[n.x,n.y,i.x,i.y]}{const t=e.transform.position;return[t.x,t.y,0,0]}}setProperty(e,n,i){if(e instanceof t.EShapeConnectorLine){const t=e.edge;t.tail.local.set(i[0],i[1]),t.head.local.set(i[2],i[3])}else e.transform.position.set(i[0],i[1])}initProperty(t,e,n){}}class Pt extends st{getProperty(t,e){return t.radius}setProperty(t,e,n){t.radius=n}isMergeable(){return!0}}class Vt extends st{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.ROTATION)?t.EShapeCapability.ROTATION:t.EShapeCapability.NONE}getProperty(t,e){return t.transform.rotation}setProperty(t,e,n){t.transform.rotation=n}isMergeable(){return!0}}class Mt extends st{getProperty(t,e){return t.shortcut}setProperty(t,e,n){t.shortcut=n}}class Nt extends st{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.WIDTH)?t.EShapeCapability.WIDTH:t.EShapeCapability.NONE}getProperty(t,e){return t.size.x}setProperty(t,e,n){t.size.x=n}isMergeable(){return!0}}class Ft extends st{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.HEIGHT)?t.EShapeCapability.HEIGHT:t.EShapeCapability.NONE}getProperty(t,e){return t.size.y}setProperty(t,e,n){t.size.y=n}isMergeable(){return!0}}class zt extends st{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.SKEW)?t.EShapeCapability.SKEW:t.EShapeCapability.NONE}getProperty(t,e){return t.transform.skew.x}setProperty(t,e,n){t.transform.skew.set(n,n)}isMergeable(){return!0}}class Ht extends ht{getProperty(t,e){return t.stroke.align}setProperty(t,e,n){t.stroke.align=n}isMergeable(){return!0}}class Gt extends ht{getProperty(t,e){return[t.stroke.color,t.stroke.alpha]}setProperty(t,e,n){t.stroke.set(void 0,n[0],n[1])}}class Ut extends ht{getProperty(t,e){return t.stroke.enable}setProperty(t,e,n){t.stroke.enable=n}}class Yt extends rt{getProperty(t,e){return t.stroke.side}setProperty(t,e,n){t.stroke.side=n}initProperty(t,e,n){t.stroke.side&=~n}}class Xt extends rt{getProperty(t,e){return t.stroke.side}setProperty(t,e,n){t.stroke.side=n}initProperty(t,e,n){t.stroke.side|=n}}class Wt extends Q{constructor(t,e,n){super(t,[e,n])}getProperty(t,e){return t.stroke.style}setProperty(t,e,n){t.stroke.style=n}initProperty(t,e,n){const i=t.stroke;i.style=i.style&~n[1]|n[0]}}class Kt extends ht{getProperty(t,e){return t.stroke.width}setProperty(t,e,n){t.stroke.width=n}isMergeable(){return!0}}class $t extends st{getProperty(t,e){return t.text.align.horizontal}setProperty(t,e,n){t.text.align.horizontal=n}}class Zt extends st{getProperty(t,e){return t.text.align.vertical}setProperty(t,e,n){t.text.align.vertical=n}}class jt extends st{getProperty(t,e){return t.text.clipping}setProperty(t,e,n){t.text.clipping=n}}class qt extends st{getProperty(t,e){const n=t.text;return[n.color,n.alpha]}setProperty(t,e,n){const i=t.text;i.color=n[0],i.alpha=n[1]}}class Jt extends st{getProperty(t,e){return t.text.direction}setProperty(t,e,n){t.text.direction=n}}class Qt extends st{getProperty(t,e){return t.text.family}setProperty(t,e,n){t.text.family=n}}class te extends st{getProperty(t,e){return t.text.fitting}setProperty(t,e,n){t.text.fitting=n}}class ee extends st{getProperty(t,e){return t.text.offset.horizontal}setProperty(t,e,n){t.text.offset.horizontal=n}}class ne extends st{getProperty(t,e){return t.text.offset.vertical}setProperty(t,e,n){t.text.offset.vertical=n}}class ie extends st{getProperty(t,e){const n=t.text.outline;return[n.color,n.alpha]}setProperty(t,e,n){const i=t.text.outline;i.color=n[0],i.alpha=n[1]}}class oe extends st{getProperty(t,e){return t.text.outline.enable}setProperty(t,e,n){t.text.outline.enable=n}}class ae extends st{getProperty(t,e){return t.text.outline.width}setProperty(t,e,n){t.text.outline.width=n}isMergeable(){return!0}}class se extends st{getProperty(t,e){return t.text.padding.horizontal}setProperty(t,e,n){t.text.padding.horizontal=n}}class le extends st{getProperty(t,e){return t.text.padding.vertical}setProperty(t,e,n){t.text.padding.vertical=n}}class re extends Q{getProperty(t,e){return t.text.size}setProperty(t,e,n){t.text.size=n}initProperty(t,e,n){const i=t.text;i.size=Math.max(0,i.size+n)}}class he extends st{getProperty(t,e){return t.text.size}setProperty(t,e,n){t.text.size=n}}class ue extends st{getProperty(t,e){return t.text.spacing.horizontal}setProperty(t,e,n){t.text.spacing.horizontal=n}isMergeable(){return!0}}class ce extends st{getProperty(t,e){return t.text.spacing.vertical}setProperty(t,e,n){t.text.spacing.vertical=n}isMergeable(){return!0}}class pe extends st{getProperty(t,e){return t.text.style}setProperty(t,e,n){t.text.style=n}}class de extends st{getProperty(t,e){return t.text.value}setProperty(t,e,n){t.text.value=n}isMergeable(){return!0}}class ge extends st{getProperty(t,e){return t.text.weight}setProperty(t,e,n){t.text.weight=n}}class _e extends st{getProperty(t,e){return t.title}setProperty(t,e,n){t.title=n}}class Se extends t.DCommandBase{constructor(t,e,n,i){super(),this._parent=n,this._newShape=t,this._oldShape=e,this._selection=i,this._index=n.children.indexOf(e),t.reference+=1,e.reference+=1}get parent(){return this._parent}get oldShape(){return this._oldShape}get newShape(){return this._newShape}get index(){return this._index}get selection(){return this._selection}execute(){return this._oldShape.detach(),this._newShape.attach(this._parent,this._index),this._selection.swapLast(this._oldShape,this._newShape),!0}redo(){return this._newShape.attach(this._parent,this._index),this._oldShape.detach(),this._selection.swapLast(this._oldShape,this._newShape),!0}undo(){return this._newShape.detach(),this._oldShape.attach(this._parent,this._index),this._selection.swapLast(this._newShape,this._oldShape),!0}destroy(){const t=this._newShape;t.reference-=1,null==t.parent&&t.reference<=0&&t.destroy();const e=this._oldShape;e.reference-=1,null==e.parent&&e.reference<=0&&e.destroy()}}class we extends t.DCommandBase{constructor(t,e,n){super(),this._parent=t,this._factory=e,this._selection=n,this._newShapes=[],this._oldShapes=[],this._indices=[]}get parent(){return this._parent}get oldShapes(){return this._oldShapes}get newShapes(){return this._newShapes}get indices(){return this._indices}get selection(){return this._selection}execute(){const e=this._parent,n=this._indices,i=this._newShapes,o=this._oldShapes,a=e.children,s=this._factory;for(let l=0,r=a.length;l<r;++l){const r=a[l];if(r.selected){let a;if(t.EShapeCapabilities.contains(r,t.EShapeCapability.REPLACING)){if(r instanceof t.EShapeGroup){const e=r.transform.pivot,n=e.x,i=e.y;0!==n||0!==i?(r.lock(t.EShapeLockPart.TRANSFORM),e.set(0,0),a=s(r)||r,e.set(n,i),r.unlock(t.EShapeLockPart.TRANSFORM,!1)):a=s(r)||r}else a=s(r)||r;a!==r&&(r.reference+=1,a.reference+=1,r.detach(),a.attach(e,l))}else a=r;n.push(l),i.push(a),o.push(r)}}const l=this._selection;return l.lock(),l.clearAndAddAll(i),l.update(J.TREE|J.SELECTION),l.unlock(),!0}redo(){const t=this._parent,e=this._indices,n=this._oldShapes,i=this._newShapes;for(let o=0,a=i.length;o<a;++o){const a=n[o],s=i[o];a!==s&&(a.detach(),s.attach(t,e[o]))}const o=this._selection;return o.lock(),o.clearAndAddAll(i),o.update(J.TREE|J.SELECTION),o.unlock(),!0}undo(){const t=this._parent,e=this._indices,n=this._oldShapes,i=this._newShapes;for(let o=0,a=i.length;o<a;++o){const a=n[o],s=i[o];a!==s&&(s.detach(),a.attach(t,e[o]))}const o=this._selection;return o.lock(),o.clearAndAddAll(n),o.update(J.TREE|J.SELECTION),o.unlock(),!0}destroy(){const t=this._oldShapes,e=this._newShapes;for(let n=0,i=e.length;n<i;++n){const i=t[n],o=e[n];i!==o&&(o.reference-=1,null==o.parent&&o.reference<=0&&o.destroy(),i.reference-=1,null==i.parent&&i.reference<=0&&i.destroy())}t.length=0,e.length=0,this.indices.length=0}}class me extends t.DCommandBase{constructor(t,e,n){super(),this._before=t,this._after=e,this._selection=n}get before(){return this._before}get after(){return this._after}get selection(){return this._selection}isClean(){return!0}execute(){return!0}redo(){return this._selection.restore(this._after),!0}undo(){return this._selection.restore(this._before),!0}destroy(){this._before.length=0,this._after.length=0}}class Te extends t.DCommandBase{constructor(t,e,n){super(),this._indices=t,this._parent=e,this._selection=n}get indices(){return this._indices}get parent(){return this._parent}get selection(){return this._selection}execute(){return!0}redo(){const t=this._indices,e=this._parent,n=e.children;for(let e=0,i=t.length;e<i;++e){const i=t[e],o=n[i];n[i]=n[i+1],n[i+1]=o}return e.toDirty(),this._selection.update(J.TREE),!0}undo(){const t=this._indices,e=this._parent,n=e.children;for(let e=t.length-1;0<=e;--e){const i=t[e],o=n[i+1];n[i+1]=n[i],n[i]=o}return e.toDirty(),this._selection.update(J.TREE),!0}destroy(){this._indices.length=0}}const Ee=(t,e)=>t.index-e.index;class ye extends t.DCommandBase{constructor(t,e,n){super(),this._indices=t,this._parent=e,this._selection=n}get indices(){return this._indices}get parent(){return this._parent}get selection(){return this._selection}execute(){return!0}redo(){const t=this._indices,e=this._parent,n=e.children,i=n.length;for(let t=0;t<i;++t)n[t].index=t;for(let e=0,o=t.length;e<o;++e){const o=t[e];n[o].index=i+o}return n.sort(Ee),e.toDirty(),this._selection.update(J.TREE),!0}undo(){const t=this._indices,e=this._parent,n=e.children,i=n.length,o=t.length;for(let e=0,a=o;e<a;++e){const o=t[e];n[i-1-e].index=o}let a=o-1,s=t[a],l=0;for(let e=0,r=i-o;e<r;++e){const i=n[e],o=e+l;o<s?i.index=o:(l+=1,a-=1,s=0<=a?t[a]:Number.MAX_SAFE_INTEGER,e-=1)}return n.sort(Ee),e.toDirty(),this._selection.update(J.TREE),!0}destroy(){this._indices.length=0}}class ve extends t.DCommandBase{constructor(t,e,n){super(),this._indices=t,this._parent=e,this._selection=n}get indices(){return this._indices}get parent(){return this._parent}get selection(){return this._selection}execute(){return!0}redo(){const t=this._indices,e=this._parent,n=e.children;for(let e=0,i=t.length;e<i;++e){const i=t[e],o=n[i];n[i]=n[i-1],n[i-1]=o}return e.toDirty(),this._selection.update(J.TREE),!0}undo(){const t=this._indices,e=this._parent,n=e.children;for(let e=t.length-1;0<=e;--e){const i=t[e],o=n[i-1];n[i-1]=n[i],n[i]=o}return e.toDirty(),this._selection.update(J.TREE),!0}destroy(){this._indices.length=0}}const Ce=(t,e)=>t.index-e.index;class be extends t.DCommandBase{constructor(t,e,n){super(),this._indices=t,this._parent=e,this._selection=n}get indices(){return this._indices}get parent(){return this._parent}get selection(){return this._selection}execute(){return!0}redo(){const t=this._indices,e=this._parent,n=e.children,i=n.length;for(let t=0;t<i;++t)n[t].index=t;for(let e=0,o=t.length;e<o;++e){const o=t[e];n[o].index=o-i}return n.sort(Ce),e.toDirty(),this._selection.update(J.TREE),!0}undo(){const t=this._indices,e=this._parent,n=e.children,i=t.length;for(let e=0,o=i;e<o;++e){const i=t[e];n[e].index=i}let o=0,a=t[o],s=-i;const l=n.length;for(let e=i;e<l;++e){const l=n[e],r=e+s;r<a?l.index=r:(s+=1,o+=1,a=o<i?t[o]:Number.MAX_SAFE_INTEGER,e-=1)}return n.sort(Ce),e.toDirty(),this._selection.update(J.TREE),!0}destroy(){this._indices.length=0}}class De{static prepare(e){let n=e.editor;null==n&&(n=new t.EShapeEditor,e.editor=n),e.updateTransform();const i=e.parent;i instanceof t.EShapeBase?i.transform.internalTransform.copyTo(n.internalTransformParentInverse).invert():n.internalTransformParentInverse.identity(),e.transform.internalTransform.copyTo(n.internalTransform),n.rotation=e.transform.rotation,n.size.copyFrom(e.size),e.lock(t.EShapeLockPart.TRANSFORM_CHILD)}static finalize(e){e.unlock(t.EShapeLockPart.TRANSFORM_CHILD,!0)}static apply(t,e,n){const i=t.editor;if(null!=i){const o=i.localTransform;i.internalTransformParentInverse.copyTo(o).append(e).append(i.internalTransform),this.applyLocal(t,o,n,i.size)}}static applyLocal(e,n,i,o){const a=n.a,s=n.b,l=n.c,r=n.d,h=n.tx,u=n.ty;e.lock(t.EShapeLockPart.UPLOADED);const c=e.transform,p=!!(i&t.EShapeCapability.POSITION),d=!!(i&t.EShapeCapability.ROTATION),g=!!(i&t.EShapeCapability.SKEW),_=!!(i&t.EShapeCapability.WIDTH),S=!!(i&t.EShapeCapability.HEIGHT);if(d||g){const t=Math.atan2(-l,r),e=Math.atan2(+s,a);if(d&&(c.rotation=.5*(t+e)),g){const n=.5*(e-t);c.skew.set(n,n)}}if(p){const t=c.pivot,e=t.x,n=t.y;c.position.set(h+(a*e+l*n),u+(s*e+r*n))}if(null!=o&&(_||S)){const n=t.toSizeNormalized(o.x*Math.sqrt(a*a+s*s)),i=t.toSizeNormalized(o.y*Math.sqrt(l*l+r*r)),h=e.size;_&&S?h.set(n,i):_?h.x=n:h.y=i}e.unlock(t.EShapeLockPart.UPLOADED,!0)}}class Le extends t.DCommandBase{constructor(t,e){super(),this._parent=t,this._selection=e,this._before=[],this._deleteds=[],this._indices=[],this._createds=[]}get parent(){return this._parent}get selection(){return this._selection}get before(){return this._before}get deleteds(){return this._deleteds}get indices(){return this._indices}get createds(){return this._createds}execute(){const e=this._selection;e.lock(),this._before=e.store();const n=e.get();for(let t=n.length-1;0<=t;--t){const e=n[t];this.isUngroupable(e)||(e.selected=!1,n.splice(t,1))}const i=this._parent,o=Z.delete(i,n,!0)||[];this._deleteds=o;for(let t=0,e=o.length;t<e;++t)o[t].reference+=1;const a=[];for(let e=0,n=o.length;e<n;++e){const n=o[e],s=n.transform.localTransform,l=s.a,r=s.b,h=s.c,u=s.d,c=s.tx,p=s.ty,d=n.children,g=[];for(let e=0,n=d.length;e<n;++e){const n=d[e].clone();n.lock(t.EShapeLockPart.ALL),n.parent=null,n.updateTransform();const i=n.transform.localTransform;i.prepend(s);let o=t.EShapeCapability.NONE;if(t.EShapeCapabilities.contains(n,t.EShapeCapability.POSITION)&&(o|=t.EShapeCapability.POSITION),t.EShapeCapabilities.contains(n,t.EShapeCapability.ROTATION)&&(o|=t.EShapeCapability.ROTATION),t.EShapeCapabilities.contains(n,t.EShapeCapability.SKEW)&&(o|=t.EShapeCapability.SKEW),o!==t.EShapeCapability.NONE&&De.applyLocal(n,i,o),n instanceof t.EShapeConnectorLine){const t=n.edge,e=t.tail;if(null==e.acceptor.shape){const t=e.local,n=t.x,i=t.y;t.set(l*n+h*i+c,r*n+u*i+p);const o=e.normal,a=o.x,s=o.y,d=l*a+h*s,g=r*a+u*s,_=d*d+g*g;if(1e-6<_){const t=Math.sqrt(1/_);o.set(d*t,g*t)}}const i=t.head;if(null==i.acceptor.shape){const t=i.local,e=t.x,n=t.y;t.set(l*e+h*n+c,r*e+u*n+p);const o=i.normal,a=o.x,s=o.y,d=l*a+h*s,g=r*a+u*s,_=d*d+g*g;if(1e-6<_){const t=Math.sqrt(1/_);o.set(d*t,g*t)}}}g.push(n)}t.EShapeConnectors.moveAll(d,g,d,g);for(let e=0,n=g.length;e<n;++e){const n=g[e];n.unlock(t.EShapeLockPart.ALL,!0),n.attach(i),n.reference+=1,a.push(n)}}return this._createds=a,this._indices=$.toIndices(o),e.clearAndAddAll(a),e.update("TREE"),e.unlock(),!0}isUngroupable(e){return e instanceof t.EShapeGroup&&t.EShapeCapabilities.contains(e,t.EShapeCapability.CHILDREN)&&t.EShapeCapabilities.contains(e,t.EShapeCapability.UNGROUPING)}redo(){const t=this._selection;t.lock(),t.clearAndAddAll(this._deleteds),t.delete(!1);const e=this._parent,n=this._createds;for(let t=0,i=n.length;t<i;++t)n[t].attach(e);return t.clearAndAddAll(n),t.update("TREE"),t.unlock(),!0}undo(){const t=this._parent,e=this._selection;e.lock();const n=this._createds;for(let t=n.length-1;0<=t;--t)n[t].detach();const i=this._deleteds,o=this._indices;for(let e=0,n=i.length;e<n;++e)i[e].attach(t,o[e]);return this._selection.restore(this._before),e.update("TREE"),e.unlock(),!0}destroy(){this._before.length=0;const t=this._deleteds;for(let e=0,n=t.length;e<n;++e){const n=t[e];n.reference-=1,null==n.parent&&n.reference<=0&&n.destroy()}t.length=0;const e=this._createds;for(let t=0,n=e.length;t<n;++t){const n=e[t];n.reference-=1,null==n.parent&&n.reference<=0&&n.destroy()}e.length=0}}function fe(t,e){return{id:void 0,graphicId:e.id,name:t,mappings:new Map}}class Ae{constructor(t){this.lines=t,this.linesLength=t.length,this.cursor=-1,this.line="",this.lineLength=0}next(){const t=this.cursor+1;if(t<this.linesLength){this.cursor=t;const e=this.lines[t];return this.line=e,this.lineLength=e.length,!0}return!1}}class Be{static parseLine(t){const e=[];let n=-1,i=t.line,o=t.lineLength;for(let a=0;a<o;++a)if('"'===i.charAt(a))for(let n=a+1;n<o;++n){const s=i.indexOf('"',n);if(s<0){if(t.next()){i+="\n"+t.line,o+=1+t.lineLength,n-=1;continue}n=o+1,e.push(this.unescape(i.substring(a+1,n-1))),a=n}else{if(n=s+1,n<o&&'"'===i.charAt(n))continue;e.push(this.unescape(i.substring(a+1,n-1))),a=n}break}else n<a&&(n=i.indexOf(",",a),n<0&&(n=o)),e.push(i.substring(a,n)),a=n;return e}static parse(t){const e=t.split(/(?:\r\n?|\n)/g),n=[],i=new Ae(e);for(;i.next();){const t=this.parseLine(i);0<t.length&&n.push(t)}return n}static stringifyLine(t){let e="",n="";for(let i=0,o=t.length;i<o;++i)e+=n+this.escape(String(t[i])),n=",";return e}static stringify(t){let e="",n="";for(let i=0,o=t.length;i<o;++i)e+=n+this.stringifyLine(t[i]),n="\n";return e}static escape(t){const e=t.replace(/"/g,'""');return e.length!==t.length||0<=t.indexOf(",")||0<=t.indexOf("\n")||0<=t.indexOf("\r")?`"${e}"`:t}static unescape(t){return t.replace(/""/g,'"')}}function xe(t){const e=Be.parse(t),n=new Map;for(let t=0,i=e.length;t<i;++t){const i=e[t],o=parseInt(i[0],10);if(o==o){const t=i[1]||"",e=i[2]||"";if(0<t.length&&0<e.length){let i=n.get(o);null==i&&(i={},n.set(o,i)),i[t]=e}}}return n}function Ie(t){const e=JSON.parse(t.mappings),n=e[0],i=e[1],o=new Map;for(let t=0,e=Math.min(n.length,i.length);t<e;++t)o.set(n[t],i[t]);return{id:t.id,graphicId:t.graphicId,name:t.name,mappings:o}}function Re(t){const e=t.mappings,n=[],i=[];return e.forEach(((t,e)=>{n.push(e),i.push(t)})),{id:t.id,graphicId:t.graphicId,name:t.name,mappings:JSON.stringify([n,i])}}class Oe{static add(e){var n,i;(null!==(n=this._typeToExtension)&&void 0!==n?n:this._typeToExtension=new Map).set(e.type,e),(null!==(i=this._extensions)&&void 0!==i?i:this._extensions=[]).push(e),t.EShapeActionValueDeserializers[e.type]=e.deserializer}static get(t){const e=this._typeToExtension;if(null!=e)return e.get(t)}static each(t){const e=this._extensions;if(null!=e)for(let n=0,i=e.length;n<i;++n)t(e[n])}}const ke={TEXT:0};class Pe{constructor(t,e,n,i){this._extension=t,this._dialog=e,this._condition=n,this._layout=i}get select(){let t=this._select;return void 0===t&&(t=this.newSelect(),this._select=t),t}newSelect(){const e=this._extension.items;return null!=e&&0<e.length?new t.DSelect({weight:1,value:e[0].type,menu:{items:this.newSelectMenuItems(e)}}):null}newSelectMenuItems(t){const e=[];for(let n=0,i=t.length;n<i;++n){const i=t[n];e.push({value:i.type,text:{value:i.label}})}return e}get selectLayout(){let t=this._selectLayout;if(void 0===t){if(t=this.newSelectLayout(),null!=t){const e=this._layout,n=e.getChildIndex(this._condition);0<=n?e.addChildAt(t,n):e.addChild(t)}this._selectLayout=t}return t}newSelectLayout(){const t=this.select;return null!=t?this.newLabeled("",t):null}get inputs(){let t=this._inputs;return void 0===t&&(t=this.newInputs(),this._inputs=t),t}newInputs(){const t=[],e=this._extension.inputs;if(null!=e)for(let n=0,i=e.length;n<i;++n)if(e[n].type===ke.TEXT){const e=this.newInputText();t.push(e)}return t}newInputText(){return new t.DInputText({weight:1,on:{enter:()=>{this.ok()}}})}newLabel(e){return new t.DInputLabel({width:60,text:{value:e}})}newSpace(){return new t.DLayoutSpace({width:60})}newLabeled(e,n){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[null!=e?this.newLabel(e):this.newSpace(),n,this.newSpace()]})}get inputLayouts(){let t=this._inputLayouts;return void 0===t&&(t=this.newInputLayouts(),this._inputLayouts=t),t}newInputLayouts(){const t=[],e=this.inputs,n=this._layout,i=this._extension.inputs;if(null!=i){const o=n.getChildIndex(this._condition);for(let a=0,s=e.length;a<s;++a){const s=this.newLabeled(i[a].label,e[a]);t.push(s),0<=o?n.addChildAt(s,o+1+a):n.addChild(s)}}return t}get value(){return this._extension.toValue(this.select,this._condition.input,this.inputs)}set value(t){null!=t&&this._extension.fromValue(t,this.select,this._condition.input,this.inputs)}show(){const t=this.selectLayout;null!=t&&t.show();const e=this.inputLayouts;if(0<e.length){const t=this._extension;if(null!=t.onShow)t.onShow(e);else for(let t=0,n=e.length;t<n;++t)e[t].show()}}hide(){const t=this._selectLayout;null!=t&&t.hide();const e=this._inputLayouts;if(null!=e)for(let t=0,n=e.length;t<n;++t)e[t].hide()}reset(){const t=this._select;if(t){const e=this._extension.items;null!=e&&0<e.length?t.value=e[0].type:t.value=null}const e=this._inputs;if(e){const t=this._extension.inputs;if(null!=t)for(let n=0,i=e.length;n<i;++n)e[n].value=t[n].initial||""}}ok(){this._dialog.ok()}}class Ve{constructor(t,e,n){this._data=new Map,this._dialog=t,this._condition=e,this._layout=n}get value(){const t=this._selected;return t?t.value:null}set value(t){if(null!=t){const e=this._data.get(t.type);null!=e&&(e.value=t)}}get(t){const e=this._data;let n=e.get(t);if(null!=n)return n;const i=Oe.get(t);return null==i?null:(n=new Pe(i,this._dialog,this._condition,this._layout),e.set(t,n),n)}show(t){if(null!=t){const e=this.get(t);if(null!=e){const t=this._selected;t!==e&&(null!=t&&t.hide(),this._selected=e,e.show())}else this.hide()}else this.hide()}hide(){const t=this._selected;null!=t&&(t.hide(),this._selected=null)}reset(){this._data.forEach((t=>{t.reset()}))}onChange(t){this.show(t)}}const Me=t=>`extension_icon_${t}`;class Ne{static add(e){var n,i;if("type"in e){const i=e.type;(null!==(n=this._typeToExtension)&&void 0!==n?n:this._typeToExtension=new Map).set(i,e);const o=e.deserializer;null!=o&&(t.EShapeDeserializers[i]=o);const a=e.onDeserialized;null!=a&&(t.EShapeOnDeserializeds[i]=a);const s=e.runtime;s&&(t.EShapeRuntimes[i]=s);const l=e.capability;null!=l&&t.EShapeCapabilities.set(i,l);const r=e.uploaded;null!=r?t.EShapeUploadeds[i]=r:null==t.EShapeUploadeds[i]&&(t.EShapeUploadeds[i]=t.createGroupUploaded)}(null!==(i=this._extensions)&&void 0!==i?i:this._extensions=[]).push(e)}static get(t){const e=this._typeToExtension;if(null!=e)return e.get(t)}static each(t){const e=this._extensions;if(null!=e)for(let n=0,i=e.length;n<i;++n)t(e[n])}static merge(t){const e=this._extensions;if(null!=e)for(let n=0,i=e.length;n<i;++n){const i=e[n];if("icon"in i){const e=i.icon;t.add(Me(n),e.width,e.height,e.svg)}}}static build(t){const e=this._extensions;if(null!=e)for(let n=0,i=e.length;n<i;++n){const i=e[n];"icon"in i&&(i.icon.texture=t[Me(n)])}}}class Fe extends st{getProperty(e,n){return e instanceof t.EShapeEmbeddedAcceptorEdge?e.side:t.EShapeAcceptorEdgeSide.NONE}setProperty(e,n,i){e instanceof t.EShapeEmbeddedAcceptorEdge&&(e.side=i)}}class ze extends st{getProperty(e,n){return e instanceof t.EShapeEmbeddedAcceptorEdge?e.subtype:t.EShapeAcceptorEdgeType.HEAD}setProperty(e,n,i){e instanceof t.EShapeEmbeddedAcceptorEdge&&(e.subtype=i)}}class He extends st{getProperty(e,n){return e instanceof t.EShapeEmbeddedAcceptorEdge&&e.vvisible}setProperty(e,n,i){e instanceof t.EShapeEmbeddedAcceptorEdge&&(e.vvisible=i)}}class Ge extends t.DPane{constructor(t){super(t),this._icons=t.icons;const e=t.selection;this._selection=e,this._diagram=t.diagram,this.initLayout()}initLayout(){this.content.setHeight("padding"),new t.DLayoutVertical({parent:this.content,x:"padding",y:"padding",width:"padding",height:"padding",children:[this.newTextLabel(),this.selectSubtype,this.selectSide,this.checkVvisible]});const e=this._selection;this.state.isDisabled=e.isEmpty(),e.on("change",(()=>{this.state.isDisabled=e.isEmpty(),this.onSelectionChange(e)})),this.onSelectionChange(e)}newTextLabel(){return new t.DText({width:"100%",text:{value:this.subtheme.getLabel()}})}get selectSubtype(){var t;return null!==(t=this._selectSubtype)&&void 0!==t?t:this._selectSubtype=this.newSelectSubtype()}newSelectSubtype(){const e=this.subtheme;return new t.DSelect({width:"padding",value:t.EShapeAcceptorEdgeType.HEAD,menu:{items:[{value:t.EShapeAcceptorEdgeType.HEAD,text:{value:e.toSelectSubtypeLabel(t.EShapeAcceptorEdgeType.HEAD)}},{value:t.EShapeAcceptorEdgeType.TAIL,text:{value:e.toSelectSubtypeLabel(t.EShapeAcceptorEdgeType.TAIL)}},{value:t.EShapeAcceptorEdgeType.ALL,text:{value:e.toSelectSubtypeLabel(t.EShapeAcceptorEdgeType.ALL)}}]},on:{change:t=>{this.onSelectSubtypeChanged(t)}}})}onSelectSubtypeChanged(e){t.DControllers.getCommandController().push(new ze(this._selection,e))}get selectSide(){var t;return null!==(t=this._selectSide)&&void 0!==t?t:this._selectSide=this.newSelectSide()}newSelectSide(){const e=this.subtheme;return new t.DSelectMultiple({width:"padding",values:[t.EShapeAcceptorEdgeSide.LEFT],menu:{items:[{value:t.EShapeAcceptorEdgeSide.LEFT,text:{value:e.toSelectSideLabel(t.EShapeAcceptorEdgeSide.LEFT)},check:!0},{value:t.EShapeAcceptorEdgeSide.TOP,text:{value:e.toSelectSideLabel(t.EShapeAcceptorEdgeSide.TOP)},check:!0},{value:t.EShapeAcceptorEdgeSide.RIGHT,text:{value:e.toSelectSideLabel(t.EShapeAcceptorEdgeSide.RIGHT)},check:!0},{value:t.EShapeAcceptorEdgeSide.BOTTOM,text:{value:e.toSelectSideLabel(t.EShapeAcceptorEdgeSide.BOTTOM)},check:!0}]},on:{change:t=>{this.onSelectSideChange(t)}}})}onSelectSideChange(e){t.DControllers.getCommandController().push(new Fe(this._selection,this.fromSelectSideValues(e)))}toSelectSideValues(e){const n=[];return e&t.EShapeAcceptorEdgeSide.LEFT&&n.push(t.EShapeAcceptorEdgeSide.LEFT),e&t.EShapeAcceptorEdgeSide.TOP&&n.push(t.EShapeAcceptorEdgeSide.TOP),e&t.EShapeAcceptorEdgeSide.RIGHT&&n.push(t.EShapeAcceptorEdgeSide.RIGHT),e&t.EShapeAcceptorEdgeSide.BOTTOM&&n.push(t.EShapeAcceptorEdgeSide.BOTTOM),n}fromSelectSideValues(e){let n=t.EShapeAcceptorEdgeSide.NONE;for(let t=0,i=e.length;t<i;++t)n|=e[t];return n}get checkVvisible(){var t;return null!==(t=this._checkVvisible)&&void 0!==t?t:this._checkVvisible=this.newCheckIsVvisible()}newCheckIsVvisible(){return new t.DButtonCheckRight({width:"padding",text:{value:this.subtheme.getCheckIsVvisibleLabel()},on:{active:()=>{this.onCheckVvisibleChanged(!0)},inactive:()=>{this.onCheckVvisibleChanged(!1)}}})}onCheckVvisibleChanged(e){t.DControllers.getCommandController().push(new He(this._selection,e))}onSelectionChange(e){const n=this.selectSubtype,i=this.selectSide,o=this.checkVvisible,a=e.last();a instanceof t.EShapeEmbeddedAcceptorEdge?(n.value=a.subtype,n.state.isEnabled=!0,i.values=this.toSelectSideValues(a.side),i.state.isEnabled=!0,o.state.isActive=a.vvisible,o.state.isEnabled=!0):(n.state.isEnabled=!1,i.state.isEnabled=!1,o.state.isEnabled=!1)}get subtheme(){var t;return null!==(t=this._subtheme)&&void 0!==t?t:this._subtheme=this.newSubtheme()}newSubtheme(){return t.DThemes.get("EEditorShapeEmbeddedAcceptorEdge")}}class Ue{static getTheme(){return t.DThemes.get("EShapeEmbeddedAcceptorEdge")}static create(e){const n=new t.EShapeEmbeddedAcceptorEdge;return e?n.copy(e):(n.subtype=t.EShapeAcceptorEdgeType.HEAD,n.side=t.EShapeAcceptorEdgeSide.LEFT,n.vvisible=!0,n.stroke.set(!1,3381759,1),n.fill.set(!0,3381759,1)),n}static load(){const e=this.getTheme().getName();Ne.add({type:t.EShapeType.EMBEDDED_ACCEPTOR_EDGE,name:e,icon:{width:24,height:24,svg:'<g transform="scale(0.667,0.667) translate(480, 480) rotate(+90) translate(-480, 480)" fill="#fff" stroke="none"><path d="M480-640 280-440l56 56 104-103v407h80v-407l104 103 56-56-200-200ZM146-260q-32-49-49-105T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 59-17 115t-49 105l-58-58q22-37 33-78t11-84q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 43 11 84t33 78l-58 58Z"/></g>'},title:e,creator:t=>Ue.create(t),editor:Ge})}}class Ye extends st{getProperty(e,n){return e instanceof t.EShapeButton&&e.state.isActive}setProperty(e,n,i){e instanceof t.EShapeButton&&(e.state.isActive=i)}}class Xe extends st{getProperty(e,n){return e instanceof t.EShapeButton&&e.isGrouped}setProperty(e,n,i){e instanceof t.EShapeButton&&(e.isGrouped=i)}}class We extends st{getProperty(e,n){return e instanceof t.EShapeButton&&e.isToggle}setProperty(e,n,i){e instanceof t.EShapeButton&&(e.isToggle=i)}}class Ke extends t.DPane{constructor(t){super(t),this._icons=t.icons;const e=t.selection;this._selection=e,this._diagram=t.diagram,this.initLayout()}initLayout(){this.content.setHeight("padding"),new t.DLayoutVertical({parent:this.content,x:"padding",y:"padding",width:"padding",height:"padding",children:[this.newTextLabel(),this.checkIsToggle,this.checkIsGrouped,this.checkIsActive]});const e=this._selection;this.state.isDisabled=e.isEmpty(),e.on("change",(()=>{this.state.isDisabled=e.isEmpty(),this.onSelectionChange(e)})),this.onSelectionChange(e)}newTextLabel(){return new t.DText({width:"100%",text:{value:this.subtheme.getLabel()}})}get checkIsToggle(){var t;return null!==(t=this._checkIsToggle)&&void 0!==t?t:this._checkIsToggle=this.newCheckIsToggle()}newCheckIsToggle(){return new t.DButtonCheckRight({width:"padding",text:{value:this.subtheme.getCheckIsToggleLabel()},on:{active:()=>{this.onCheckIsToggleChanged(!0)},inactive:()=>{this.onCheckIsToggleChanged(!1)}}})}onCheckIsToggleChanged(e){t.DControllers.getCommandController().push(new We(this._selection,e))}onSelectionChangeCheckIsToggle(e){const n=this.checkIsToggle.state,i=e.last();i instanceof t.EShapeButton?(n.lock(),n.isActive=i.isToggle,n.isDisabled=!1,n.unlock()):n.isDisabled=!0}get checkIsGrouped(){var t;return null!==(t=this._checkIsGrouped)&&void 0!==t?t:this._checkIsGrouped=this.newCheckIsGrouped()}newCheckIsGrouped(){return new t.DButtonCheckRight({width:"padding",text:{value:this.subtheme.getCheckIsGroupedLabel()},on:{active:()=>{this.onCheckIsGroupedChanged(!0)},inactive:()=>{this.onCheckIsGroupedChanged(!1)}}})}onCheckIsGroupedChanged(e){t.DControllers.getCommandController().push(new Xe(this._selection,e))}onSelectionChangeCheckIsGrouped(e){const n=this.checkIsGrouped.state,i=e.last();i instanceof t.EShapeButton?(n.lock(),n.isActive=i.isGrouped,n.isDisabled=!1,n.unlock()):n.isDisabled=!0}get checkIsActive(){var t;return null!==(t=this._checkIsActive)&&void 0!==t?t:this._checkIsActive=this.newCheckIsActive()}newCheckIsActive(){return new t.DButtonCheckRight({width:"padding",text:{value:this.subtheme.getCheckIsActiveLabel()},on:{active:()=>{this.onCheckIsActiveChanged(!0)},inactive:()=>{this.onCheckIsActiveChanged(!1)}}})}onCheckIsActiveChanged(e){t.DControllers.getCommandController().push(new Ye(this._selection,e))}onSelectionChangeCheckIsActive(e){const n=this.checkIsActive.state,i=e.last();i instanceof t.EShapeButton?(n.lock(),n.isActive=i.state.isActive,n.isDisabled=!1,n.unlock()):n.isDisabled=!0}onSelectionChange(t){this.onSelectionChangeCheckIsToggle(t),this.onSelectionChangeCheckIsGrouped(t),this.onSelectionChangeCheckIsActive(t)}get subtheme(){var t;return null!==(t=this._subtheme)&&void 0!==t?t:this._subtheme=this.newSubtheme()}newSubtheme(){return t.DThemes.get("EEditorShapeButton")}}class $e{static getTheme(){return t.DThemes.get("EShapeButton")}static create(e){const n=new t.EShapeButton;if(e)n.copy(e);else{const t=this.getTheme().getLabel();n.stroke.set(!1,3381759,1),n.fill.set(!0,3381759,1),n.text.set(t,16777215,1),n.cursor="pointer",n.state.isFocusable=!0,n.interactive=!0}return n}static load(){const e=this.getTheme().getName();Ne.add({type:t.EShapeType.BUTTON,name:e,icon:{width:24,height:24,svg:'<g transform="scale(26.6666)" fill="#fff" stroke="none"><path d="M22,9v6c0,1.1-0.9,2-2,2h-1l0-2h1V9H4v6h6v2H4c-1.1,0-2-0.9-2-2V9c0-1.1,0.9-2,2-2h16C21.1,7,22,7.9,22,9z M14.5,19 l1.09-2.41L18,15.5l-2.41-1.09L14.5,12l-1.09,2.41L11,15.5l2.41,1.09L14.5,19z M17,14l0.62-1.38L19,12l-1.38-0.62L17,10l-0.62,1.38 L15,12l1.38,0.62L17,14z M14.5,19l1.09-2.41L18,15.5l-2.41-1.09L14.5,12l-1.09,2.41L11,15.5l2.41,1.09L14.5,19z M17,14l0.62-1.38 L19,12l-1.38-0.62L17,10l-0.62,1.38L15,12l1.38,0.62L17,14z"/></g>'},title:e,creator:t=>$e.create(t),editor:Ke})}}class Ze{constructor(e,n,i,o,a,s){this.label=e,this.weight=n,this.layers=i,this.bringToFront=o,this.isGrouped=a,this.isActive=s,this.action=new t.EShapeActionValueShowHideLayer("isActive",i,o)}isEquals(t){if(this.label!==t.label)return!1;if(this.weight!==t.weight)return!1;if(this.bringToFront!==t.bringToFront)return!1;if(this.isGrouped!==t.isGrouped)return!1;if(this.isActive!==t.isActive)return!1;const e=this.layers,n=e.length,i=t.layers;if(n!==i.length)return!1;for(let t=0;t<n;++t)if(e[t]!==i[t])return!1;return!0}serizlize(t){const e=this.serializedLayers(t),n=(this.bringToFront?1:0)|(this.isGrouped?2:0)|(this.isActive?4:0);return t.addResource(`[${t.addResource(this.label)},${this.weight},${e},${n}]`)}serializedLayers(t){const e=this.layers;let n="[",i="";for(let t=0,o=e.length;t<o;++t)n+=i+e[t],i=",";return n+="]",t.addResource(n)}static deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);return null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),new Ze(n[i[0]],i[1],this.deserializeLayers(i[2],e),!!(1&i[3]),!!(2&i[3]),!!(4&i[3]))}return null}static deserializeLayers(t,e){const n=[],i=e.resources,o=i.length;if(0<=t&&t<o){let o=e.getExtension(t);null==o&&(o=JSON.parse(i[t]),e.setExtension(t,o));for(let t=0,e=o.length;t<e;++t)n.push(o[t])}return n}}class je{constructor(t){this._values=[],this._sizeX=1,this._margin=2,this._onChange=t}get values(){return this._values}get margin(){return this._margin}set margin(t){this._margin!==t&&(this._margin=t,this._onChange())}add(t,e){null!=e?this._values.splice(e,0,t):this._values.push(t),this._onChange()}remove(t){const e=this._values;if(0<=t&&t<e.length){const n=e.splice(t,1)[0];return this._onChange(),n}return null}indexOf(t){const e=this._values;for(let n=0,i=e.length;n<i;++n)if(e[n]===t)return n;for(let n=0,i=e.length;n<i;++n)if(e[n].isEquals(t))return n;return-1}get(t){const e=this._values[t];return null!=e?e:null}set(t,e){this._values[t]=e,this._onChange()}swap(t,e){const n=this._values,i=n[e];n[e]=n[t],n[t]=i,this._onChange()}size(){return this._values.length}copy(t){const e=this._values,n=t._values,i=n.length;for(let t=0;t<i;++t)e[t]=n[t];return e.length!==i&&(e.length=i),this._sizeX=t._sizeX,this._onChange(),this}serialize(t){let e="",n="[";const i=this._values;for(let o=0,a=i.length;o<a;++o)e+=n+i[o].serizlize(t),n=",";return e+=n+this._margin+"]",t.addResource(e)}deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i));let o=!1;const a=this._values;0<a.length&&(a.length=0,o=!0);for(let t=0,n=i.length-1;t<n;++t){const n=Ze.deserialize(i[t],e);null!=n&&a.push(n)}const s=i[i.length-1];this._margin!==s&&(this._margin=s,o=!0),0<a.length&&(o=!0),o&&this._onChange()}}}class qe{}qe.ID=t.EShapeType.EXTENSION+200;class Je extends t.EShapeGroupShadowed{constructor(e,n=qe.ID){super(e,n),this._button=new je((()=>{this.onButtonValueChange()})),this._corner=t.EShapeCorner.ALL}get button(){return this._button}get corner(){return this._corner}set corner(t){this._corner!==t&&(this._corner=t,this.updateUploaded())}onButtonValueChange(){this.newButtons(),this.layoutButtons()}onSizeChange(){super.onSizeChange(),this.layoutButtons()}newButtons(){const e=this.button,n=e.size(),i=e.values,o=this.children,a=o.length;if(a<n){const e=0<a?o[a-1]:null;for(let o=a;o<n;++o){const n=new t.EShapeButton,a=i[o];null!=e?(n.copy(e),n.text.value=a.label):(n.stroke.set(!1,3381759,1),n.fill.set(!0,3381759,1),n.text.set(a.label,16777215,1),n.state.isFocusable=!0,n.interactive=!0),0<n.action.size()?n.action.set(0,a.action):n.action.add(a.action),n.isToggle=!0,n.isGrouped=!0,n.attach(this)}}else if(n<a)for(let t=a-1;n<=t;--t)o[t].detach();const s=this.corner;for(let t=0;t<n;++t){const e=o[t],a=i[t];e.corner=this.toCorner(t,n,s),e.text.value=a.label,0<e.action.size()?e.action.set(0,a.action):e.action.add(a.action),e.state.isActive=a.isActive}}layoutButtons(){const e=this.button,n=e.values,i=n.length,o=e.margin,a=this.size,s=a.x,l=a.y,r=this.children,h=r.length;let u=0;for(let t=0;t<i;++t)u+=n[t].weight;u=Math.max(1e-4,u);const c=Math.max(0,s-(i-1)*o)/u;let p=.5*-s;for(let e=0;e<h;++e){const i=n[e].weight*c,a=r[e];a.lock(t.EShapeLockPart.ALL),a.size.set(i,l),a.transform.position.set(p+.5*i,0),a.unlock(t.EShapeLockPart.ALL,!0),p+=i+o}}toCorner(e,n,i){let o=t.EShapeCorner.NONE;return 0===e&&(o|=t.EShapeCorner.LEFT&i),e===n-1&&(o|=t.EShapeCorner.RIGHT&i),o}copy(e,n=t.EShapeCopyPart.ALL){const i=super.copy(e,n);return e instanceof Je&&this._button.copy(e.button),i}serialize(t){const e=super.serialize(t),n=e[15];return e[15]=t.addResource(`[${this._button.serialize(t)},${n}]`),e}}class Qe extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._value=t}execute(){return this.redo()}redo(){const t=this._value,e=this._selection.get();for(let n=0,i=e.length;n<i;++n){const i=e[n];i instanceof Je&&i.button.add(t)}return this._selection.update("PROPERTY"),!0}undo(){const t=this._selection.get();for(let e=0,n=t.length;e<n;++e){const n=t[e];n instanceof Je&&n.button.remove(n.button.size()-1)}return this._selection.update("PROPERTY"),!0}}class tn extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t;const n=[],i=this._selection.get();for(let e=0,o=i.length;e<o;++e){const o=i[e];if(o instanceof Je){const e=o.button.indexOf(t);n.push(e),0<e&&o.button.swap(e-1,e)}}this._indices=n,this._selection.update("PROPERTY")}execute(){return!0}redo(){const t=this._selection.get(),e=this._indices;for(let n=0,i=t.length;n<i;++n){const i=t[n];if(i instanceof Je){const t=e[n];0<t&&i.button.swap(t-1,t)}}return this._selection.update("PROPERTY"),!0}undo(){return this.redo()}}class en extends t.DCommandBase{constructor(t,e){super();const n=e.get(),i=[];for(let e=0,o=n.length;e<o;++e){const o=n[e];o instanceof Je?(i.push(o.button.margin),o.button.margin=t):i.push(0)}this._values=i,this._selection=e}execute(){return!0}redo(){const t=this._selection,e=t.get(),n=[];for(let t=0,i=e.length;t<i;++t){const i=e[t];if(i instanceof Je){const e=n[t];n[t]=i.button.margin,i.button.margin=e}}return t.update("PROPERTY"),!0}undo(){return this.redo()}}class nn extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t;const n=[],i=this._selection.get();for(let e=0,o=i.length;e<o;++e){const o=i[e];if(o instanceof Je){const e=o.button.indexOf(t);n.push(e),0<=e&&o.button.remove(e)}}this._indices=n,this._selection.update("PROPERTY")}execute(){return!0}redo(){const t=this._indices,e=this._selection.get();for(let n=0,i=e.length;n<i;++n){const i=e[n];if(i instanceof Je){const e=t[n];0<=e&&i.button.remove(e)}}return this._selection.update("PROPERTY"),!0}undo(){const t=this._target,e=this._indices,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i];if(o instanceof Je){const n=e[i];0<=n&&o.button.add(t,n)}}return this._selection.update("PROPERTY"),!0}}class on extends t.DCommandBase{constructor(t,e,n,i){super(),this._selection=n,this._oldValue=t,this._newValue=e,this._list=i;const o=[],a=[],s=this._selection.get();for(let n=0,i=s.length;n<i;++n){const i=s[n];if(i instanceof Je){const n=i.button.indexOf(t);o.push(n),0<=n?(a.push(i.button.get(n)),i.button.set(n,e)):a.push(e)}else o.push(-1),a.push(e)}this._indices=o,this._oldValues=a,i.data.selection.contains(t)&&i.data.selection.clearAndAdd(e),this._selection.update("PROPERTY")}execute(){return!0}redo(){const t=this._newValue,e=this._indices,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i];if(o instanceof Je){const n=e[i];0<=n&&o.button.set(n,t)}}const i=this._list;return i.data.selection.contains(this._oldValue)&&i.data.selection.clearAndAdd(t),this._selection.update("PROPERTY"),!0}undo(){const t=this._indices,e=this._oldValues,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i];if(o instanceof Je){const n=t[i];0<=n&&o.button.set(n,e[i])}}const i=this._list;return i.data.selection.contains(this._newValue)&&i.data.selection.clearAndAdd(this._oldValue),this._selection.update("PROPERTY"),!0}}class an extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t;const n=[],i=this._selection.get();for(let e=0,o=i.length;e<o;++e){const o=i[e];if(o instanceof Je){const e=o.button,i=e.indexOf(t);n.push(i),0<=i&&i<e.size()-1&&e.swap(i+1,i)}else n.push(-1)}this._indices=n,this._selection.update("PROPERTY")}execute(){return!0}redo(){const t=this._selection.get(),e=this._indices;for(let n=0,i=t.length;n<i;++n){const i=t[n];if(i instanceof Je){const t=i.button,o=e[n];0<=o&&o<t.size()-1&&t.swap(o+1,o)}}return this._selection.update("PROPERTY"),!0}undo(){return this.redo()}}class sn extends t.DDialogLayered{newContentChildren(t,e){const n=super.newContentChildren(t,e);return n.push(this.inputLabel,this.inputWidth,this.newLayoutOf(t.getSelectLayerLabel(),this.selectLayer),this.newLayoutOf(null,this.checkBringToFront),this.newLayoutOf(null,this.checkIsGrouped),this.newLayoutOf(null,this.checkIsActive)),n}newLayoutOf(e,n){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLayoutLabel(e),n,this.newLayoutSpace()]})}newLayoutLabel(e){return null!=e?new t.DInputLabel({width:60,text:{value:e}}):this.newLayoutSpace()}newLayoutSpace(){return new t.DLayoutSpace({width:60})}get inputLabel(){var t;return null!==(t=this._inputLabel)&&void 0!==t?t:this._inputLabel=this.newInputLabel()}newInputLabel(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputLabelLabel()}},input:{weight:1,text:{value:""},on:{enter:()=>{this.ok()}}},space:{width:60}})}get inputWidth(){var t;return null!==(t=this._inputWidth)&&void 0!==t?t:this._inputWidth=this.newInputWidth()}newInputWidth(){return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputWidthLabel()}},input:{weight:1,text:{value:0},min:0,on:{enter:()=>{this.ok()}}},space:{width:60}})}get selectLayer(){var t;return null!==(t=this._selectLayer)&&void 0!==t?t:this._selectLayer=this.newSelectLayer()}newSelectLayer(){return new t.DSelectMultiple({weight:1})}newSelectLayerMenuItemOptions(){var t;const e=null===(t=this.options)||void 0===t?void 0:t.diagram;if(null!=e){const t=e.canvas;if(null!=t){const e=[],n=t.layer.children;for(let t=n.length-1;0<=t;--t){const i=n[t];e.push({value:t,text:{value:i.name},check:!0})}return e}}return[]}get checkBringToFront(){var t;return null!==(t=this._checkBringToFront)&&void 0!==t?t:this._checkBringToFront=this.newCheckBringToFront()}newCheckBringToFront(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckBringToFromLabel(),align:{horizontal:"LEFT"}}})}get checkIsGrouped(){var t;return null!==(t=this._checkIsGrouped)&&void 0!==t?t:this._checkIsGrouped=this.newCheckIsGrouped()}newCheckIsGrouped(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckIsGroupedLabel(),align:{horizontal:"LEFT"}}})}get checkIsActive(){var t;return null!==(t=this._checkIsActive)&&void 0!==t?t:this._checkIsActive=this.newCheckIsActive()}newCheckIsActive(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckIsActiveLabel(),align:{horizontal:"LEFT"}}})}reset(){return this.inputLabel.input.value=this.theme.newInputLabel(),this.inputWidth.input.value=1,this.selectLayer.values=[],this.selectLayer.menu=new t.DMenu({fit:!0,items:this.newSelectLayerMenuItemOptions()}),this.checkBringToFront.state.isActive=!1,this.checkIsGrouped.state.isActive=!0,this}get value(){return new Ze(this.inputLabel.input.value,this.inputWidth.input.value,this.selectLayer.values.slice(0),this.checkBringToFront.state.isActive,this.checkIsGrouped.state.isActive,this.checkIsActive.state.isActive)}set value(e){this.selectLayer.menu=new t.DMenu({fit:!0,items:this.newSelectLayerMenuItemOptions()}),null!=e&&(this.inputLabel.input.value=e.label,this.inputWidth.input.value=e.weight,this.selectLayer.values=e.layers,this.checkBringToFront.state.isActive=e.bringToFront,this.checkIsGrouped.state.isActive=e.isGrouped,this.checkIsActive.state.isActive=e.isActive)}getResolvedValue(){return this.value}getType(){return"EDialogShapeButtonLayerValue"}}class ln extends t.DPane{constructor(t){super(t),this._icons=t.icons;const e=t.selection;this._selection=e,this._diagram=t.diagram,this.initLayout()}initLayout(){this.content.setHeight("padding"),new t.DLayoutVertical({parent:this.content,x:"padding",y:"padding",width:"padding",height:"padding",children:[new t.DLayoutHorizontal({width:"100%",height:"auto",children:[this.newTextLabel(),this.buttonNew,this.buttonDelete,this.buttonBringForward,this.buttonSendBackward]}),this.columnList,this.inputMargin]});const e=this._selection;this.state.isDisabled=e.isEmpty(),e.on("change",(()=>{this.state.isDisabled=e.isEmpty(),this.onSelectionChange(e)}));const n=this.columnList;n.data.selection.on("change",(()=>{this.onListSelectionChange(n)})),this.onSelectionChange(e)}newTextLabel(){return new t.DText({weight:1,text:{value:this.subtheme.getLabel()}})}get buttonNew(){var t;return null!==(t=this._buttonNew)&&void 0!==t?t:this._buttonNew=this.newButtonNew()}newButtonNew(){return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.subtheme.getButtonNewTitle(),on:{active:t=>{this.onButtonNewActive(t)}}})}onButtonNewActive(e){this.dialogButton.reset().open(e).then((e=>{null!=e&&t.DControllers.getCommandController().push(new Qe(e,this._selection))}))}onSelectionChangeButtonNew(t){const e=this.buttonNew;t.last()instanceof Je?e.state.isDisabled=!1:e.state.isDisabled=!0}get buttonDelete(){var t;return null!==(t=this._buttonDelete)&&void 0!==t?t:this._buttonDelete=this.newButtonDelete()}newButtonDelete(){return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.subtheme.getButtonDeleteTitle(),on:{active:()=>{const e=this.columnList,n=e.data.selection.first;null!=n&&1<e.data.size()&&t.DControllers.getCommandController().push(new nn(n,this._selection))}}})}onListSelectionChangeButtonDelete(t){this.buttonDelete.state.isDisabled=t.data.size()<=1||t.data.selection.isEmpty()}get buttonBringForward(){var t;return null!==(t=this._buttonBringForward)&&void 0!==t?t:this._buttonBringForward=this.newButtonBringForward()}newButtonBringForward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.subtheme.getButtonBringForwardTitle(),on:{active:()=>{const e=this.columnList,n=e.selection.first;null!=n&&e.data.items[0]!==n&&t.DControllers.getCommandController().push(new tn(n,this._selection))}}})}onListSelectionChangeButtonBringForward(t){const e=t.data.selection.first,n=t.data.items;this.buttonBringForward.state.isDisabled=null==e||n[0]===e}get buttonSendBackward(){var t;return null!==(t=this._buttonSendBackward)&&void 0!==t?t:this._buttonSendBackward=this.newButtonSendBackward()}newButtonSendBackward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.subtheme.getButtonSendBackwardTitle(),on:{active:()=>{const e=this.columnList,n=e.selection.first,i=e.data.items;null!=n&&i[i.length-1]!==n&&t.DControllers.getCommandController().push(new an(n,this._selection))}}})}onListSelectionChangeButtonSendBackward(t){const e=t.selection.first,n=t.data.items;this.buttonSendBackward.state.isDisabled=null==e||n[n.length-1]===e}get dialogButton(){var t;return null!==(t=this._dialogButton)&&void 0!==t?t:this._dialogButton=this.newDialogButton()}newDialogButton(){return new sn({diagram:this._diagram})}get columnList(){var t;return null!==(t=this._columnList)&&void 0!==t?t:this._columnList=this.newColumnList()}newColumnList(){const e=new t.DList({width:"100%",weight:1,data:{toLabel:t=>t.label},updater:{newItem:n=>new t.DListItem(n,{on:{dblclick:(t,n,i)=>{this.onColumnListDblClick(t,n,i,e)}}})}});return e}onColumnListDblClick(e,n,i,o){const a=i.value;if(null!=a){const e=this.dialogButton;e.value=a,e.open(i).then((e=>{null!=e&&t.DControllers.getCommandController().push(new on(a,e,this._selection,o))}))}}onSelectionChangeColumnList(t){const e=t.last(),n=this.columnList;n.data.items=e instanceof Je?e.button.values:[],this.onListSelectionChange(n)}get inputMargin(){var t;return null!==(t=this._inputMargin)&&void 0!==t?t:this._inputMargin=this.newInputMargin()}newInputMargin(){return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.subtheme.getInputMarginLabel()}},input:{weight:1,on:{change:e=>{t.DControllers.getCommandController().push(new en(e,this._selection))}}}})}onSelectionChangeInputRowHeight(t){const e=t.last(),n=this.inputMargin;e instanceof Je?(n.input.value=e.button.margin,n.state.isDisabled=!1):n.state.isDisabled=!0}onSelectionChange(t){this.onSelectionChangeButtonNew(t),this.onSelectionChangeColumnList(t)}onListSelectionChange(t){this.onListSelectionChangeButtonDelete(t),this.onListSelectionChangeButtonBringForward(t),this.onListSelectionChangeButtonSendBackward(t)}get subtheme(){var t;return null!==(t=this._subtheme)&&void 0!==t?t:this._subtheme=this.newSubtheme()}newSubtheme(){return t.DThemes.get("EEditorShapeButtonLayer")}}class rn{static getTheme(){return t.DThemes.get("EShapeButtonLayer")}static create(e){const n=new Je(t.EShapeResourceManagerDeserializationMode.EDITOR);if(e){if(n.copy(e),!(e instanceof Je)){const t=this.getTheme().getLabel();n.button.add(new Ze(t,1,[],!1,!0,!1))}}else{const t=this.getTheme().getLabel();n.button.add(new Ze(t,1,[],!1,!0,!1))}return n.onSizeChange(),n}static load(){const e=this.getTheme().getName();Ne.add({type:qe.ID,name:e,icon:{width:24,height:24,svg:'<g transform="scale(26.6666)" fill="#fff" stroke="none"><path d="M22,9v6c0,1.1-0.9,2-2,2h-1l0-2h1V9H4v6h6v2H4c-1.1,0-2-0.9-2-2V9c0-1.1,0.9-2,2-2h16C21.1,7,22,7.9,22,9z"/><path d="M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16zm0-11.47L17.74 9 12 13.47 6.26 9 12 4.53z" transform="translate(7.25,8) scale(0.6)"/></g>'},title:e,creator:t=>rn.create(t),deserializer:(t,e)=>rn.deserialize(t,e),editor:ln,uploaded:t.createGroupUploaded,capability:(t.EShapeCapability.PRIMITIVE|t.EShapeCapability.STROKE_SIDE|t.EShapeCapability.BORDER_RADIUS)&~t.EShapeCapability.CHILDREN})}static deserialize(e,n){const i=new Je(n.mode),o=e[15],a=n.resources;if(0<=o&&o<a.length){let t=n.getExtension(o);null==t&&(t=JSON.parse(a[o]),n.setExtension(o,t)),i.button.deserialize(t[0],n),e[15]=t[t.length-1]}const s=t.deserializeBase(e,n,i);return i.size.init(),s}}class hn{constructor(t,e){this.major=t,this.minor=e}copy(t){return this.major.copy(t.major),this.minor.copy(t.minor),this}serialize(t){return t.addResource(`[${this.major.serialize(t)},${this.minor.serialize(t)}]`)}deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),this.major.deserialize(i[0],e),this.minor.deserialize(i[1],e)}}}class un{constructor(t){this.count=t}copy(t){return this.count=t.count,this}serialize(t){return t.addResource(`${this.count}`)}deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),this.count=i}}}class cn{constructor(t){this.count=t}copy(t){return this.count=t.count,this}serialize(t){return t.addResource(`${this.count}`)}deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),this.count=i}}}class pn{constructor(){this.padding=10,this.tick=new hn(new un(3),new cn(3))}copy(t){return this.padding=t.padding,this.tick.copy(t.tick),this}serialize(t){return t.addResource(`[${this.padding},${this.tick.serialize(t)}]`)}deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),this.padding=i[0],this.tick.deserialize(i[1],e)}}}class dn extends pn{}class gn{constructor(){this.x=new pn,this.y=new dn}copy(t){return this.x.copy(t.x),this.y.copy(t.y),this}serialize(t){return t.addResource(`[${this.x.serialize(t)},${this.y.serialize(t)}]`)}deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),this.x.deserialize(i[0],e),this.y.deserialize(i[1],e)}}}class _n{}_n.ID=t.EShapeType.EXTENSION+0,_n.PLOT_AREA_ID="plot-area",_n.LINE_ID="line",_n.X_AXIS_ID="x-axis",_n.X_AXIS_TICK_MAJOR_ID="x-axis-tick-major",_n.X_AXIS_TICK_MINOR_ID="x-axis-tick-minor",_n.Y_AXIS_ID="y-axis",_n.Y_AXIS_TICK_MAJOR_ID="y-axis-tick-major",_n.Y_AXIS_TICK_MINOR_ID="y-axis-tick-minor";class Sn extends t.EShapeGroup{constructor(t,e=_n.ID){super(t,e),this.axis=new gn}copy(e,n=t.EShapeCopyPart.ALL){const i=super.copy(e,n);return e instanceof Sn&&this.axis.copy(e.axis),i}serialize(t){const e=super.serialize(t),n=e[15];return e[15]=t.addResource(`[${this.axis.serialize(t)},${n}]`),e}}class wn extends st{getProperty(t,e){return t instanceof Sn?t.axis.x.padding:0}setProperty(t,e,n){t instanceof Sn&&(t.axis.x.padding=n)}isMergeable(){return!0}}class mn extends st{getProperty(t,e){return t instanceof Sn?t.axis.y.padding:0}setProperty(t,e,n){t instanceof Sn&&(t.axis.y.padding=n)}isMergeable(){return!0}}class Tn extends st{getProperty(t,e){return t instanceof Sn?t.axis.x.tick.major.count:0}setProperty(t,e,n){t instanceof Sn&&(t.axis.x.tick.major.count=n)}isMergeable(){return!0}}class En extends st{getProperty(t,e){return t instanceof Sn?t.axis.x.tick.minor.count:0}setProperty(t,e,n){t instanceof Sn&&(t.axis.x.tick.minor.count=n)}isMergeable(){return!0}}class yn extends st{getProperty(t,e){return t instanceof Sn?t.axis.y.tick.major.count:0}setProperty(t,e,n){t instanceof Sn&&(t.axis.y.tick.major.count=n)}isMergeable(){return!0}}class vn extends st{getProperty(t,e){return t instanceof Sn?t.axis.y.tick.minor.count:0}setProperty(t,e,n){t instanceof Sn&&(t.axis.y.tick.minor.count=n)}isMergeable(){return!0}}class Cn{static getTheme(){return t.DThemes.get("EShapeChartLine")}static getPlotArea(t){return $.findChildById(t,_n.PLOT_AREA_ID)}static newPlotArea(e){const n=new t.EShapeRectangle;return n.id=_n.PLOT_AREA_ID,n.size.set(e.size.x,e.size.y),n.stroke.enable=!1,n.fill.alpha=.5*t.EShapeDefaults.FILL_ALPHA,n.text.value=this.getTheme().newPlotAreaLabel(),n.text.align.vertical=t.EShapeTextAlignVertical.OUTSIDE_TOP,n.attach(e),n}static getLine(t){return $.findChildById(t,_n.LINE_ID)}static newLine(e){const n=.8*e.size.x*.5,i=.8*e.size.y*.5,o=t.createLine([-n,+i,+n,-i],[],t.EShapeDefaults.STROKE_WIDTH,t.EShapePointsStyle.NONE);return o.id=_n.LINE_ID,o.attach(e),o}static getXAxis(t){return $.findChildById(t,_n.X_AXIS_ID)}static getXAxisTickMajor(t){return $.findChildById(t,_n.X_AXIS_TICK_MAJOR_ID)}static getXAxisTickMinor(t){return $.findChildById(t,_n.X_AXIS_TICK_MINOR_ID)}static newXAxis(e){const n=new t.EShapeBar;return n.id=_n.X_AXIS_ID,n.size.set(e.size.x,0),n.transform.position.set(0,.5*e.size.y),n.points.position=t.EShapeBarPosition.LEFT,n.points.size=-1,n.stroke.width=t.EShapeDefaults.STROKE_WIDTH,n.text.value=this.getTheme().newXAxisLabel(),n.text.align.vertical=t.EShapeTextAlignVertical.OUTSIDE_BOTTOM,n.text.padding.set(50,50),n.attach(e),n}static createXAxis(t){t.createChildren((t=>[Cn.newXAxis(t)]))}static deleteXAxis(t){t.deleteChildren((t=>{let e=null;const n=Cn.getXAxis(t);null!=n&&(e=[n]);const i=Cn.getXAxisTickMajor(t);null!=i&&(null==e?e=[i]:e.push(i));const o=Cn.getXAxisTickMinor(t);return null!=o&&(null==e?e=[o]:e.push(o)),e}))}static setXAxisPadding(e,n){t.DControllers.getCommandController().push(new wn(n,e))}static newXAxisTickMajor(e){const n=new t.EShapeBar;return n.id=_n.X_AXIS_TICK_MAJOR_ID,n.size.set(0,0),n.transform.position.set(0,.5*e.size.y),n.points.position=t.EShapeBarPosition.TOP,n.points.size=10,n.stroke.width=t.EShapeDefaults.STROKE_WIDTH,n.text.value="%YMD\n%Hms.%mi",n.text.align.vertical=t.EShapeTextAlignVertical.TOP,n.text.padding.set(12.5,12.5),n.attach(e),n}static newXAxisTickMinor(e,n,i){const o=new t.EShapeBar;return o.id=_n.X_AXIS_TICK_MINOR_ID,o.size.set(0,0),o.transform.position.set(n,i),o.points.position=t.EShapeBarPosition.TOP,o.points.size=5,o.stroke.width=.5*t.EShapeDefaults.STROKE_WIDTH,o.attach(e),o}static createXAxisTickMajor(t){t.createChildren((t=>null!=Cn.getXAxis(t)?[this.newXAxisTickMajor(t)]:null))}static deleteXAxisTickMajor(t){t.deleteChildren((t=>{let e=null;const n=Cn.getXAxisTickMajor(t);null!=n&&(e=[n]);const i=Cn.getXAxisTickMinor(t);return null!=i&&(null==e?e=[i]:e.push(i)),e}))}static setXAxisTickMajorCount(e,n){t.DControllers.getCommandController().push(new Tn(n,e))}static createXAxisTickMinor(t){t.createChildren((t=>{const e=Cn.getXAxis(t);if(null!=e){const n=e.size.x,i=e.transform.position;return[this.newXAxisTickMinor(t,i.x-.25*n,i.y)]}return null}))}static deleteXAxisTickMinor(t){t.deleteChildren((t=>{const e=Cn.getXAxisTickMinor(t);return null!=e?[e]:null}))}static setXAxisTickMinorCount(e,n){t.DControllers.getCommandController().push(new En(n,e))}static getYAxis(t){return $.findChildById(t,_n.Y_AXIS_ID)}static getYAxisTickMajor(t){return $.findChildById(t,_n.Y_AXIS_TICK_MAJOR_ID)}static getYAxisTickMinor(t){return $.findChildById(t,_n.Y_AXIS_TICK_MINOR_ID)}static newYAxis(e){const n=new t.EShapeBar;return n.id=_n.Y_AXIS_ID,n.size.set(0,e.size.y),n.transform.position.set(.5*-e.size.x,0),n.points.position=t.EShapeBarPosition.TOP,n.points.size=-1,n.stroke.width=t.EShapeDefaults.STROKE_WIDTH,n.text.value=this.getTheme().newYAxisLabel(),n.text.align.horizontal=t.EShapeTextAlignHorizontal.OUTSIDE_LEFT,n.text.direction=t.EShapeTextDirection.BOTTOM_TO_TOP,n.text.padding.set(50,50),n.attach(e),n}static createYAxis(t){t.createChildren((t=>[Cn.newYAxis(t)]))}static deleteYAxis(t){t.deleteChildren((t=>{let e=null;const n=Cn.getYAxis(t);null!=n&&(e=[n]);const i=Cn.getYAxisTickMajor(t);null!=i&&(null==e?e=[i]:e.push(i));const o=Cn.getYAxisTickMinor(t);return null!=o&&(null==e?e=[o]:e.push(o)),e}))}static setYAxisPadding(e,n){t.DControllers.getCommandController().push(new mn(n,e))}static newYAxisTickMajor(e){const n=new t.EShapeBar;return n.id=_n.Y_AXIS_TICK_MAJOR_ID,n.size.set(0,0),n.transform.position.set(.5*-e.size.x,0),n.points.position=t.EShapeBarPosition.RIGHT,n.points.size=10,n.stroke.width=t.EShapeDefaults.STROKE_WIDTH,n.text.value="%ssi",n.text.align.horizontal=t.EShapeTextAlignHorizontal.RIGHT,n.text.padding.set(12.5,12.5),n.attach(e),n}static newYAxisTickMinor(e,n,i){const o=new t.EShapeBar;return o.id=_n.Y_AXIS_TICK_MINOR_ID,o.size.set(0,0),o.transform.position.set(n,i),o.points.position=t.EShapeBarPosition.RIGHT,o.points.size=5,o.stroke.width=.5*t.EShapeDefaults.STROKE_WIDTH,o.attach(e),o}static createYAxisTickMajor(t){t.createChildren((t=>null!=Cn.getYAxis(t)?[this.newYAxisTickMajor(t)]:null))}static deleteYAxisTickMajor(t){t.deleteChildren((t=>{let e=null;const n=Cn.getYAxisTickMajor(t);null!=n&&(e=[n]);const i=Cn.getYAxisTickMinor(t);return null!=i&&(null==e?e=[i]:e.push(i)),e}))}static setYAxisTickMajorCount(e,n){t.DControllers.getCommandController().push(new yn(n,e))}static createYAxisTickMinor(t){t.createChildren((t=>{const e=Cn.getYAxis(t);if(null!=e){const n=e.size.y,i=e.transform.position;return[this.newYAxisTickMinor(t,i.x,i.y+.25*n)]}return null}))}static deleteYAxisTickMinor(t){t.deleteChildren((t=>{const e=Cn.getYAxisTickMinor(t);return null!=e?[e]:null}))}static setYAxisTickMinorCount(e,n){t.DControllers.getCommandController().push(new vn(n,e))}}class bn extends t.DPane{constructor(e){super(e);const n=e.selection;this.state.isDisabled=n.isEmpty(),n.on("change",(()=>{this.state.isDisabled=n.isEmpty()}));const i=this.subtheme;new t.DLayoutVertical({parent:this.content,x:"padding",y:"padding",width:"padding",height:"auto",children:[this.newTextLabel(),new t.DButtonCheckRight({width:"100%",text:{value:i.getCheckXAxisLabel()},padding:0,background:{color:null},on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn?(t.state.isActive=null!=Cn.getXAxis(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),n.on("change",e)},active:()=>{Cn.createXAxis(n)},inactive:()=>{Cn.deleteXAxis(n)}}}),new t.DButtonCheckRight({width:"100%",text:{value:i.getCheckXAxisMajorTickLabel()},padding:{top:0,right:0,left:10,bottom:0},background:{color:null},on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn&&null!=Cn.getXAxis(e)?(t.state.isActive=null!=Cn.getXAxisTickMajor(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),n.on("change",e)},active:()=>{Cn.createXAxisTickMajor(n)},inactive:()=>{Cn.deleteXAxisTickMajor(n)}}}),new t.DButtonCheckRight({width:"100%",text:{value:i.getCheckXAxisMinorTickLabel()},padding:{top:0,right:0,left:10,bottom:0},background:{color:null},on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn&&null!=Cn.getXAxis(e)?(t.state.isActive=null!=Cn.getXAxisTickMinor(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),n.on("change",e)},active:()=>{Cn.createXAxisTickMinor(n)},inactive:()=>{Cn.deleteXAxisTickMinor(n)}}}),new t.DButtonCheckRight({width:"100%",text:{value:i.getCheckYAxisLabel()},padding:0,background:{color:null},on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn?(t.state.isActive=null!=Cn.getYAxis(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),n.on("change",e)},active:()=>{Cn.createYAxis(n)},inactive:()=>{Cn.deleteYAxis(n)}}}),new t.DButtonCheckRight({width:"100%",text:{value:i.getCheckYAxisMajorTickLabel()},padding:{top:0,right:0,left:10,bottom:0},background:{color:null},on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn&&null!=Cn.getYAxis(e)?(t.state.isActive=null!=Cn.getYAxisTickMajor(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),n.on("change",e)},active:()=>{Cn.createYAxisTickMajor(n)},inactive:()=>{Cn.deleteYAxisTickMajor(n)}}}),new t.DButtonCheckRight({width:"100%",text:{value:i.getCheckYAxisMinorTickLabel()},padding:{top:0,right:0,left:10,bottom:0},background:{color:null},on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn&&null!=Cn.getYAxis(e)?(t.state.isActive=null!=Cn.getYAxisTickMinor(e),t.state.isDisabled=!1):t.state.isDisabled=!0};e(),n.on("change",e)},active:()=>{Cn.createYAxisTickMinor(n)},inactive:()=>{Cn.deleteYAxisTickMinor(n)}}}),new t.DText({width:"100%",text:{value:i.getTextMajorTickCountLabel()}}),new t.DLayoutHorizontal({width:"100%",children:[new t.DInputInteger({weight:1,min:0,on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn&&(t.value=e.axis.x.tick.major.count)};e(),n.on("change",e)},change:t=>{Cn.setXAxisTickMajorCount(t,n)}}}),new t.DInputInteger({weight:1,min:0,on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn&&(t.value=e.axis.y.tick.major.count)};e(),n.on("change",e)},change:t=>{Cn.setYAxisTickMajorCount(t,n)}}})]}),new t.DText({width:"100%",text:{value:i.getTextMinorTickCountLabel()}}),new t.DLayoutHorizontal({width:"100%",children:[new t.DInputInteger({weight:1,min:0,on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn&&(t.value=e.axis.x.tick.minor.count)};e(),n.on("change",e)},change:t=>{Cn.setXAxisTickMinorCount(t,n)}}}),new t.DInputInteger({weight:1,min:0,on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn&&(t.value=e.axis.y.tick.minor.count)};e(),n.on("change",e)},change:t=>{Cn.setYAxisTickMinorCount(t,n)}}})]}),new t.DText({width:"100%",text:{value:i.getTextPaddingLabel()}}),new t.DLayoutHorizontal({width:"100%",children:[new t.DInputInteger({weight:1,min:0,on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn&&(t.value=e.axis.x.padding)};e(),n.on("change",e)},change:t=>{Cn.setXAxisPadding(t,n)}}}),new t.DInputInteger({weight:1,min:0,on:{init:t=>{const e=()=>{const e=n.last();e instanceof Sn&&(t.value=e.axis.y.padding)};e(),n.on("change",e)},change:t=>{Cn.setYAxisPadding(t,n)}}})]})],on:{init:t=>{const e=()=>{t.state.isDisabled=!(n.last()instanceof Sn)};e(),n.on("change",e)}}})}newTextLabel(){return new t.DText({width:"100%",text:{value:this.subtheme.getLabel()}})}get subtheme(){var t;return null!==(t=this._subtheme)&&void 0!==t?t:this._subtheme=this.newSubtheme()}newSubtheme(){return t.DThemes.get("EEditorShapeChartLine")}}class Dn extends t.EShapeActionRuntimeBase{constructor(e){super();const n=$.findChildById(e,"line");if(null!=n){const t=e.data;if(t.size()<=0)n.detach(),this.lines=[];else{const i=[n];for(let o=1,a=t.size();o<a;++o){const t=n.clone();t.attach(e),i.push(t)}this.lines=i}}else this.lines=[];let i=3,o=3,a=3,s=3;e instanceof Sn&&(i=e.axis.x.tick.major.count,o=e.axis.y.tick.major.count,a=e.axis.x.tick.minor.count,s=e.axis.y.tick.minor.count),this.xmajorCount=i,this.ymajorCount=o,this.xminorCount=a,this.yminorCount=s,this.xmajors=this.initTicks(e,_n.X_AXIS_TICK_MAJOR_ID,i),this.ymajors=this.initTicks(e,_n.Y_AXIS_TICK_MAJOR_ID,o),this.xminors=this.initTicks(e,_n.X_AXIS_TICK_MINOR_ID,(i+1)*a),this.yminors=this.initTicks(e,_n.Y_AXIS_TICK_MINOR_ID,(o+1)*s),this.workMajorPositions=new Float64Array(Math.max(i,o));const l=$.findChildById(e,_n.X_AXIS_TICK_MAJOR_ID);this.xformatter=t.NumberFormatters.create(null!=l?l.text.value:"");const r=$.findChildById(e,_n.Y_AXIS_TICK_MAJOR_ID);this.yformatter=t.NumberFormatters.create(null!=r?r.text.value:""),this.plotArea=$.findChildById(e,"plot-area");let h=10,u=10;e instanceof Sn&&(h=e.axis.x.padding,u=e.axis.y.padding),this.xpadding=h,this.ypadding=u}initTicks(t,e,n){const i=$.findChildById(t,e);if(null!=i){if(n<=0)return i.detach(),[];{const e=[i];for(let o=1;o<n;++o){const n=i.clone();n.attach(t),e.push(n)}return e}}return[]}toStepScale(t){return 5.5<=t?10:2.2<=t?5:1.1<=t?2:1}getStep(t,e,n){if(n<=0||e<=t)return-1;const i=(e-t)/n,o=Math.floor(Math.log(i)/Math.LN10),a=Math.pow(10,o);return this.toStepScale(i/a)*a}getTickPositions(t,e,n,i,o,a,s){if(n<=0)return s;if(e<=t||i<=0){s[0]=t;for(let t=1;t<n;++t)s[t]=NaN;return s}const l=t/i;let r=Math.floor(l);o<(l-r)*i*a&&(r=Math.ceil(l));const h=e/i;let u=Math.ceil(h);o<(u-h)*i*a&&(u=Math.floor(h));const c=Math.min(n,Math.ceil(u-r+1));for(let t=0;t<c;++t)s[t]=(r+t)*i;for(let t=c;t<n;++t)s[t]=NaN;return s}updateTicksXMinor(e,n,i,o,a,s,l){const r=this.xminors;if(0<r.length){const h=this.xminorCount;if(0<e){const u=this.xpadding;if(n<0)for(let l=0,c=(n+1)*h;l<h;l+=1,c+=1){const n=r[c],p=(i-(h-l)*e-o)*a+s;s-u<=p?(n.lock(t.EShapeLockPart.UPLOADED),n.visible=!0,n.transform.position.x=p,n.unlock(t.EShapeLockPart.UPLOADED,!0)):n.visible=!1}else for(let c=0,p=(n+1)*h;c<h;c+=1,p+=1){const n=r[p],h=(i+(c+1)*e-o)*a+s;h<=l+u?(n.lock(t.EShapeLockPart.UPLOADED),n.visible=!0,n.transform.position.x=h,n.unlock(t.EShapeLockPart.UPLOADED,!0)):n.visible=!1}}else for(let t=(n+1)*h,e=t+h;t<e;++t)r[t].visible=!1}}toStepMinor(t,e){return 0<=t?t/(e+1):-1}updateTicksX(e,n,i,o,a){const s=this.xmajors,l=this.xminors,r=this.xminorCount,h=this.xpadding,u=this.getStep(e,n,s.length),c=this.getTickPositions(e,n,s.length,u,h,i,this.workMajorPositions),p=this.toStepMinor(u,r);this.updateTicksXMinor(p,-1,c[0],e,i,o,a);for(let n=0,h=s.length;n<h;++n){const h=s[n],d=c[n];if(d==d)h.lock(t.EShapeLockPart.UPLOADED),h.visible=!0,h.transform.position.x=(d-e)*i+o,h.text.value=this.xformatter.format(d,u),h.unlock(t.EShapeLockPart.UPLOADED,!0),this.updateTicksXMinor(p,n,c[n],e,i,o,a);else if(h.visible=!1,0<l.length)for(let t=(n+1)*r,e=t+r;t<e;++t)l[t].visible=!1}}updateTicksYMinor(e,n,i,o,a,s,l){const r=this.yminors;if(0<r.length){const h=this.yminorCount;if(0<e){const u=this.ypadding;if(n<0)for(let s=0,c=(n+1)*h;s<h;s+=1,c+=1){const n=r[c],p=l-(i-(h-s)*e-o)*a;p<=l+u?(n.lock(t.EShapeLockPart.UPLOADED),n.visible=!0,n.transform.position.y=p,n.unlock(t.EShapeLockPart.UPLOADED,!0)):n.visible=!1}else for(let c=0,p=(n+1)*h;c<h;c+=1,p+=1){const n=r[p],h=l-(i+(c+1)*e-o)*a;s-u<=h?(n.lock(t.EShapeLockPart.UPLOADED),n.visible=!0,n.transform.position.y=h,n.unlock(t.EShapeLockPart.UPLOADED,!0)):n.visible=!1}}else for(let t=(n+1)*h,e=t+h;t<e;++t)r[t].visible=!1}}updateTicksY(e,n,i,o,a){const s=this.ymajors,l=this.yminors,r=this.yminorCount,h=this.ypadding,u=this.getStep(e,n,s.length),c=this.getTickPositions(e,n,s.length,u,h,i,this.workMajorPositions),p=this.toStepMinor(u,r);this.updateTicksYMinor(p,-1,c[0],e,i,o,a);for(let n=0,h=s.length;n<h;++n){const h=s[n],d=c[n];if(d==d)h.lock(t.EShapeLockPart.UPLOADED),h.visible=!0,h.transform.position.y=a-(d-e)*i,h.text.value=this.yformatter.format(d,u),h.unlock(t.EShapeLockPart.UPLOADED,!0),this.updateTicksYMinor(p,n,c[n],e,i,o,a);else if(h.visible=!1,0<l.length)for(let t=(n+1)*r,e=t+r;t<e;++t)l[t].visible=!1}}updateLines(e,n,i,o,a,s,l){const r=this.lines;for(let h=0,u=Math.min(r.length,e.size());h<u;++h){const u=e.get(h);if(null!=u){const e=r[h],c=e.points;if(null!=c){const r=c.values,h=u.values,p=h.length;if(2<=p){const d=u.times;if(d.length<p)for(let t=0;t<p;++t){const e=t<<1;r[e+0]=(t+1-n)*i+o,r[e+1]=l-(h[t]-a)*s}else for(let t=0;t<p;++t){const e=t<<1;r[e+0]=(d[t]-n)*i+o,r[e+1]=l-(h[t]-a)*s}e.lock(t.EShapeLockPart.UPLOADED),e.visible=!0,c.values=r,e.unlock(t.EShapeLockPart.UPLOADED,!0)}else e.visible=!1}}}}execute(t,e,n){const i=t.data;if(i.isChanged){let e=1/0,n=-1/0,o=1/0,a=-1/0;for(let t=0,s=i.size();t<s;++t){const s=i.get(t);if(null!=s){const t=s.values,i=t.length,l=s.times,r=l.length;if(r<i)1<e&&(e=1),n<i&&(n=i);else for(let t=0;t<r;++t){const i=l[t];i<e&&(e=i),n<i&&(n=i)}for(let e=0;e<i;++e){const n=t[e];n<o&&(o=n),a<n&&(a=n)}}}n<e?(e=0,n=1):n<=e&&(n=e+1),a<o?(a=1,o=0):a<=o&&(a=o+1);const s=n-e,l=a-o,r=this.plotArea,h=null!=r?r.size:t.size,u=.5*h.x,c=.5*h.y,p=this.xpadding,d=this.ypadding,g=-u+p;let _=+u-p;const S=-c+d;let w=+c-d;_<=g&&(_=g+1),w<=S&&(w=S+1);const m=(_-g)/s,T=(w-S)/l;this.updateTicksX(e,n,m,g,_),this.updateTicksY(o,a,T,S,w),this.updateLines(i,e,m,g,o,T,w)}}}class Ln extends t.EShapeRuntimeImpl{constructor(t){super(t),this.actions.push(new Dn(t))}}class fn{static getTheme(){return t.DThemes.get("EShapeChartLine")}static deserialize(e,n){const i=new Sn(n.mode),o=e[15],a=n.resources;if(0<=o&&o<a.length){let t=n.getExtension(o);null==t&&(t=JSON.parse(a[o]),n.setExtension(o,t)),i.axis.deserialize(t[0],n),e[15]=t[t.length-1]}const s=t.deserializeBase(e,n,i);return i.size.init(),s}static create(e){const n=new Sn(t.EShapeResourceManagerDeserializationMode.EDITOR);return e&&n.copy(e),Cn.newPlotArea(n),Cn.newLine(n),Cn.newXAxis(n),Cn.newXAxisTickMajor(n),Cn.newYAxis(n),Cn.newYAxisTickMajor(n),e instanceof Sn&&n.axis.copy(e.axis),n}static load(){const t=this.getTheme().getName();Ne.add({type:_n.ID,name:t,icon:{width:24,height:24,svg:'<g transform="scale(26.6666)" fill="#fff" stroke="none"><path d="M23,8c0,1.1-0.9,2-2,2c-0.18,0-0.35-0.02-0.51-0.07l-3.56,3.55C16.98,13.64,17,13.82,17,14c0,1.1-0.9,2-2,2s-2-0.9-2-2 c0-0.18,0.02-0.36,0.07-0.52l-2.55-2.55C10.36,10.98,10.18,11,10,11c-0.18,0-0.36-0.02-0.52-0.07l-4.55,4.56 C4.98,15.65,5,15.82,5,16c0,1.1-0.9,2-2,2s-2-0.9-2-2s0.9-2,2-2c0.18,0,0.35,0.02,0.51,0.07l4.56-4.55C8.02,9.36,8,9.18,8,9 c0-1.1,0.9-2,2-2s2,0.9,2,2c0,0.18-0.02,0.36-0.07,0.52l2.55,2.55C14.64,12.02,14.82,12,15,12c0.18,0,0.36,0.02,0.52,0.07 l3.55-3.56C19.02,8.35,19,8.18,19,8c0-1.1,0.9-2,2-2S23,6.9,23,8z"/></g>'},title:t,creator:t=>fn.create(t),editor:bn,deserializer:(t,e)=>fn.deserialize(t,e),runtime:Ln})}}class An{static getTheme(){return t.DThemes.get("EShapeInput")}static create(e){const n=new t.EShapeRectangleRounded;return e?n.copy(e):(n.stroke.set(!0,t.EShapeDefaults.STROKE_COLOR,1,1),n.fill.set(!0,16777215,1),n.text.set(this.getTheme().getLabel()),n.cursor="text",n.state.isFocusable=!0,n.interactive=!0),n.action.add(new t.EShapeActionValueMiscInput(t.EShapeActionValueMiscType.INPUT_TEXT,'"ALWAYS"',"",t.EShapeActionValueOnInputAction.EMIT_EVENT)),n.action.add(new t.EShapeActionValueChangeColor(t.EShapeActionValueChangeColorType.STROKE,"inFocused",t.EShapeActionValueChangeColorTarget.COLOR,t.EShapeDefaults.HIGHLIGHT_COLOR,0,"")),n.action.add(new t.EShapeActionValueChangeColor(t.EShapeActionValueChangeColorType.TEXT,"inDisabled",t.EShapeActionValueChangeColorTarget.ALPHA,0,.5,"")),n}static load(){const t=this.getTheme().getName();Ne.add({icon:{width:24,height:24,svg:'<g transform="scale(26.6666)" fill="#fff" stroke="none"><path d="M22,9v6c0,1.1-0.9,2-2,2h-1l0-2h1V9H4v6h6v2H4c-1.1,0-2-0.9-2-2V9c0-1.1,0.9-2,2-2h16C21.1,7,22,7.9,22,9z"/><path d="M5 4v3h5.5v12h3V7H19V4H5z" transform="translate(7.25,8.5) scale(0.6)" /></g>'},title:t,creator:t=>An.create(t)})}}class Bn{constructor(t){this._parent=t}get values(){const t=this._parent,e=t.data.values,n=t.column.values,i=[];for(let t=0,o=e.length;t<o;++t){const o=e[t],a=[];for(let t=0,i=n.length;t<i;++t){const i=n[t].runtime;null!=i&&a.push(i.toValue(o,t,e))}i.push(a)}return i}}class xn{isEquals(t){return!0}serialize(t){return-1}static deserialize(t,e){return new xn}}class In{constructor(t){this.label=t}isEquals(t){return this.label===t.label}serialize(t){const e=t.addResource(this.label);return t.addResource(`[${e}]`)}static deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);return null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),new In(n[i[0]])}return new In("")}}const Rn={TEXT:0,NUMBER:1};class On{constructor(t,e,n,i,o,a,s,l){this.weight=t,this.type=e,this.getter=n,this.setter=i,this.format=o,this.align=a,this.header=s,this.body=l}isEquals(t){return this.weight===t.weight&&this.type===t.type&&this.getter===t.getter&&this.setter===t.setter&&this.format===t.format&&this.align===t.align&&this.header.isEquals(t.header)&&this.body.isEquals(t.body)}toLabel(){return this.header.label}serialize(t){const e=t.addResource(this.getter),n=t.addResource(this.setter),i=t.addResource(this.format),o=this.header.serialize(t),a=this.body.serialize(t);return t.addResource(`[${this.weight},${this.type},${e},${n},${i},${this.align},-1,${o},${a}]`)}static deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);return null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i)),new On(i[0],i[1],n[i[2]],n[i[3]],n[i[4]],i[5],In.deserialize(i[7],e),xn.deserialize(i[8],e))}return null}}class kn{constructor(t){this.values=[],this._sizeX=1,this._onChange=t}add(t,e){null!=e?this.values.splice(e,0,t):this.values.push(t),this._onChange()}remove(t){const e=this.values;if(0<=t&&t<e.length){const n=e.splice(t,1)[0];return this._onChange(),n}return null}indexOf(t){const e=this.values;for(let n=0,i=e.length;n<i;++n)if(e[n]===t)return n;for(let n=0,i=e.length;n<i;++n)if(e[n].isEquals(t))return n;return-1}get(t){const e=this.values[t];return null!=e?e:null}set(t,e){this.values[t]=e,this._onChange()}swap(t,e){const n=this.values,i=n[e];n[e]=n[t],n[t]=i,this._onChange()}size(){return this.values.length}copy(t){const e=this.values,n=t.values,i=n.length;for(let t=0;t<i;++t)e.push(n[t]);return e.length!==i&&(e.length=i),this._sizeX=t._sizeX,this._onChange(),this}serialize(t){let e="",n="[";const i=this.values;for(let o=0,a=i.length;o<a;++o)e+=n+i[o].serialize(t),n=",";return e+="]",t.addResource(e)}deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i));let o=!1;const a=this.values;0<a.length&&(a.length=0,o=!0);for(let t=0,n=i.length;t<n;++t){const n=On.deserialize(i[t],e);null!=n&&a.push(n)}0<a.length&&(o=!0),o&&this._onChange()}}}class Pn{}Pn.ID=t.EShapeType.EXTENSION+100,Pn.HEADER_ID=t.EShapeType.EXTENSION+101,Pn.BODY_ID=t.EShapeType.EXTENSION+102;const Vn={NONE:0,SINGLE:1,MULTIPLE:2};class Mn{constructor(t){this.parent=t,this.type=Vn.NONE,this.indices=[],this.body=null}get values(){const t=this.indices,e=this.parent.data.values,n=this._values=this._values||[];if(null!=e){n.length=0;for(let i=0,o=t.length;i<o;++i){const o=t[i];0<=o&&o<e.length&&n.push(e[o])}}return n}size(){return this.indices.length}isEmpty(){return this.indices.length<=0}toggle(t){const e=this.indices,n=e.indexOf(t);if(n<0){e.push(t);const n=this.getBody();null!=n&&this.setRowActive(n,t,!0)}else{e.splice(n,1);const i=this.getBody();null!=i&&this.setRowActive(i,t,!1)}}add(t){const e=this.indices;if(e.indexOf(t)<0){e.push(t);const n=this.getBody();null!=n&&this.setRowActive(n,t,!0)}}addTo(t){const e=this.indices,n=e[e.length-1];if(n<t){const i=this.getBody();for(let o=n+1;o<=t;++o)e.indexOf(o)<0&&(e.push(o),null!=i&&this.setRowActive(i,o,!0))}else if(t<n){const i=this.getBody();for(let o=n-1;t<=o;--o)e.indexOf(o)<0&&(e.push(o),null!=i&&this.setRowActive(i,o,!0))}}remove(t){const e=this.indices,n=e.indexOf(t);if(0<=n){e.splice(n,1);const i=this.getBody();null!=i&&this.setRowActive(i,t,!1)}}clear(){const t=this.indices,e=this.getBody();if(null!=e)for(let n=0,i=t.length;n<i;++n)this.setRowActive(e,t[n],!1);t.length=0}clearAndAdd(t){const e=this.indices,n=this.getBody();if(null!=n){for(let i=0,o=e.length;i<o;++i){const o=e[i];o!==t&&this.setRowActive(n,o,!1)}this.setRowActive(n,t,!0)}e.length=0,e.push(t)}getBody(){const t=this.body;return null!=t?t:this.body=$.findChildByType(this.parent,Pn.BODY_ID)}getRow(t,e){const n=t.children;return 0<=e&&e<n.length?n[e]:null}setRowActive(t,e,n){const i=this.getRow(t,e);if(null!=i){const t=i.children;for(let e=0,i=t.length;e<i;++e)t[e].state.isActive=n}}serialize(t){return t.addResource(`[${this.type}]`)}deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i));const o=i[0];this.type!==o&&(this.type=o)}}}class Nn{constructor(t,e){this._height=40,this._onChange=e,this._isCellUpdateAllowed=!0,this._isCellUpdateCalled=!1,this.selection=new Mn(t)}toDirty(){this.updateCells()}disallowCellUpdate(){this._isCellUpdateAllowed=!1,this._isCellUpdateCalled=!1}allowCellUpdate(t){this._isCellUpdateAllowed=!0;const e=this._isCellUpdateCalled;t&&e&&this.updateCells()}updateCells(){this._isCellUpdateAllowed?this._onChange():this._isCellUpdateCalled=!0}get height(){return this._height}set height(t){t=Math.max(5,t),this._height!==t&&(this._height=t,this.updateCells())}copy(t){return this.disallowCellUpdate(),this._height=t._height,this.allowCellUpdate(!1),this.updateCells(),this}serialize(t){const e=this.selection.serialize(t);return t.addResource(`[${this._height},${e}]`)}deserialize(t,e){const n=e.resources;if(0<=t&&t<n.length){let i=e.getExtension(t);null==i&&(i=JSON.parse(n[t]),e.setExtension(t,i));let o=!1;const a=i[0];this._height!==a&&(this._height=a,o=!0),this.selection.deserialize(i[1],e),o&&this._onChange()}}}class Fn extends t.EShapeGroupShadowed{constructor(t,e=Pn.ID){super(t,e),this._columnWidths=[],this._columnXs=[],this.column=new kn((()=>{this.onColumnChange()})),this.row=new Nn(this,(()=>{this.onRowChange()})),this.cell=new Bn(this)}onColumnChange(){this.newCellsHeader(),this.newCellsBody(!0),this.layoutCells()}onRowChange(){this.newCellsBody(!1),this.layoutCells()}onSizeChange(){super.onSizeChange(),this.newCellsBody(!1),this.layoutCells()}newCellsHeader(){if(this.children.length<=0)return;const e=this.children[0],n=this.column,i=n.size(),o=n.values,a=e.children,s=a.length;if(s<i){const n=a[s-1]||this;for(let a=s;a<i;++a){const i=(new t.EShapeRectangle).copy(n);i.text.value=o[a].header.label,i.attach(e)}}else if(i<s)for(let t=s-1;i<=t;--t)a[t].detach();for(let t=0;t<i;++t)a[t].text.value=o[t].header.label}toRowCountRequired(){return Math.min(1e3,Math.max(1,Math.floor(Math.abs(this.size.y)/this.row.height)))-1}newCellsBody(e){if(this.children.length<=1)return;const n=this.children[1],i=n.children,o=i.length,a=this.toRowCountRequired(),s=Math.max(2,a);if(o<s){const e=(0<o?i[0]:null)||this,a=(1<o?i[1]:null)||this,l=this.mode;for(let i=o;i<s;++i){const o=i%2==0?e:a;new t.EShapeGroupShadowed(l).copy(o,t.EShapeCopyPart.ACTION).attach(n)}}else if(s<o)for(let t=o-1;s<=t;--t)i[t].detach();0<i.length&&(i[0].visible=0<a),1<i.length&&(i[1].visible=1<a);const l=(0<i.length?i[0].children[0]:null)||this,r=(1<i.length?i[1].children[0]:null)||this,h=this.column,u=h.values,c=h.size();for(let n=0;n<s;++n){const o=n<=1?Math.max(1,c):c,a=i[n],s=a.children,h=s.length,p=n%2==0?l:r;if(h<o)for(let e=h;e<o;++e)(new t.EShapeRectangle).copy(p).attach(a);else if(o<h)for(let t=h-1;o<=t;--t)s[t].detach();if(0<s.length&&(s[0].visible=0<c),1<s.length&&(s[1].visible=1<c),e)for(let t=0;t<c;++t)s[t].text.align.horizontal=u[t].align}}layoutCells(){if(this.children.length<=1)return;const e=this.row.height,n=.5*e,i=this.column,o=this.size,a=o.x,s=o.y,l=.5*-a,r=.5*-s,h=i.values,u=h.length;let c=0;for(let t=0;t<u;++t)c+=h[t].weight;c=Math.max(1e-5,c);const p=this._columnWidths,d=this._columnXs,g=a/c;let _=0;for(let t=0;t<u;++t){const e=h[t].weight*g;p[t]=e,d[t]=_+.5*e,_+=e}const S=this.children[0];S.lock(t.EShapeLockPart.ALL),S.size.set(a,e),S.transform.position.set(0,r+n),S.unlock(t.EShapeLockPart.ALL,!0);const w=S.children,m=w.length;for(let n=0;n<m;++n){const i=w[n];i.lock(t.EShapeLockPart.ALL),i.size.set(p[n],e),i.transform.position.set(l+d[n],0),i.unlock(t.EShapeLockPart.ALL,!0)}const T=this.children[1];T.lock(t.EShapeLockPart.ALL),T.size.set(a,s-e),T.transform.position.set(0,n),T.unlock(t.EShapeLockPart.ALL,!0);const E=T.children,y=E.length;for(let n=0,i=r+e;n<y;++n,i+=e){const o=E[n];o.lock(t.EShapeLockPart.ALL),o.size.set(a,e),o.transform.position.set(0,i),o.unlock(t.EShapeLockPart.ALL,!0);const s=o.children,r=s.length;for(let n=0;n<r;++n){const i=s[n];i.lock(t.EShapeLockPart.ALL),i.size.set(p[n],e),i.transform.position.set(l+d[n],0),i.unlock(t.EShapeLockPart.ALL,!0)}}}copy(e,n=t.EShapeCopyPart.ALL){const i=super.copy(e,n);return e instanceof Fn&&(this.column.copy(e.column),this.row.copy(e.row)),i}serialize(t){const e=super.serialize(t),n=e[15];return e[15]=t.addResource(`[${this.column.serialize(t)},${this.row.serialize(t)},${n}]`),e}}class zn extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._value=t}execute(){return this.redo()}redo(){const t=this._value,e=this._selection.get();for(let n=0,i=e.length;n<i;++n){const i=e[n];i instanceof Fn&&i.column.add(t)}return this._selection.update("PROPERTY"),!0}undo(){const t=this._selection.get();for(let e=0,n=t.length;e<n;++e){const n=t[e];n instanceof Fn&&n.column.remove(n.column.size()-1)}return this._selection.update("PROPERTY"),!0}}class Hn extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t;const n=[],i=this._selection.get();for(let e=0,o=i.length;e<o;++e){const o=i[e];if(o instanceof Fn){const e=o.column.indexOf(t);n.push(e),0<e&&o.column.swap(e-1,e)}}this._indices=n,this._selection.update("PROPERTY")}execute(){return!0}redo(){const t=this._selection.get(),e=this._indices;for(let n=0,i=t.length;n<i;++n){const i=t[n];if(i instanceof Fn){const t=e[n];0<t&&i.column.swap(t-1,t)}}return this._selection.update("PROPERTY"),!0}undo(){return this.redo()}}class Gn extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t;const n=[],i=this._selection.get();for(let e=0,o=i.length;e<o;++e){const o=i[e];if(o instanceof Fn){const e=o.column.indexOf(t);n.push(e),0<=e&&o.column.remove(e)}}this._indices=n,this._selection.update("PROPERTY")}execute(){return!0}redo(){const t=this._indices,e=this._selection.get();for(let n=0,i=e.length;n<i;++n){const i=e[n];if(i instanceof Fn){const e=t[n];0<=e&&i.column.remove(e)}}return this._selection.update("PROPERTY"),!0}undo(){const t=this._target,e=this._indices,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i];if(o instanceof Fn){const n=e[i];0<=n&&o.column.add(t,n)}}return this._selection.update("PROPERTY"),!0}}class Un extends t.DCommandBase{constructor(t,e,n,i){super(),this._selection=n,this._oldValue=t,this._newValue=e,this._list=i;const o=[],a=[],s=this._selection.get();for(let n=0,i=s.length;n<i;++n){const i=s[n];if(i instanceof Fn){const n=i.column.indexOf(t);o.push(n),0<=n?(a.push(i.column.get(n)),i.column.set(n,e)):a.push(e)}else o.push(-1),a.push(e)}this._indices=o,this._oldValues=a,i.data.selection.contains(t)&&i.data.selection.clearAndAdd(e),this._selection.update("PROPERTY")}execute(){return!0}redo(){const t=this._newValue,e=this._indices,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i];if(o instanceof Fn){const n=e[i];0<=n&&o.column.set(n,t)}}const i=this._list;return i.data.selection.contains(this._oldValue)&&i.data.selection.clearAndAdd(t),this._selection.update("PROPERTY"),!0}undo(){const t=this._indices,e=this._oldValues,n=this._selection.get();for(let i=0,o=n.length;i<o;++i){const o=n[i];if(o instanceof Fn){const n=t[i];0<=n&&o.column.set(n,e[i])}}const i=this._list;return i.data.selection.contains(this._newValue)&&i.data.selection.clearAndAdd(this._oldValue),this._selection.update("PROPERTY"),!0}}class Yn extends t.DCommandBase{constructor(t,e){super(),this._selection=e,this._target=t;const n=[],i=this._selection.get();for(let e=0,o=i.length;e<o;++e){const o=i[e];if(o instanceof Fn){const e=o.column,i=e.indexOf(t);n.push(i),0<=i&&i<e.size()-1&&e.swap(i+1,i)}else n.push(-1)}this._indices=n,this._selection.update("PROPERTY")}execute(){return!0}redo(){const t=this._selection.get(),e=this._indices;for(let n=0,i=t.length;n<i;++n){const i=t[n];if(i instanceof Fn){const t=i.column,o=e[n];0<=o&&o<t.size()-1&&t.swap(o+1,o)}}return this._selection.update("PROPERTY"),!0}undo(){return this.redo()}}class Xn extends t.DCommandBase{constructor(t,e){super();const n=e.get(),i=[];for(let e=0,o=n.length;e<o;++e){const o=n[e];o instanceof Fn?(i.push(o.row.height),o.row.height=t):i.push(35)}this._values=i,this._selection=e}execute(){return!0}redo(){const t=this._selection,e=t.get(),n=[];for(let t=0,i=e.length;t<i;++t){const i=e[t];if(i instanceof Fn){const e=n[t];n[t]=i.row.height,i.row.height=e}}return t.update("PROPERTY"),!0}undo(){return this.redo()}}class Wn extends t.DCommandBase{constructor(t,e){super();const n=e.get(),i=[];for(let e=0,o=n.length;e<o;++e){const o=n[e];o instanceof Fn?(i.push(o.row.selection.type),o.row.selection.type=t):i.push(Vn.NONE)}this._values=i,this._selection=e}execute(){return!0}redo(){const t=this._selection,e=t.get(),n=[];for(let t=0,i=e.length;t<i;++t){const i=e[t];if(i instanceof Fn){const e=n[t];n[t]=i.row.selection.type,i.row.selection.type=e}}return t.update("PROPERTY"),!0}undo(){return this.redo()}}class Kn extends t.DDialogLayered{newContentChildren(e,n){const i=super.newContentChildren(e,n);return i.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:e.getSelectColumnValueTypeLabel()}}),new t.DSelect({weight:1,value:Rn.TEXT,menu:{items:[{value:Rn.TEXT,text:{value:e.toSelectColumnValueTypeLabel(Rn.TEXT)}},{value:Rn.NUMBER,text:{value:e.toSelectColumnValueTypeLabel(Rn.NUMBER)}}]},on:{init:t=>{this._selectType=t}}}),new t.DLayoutSpace({width:60})]})),i.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:e.getInputLabelLabel()}}),new t.DInputText({weight:1,text:{value:""},on:{init:t=>{this._inputLabel=t},enter:()=>{this.ok()}}}),new t.DLayoutSpace({width:60})]})),i.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:e.getInputWidthLabel()}}),new t.DInputReal({weight:1,text:{value:0},min:0,on:{init:t=>{this._inputWidth=t},enter:()=>{this.ok()}}}),new t.DLayoutSpace({width:60})]})),i.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:e.getInputGetterLabel()}}),new t.DInputText({weight:1,text:{value:""},on:{init:t=>{this._inputGetter=t},enter:()=>{this.ok()}}}),new t.DLayoutSpace({width:60})]})),i.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:e.getInputSetterLabel()}}),new t.DInputText({weight:1,text:{value:""},on:{init:t=>{this._inputSetter=t},enter:()=>{this.ok()}}}),new t.DLayoutSpace({width:60})]})),i.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:e.getInputFormatLabel()}}),new t.DInputText({weight:1,text:{value:""},on:{init:t=>{this._inputFormat=t},enter:()=>{this.ok()}}}),new t.DLayoutSpace({width:60})]})),i.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:e.getSelectTextAlignLabel()}}),new t.DSelect({weight:1,value:t.EShapeTextAlignHorizontal.CENTER,menu:{items:[{value:t.EShapeTextAlignHorizontal.LEFT,text:{value:e.toTextAlignLabel(t.EShapeTextAlignHorizontal.LEFT)}},{value:t.EShapeTextAlignHorizontal.CENTER,text:{value:e.toTextAlignLabel(t.EShapeTextAlignHorizontal.CENTER)}},{value:t.EShapeTextAlignHorizontal.RIGHT,text:{value:e.toTextAlignLabel(t.EShapeTextAlignHorizontal.RIGHT)}}]},on:{init:t=>{this._selectAlign=t}}}),new t.DLayoutSpace({width:60})]})),i}reset(){return this._selectType.value=Rn.TEXT,this._inputLabel.value=this.theme.newInputLabel(),this._inputWidth.value=1,this._inputGetter.value="",this._inputSetter.value="",this._inputFormat.value="",this._selectAlign.value=t.EShapeTextAlignHorizontal.CENTER,this}get value(){return new On(this._inputWidth.value,this._selectType.value||Rn.TEXT,this._inputGetter.value,this._inputSetter.value,this._inputFormat.value,this._selectAlign.value||t.EShapeTextAlignHorizontal.LEFT,new In(this._inputLabel.value),new xn)}set value(t){null!=t&&(this._selectType.value=t.type,this._inputLabel.value=t.header.label,this._inputWidth.value=t.weight,this._inputGetter.value=t.getter,this._inputSetter.value=t.setter,this._inputFormat.value=t.format,this._selectAlign.value=t.align)}getResolvedValue(){return this.value}getType(){return"EDialogShapeTableColumn"}}class $n extends t.DPane{constructor(e){super(e),this._icons=e.icons;const n=e.selection;this._selection=n,this.state.isDisabled=n.isEmpty(),n.on("change",(()=>{this.state.isDisabled=n.isEmpty()})),this.content.setHeight("padding"),new t.DLayoutVertical({parent:this.content,x:"padding",y:"padding",width:"padding",height:"padding",children:[new t.DLayoutHorizontal({width:"100%",height:"auto",children:[this.newTextLabel(),this.buttonNew,this.buttonDelete,this.buttonBringForward,this.buttonSendBackward]}),this.columnList,new t.DText({width:"100%",text:{value:this.subtheme.getInputRowHeightLabel()}}),this.inputRowHeight,new t.DText({width:"100%",text:{value:this.subtheme.getSelectRowSelectionTypeLabel()}}),this.selectRowSelectionType]}),n.on("change",(()=>{this.onSelectionChange(n)}));const i=this.columnList;i.data.selection.on("change",(()=>{this.onListSelectionChange(i)})),this.onSelectionChange(n)}newTextLabel(){return new t.DText({weight:1,text:{value:this.subtheme.getLabel()}})}get buttonNew(){var t;return null!==(t=this._buttonNew)&&void 0!==t?t:this._buttonNew=this.newButtonNew()}newButtonNew(){return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.subtheme.getButtonNewTitle(),on:{active:t=>{this.onButtonNewActive(t)}}})}onButtonNewActive(e){this.columnDialog.reset().open(e).then((e=>{null!=e&&t.DControllers.getCommandController().push(new zn(e,this._selection))}))}onSelectionChangeButtonNew(t){const e=this.buttonNew;t.last()instanceof Fn?e.state.isDisabled=!1:e.state.isDisabled=!0}get buttonDelete(){var t;return null!==(t=this._buttonDelete)&&void 0!==t?t:this._buttonDelete=this.newButtonDelete()}newButtonDelete(){return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.subtheme.getButtonDeleteTitle(),on:{active:()=>{const e=this.columnList,n=e.data.selection.first;null!=n&&1<e.data.size()&&t.DControllers.getCommandController().push(new Gn(n,this._selection))}}})}onListSelectionChangeButtonDelete(t){this.buttonDelete.state.isDisabled=t.data.size()<=1||t.data.selection.isEmpty()}get buttonBringForward(){var t;return null!==(t=this._buttonBringForward)&&void 0!==t?t:this._buttonBringForward=this.newButtonBringForward()}newButtonBringForward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.subtheme.getButtonBringForwardTitle(),on:{active:()=>{const e=this.columnList,n=e.selection.first;null!=n&&e.data.items[0]!==n&&t.DControllers.getCommandController().push(new Hn(n,this._selection))}}})}onListSelectionChangeButtonBringForward(t){const e=t.data.selection.first,n=t.data.items;this.buttonBringForward.state.isDisabled=null==e||n[0]===e}get buttonSendBackward(){var t;return null!==(t=this._buttonSendBackward)&&void 0!==t?t:this._buttonSendBackward=this.newButtonSendBackward()}newButtonSendBackward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.subtheme.getButtonSendBackwardTitle(),on:{active:()=>{const e=this.columnList,n=e.selection.first,i=e.data.items;null!=n&&i[i.length-1]!==n&&t.DControllers.getCommandController().push(new Yn(n,this._selection))}}})}onListSelectionChangeButtonSendBackward(t){const e=t.selection.first,n=t.data.items;this.buttonSendBackward.state.isDisabled=null==e||n[n.length-1]===e}get columnDialog(){var t;return null!==(t=this._columnDialog)&&void 0!==t?t:this._columnDialog=this.newColumnDialog()}newColumnDialog(){return new Kn}get columnList(){var t;return null!==(t=this._columnList)&&void 0!==t?t:this._columnList=this.newColumnList()}newColumnList(){const e=new t.DList({width:"100%",weight:1,data:{toLabel:t=>t.toLabel()},updater:{newItem:n=>new t.DListItem(n,{on:{dblclick:(t,n,i)=>{this.onColumnListDblClick(t,n,i,e)}}})}});return e}onColumnListDblClick(e,n,i,o){const a=i.value;if(null!=a){const e=this.columnDialog;e.value=a,e.open(i).then((()=>{const n=e.value;null!=n&&t.DControllers.getCommandController().push(new Un(a,n,this._selection,o))}))}}onSelectionChangeColumnList(t){const e=t.last(),n=this.columnList;n.data.items=e instanceof Fn?e.column.values:[],this.onListSelectionChange(n)}get inputRowHeight(){var t;return null!==(t=this._inputRowHeight)&&void 0!==t?t:this._inputRowHeight=this.newInputRowHeight()}newInputRowHeight(){return new t.DInputReal({width:"100%",min:5,step:1,on:{change:e=>{t.DControllers.getCommandController().push(new Xn(e,this._selection))}}})}onSelectionChangeInputRowHeight(t){const e=t.last(),n=this.inputRowHeight;e instanceof Fn?(n.value=e.row.height,n.state.isDisabled=!1):n.state.isDisabled=!0}get selectRowSelectionType(){var t;return null!==(t=this._selectRowSelectionType)&&void 0!==t?t:this._selectRowSelectionType=this.newSelectRowSelectionType()}newSelectRowSelectionType(){const e=this.subtheme;return new t.DSelect({width:"100%",value:Vn.SINGLE,menu:{items:[{value:Vn.NONE,text:{value:e.toSelectRowSelectionTypeLabel(Vn.NONE)}},{value:Vn.SINGLE,text:{value:e.toSelectRowSelectionTypeLabel(Vn.SINGLE)}},{value:Vn.MULTIPLE,text:{value:e.toSelectRowSelectionTypeLabel(Vn.MULTIPLE)}}]},on:{change:e=>{null==e&&(e=Vn.SINGLE),t.DControllers.getCommandController().push(new Wn(e,this._selection))}}})}onSelectionChangeSelectRowSelectionType(t){const e=t.last(),n=this.selectRowSelectionType;e instanceof Fn?(n.value=e.row.selection.type,n.state.isDisabled=!1):n.state.isDisabled=!0}onSelectionChange(t){this.onSelectionChangeButtonNew(t),this.onSelectionChangeColumnList(t),this.onSelectionChangeInputRowHeight(t),this.onSelectionChangeSelectRowSelectionType(t)}onListSelectionChange(t){this.onListSelectionChangeButtonDelete(t),this.onListSelectionChangeButtonBringForward(t),this.onListSelectionChangeButtonSendBackward(t)}get subtheme(){var t;return null!==(t=this._subtheme)&&void 0!==t?t:this._subtheme=this.newSubtheme()}newSubtheme(){return t.DThemes.get("EEditorShapeTable")}}class Zn extends t.EShapeActionRuntimeBase{constructor(t){super(),this.body=$.findChildByType(t,Pn.BODY_ID),this.column=t.column}execute(t,e,n){const i=this.body,o=this.column;if(null!=i&&null!=o){const e=t.data;if(e.isChanged){const t=i.children,n=t.length,a=e.get(0);if(null!=a){const e=o.values,i=a.values,s=i.length,l=Math.min(n,s);for(let n=0;n<l;++n){const o=i[n],a=t[n].children,s=a.length,l=Math.min(s,e.length);for(let t=0;t<l;++t){const n=a[t],s=e[t].runtime;null!=s&&(n.state.isFocusable=!0,n.text.value=s.formatter(s.toValue(o,t,i),t))}for(let t=l;t<s;++t){const e=a[t];e.state.isFocusable=!1,e.text.value=""}}for(let e=l;e<n;++e){const n=t[e].children,i=n.length;for(let t=0;t<i;++t){const e=n[t];e.state.isFocusable=!1,e.text.value=""}}}else for(let e=0;e<n;++e){const n=t[e].children,i=n.length;for(let t=0;t<i;++t){const e=n[t];e.state.isFocusable=!1,e.text.value=""}}}}}}class jn extends t.EShapeActionValueChangeColorCode{constructor(){super(t.EShapeActionValueChangeColorType.FILL,"",jn.getColorCode(),"","")}static getColorCode(){const e=t.UtilRgb.brighten(t.EShapeDefaults.HIGHLIGHT_COLOR,.8),n=t.UtilRgb.brighten(t.EShapeDefaults.HIGHLIGHT_COLOR,.75),i=t.UtilRgb.brighten(t.EShapeDefaults.HIGHLIGHT_COLOR,.85);return`inDisabled ? ${t.UtilRgb.darken(t.EShapeDefaults.FILL_COLOR,.25)} : ( isActive ?\t( isHovered ? ${e} : ${n} ) :\t( isHovered ? ${i} : null ))`}}class qn extends t.EShapeRuntimeImpl{constructor(t){super(t),this.lastRowIndex=-1,this.lastColumnIndex=-1,this.init(t)}init(t){const e=t.parent;if(e instanceof Fn){this.selection=e.row.selection;const n=t.children;for(let t=0,e=n.length;t<e;++t){const e=n[t].children;for(let t=0,n=e.length;t<n;++t)e[t].action.add(new jn)}}}onClick(t,e){super.onClick(t,e);const n=this.selection;if(null!=e&&null!=n&&n.type!==Vn.NONE){const t=this.lastRowIndex;if(0<=t){const i=n.indices,o=n.type===Vn.SINGLE,a=!o,s="data"in e?e.data.originalEvent:e,l=s.ctrlKey,r=s.shiftKey;o||i.length<=0||!a||!l&&!r?n.clearAndAdd(t):l?n.toggle(t):r&&n.addTo(t)}}}onDblClick(t,e,n){const i=super.onDblClick(t,e,n),o=this.getCell(t,this.lastRowIndex,this.lastColumnIndex);return null!=o&&o.focus(),i}onOut(t,e){super.onOut(t,e);const n=this.lastRowIndex;0<=n&&(this.setRowHovered(t,n,!1),this.lastRowIndex=-1)}onCellTouched(e,n,i){let o=!1;const a=this.lastRowIndex;if(a!==n&&(this.setRowHovered(e,a,!1),this.setRowHovered(e,n,!0),this.lastRowIndex=n,o=!0),this.lastColumnIndex!==i&&(this.lastColumnIndex=i,o=!0),o){const o=this.getCell(e,n,i);e.title=o&&o.text.value||"";const a=t.DApplications.getLayer(e);a&&(a.view.title=e.title)}}getRow(t,e){const n=t.children;return 0<=e&&e<n.length?n[e]:null}getCell(t,e,n){const i=this.getRow(t,e);if(null!=i){const t=i.children;if(0<=n&&n<t.length)return t[n]}return null}setRowHovered(t,e,n){const i=this.getRow(t,e);if(null!=i){const t=i.children;for(let e=0,i=t.length;e<i;++e)t[e].state.isHovered=n}}}qn.WORK_POINT=new e.Point;class Jn extends t.EShapeGroupShadowed{constructor(t,e=Pn.BODY_ID){super(t,e)}containsAbs(t,e,n,i){if(this.containsAbsBBox(t,e,n,i)){const n=this.children;if(0<n.length){const o=n[0],a=(i+e)/o.size.y|0;if(a<n.length){const e=o.children;for(let n=0,i=e.length;n<i;++n){const i=e[n];if(t<i.transform.position.x+.5*i.size.x){const t=this.runtime;return t instanceof qn&&t.onCellTouched(this,a,n),!0}}return!0}return!1}}return!1}containsText(t,e){return null}containsChildren(t,e){return null}}const Qn=(t,e)=>t[e],ti=(t,e,n,i)=>{t[e]=i},ei=t=>String(t);class ni{constructor(e){if(this.toValue=this.parseToValue(e.getter,Qn,'""'),this.fromValue=this.parseFromValue(e.setter,ti),e.type===Rn.TEXT)this.formatter=this.parseFormat(e.format,ei,'""');else{const n=e.format;if(0<n.trim().length){const e=t.NumberFormatters.create(n);this.formatter=t=>e.format(t,1)}else this.formatter=ei}}parseToValue(t,e,n){if(t.trim().length<=0)return e;try{return Function("row","index","rows",`try{ return (${t}); } catch( e ) { return ${n}; }`)}catch(t){return e}}parseFromValue(t,e){if(t.trim().length<=0)return e;try{return Function("row","index","rows","value",`try{ ${t} = value; } catch( e ) {}`)}catch(t){return e}}parseFormat(t,e,n){if(t.trim().length<=0)return e;try{return Function("value","index",`try{ return (${t}); } catch( e ) { return ${n}; }`)}catch(t){return e}}}class ii extends t.EShapeRuntimeImpl{}class oi extends t.EShapeGroupShadowed{constructor(t,e=Pn.HEADER_ID){super(t,e)}}class ai extends t.EShapeRuntimeImpl{constructor(t){if(super(t),t instanceof Fn){const e=t.column.values;for(let t=0,n=e.length;t<n;++t){const n=e[t];n.runtime=new ni(n)}this.actions.push(new Zn(t))}}}class si{static getTheme(){return t.DThemes.get("EShapeTable")}static create(e){const n=t.EShapeResourceManagerDeserializationMode.EDITOR,i=new Fn(n),o=new oi(n).attach(i),a=(new t.EShapeRectangle).attach(o);a.stroke.side=t.EShapeStrokeSide.BOTTOM,a.stroke.width=1,a.stroke.color=t.UtilRgb.brighten(t.EShapeDefaults.STROKE_COLOR,.65);const s=new Jn(n).attach(i);s.state.isFocusable=!0,s.interactive=!0;const l=new t.EShapeGroupShadowed(n).attach(s),r=new t.EShapeGroupShadowed(n).attach(s),h=(new t.EShapeRectangle).attach(l);h.stroke.enable=!1,h.text.value="-",h.text.clipping=!0;const u=(new t.EShapeRectangle).attach(r);return u.fill.color=t.UtilRgb.darken(t.EShapeDefaults.FILL_COLOR,.05),u.stroke.enable=!1,u.text.value="-",u.text.clipping=!0,i.column.add(new On(1,Rn.TEXT,"","","",t.EShapeTextAlignHorizontal.CENTER,new In(this.getTheme().newHeaderLabel()),new xn)),e&&i.copy(e),i.onSizeChange(),i}static load(){const e=this.getTheme(),n=e.getName();Ne.add({type:Pn.ID,name:n,icon:{width:24,height:24,svg:'<g transform="scale(26.6666)" fill="#fff" stroke="none"><path d="M20 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 2v3H5V5h15zm-5 14h-5v-9h5v9zM5 10h3v9H5v-9zm12 9v-9h3v9h-3z"/></g>'},title:n,creator:t=>si.create(t),deserializer:(t,e)=>si.deserialize(t,e),editor:$n,runtime:ai,uploaded:t.createGroupUploaded}),Ne.add({type:Pn.HEADER_ID,name:e.getHeaderName(),deserializer:(t,e)=>si.deserializeHeader(t,e),runtime:ii,capability:t.EShapeCapability.PRIMITIVE&~t.EShapeCapability.CHILDREN}),Ne.add({type:Pn.BODY_ID,name:e.getBodyName(),deserializer:(t,e)=>si.deserializeBody(t,e),runtime:qn,capability:t.EShapeCapability.PRIMITIVE&~t.EShapeCapability.CHILDREN})}static deserialize(e,n){const i=new Fn(n.mode),o=e[15],a=n.resources;if(0<=o&&o<a.length){let t=n.getExtension(o);null==t&&(t=JSON.parse(a[o]),n.setExtension(o,t)),i.column.deserialize(t[0],n),i.row.deserialize(t[1],n),e[15]=t[t.length-1]}const s=t.deserializeBase(e,n,i);return i.size.init(),s}static deserializeHeader(e,n){const i=new oi(n.mode),o=t.deserializeBase(e,n,i);return i.size.init(),o}static deserializeBody(e,n){const i=new Jn(n.mode),o=t.deserializeBase(e,n,i);return i.size.init(),o}}const li=t=>`extension_factory_icon_${t}`;class ri{static add(t){this._factories.push(t)}static each(t){const e=this._factories;for(let n=0,i=e.length;n<i;++n)t(e[n])}static merge(t){const e=this._factories;for(let n=0,i=e.length;n<i;++n){const i=e[n].icon;t.add(li(n),i.width,i.height,i.svg)}}static build(t){const e=this._factories;for(let n=0,i=e.length;n<i;++n)e[n].icon.texture=t[li(n)]}}ri._factories=[];class hi extends t.DInputSearch{getClipperRect(e,n,i){return t.UtilHtmlElement.getClipperRect(null,this,e,n,i)}}class ui extends t.DBoard{constructor(e){super(e),this.addChild(new t.DLayoutVertical({x:"padding",y:"padding",width:"padding",height:"padding",children:[this.input,this.list,this.text]})),this.onInputChange("")}get input(){let t=this._input;return null==t&&(t=this.newInput(),this._input=t),t}newInput(){return new hi({width:"padding",on:{input:t=>{this.onInputChange(t)}}})}onInputChange(t){this.list.data.clearAndAddAll(this.newKeywords(t))}newKeywords(e){var n;const i=null!==(n=this._keywords)&&void 0!==n?n:this._keywords=t.DThemes.get("EDialogAction").newKeywords();if(0<e.trim().length){const t=[];for(let n=0,o=i.length;n<o;++n){const o=i[n];0<=o.keyword.indexOf(e)&&t.push(o)}return t}return i}get list(){let t=this._list;return null==t&&(t=this.newList(),this._list=t),t}newList(){return new t.DList({weight:1,width:"padding",data:{selection:{on:{change:()=>{this.onListSelectionChange()}}},toLabel:t=>t.keyword,toId:t=>t.keyword}})}onListSelectionChange(){const t=this.list.data.selection.first;this.text.text=t?`${t.keyword}: ${t.type}\n${t.description}`:""}get text(){let t=this._text;return null==t&&(t=this.newText(),this._text=t),t}newText(){return new t.DText({width:"padding",height:120,state:"READ_ONLY",text:{style:{wordWrap:"NORMAL"}},theme:"DInputTextArea"})}getType(){return"DDialog"}}class ci extends t.DDialogLayered{newContentChildren(t,e){const n=super.newContentChildren(t,e);n.push(this.selectLayout,this.showHideTypeLayout,this.blinkTypeLayout,this.transformTypeLayout,this.changeColorTypeLayout,this.changeColorTargetLayout,this.rotateTypeLayout,this.resizeTypeLayout,this.originXLayout,this.originYLayout,this.moveTypeLayout,this.openTypeLayout,this.openDialogTypeLayout,this.changeTextTypeLayout,this.miscTypeLayout,this.onInputActionLayout,this.whenTypeLayout,this.gestureTypeLayout,this.gestureOperationTypeLayout,this.selectLayerLayout,this.condition,this.intervalLayout,this.size,this.amount,this.targetName,this.colorLayout,this.target,this.argument,this.contents,this.initialization,this.pointerEventsLayout,this.colorCode,this.alphaCode,this.brightness,this.blend,this.initial,this.step,this.min,this.max,this.scaleLayout,this.checkBringToFrontLayout,this.inNewWindowLayout);const i=()=>{this.onChange()};return this.select.on("change",i),this.showHideType.on("change",i),this.blinkType.on("change",i),this.transformType.on("change",i),this.resizeType.on("change",i),this.changeColorTarget.on("change",i),this.openType.on("change",i),this.openDialogType.on("change",i),this.miscType.on("change",i),n}newLabel(e){return new t.DInputLabel({width:60,text:{value:e}})}newSpace(){return new t.DLayoutSpace({width:60})}newLabeled(e,n){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[null!=e?this.newLabel(e):this.newSpace(),n,this.newSpace()]})}get themeShape(){var t;return null!==(t=this._themeShape)&&void 0!==t?t:this._themeShape=this.newThemeShape()}newThemeShape(){return t.DThemes.get("EShapeActionValue")}get select(){var t;return null!==(t=this._select)&&void 0!==t?t:this._select=this.newSelect()}newSelect(){return new t.DSelect({weight:1,value:t.EShapeActionValueType.SHOW_HIDE,menu:{items:this.newSelectMenuItems()}})}newSelectMenuItems(){const e=this.themeShape,n=[{value:t.EShapeActionValueType.SHOW_HIDE,text:{value:e.toTypeLabel(t.EShapeActionValueType.SHOW_HIDE)}},{value:t.EShapeActionValueType.BLINK,text:{value:e.toTypeLabel(t.EShapeActionValueType.BLINK)}},{value:t.EShapeActionValueType.TRANSFORM,text:{value:e.toTypeLabel(t.EShapeActionValueType.TRANSFORM)}},{value:t.EShapeActionValueType.CHANGE_COLOR,text:{value:e.toTypeLabel(t.EShapeActionValueType.CHANGE_COLOR)}},{value:t.EShapeActionValueType.CHANGE_TEXT,text:{value:e.toTypeLabel(t.EShapeActionValueType.CHANGE_TEXT)}},{value:t.EShapeActionValueType.CHANGE_CURSOR,text:{value:e.toTypeLabel(t.EShapeActionValueType.CHANGE_CURSOR)}},{value:t.EShapeActionValueType.OPEN,text:{value:e.toTypeLabel(t.EShapeActionValueType.OPEN)}},{value:t.EShapeActionValueType.GESTURE,text:{value:e.toTypeLabel(t.EShapeActionValueType.GESTURE)}},{value:t.EShapeActionValueType.MISC,text:{value:e.toTypeLabel(t.EShapeActionValueType.MISC)}}];return Oe.each((t=>{n.push({value:t.type,text:{value:t.label}})})),n}get selectLayout(){var t;return null!==(t=this._selectLayout)&&void 0!==t?t:this._selectLayout=this.newSelectLayout()}newSelectLayout(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabel(this.theme.getSelectActionLabel()),this.select,new t.DLayoutHorizontal({width:60,height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonKeyword]})]})}get buttonKeyword(){var t;return null!==(t=this._buttonKeyword)&&void 0!==t?t:this._buttonKeyword=this.newButtonKeyword()}newButtonKeyword(){var e;return new t.DButtonAmbient({width:30,toggle:!0,image:{source:null===(e=this.options)||void 0===e?void 0:e.icons.action_keyword},title:this.theme.getButtonKeywordTitle(),on:{active:()=>{this.onButtonKeywordActive()},inactive:()=>{this.onButtonKeywordInactive()}}})}onButtonKeywordActive(){const e=this.boardKeyword,n=this.getBoardKeywordOffset(),i=this.width,o=t.DApplications.getLayer(this);if(null!=o){const t=e.width;o.width<this.position.x+i+n+t?e.position.x=-t-n:e.position.x=i+n}else e.position.x=i+n;e.show()}onButtonKeywordInactive(){this.boardKeyword.hide()}get boardKeyword(){var t;return null!==(t=this._boardKeyword)&&void 0!==t?t:this._boardKeyword=this.newBoardKeyword()}newBoardKeyword(){return new ui({parent:this,x:0,y:0,width:()=>300,height:()=>400,padding:16})}getBoardKeywordOffset(){return 16}get showHideType(){var t;return null!==(t=this._showHideType)&&void 0!==t?t:this._showHideType=this.newShowHideType()}newShowHideType(){const e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueShowHideType.SHAPE,menu:{items:[{value:t.EShapeActionValueShowHideType.SHAPE,text:{value:e.toShowHideTypeLabel(t.EShapeActionValueShowHideType.SHAPE)}},{value:t.EShapeActionValueShowHideType.LAYER,text:{value:e.toShowHideTypeLabel(t.EShapeActionValueShowHideType.LAYER)}}]}})}get showHideTypeLayout(){var t;return null!==(t=this._showHideTypeLayout)&&void 0!==t?t:this._showHideTypeLayout=this.newLabeled(null,this.showHideType)}onChangeShowHideTypeLayout(e){const n=this.showHideTypeLayout;e===t.EShapeActionValueType.SHOW_HIDE?n.show():n.hide()}get blinkType(){var t;return null!==(t=this._blinkType)&&void 0!==t?t:this._blinkType=this.newBlinkType()}newBlinkType(){const e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueBlinkType.VISIBILITY,menu:{items:[{value:t.EShapeActionValueBlinkType.VISIBILITY,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.VISIBILITY)}},{value:t.EShapeActionValueBlinkType.BRIGHTEN,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.BRIGHTEN)}},{value:t.EShapeActionValueBlinkType.DARKEN,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.DARKEN)}},{value:t.EShapeActionValueBlinkType.OPACITY,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.OPACITY)}},{value:t.EShapeActionValueBlinkType.COLOR_FILL,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.COLOR_FILL)}},{value:t.EShapeActionValueBlinkType.COLOR_STROKE,text:{value:e.toBlinkTypeLabel(t.EShapeActionValueBlinkType.COLOR_STROKE)}}]}})}get blinkTypeLayout(){var t;return null!==(t=this._blinkTypeLayout)&&void 0!==t?t:this._blinkTypeLayout=this.newLabeled(null,this.blinkType)}onChangeBlinkTypeLayout(e){const n=this.blinkTypeLayout;e===t.EShapeActionValueType.BLINK?n.show():n.hide()}get transformType(){var t;return null!==(t=this._transformType)&&void 0!==t?t:this._transformType=this.newTransformType()}newTransformType(){const e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueTransformType.MOVE,menu:{items:[{value:t.EShapeActionValueTransformType.MOVE,text:{value:e.toTransformTypeLabel(t.EShapeActionValueTransformType.MOVE)}},{value:t.EShapeActionValueTransformType.ROTATE,text:{value:e.toTransformTypeLabel(t.EShapeActionValueTransformType.ROTATE)}},{value:t.EShapeActionValueTransformType.RESIZE,text:{value:e.toTransformTypeLabel(t.EShapeActionValueTransformType.RESIZE)}}]}})}get transformTypeLayout(){var t;return null!==(t=this._transformTypeLayout)&&void 0!==t?t:this._transformTypeLayout=this.newLabeled(null,this.transformType)}onChangeTransformTypeLayout(e){const n=this.transformTypeLayout;e===t.EShapeActionValueType.TRANSFORM?n.show():n.hide()}get changeColorType(){var t;return null!==(t=this._changeColorType)&&void 0!==t?t:this._changeColorType=this.newChangeColorType()}newChangeColorType(){const e=this.themeShape;return new t.DSelectMultiple({weight:1,values:[t.EShapeActionValueChangeColorType.FILL],menu:{items:[{value:t.EShapeActionValueChangeColorType.FILL,text:{value:e.toChangeColorTypeLabel(t.EShapeActionValueChangeColorType.FILL)},check:!0},{value:t.EShapeActionValueChangeColorType.STROKE,text:{value:e.toChangeColorTypeLabel(t.EShapeActionValueChangeColorType.STROKE)},check:!0},{value:t.EShapeActionValueChangeColorType.TEXT,text:{value:e.toChangeColorTypeLabel(t.EShapeActionValueChangeColorType.TEXT)},check:!0},{value:t.EShapeActionValueChangeColorType.TEXT_OUTLINE,text:{value:e.toChangeColorTypeLabel(t.EShapeActionValueChangeColorType.TEXT_OUTLINE)},check:!0}]}})}get changeColorTypeLayout(){var t;return null!==(t=this._changeColorTypeLayout)&&void 0!==t?t:this._changeColorTypeLayout=this.newLabeled(null,this.changeColorType)}onChangeChangeColorTypeLayout(e){const n=this.changeColorTypeLayout;e===t.EShapeActionValueType.CHANGE_COLOR?n.show():n.hide()}get changeColorTarget(){var t;return null!==(t=this._changeColorTarget)&&void 0!==t?t:this._changeColorTarget=this.newChangeColorTarget()}newChangeColorTarget(){const e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA,menu:{items:[{value:t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA,text:{value:e.toChangeColorTargetLabel(t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA)}},{value:t.EShapeActionValueChangeColorTarget.COLOR,text:{value:e.toChangeColorTargetLabel(t.EShapeActionValueChangeColorTarget.COLOR)}},{value:t.EShapeActionValueChangeColorTarget.ALPHA,text:{value:e.toChangeColorTargetLabel(t.EShapeActionValueChangeColorTarget.ALPHA)}},{value:t.EShapeActionValueChangeColorTarget.CODE,text:{value:e.toChangeColorTargetLabel(t.EShapeActionValueChangeColorTarget.CODE)}},{value:t.EShapeActionValueChangeColorTarget.BRIGHTNESS,text:{value:e.toChangeColorTargetLabel(t.EShapeActionValueChangeColorTarget.BRIGHTNESS)}}]}})}get changeColorTargetLayout(){var t;return null!==(t=this._changeColorTargetLayout)&&void 0!==t?t:this._changeColorTargetLayout=this.newLabeled(null,this.changeColorTarget)}onChangeChangeColorTargetLayout(e){const n=this.changeColorTargetLayout;e===t.EShapeActionValueType.CHANGE_COLOR?n.show():n.hide()}get rotateType(){var t;return null!==(t=this._rotateType)&&void 0!==t?t:this._rotateType=this.newRotateType()}newRotateType(){const e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueTransformRotateType.RELATIVE,menu:{items:[{value:t.EShapeActionValueTransformRotateType.RELATIVE,text:{value:e.toTransformRotateTypeLabel(t.EShapeActionValueTransformRotateType.RELATIVE)}},{value:t.EShapeActionValueTransformRotateType.ABSOLUTE,text:{value:e.toTransformRotateTypeLabel(t.EShapeActionValueTransformRotateType.ABSOLUTE)}}]}})}get rotateTypeLayout(){var t;return null!==(t=this._rotateTypeLayout)&&void 0!==t?t:this._rotateTypeLayout=this.newLabeled(null,this.rotateType)}onChangeRotateTypeLayout(e){const n=this.rotateTypeLayout;e===t.EShapeActionValueType.TRANSFORM&&this.transformType.value===t.EShapeActionValueTransformType.ROTATE?n.show():n.hide()}get resizeType(){var t;return null!==(t=this._resizeType)&&void 0!==t?t:this._resizeType=this.newResizeType()}newResizeType(){const e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueTransformResizeType.RELATIVE_SIZE,menu:{items:[{value:t.EShapeActionValueTransformResizeType.ABSOLUTE_SIZE,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.ABSOLUTE_SIZE)}},{value:t.EShapeActionValueTransformResizeType.RELATIVE_SIZE,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.RELATIVE_SIZE)}},{value:t.EShapeActionValueTransformResizeType.ABSOLUTE_HEIGHT,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.ABSOLUTE_HEIGHT)}},{value:t.EShapeActionValueTransformResizeType.RELATIVE_HEIGHT,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.RELATIVE_HEIGHT)}},{value:t.EShapeActionValueTransformResizeType.ABSOLUTE_WIDTH,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.ABSOLUTE_WIDTH)}},{value:t.EShapeActionValueTransformResizeType.RELATIVE_WIDTH,text:{value:e.toTransformResizeTypeLabel(t.EShapeActionValueTransformResizeType.RELATIVE_WIDTH)}}]}})}get resizeTypeLayout(){var t;return null!==(t=this._resizeTypeLayout)&&void 0!==t?t:this._resizeTypeLayout=this.newLabeled(null,this.resizeType)}onChangeResizeTypeLayout(e){const n=this.resizeTypeLayout;e===t.EShapeActionValueType.TRANSFORM&&this.transformType.value===t.EShapeActionValueTransformType.RESIZE?n.show():n.hide()}get originX(){var t;return null!==(t=this._originX)&&void 0!==t?t:this._originX=this.newOriginX()}newOriginX(){return new t.DInputReal({weight:1,text:{value:.5},step:.1,on:{enter:()=>{this.ok()}}})}get originXLayout(){var t;return null!==(t=this._originXLayout)&&void 0!==t?t:this._originXLayout=this.newLabeled(this.theme.getInputOriginXLabel(),this.originX)}onChangeOriginXLayout(e){const n=this.originXLayout;if(e===t.EShapeActionValueType.TRANSFORM){const e=this.transformType.value;if(e===t.EShapeActionValueTransformType.RESIZE){const e=this.resizeType.value;e===t.EShapeActionValueTransformResizeType.ABSOLUTE_SIZE||e===t.EShapeActionValueTransformResizeType.RELATIVE_SIZE||e===t.EShapeActionValueTransformResizeType.ABSOLUTE_WIDTH||e===t.EShapeActionValueTransformResizeType.RELATIVE_WIDTH?n.show():n.hide()}else e===t.EShapeActionValueTransformType.ROTATE?n.show():n.hide()}else n.hide()}get originY(){var t;return null!==(t=this._originY)&&void 0!==t?t:this._originY=this.newOriginY()}newOriginY(){return new t.DInputReal({weight:1,text:{value:.5},step:.1,on:{enter:()=>{this.ok()}}})}get originYLayout(){var t;return null!==(t=this._originYLayout)&&void 0!==t?t:this._originYLayout=this.newLabeled(this.theme.getInputOriginYLabel(),this.originY)}onChangeOriginYLayout(e){const n=this.originYLayout;if(e===t.EShapeActionValueType.TRANSFORM){const e=this.transformType.value;if(e===t.EShapeActionValueTransformType.RESIZE){const e=this.resizeType.value;e===t.EShapeActionValueTransformResizeType.ABSOLUTE_SIZE||e===t.EShapeActionValueTransformResizeType.RELATIVE_SIZE||e===t.EShapeActionValueTransformResizeType.ABSOLUTE_HEIGHT||e===t.EShapeActionValueTransformResizeType.RELATIVE_HEIGHT?n.show():n.hide()}else e===t.EShapeActionValueTransformType.ROTATE?n.show():n.hide()}else n.hide()}get moveType(){var t;return null!==(t=this._moveType)&&void 0!==t?t:this._moveType=this.newMoveType()}newMoveType(){const e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueTransformMoveType.RELATIVE_X,menu:{items:[{value:t.EShapeActionValueTransformMoveType.RELATIVE_X,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.RELATIVE_X)}},{value:t.EShapeActionValueTransformMoveType.RELATIVE_Y,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.RELATIVE_Y)}},{value:t.EShapeActionValueTransformMoveType.ABSOLUTE_X,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.ABSOLUTE_X)}},{value:t.EShapeActionValueTransformMoveType.ABSOLUTE_Y,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.ABSOLUTE_Y)}},{value:t.EShapeActionValueTransformMoveType.FORWARD_OR_BACKWARD,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.FORWARD_OR_BACKWARD)}},{value:t.EShapeActionValueTransformMoveType.LEFT_OR_RIGHT,text:{value:e.toTransformMoveTypeLabel(t.EShapeActionValueTransformMoveType.LEFT_OR_RIGHT)}}]}})}get moveTypeLayout(){var t;return null!==(t=this._moveTypeLayout)&&void 0!==t?t:this._moveTypeLayout=this.newLabeled(null,this.moveType)}onChangeMoveTypeLayout(e){const n=this.moveTypeLayout;e===t.EShapeActionValueType.TRANSFORM&&this.transformType.value===t.EShapeActionValueTransformType.MOVE?n.show():n.hide()}get openType(){var t;return null!==(t=this._openType)&&void 0!==t?t:this._openType=this.newOpenType()}newOpenType(){return new t.DSelect({weight:1,value:t.EShapeActionValueOpenType.DIAGRAM,menu:{items:this.newOpenTypeMenuItems()}})}newOpenTypeMenuItems(){const e=this.themeShape,n=[{value:t.EShapeActionValueOpenType.DIAGRAM,text:{value:e.toOpenTypeLabel(t.EShapeActionValueOpenType.DIAGRAM)}},{value:t.EShapeActionValueOpenType.PAGE,text:{value:e.toOpenTypeLabel(t.EShapeActionValueOpenType.PAGE)}},{value:t.EShapeActionValueOpenType.DIALOG,text:{value:e.toOpenTypeLabel(t.EShapeActionValueOpenType.DIALOG)}}];return t.EShapeActionOpenExtensions.each((t=>{n.push({value:t.type,text:{value:t.label}})})),n}get openTypeLayout(){var t;return null!==(t=this._openTypeLayout)&&void 0!==t?t:this._openTypeLayout=this.newLabeled(null,this.openType)}onChangeOpenTypeLayout(e){const n=this.openTypeLayout;e===t.EShapeActionValueType.OPEN?n.show():n.hide()}get openDialogType(){var t;return null!==(t=this._openDialogType)&&void 0!==t?t:this._openDialogType=this.newOpenDialogType()}newOpenDialogType(){return new t.DSelect({weight:1,value:t.EShapeActionValueOpenDialogType.TEXT,menu:{items:this.newOpenDialogTypeMenuItems()}})}newOpenDialogTypeMenuItems(){const e=this.themeShape,n=[{value:t.EShapeActionValueOpenDialogType.TEXT,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.TEXT)}},{value:t.EShapeActionValueOpenDialogType.INTEGER,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.INTEGER)}},{value:t.EShapeActionValueOpenDialogType.REAL,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.REAL)}},{value:t.EShapeActionValueOpenDialogType.BOOLEAN,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.BOOLEAN)}},{value:t.EShapeActionValueOpenDialogType.DATE,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.DATE)}},{value:t.EShapeActionValueOpenDialogType.TIME,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.TIME)}},{value:t.EShapeActionValueOpenDialogType.DATETIME,text:{value:e.toOpenDialogTypeLabel(t.EShapeActionValueOpenDialogType.DATETIME)}}];return t.EShapeActionOpenDialogExtensions.each((t=>{n.push({value:t.type,text:{value:t.label}})})),n}get openDialogTypeLayout(){var t;return null!==(t=this._openDialogTypeLayout)&&void 0!==t?t:this._openDialogTypeLayout=this.newLabeled(null,this.openDialogType)}onChangeOpenDialogTypeLayout(e){const n=this.openDialogTypeLayout;e===t.EShapeActionValueType.OPEN&&this.openType.value===t.EShapeActionValueOpenType.DIALOG?n.show():n.hide()}get changeTextType(){var t;return null!==(t=this._changeTextType)&&void 0!==t?t:this._changeTextType=this.newChangeTextType()}newChangeTextType(){const e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueChangeTextType.TEXT,menu:{items:[{value:t.EShapeActionValueChangeTextType.TEXT,text:{value:e.toChangeTextTypeLabel(t.EShapeActionValueChangeTextType.TEXT)}},{value:t.EShapeActionValueChangeTextType.NUMBER,text:{value:e.toChangeTextTypeLabel(t.EShapeActionValueChangeTextType.NUMBER)}}]}})}get changeTextTypeLayout(){var t;return null!==(t=this._changeTextTypeLayout)&&void 0!==t?t:this._changeTextTypeLayout=this.newLabeled(null,this.changeTextType)}onChangeChangeTextTypeLayout(e){const n=this.changeTextTypeLayout;e===t.EShapeActionValueType.CHANGE_TEXT?n.show():n.hide()}get miscType(){var t;return null!==(t=this._miscType)&&void 0!==t?t:this._miscType=this.newMiscType()}newMiscType(){return new t.DSelect({weight:1,value:t.EShapeActionValueMiscType.INPUT_TEXT,menu:{items:this.newMiscTypeMenuItems()}})}newMiscTypeMenuItems(){const e=this.themeShape,n=[{value:t.EShapeActionValueMiscType.INPUT_TEXT,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.INPUT_TEXT)}},{value:t.EShapeActionValueMiscType.INPUT_INTEGER,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.INPUT_INTEGER)}},{value:t.EShapeActionValueMiscType.INPUT_REAL,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.INPUT_REAL)}},{value:t.EShapeActionValueMiscType.EMIT_EVENT,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.EMIT_EVENT)}},{value:t.EShapeActionValueMiscType.WRITE_BOTH,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.WRITE_BOTH)}},{value:t.EShapeActionValueMiscType.WRITE_LOCAL,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.WRITE_LOCAL)}},{value:t.EShapeActionValueMiscType.WRITE_REMOTE,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.WRITE_REMOTE)}},{value:t.EShapeActionValueMiscType.HTML_ELEMENT,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.HTML_ELEMENT)}},{value:t.EShapeActionValueMiscType.EXECUTE,text:{value:e.toMiscTypeLabel(t.EShapeActionValueMiscType.EXECUTE)}}];return t.EShapeActionMiscExtensions.each((t=>{n.push({value:t.type,text:{value:t.label}})})),n}get miscTypeLayout(){var t;return null!==(t=this._miscTypeLayout)&&void 0!==t?t:this._miscTypeLayout=this.newLabeled(null,this.miscType)}onChangeMiscTypeLayout(e){const n=this.miscTypeLayout;e===t.EShapeActionValueType.MISC?n.show():n.hide()}get onInputAction(){var t;return null!==(t=this._onInputAction)&&void 0!==t?t:this._onInputAction=this.newOnInputAction()}newOnInputAction(){const e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueOnInputAction.WRITE_REMOTE,menu:{items:[{value:t.EShapeActionValueOnInputAction.EMIT_EVENT,text:{value:e.toOnInputActionLabel(t.EShapeActionValueOnInputAction.EMIT_EVENT)}},{value:t.EShapeActionValueOnInputAction.WRITE_BOTH,text:{value:e.toOnInputActionLabel(t.EShapeActionValueOnInputAction.WRITE_BOTH)}},{value:t.EShapeActionValueOnInputAction.WRITE_LOCAL,text:{value:e.toOnInputActionLabel(t.EShapeActionValueOnInputAction.WRITE_LOCAL)}},{value:t.EShapeActionValueOnInputAction.WRITE_REMOTE,text:{value:e.toOnInputActionLabel(t.EShapeActionValueOnInputAction.WRITE_REMOTE)}}]}})}get onInputActionLayout(){var t;return null!==(t=this._onInputActionLayout)&&void 0!==t?t:this._onInputActionLayout=this.newLabeled(null,this.onInputAction)}onChangeOnInputActionLayout(e){const n=this.onInputActionLayout;if(e===t.EShapeActionValueType.OPEN)switch(this.openType.value){case t.EShapeActionValueOpenType.DIALOG_TEXT:case t.EShapeActionValueOpenType.DIALOG_INTEGER:case t.EShapeActionValueOpenType.DIALOG_REAL:case t.EShapeActionValueOpenType.DIALOG_BOOLEAN:n.show();break;case t.EShapeActionValueOpenType.DIALOG:const e=this.openDialogType.value;null==e||t.EShapeActionValueOpenDialogType.EXTENSION<=e?n.hide():n.show();break;default:n.hide()}else if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.INPUT_TEXT:case t.EShapeActionValueMiscType.INPUT_INTEGER:case t.EShapeActionValueMiscType.INPUT_REAL:n.show();break;default:n.hide()}else n.hide()}get whenType(){var t;return null!==(t=this._whenType)&&void 0!==t?t:this._whenType=this.newWhenType()}newWhenType(){const e=this.themeShape;return new t.DSelect({weight:1,value:t.UtilHtmlElementWhen.FOCUSED,menu:{items:[{value:t.UtilHtmlElementWhen.CLICKED,text:{value:e.toHtmlElementWhenLabel(t.UtilHtmlElementWhen.CLICKED)}},{value:t.UtilHtmlElementWhen.DOUBLE_CLICKED,text:{value:e.toHtmlElementWhenLabel(t.UtilHtmlElementWhen.DOUBLE_CLICKED)}},{value:t.UtilHtmlElementWhen.FOCUSED,text:{value:e.toHtmlElementWhenLabel(t.UtilHtmlElementWhen.FOCUSED)}},{value:t.UtilHtmlElementWhen.ALWAYS,text:{value:e.toHtmlElementWhenLabel(t.UtilHtmlElementWhen.ALWAYS)}}]}})}get whenTypeLayout(){var t;return null!==(t=this._whenTypeLayout)&&void 0!==t?t:this._whenTypeLayout=this.newLabeled(this.theme.getSelectWhenLabel(),this.whenType)}toWhenTypeValue(e){switch(e){case t.UtilHtmlElementWhen.CLICKED:return'"CLICKED"';case t.UtilHtmlElementWhen.DOUBLE_CLICKED:return'"DOUBLE_CLICKED"';case t.UtilHtmlElementWhen.FOCUSED:return'"FOCUSED"';case t.UtilHtmlElementWhen.ALWAYS:return'"ALWAYS"'}return'"FOCUSED"'}toWhenType(e){switch(e){case'"CLICKED"':return t.UtilHtmlElementWhen.CLICKED;case'"DOUBLE_CLICKED"':return t.UtilHtmlElementWhen.DOUBLE_CLICKED;case'"FOCUSED"':return t.UtilHtmlElementWhen.FOCUSED;case'"ALWAYS"':return t.UtilHtmlElementWhen.ALWAYS}return t.UtilHtmlElementWhen.FOCUSED}onChangeWhenTypeLayout(e){const n=this.whenTypeLayout;if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.INPUT_TEXT:case t.EShapeActionValueMiscType.INPUT_INTEGER:case t.EShapeActionValueMiscType.INPUT_REAL:case t.EShapeActionValueMiscType.HTML_ELEMENT:case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:n.show();break;default:n.hide()}else n.hide()}get gestureType(){var t;return null!==(t=this._gestureType)&&void 0!==t?t:this._gestureType=this.newGestureType()}newGestureType(){const e=this.themeShape;return new t.DSelect({weight:1,value:t.EShapeActionValueGestureType.SHAPE,menu:{items:[{value:t.EShapeActionValueGestureType.SHAPE,text:{value:e.toGestureTypeLabel(t.EShapeActionValueGestureType.SHAPE)}},{value:t.EShapeActionValueGestureType.LAYER,text:{value:e.toGestureTypeLabel(t.EShapeActionValueGestureType.LAYER)}}]}})}get gestureTypeLayout(){var t;return null!==(t=this._gestureTypeLayout)&&void 0!==t?t:this._gestureTypeLayout=this.newLabeled("",this.gestureType)}onChangeGestureTypeLayout(e){const n=this.gestureTypeLayout;e===t.EShapeActionValueType.GESTURE?n.show():n.hide()}get gestureOperationType(){var t;return null!==(t=this._gestureOperationType)&&void 0!==t?t:this._gestureOperationType=this.newGestureOperationType()}newGestureOperationType(){const e=this.themeShape;return new t.DSelectMultiple({weight:1,values:this.fromGestureOperationType(t.EShapeActionValueGestureOperationType.ALL),menu:{items:[{value:t.EShapeActionValueGestureOperationType.DRAG,text:{value:e.toGestureOperationTypeLabel(t.EShapeActionValueGestureOperationType.DRAG)},check:!0},{value:t.EShapeActionValueGestureOperationType.PINCH,text:{value:e.toGestureOperationTypeLabel(t.EShapeActionValueGestureOperationType.PINCH)},check:!0}]}})}toGestureOperationType(e){let n=t.EShapeActionValueGestureOperationType.NONE;for(let t=0,i=e.length;t<i;++t)n|=e[t];return n}fromGestureOperationType(e){const n=[];return e&t.EShapeActionValueGestureOperationType.DRAG&&n.push(t.EShapeActionValueGestureOperationType.DRAG),e&t.EShapeActionValueGestureOperationType.PINCH&&n.push(t.EShapeActionValueGestureOperationType.PINCH),n}get gestureOperationTypeLayout(){var t;return null!==(t=this._gestureOperationTypeLayout)&&void 0!==t?t:this._gestureOperationTypeLayout=this.newLabeled("",this.gestureOperationType)}onChangeGestureOperationTypeLayout(e){const n=this.gestureOperationTypeLayout;e===t.EShapeActionValueType.GESTURE?n.show():n.hide()}get selectLayer(){var t;return null!==(t=this._selectLayer)&&void 0!==t?t:this._selectLayer=this.newSelectLayer()}newSelectLayer(){return new t.DSelectMultiple({weight:1})}newSelectLayerMenuItemOptions(){var t;const e=null===(t=this.options)||void 0===t?void 0:t.diagram;if(null!=e){const t=e.canvas;if(null!=t){const e=[],n=t.layer.children;for(let t=n.length-1;0<=t;--t){const i=n[t];e.push({value:t,text:{value:i.name},check:!0})}return e}}return[]}get selectLayerLayout(){var t;return null!==(t=this._selectLayerLayout)&&void 0!==t?t:this._selectLayerLayout=this.newLabeled(this.theme.getSelectLayerLabel(),this.selectLayer)}onChangeSelectLayerLayout(e){const n=this.selectLayerLayout;e===t.EShapeActionValueType.SHOW_HIDE&&this.showHideType.value===t.EShapeActionValueShowHideType.LAYER?n.show():n.hide()}get condition(){var t;return null!==(t=this._condition)&&void 0!==t?t:this._condition=this.newCondition()}newCondition(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputConditionLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeCondition(e){const n=this.condition;if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.INPUT_TEXT:case t.EShapeActionValueMiscType.INPUT_INTEGER:case t.EShapeActionValueMiscType.INPUT_REAL:case t.EShapeActionValueMiscType.HTML_ELEMENT:case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:n.hide();break;default:n.show()}else n.show()}get interval(){var t;return null!==(t=this._interval)&&void 0!==t?t:this._interval=this.newInterval()}newInterval(){return new t.DInputInteger({weight:1,text:{value:1e3},min:0,step:100,on:{enter:()=>{this.ok()}}})}get intervalLayout(){var t;return null!==(t=this._intervalLayout)&&void 0!==t?t:this._intervalLayout=this.newIntervalLayout()}newIntervalLayout(){const e=this.theme;return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabel(e.getInputIntervalLabel()),this.interval,new t.DText({width:60,text:{value:e.getInputIntervalUnitLabel(),align:{horizontal:t.DAlignHorizontal.LEFT}}})]})}onChangeIntervalLayout(e){const n=this.intervalLayout;e===t.EShapeActionValueType.BLINK?n.show():n.hide()}get size(){var t;return null!==(t=this._size)&&void 0!==t?t:this._size=this.newSize()}newSize(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputSizeLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeSize(e){const n=this.size;e===t.EShapeActionValueType.TRANSFORM&&this.transformType.value===t.EShapeActionValueTransformType.RESIZE?n.show():n.hide()}get amount(){var t;return null!==(t=this._amount)&&void 0!==t?t:this._amount=this.newAmount()}newAmount(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputAmountLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeAmount(e){const n=this.amount;if(e===t.EShapeActionValueType.TRANSFORM){const e=this.transformType.value;e===t.EShapeActionValueTransformType.MOVE||e===t.EShapeActionValueTransformType.ROTATE?n.show():n.hide()}else n.hide()}get contents(){var t;return null!==(t=this._contents)&&void 0!==t?t:this._contents=this.newContents()}newContents(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputValueLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeContents(e){const n=this.contents;if(e===t.EShapeActionValueType.CHANGE_TEXT)n.show();else if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.WRITE_BOTH:case t.EShapeActionValueMiscType.WRITE_LOCAL:case t.EShapeActionValueMiscType.WRITE_REMOTE:n.show();break;default:n.hide()}else n.hide()}get initialization(){var t;return null!==(t=this._initialization)&&void 0!==t?t:this._initialization=this.newInitialization()}newInitialization(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputInitializationLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeInitialization(e){const n=this.initialization;if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.HTML_ELEMENT:case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:n.show();break;default:n.hide()}else n.hide()}get pointerEventsLayout(){var t;return null!==(t=this._pointerEventsLayout)&&void 0!==t?t:this._pointerEventsLayout=this.newLabeled(null,this.pointerEvents)}onChangePointerEventsLayout(e){const n=this.pointerEventsLayout;if(e===t.EShapeActionValueType.MISC)switch(this.miscType.value){case t.EShapeActionValueMiscType.HTML_ELEMENT:case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:n.show();break;default:n.hide()}else n.hide()}get pointerEvents(){var t;return null!==(t=this._pointerEvents)&&void 0!==t?t:this._pointerEvents=this.newPointerEvents()}newPointerEvents(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckPointEventsLabel(),align:{horizontal:"LEFT"}}})}get targetName(){var t;return null!==(t=this._targetName)&&void 0!==t?t:this._targetName=this.newTargetName()}newTargetName(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputTargetNameLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeTargetName(e){const n=this.targetName;e===t.EShapeActionValueType.EMIT_EVENT||e===t.EShapeActionValueType.CHANGE_CURSOR?n.show():n.hide()}get color(){var t;return null!==(t=this._color)&&void 0!==t?t:this._color=this.newColor()}newColor(){const e=new t.DButtonColor({weight:1});return e.dialog.on("open",(()=>{const t=e.dialog.new,n=e.dialog.current;t.color=n.color,t.alpha=n.alpha})),e}get colorLayout(){var t;return null!==(t=this._colorLayout)&&void 0!==t?t:this._colorLayout=this.newColorLayout()}newColorLayout(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getButtonColorLabel()}}),this.color,new t.DLayoutSpace({width:60})]})}onChangeColorLayout(e){const n=this.colorLayout;if(e===t.EShapeActionValueType.CHANGE_COLOR){const e=this.changeColorTarget.value;e===t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA||e===t.EShapeActionValueChangeColorTarget.COLOR||e===t.EShapeActionValueChangeColorTarget.ALPHA?n.show():n.hide()}else if(e===t.EShapeActionValueType.BLINK){const e=this.blinkType.value;e===t.EShapeActionValueBlinkType.COLOR_FILL||e===t.EShapeActionValueBlinkType.COLOR_STROKE?n.show():n.hide()}else n.hide()}get target(){var t;return null!==(t=this._target)&&void 0!==t?t:this._target=this.newTarget()}newTarget(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputTargetLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeTarget(e){const n=this.target;if(e===t.EShapeActionValueType.OPEN)n.show();else if(e===t.EShapeActionValueType.MISC){const e=this.miscType.value;null==e?n.show():e===t.EShapeActionValueMiscType.HTML_ELEMENT||e===t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS||t.EShapeActionValueMiscType.EXTENSION<=e?n.hide():n.show()}else n.hide()}get argument(){var t;return null!==(t=this._argument)&&void 0!==t?t:this._argument=this.newArgument()}newArgument(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputArgumentLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeArgument(e){const n=this.argument;if(e===t.EShapeActionValueType.OPEN)if(this.openType.value===t.EShapeActionValueOpenType.DIALOG){const e=this.openDialogType.value;null==e?n.hide():t.EShapeActionValueOpenDialogType.EXTENSION<=e?n.show():n.hide()}else n.hide();else if(e===t.EShapeActionValueType.MISC){const e=this.miscType.value;null!=e&&t.EShapeActionValueMiscType.EXTENSION<=e?n.show():n.hide()}else n.hide()}get colorCode(){var t;return null!==(t=this._colorCode)&&void 0!==t?t:this._colorCode=this.newColorCode()}newColorCode(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputColorCodeLabel()}},input:{weight:1,text:{value:""},on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeColorCode(e){const n=this.colorCode;e===t.EShapeActionValueType.CHANGE_COLOR&&this.changeColorTarget.value===t.EShapeActionValueChangeColorTarget.CODE?n.show():n.hide()}get alphaCode(){var t;return null!==(t=this._alphaCode)&&void 0!==t?t:this._alphaCode=this.newAlphaCode()}newAlphaCode(){return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,on:{enter:()=>{this.ok()}}},label:{width:60,text:{value:this.theme.getInputAlphaCodeLabel()}},space:{width:60}})}onChangeAlphaCode(e){const n=this.alphaCode;e===t.EShapeActionValueType.CHANGE_COLOR&&this.changeColorTarget.value===t.EShapeActionValueChangeColorTarget.CODE?n.show():n.hide()}get brightness(){var t;return null!==(t=this._brightness)&&void 0!==t?t:this._brightness=this.newBrightness()}newBrightness(){return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,on:{enter:()=>{this.ok()}}},label:{width:60,text:{value:this.theme.getInputBrightnessLabel()}},space:{width:60}})}onChangeBrightness(e){const n=this.brightness;e===t.EShapeActionValueType.CHANGE_COLOR&&this.changeColorTarget.value===t.EShapeActionValueChangeColorTarget.BRIGHTNESS?n.show():n.hide()}get blend(){var t;return null!==(t=this._blend)&&void 0!==t?t:this._blend=this.newBlend()}newBlend(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputBlendLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeBlend(e){const n=this.blend;if(e===t.EShapeActionValueType.CHANGE_COLOR){const e=this.changeColorTarget.value;e===t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA||e===t.EShapeActionValueChangeColorTarget.COLOR||e===t.EShapeActionValueChangeColorTarget.ALPHA||e===t.EShapeActionValueChangeColorTarget.CODE?n.show():n.hide()}else n.hide()}get initial(){var t;return null!==(t=this._initial)&&void 0!==t?t:this._initial=this.newInitial()}newInitial(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputInitialLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeInitial(e){const n=this.initial;if(e===t.EShapeActionValueType.OPEN)if(this.openType.value===t.EShapeActionValueOpenType.DIALOG)switch(this.openDialogType.value){case t.EShapeActionValueOpenDialogType.TEXT:case t.EShapeActionValueOpenDialogType.INTEGER:case t.EShapeActionValueOpenDialogType.REAL:case t.EShapeActionValueOpenDialogType.BOOLEAN:case t.EShapeActionValueOpenDialogType.DATE:case t.EShapeActionValueOpenDialogType.TIME:case t.EShapeActionValueOpenDialogType.DATETIME:n.show();break;default:n.hide()}else n.hide();else n.hide()}get step(){var t;return null!==(t=this._step)&&void 0!==t?t:this._step=this.newStep()}newStep(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputStepLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeStep(e){const n=this.step;if(e===t.EShapeActionValueType.OPEN)if(this.openType.value===t.EShapeActionValueOpenType.DIALOG)switch(this.openDialogType.value){case t.EShapeActionValueOpenDialogType.INTEGER:case t.EShapeActionValueOpenDialogType.REAL:n.show();break;default:n.hide()}else n.hide();else n.hide()}get min(){var t;return null!==(t=this._min)&&void 0!==t?t:this._min=this.newMin()}newMin(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputMinLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeMin(e){const n=this.min;if(e===t.EShapeActionValueType.OPEN)if(this.openType.value===t.EShapeActionValueOpenType.DIALOG)switch(this.openDialogType.value){case t.EShapeActionValueOpenDialogType.INTEGER:case t.EShapeActionValueOpenDialogType.REAL:n.show();break;default:n.hide()}else n.hide();else n.hide()}get max(){var t;return null!==(t=this._max)&&void 0!==t?t:this._max=this.newMax()}newMax(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputMaxLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}onChangeMax(e){const n=this.max;if(e===t.EShapeActionValueType.OPEN)if(this.openType.value===t.EShapeActionValueOpenType.DIALOG)switch(this.openDialogType.value){case t.EShapeActionValueOpenDialogType.INTEGER:case t.EShapeActionValueOpenDialogType.REAL:n.show();break;default:n.hide()}else n.hide();else n.hide()}get scaleLayout(){var t;return null!==(t=this._scaleLayout)&&void 0!==t?t:this._scaleLayout=this.newScaleLayout()}newScaleLayout(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getInputScaleLabel()}}),this.scaleMin,this.scaleMax,new t.DLayoutSpace({width:60})]})}onChangeScaleLayout(e){const n=this.scaleLayout;e===t.EShapeActionValueType.GESTURE?n.show():n.hide()}get scaleMin(){var t;return null!==(t=this._scaleMin)&&void 0!==t?t:this._scaleMin=this.newScaleMin()}newScaleMin(){return new t.DInputReal({weight:1,on:{enter:()=>{this.ok()}}})}get scaleMax(){var t;return null!==(t=this._scaleMax)&&void 0!==t?t:this._scaleMax=this.newScaleMax()}newScaleMax(){return new t.DInputReal({weight:1,on:{enter:()=>{this.ok()}}})}get checkBringToFront(){var t;return null!==(t=this._checkBringToFront)&&void 0!==t?t:this._checkBringToFront=this.newCheckBringToFront()}newCheckBringToFront(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckBringToFrontLabel(),align:{horizontal:"LEFT"}}})}get checkBringToFrontLayout(){var t;return null!==(t=this._checkBringToFrontLayout)&&void 0!==t?t:this._checkBringToFrontLayout=this.newLabeled(null,this.checkBringToFront)}onChangeCheckBringToFrontLayout(e){const n=this.checkBringToFrontLayout;e===t.EShapeActionValueType.SHOW_HIDE&&this.showHideType.value===t.EShapeActionValueShowHideType.LAYER?n.show():n.hide()}get inNewWindow(){var t;return null!==(t=this._inNewWindow)&&void 0!==t?t:this._inNewWindow=this.newInNewWindow()}newInNewWindow(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckInNewWindowLabel(),align:{horizontal:"LEFT"}}})}get inNewWindowLayout(){var t;return null!==(t=this._inNewWindowLayout)&&void 0!==t?t:this._inNewWindowLayout=this.newLabeled(null,this.inNewWindow)}onChangeInNewWindowLayout(e){const n=this.inNewWindowLayout;e===t.EShapeActionValueType.OPEN?this.openType.value===t.EShapeActionValueOpenType.DIALOG?n.hide():n.show():n.hide()}get extension(){var t;return null!==(t=this._extension)&&void 0!==t?t:this._extension=new Ve(this,this.condition,this.content)}onChange(){const t=this.select.value;this.onChangeAlphaCode(t),this.onChangeAmount(t),this.onChangeBlend(t),this.onChangeBlinkTypeLayout(t),this.onChangeBrightness(t),this.onChangeChangeColorTargetLayout(t),this.onChangeChangeColorTypeLayout(t),this.onChangeChangeTextTypeLayout(t),this.onChangeCondition(t),this.onChangeColorCode(t),this.onChangeColorLayout(t),this.onChangeInitial(t),this.onChangeStep(t),this.onChangeMin(t),this.onChangeMax(t),this.onChangeIntervalLayout(t),this.onChangeMiscTypeLayout(t),this.onChangeMoveTypeLayout(t),this.onChangeOnInputActionLayout(t),this.onChangeWhenTypeLayout(t),this.onChangeGestureTypeLayout(t),this.onChangeGestureOperationTypeLayout(t),this.onChangeSelectLayerLayout(t),this.onChangeOpenTypeLayout(t),this.onChangeOpenDialogTypeLayout(t),this.onChangeOriginXLayout(t),this.onChangeOriginYLayout(t),this.onChangeResizeTypeLayout(t),this.onChangeRotateTypeLayout(t),this.onChangeShowHideTypeLayout(t),this.onChangeSize(t),this.onChangeTarget(t),this.onChangeArgument(t),this.onChangeTargetName(t),this.onChangeContents(t),this.onChangeInitialization(t),this.onChangePointerEventsLayout(t),this.onChangeTransformTypeLayout(t),this.onChangeScaleLayout(t),this.onChangeCheckBringToFrontLayout(t),this.onChangeInNewWindowLayout(t),this.extension.onChange(t)}reset(){return this.select.value=t.EShapeActionValueType.SHOW_HIDE,this.showHideType.value=t.EShapeActionValueShowHideType.SHAPE,this.blinkType.value=t.EShapeActionValueBlinkType.VISIBILITY,this.transformType.value=t.EShapeActionValueTransformType.MOVE,this.changeColorType.values=[t.EShapeActionValueChangeColorType.FILL],this.changeColorTarget.value=t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA,this.resizeType.value=t.EShapeActionValueTransformResizeType.RELATIVE_SIZE,this.originY.value=.5,this.originX.value=.5,this.moveType.value=t.EShapeActionValueTransformMoveType.RELATIVE_X,this.rotateType.value=t.EShapeActionValueTransformRotateType.RELATIVE,this.openType.value=t.EShapeActionValueOpenType.DIAGRAM,this.openDialogType.value=t.EShapeActionValueOpenDialogType.TEXT,this.changeTextType.value=t.EShapeActionValueChangeTextType.TEXT,this.miscType.value=t.EShapeActionValueMiscType.INPUT_TEXT,this.onInputAction.value=t.EShapeActionValueOnInputAction.WRITE_REMOTE,this.whenType.value=t.UtilHtmlElementWhen.FOCUSED,this.gestureType.value=t.EShapeActionValueGestureType.SHAPE,this.gestureOperationType.values=this.fromGestureOperationType(t.EShapeActionValueGestureOperationType.ALL),this.selectLayer.values=[],this.selectLayer.menu=new t.DMenu({fit:!0,items:this.newSelectLayerMenuItemOptions()}),this.condition.input.value="",this.size.input.value="",this.amount.input.value="",this.contents.input.value="",this.initialization.input.value="",this.pointerEvents.state.isActive=!0,this.targetName.input.value="",this.interval.value=1e3,this.color.value.color=16777215,this.color.value.alpha=1,this.target.input.value="",this.argument.input.value="",this.colorCode.input.value="",this.alphaCode.input.value="",this.brightness.input.value="",this.blend.input.value="",this.initial.input.value="",this.step.input.value="",this.min.input.value="",this.max.input.value="",this.scaleMin.value=.05,this.scaleMax.value=20,this.checkBringToFront.state.isActive=!1,this.inNewWindow.state.isActive=!1,this.extension.reset(),this.onChange(),this}get value(){var e,n,i,o;const a=this.select.value,s=this.condition.input.value;if(null!=a)switch(a){case t.EShapeActionValueType.SHOW_HIDE:switch(this.showHideType.value){case t.EShapeActionValueShowHideType.SHAPE:case null:return new t.EShapeActionValueShowHideShape(s);case t.EShapeActionValueShowHideType.LAYER:return new t.EShapeActionValueShowHideLayer(s,this.selectLayer.values.slice(0),this.checkBringToFront.state.isActive)}break;case t.EShapeActionValueType.BLINK:const a=this.blinkType.value||t.EShapeActionValueBlinkType.VISIBILITY,l=this.interval.value,r=this.color.value;return new t.EShapeActionValueBlink(a,s,l,r.color,r.alpha);case t.EShapeActionValueType.CHANGE_COLOR:const h=t.EShapeActionValueChangeColorTypes.pack(this.changeColorType.values),u=this.changeColorTarget.value||t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA;switch(u){case t.EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA:case t.EShapeActionValueChangeColorTarget.COLOR:case t.EShapeActionValueChangeColorTarget.ALPHA:const e=this.color.value;return new t.EShapeActionValueChangeColor(h,s,u,e.color,e.alpha,this.blend.input.value);case t.EShapeActionValueChangeColorTarget.CODE:return new t.EShapeActionValueChangeColorCode(h,s,this.colorCode.input.value,this.alphaCode.input.value,this.blend.input.value);case t.EShapeActionValueChangeColorTarget.BRIGHTNESS:return new t.EShapeActionValueChangeColorBrightness(h,s,this.brightness.input.value)}break;case t.EShapeActionValueType.TRANSFORM:const c=this.transformType.value,p=this.originX.value,d=this.originY.value;switch(c){case t.EShapeActionValueTransformType.RESIZE:const e=this.resizeType.value||t.EShapeActionValueTransformResizeType.RELATIVE_SIZE;return new t.EShapeActionValueTransformResize(e,s,p,d,this.size.input.value);case t.EShapeActionValueTransformType.MOVE:const n=this.moveType.value||t.EShapeActionValueTransformMoveType.RELATIVE_X;return new t.EShapeActionValueTransformMove(n,s,this.amount.input.value);case t.EShapeActionValueTransformType.ROTATE:const i=this.rotateType.value||t.EShapeActionValueTransformRotateType.RELATIVE;return new t.EShapeActionValueTransformRotate(i,s,p,d,this.amount.input.value)}break;case t.EShapeActionValueType.CHANGE_TEXT:const g=this.changeTextType.value||t.EShapeActionValueChangeTextType.TEXT;return new t.EShapeActionValueChangeText(g,s,this.contents.input.value);case t.EShapeActionValueType.OPEN:const _=null!==(e=this.openType.value)&&void 0!==e?e:t.EShapeActionValueOpenType.DIAGRAM;switch(_){case t.EShapeActionValueOpenType.DIALOG:const e=null!==(n=this.openDialogType.value)&&void 0!==n?n:t.EShapeActionValueOpenDialogType.TEXT;switch(e){case t.EShapeActionValueOpenDialogType.INTEGER:case t.EShapeActionValueOpenDialogType.REAL:return new t.EShapeActionValueOpenDialog(s,this.target.input.value,null!==(i=this.onInputAction.value)&&void 0!==i?i:t.EShapeActionValueOnInputAction.EMIT_EVENT,this.initial.input.value,this.step.input.value,this.min.input.value,this.max.input.value,e);case t.EShapeActionValueOpenDialogType.TEXT:case t.EShapeActionValueOpenDialogType.BOOLEAN:case t.EShapeActionValueOpenDialogType.DATE:case t.EShapeActionValueOpenDialogType.TIME:case t.EShapeActionValueOpenDialogType.DATETIME:return new t.EShapeActionValueOpenDialog(s,this.target.input.value,null!==(o=this.onInputAction.value)&&void 0!==o?o:t.EShapeActionValueOnInputAction.EMIT_EVENT,this.initial.input.value,"","","",e);default:return new t.EShapeActionValueOpenDialogExtension(s,this.target.input.value,this.argument.input.value,e)}case t.EShapeActionValueOpenType.DIAGRAM:case t.EShapeActionValueOpenType.PAGE:return new t.EShapeActionValueOpen(_,s,this.target.input.value,this.inNewWindow.state.isActive);default:return new t.EShapeActionValueOpenExtension(_,s,this.target.input.value,this.inNewWindow.state.isActive)}case t.EShapeActionValueType.EMIT_EVENT:return new t.EShapeActionValueEmitEvent(s,this.targetName.input.value);case t.EShapeActionValueType.CHANGE_CURSOR:return new t.EShapeActionValueChangeCursor(s,this.targetName.input.value);case t.EShapeActionValueType.GESTURE:return new t.EShapeActionValueGesture(s,this.gestureType.value||t.EShapeActionValueGestureType.SHAPE,this.toGestureOperationType(this.gestureOperationType.values),this.scaleMin.value,this.scaleMax.value);case t.EShapeActionValueType.MISC:const S=this.miscType.value||t.EShapeActionValueMiscType.INPUT_TEXT;switch(S){case t.EShapeActionValueMiscType.INPUT_TEXT:case t.EShapeActionValueMiscType.INPUT_REAL:case t.EShapeActionValueMiscType.INPUT_INTEGER:return new t.EShapeActionValueMiscInput(S,this.toWhenTypeValue(this.whenType.value),this.target.input.value,this.onInputAction.value||t.EShapeActionValueOnInputAction.EMIT_EVENT);case t.EShapeActionValueMiscType.EMIT_EVENT:return new t.EShapeActionValueMiscEmitEvent(s,this.target.input.value);case t.EShapeActionValueMiscType.WRITE_BOTH:case t.EShapeActionValueMiscType.WRITE_LOCAL:case t.EShapeActionValueMiscType.WRITE_REMOTE:return new t.EShapeActionValueMiscWrite(S,s,this.target.input.value,this.contents.input.value);case t.EShapeActionValueMiscType.HTML_ELEMENT:return this.pointerEvents.state.isActive?new t.EShapeActionValueMiscHtmlElement(S,this.toWhenTypeValue(this.whenType.value),this.initialization.input.value):new t.EShapeActionValueMiscHtmlElement(t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS,this.toWhenTypeValue(this.whenType.value),this.initialization.input.value);case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:return new t.EShapeActionValueMiscHtmlElement(S,this.toWhenTypeValue(this.whenType.value),this.initialization.input.value);case t.EShapeActionValueMiscType.EXECUTE:return new t.EShapeActionValueMiscExecute(s,this.target.input.value);default:if(t.EShapeActionValueMiscType.EXTENSION<=S)return new t.EShapeActionValueMiscExtension(S,s,this.argument.input.value)}break;default:return this.extension.value}return null}set value(e){if(this.selectLayer.menu=new t.DMenu({fit:!0,items:this.newSelectLayerMenuItemOptions()}),null!=e){if(this.select.value=e.type,e instanceof t.EShapeActionValueShowHide)this.condition.input.value=e.condition,this.showHideType.value=t.EShapeActionValueShowHideType.SHAPE;else if(e instanceof t.EShapeActionValueShowHideShape)this.condition.input.value=e.condition,this.showHideType.value=e.subtype;else if(e instanceof t.EShapeActionValueShowHideLayer)this.condition.input.value=e.condition,this.showHideType.value=e.subtype,this.selectLayer.values=e.layers.slice(0),this.checkBringToFront.state.isActive=e.bringToFront;else if(e instanceof t.EShapeActionValueBlink)this.condition.input.value=e.condition,this.blinkType.value=e.subtype,this.interval.value=e.interval,this.color.value.color=e.color,this.color.value.alpha=e.alpha;else if(e instanceof t.EShapeActionValueChangeColor)this.condition.input.value=e.condition,this.changeColorType.values=t.EShapeActionValueChangeColorTypes.unpack(e.subtype),this.changeColorTarget.value=e.target,this.color.value.color=e.color,this.color.value.alpha=e.alpha,this.blend.input.value=e.blend;else if(e instanceof t.EShapeActionValueChangeColorCode)this.condition.input.value=e.condition,this.changeColorType.values=t.EShapeActionValueChangeColorTypes.unpack(e.subtype),this.changeColorTarget.value=t.EShapeActionValueChangeColorTarget.CODE,this.colorCode.input.value=e.color,this.alphaCode.input.value=e.alpha,this.blend.input.value=e.blend;else if(e instanceof t.EShapeActionValueChangeColorBrightness)this.condition.input.value=e.condition,this.changeColorType.values=t.EShapeActionValueChangeColorTypes.unpack(e.subtype),this.changeColorTarget.value=t.EShapeActionValueChangeColorTarget.BRIGHTNESS,this.brightness.input.value=e.brightness;else if(e instanceof t.EShapeActionValueTransformResize)this.condition.input.value=e.condition,this.transformType.value=t.EShapeActionValueTransformType.RESIZE,this.resizeType.value=e.opetype,this.originX.value=e.originX,this.originY.value=e.originY,this.size.input.value=e.amount;else if(e instanceof t.EShapeActionValueTransformMove)this.condition.input.value=e.condition,this.transformType.value=t.EShapeActionValueTransformType.MOVE,this.moveType.value=e.opetype,this.amount.input.value=e.amount;else if(e instanceof t.EShapeActionValueTransformRotate)this.condition.input.value=e.condition,this.transformType.value=t.EShapeActionValueTransformType.ROTATE,this.rotateType.value=e.opetype,this.originX.value=e.originX,this.originY.value=e.originY,this.amount.input.value=e.amount;else if(e instanceof t.EShapeActionValueChangeText)this.condition.input.value=e.condition,this.changeTextType.value=e.subtype,this.contents.input.value=e.value;else if(e instanceof t.EShapeActionValueOpen)this.condition.input.value=e.condition,this.openType.value=e.subtype,this.target.input.value=e.target,this.inNewWindow.state.isActive=e.inNewWindow;else if(e instanceof t.EShapeActionValueOpenDialog)this.condition.input.value=e.condition,this.openType.value=e.subtype,this.target.input.value=e.target,this.onInputAction.value=e.onInputAction,this.initial.input.value=e.initial,this.step.input.value=e.step,this.min.input.value=e.min,this.max.input.value=e.max,this.openDialogType.value=e.dialogType;else if(e instanceof t.EShapeActionValueOpenDialogExtension)this.condition.input.value=e.condition,this.openType.value=e.subtype,this.target.input.value=e.target,this.argument.input.value=e.argument,this.openDialogType.value=e.dialogType;else if(e instanceof t.EShapeActionValueOpenExtension)this.condition.input.value=e.condition,this.openType.value=e.subtype,this.target.input.value=e.target,this.inNewWindow.state.isActive=e.inNewWindow;else if(e instanceof t.EShapeActionValueEmitEvent)this.condition.input.value=e.condition,this.targetName.input.value=e.name;else if(e instanceof t.EShapeActionValueChangeCursor)this.condition.input.value=e.condition,this.targetName.input.value=e.name;else if(e instanceof t.EShapeActionValueGesture)this.condition.input.value=e.condition,this.gestureType.value=e.subtype,this.gestureOperationType.values=this.fromGestureOperationType(e.operationType),this.scaleMin.value=e.scaleMin,this.scaleMax.value=e.scaleMax;else if(e instanceof t.EShapeActionValueMisc)switch(e.subtype){case t.EShapeActionValueMiscType.INPUT_TEXT:case t.EShapeActionValueMiscType.INPUT_REAL:case t.EShapeActionValueMiscType.INPUT_INTEGER:this.miscType.value=e.subtype,this.whenType.value=this.toWhenType(e.condition),this.target.input.value=e.target,this.onInputAction.value=e.onInputAction,this.contents.input.value=e.value;break;case t.EShapeActionValueMiscType.HTML_ELEMENT:this.miscType.value=t.EShapeActionValueMiscType.HTML_ELEMENT,this.whenType.value=this.toWhenType(e.condition),this.target.input.value=e.target,this.onInputAction.value=e.onInputAction,this.initialization.input.value=e.value,this.pointerEvents.state.isActive=!0;break;case t.EShapeActionValueMiscType.HTML_ELEMENT_WITHOUT_POINTER_EVENTS:this.miscType.value=t.EShapeActionValueMiscType.HTML_ELEMENT,this.whenType.value=this.toWhenType(e.condition),this.target.input.value=e.target,this.onInputAction.value=e.onInputAction,this.initialization.input.value=e.value,this.pointerEvents.state.isActive=!1;break;default:this.condition.input.value=e.condition,this.miscType.value=e.subtype,this.target.input.value=e.target,this.onInputAction.value=e.onInputAction,this.contents.input.value=e.value}else e instanceof t.EShapeActionValueMiscExecute?(this.miscType.value=t.EShapeActionValueMiscType.EXECUTE,this.condition.input.value=e.condition,this.target.input.value=e.target):e instanceof t.EShapeActionValueMiscExtension?(this.miscType.value=t.EShapeActionValueMiscType.EXTENSION,this.condition.input.value=e.condition,this.argument.input.value=e.argument):this.extension.value=e;this.onChange()}}getResolvedValue(){return this.value}getType(){return"EDialogAction"}}class pi extends t.DDialogLayered{newContentChildren(e,n){const i=super.newContentChildren(e,n);return i.push(this.inputSource,this.inputDestination,this.inputInitial,new t.DLayoutSpace({height:6}),this.table),i}get inputSource(){let t=this._inputSource;return null==t&&(t=this.newInputSource(),this._inputSource=t),t}newInputSource(){return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,on:{input:t=>{this.onInputSourceChanged(t)},enter:()=>{this.ok()}}},label:{width:60,text:{value:this.theme.getInputSourceLabel()}},space:{width:60}})}onInputSourceChanged(t){this._newSource=t,this.updateRows()}get inputDestination(){let t=this._inputDestination;return null==t&&(t=this.newInputDestination(),this._inputDestination=t),t}newInputDestination(){return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,text:{value:""},on:{input:t=>{this.onInputDestinationChanged(t)},enter:()=>{this.ok()}}},label:{width:60,text:{value:this.theme.getInputDestinationLabel()}},space:{width:60}})}onInputDestinationChanged(t){this._newDestination=t,this.updateRows()}get inputInitial(){let t=this._inputInitial;return null==t&&(t=this.newInputInitial(),this._inputInitial=t),t}newInputInitial(){return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,text:{value:""},on:{enter:()=>{this.ok()}}},label:{width:60,text:{value:this.theme.getInputInitialLabel()}},space:{width:60}})}get table(){let t=this._table;return null==t&&(t=this.newTable(),this._table=t),t}newTable(){return new t.DTable({width:"padding",height:300,columns:this.newColumnOptions()})}newColumnOptions(){const t=this.theme;return[{type:"TEXT",label:t.getTableColumnDataIdLabel(),editable:!1,sortable:!0,getter:t=>t.id},{type:"TEXT",label:t.getTableColumnMappedToLabel(),editable:!1,sortable:!0,getter:t=>t.mappedId}]}set(t,e){let n=!1;return void 0!==t&&(null!=t?(this.inputSource.input.value=t[0],this.inputDestination.input.value=t[1],this.inputInitial.input.value=t[2],this._newSource=t[0],this._newDestination=t[1]):(this.inputSource.input.value="",this.inputDestination.input.value="",this.inputInitial.input.value="",this._newSource="",this._newDestination=""),n=!0),void 0!==e&&(this._ids=this.toIds(e),n=!0),n&&this.updateRows(),this}get value(){return[this.inputSource.input.value.trim(),this.inputDestination.input.value.trim(),this.inputInitial.input.value.trim()]}set value(t){this.set(t)}getResolvedValue(){return this.value}toIds(t){const e=[];if(null!=t){const n=new Set;this.newIds(t.children,n),n.forEach((t=>{e.push(t)})),e.sort()}return e}newIds(e,n){for(let i=0,o=e.length;i<o;++i){const o=e[i],a=o.data;for(let e=0,i=a.size();e<i;++e){const i=a.get(e);i&&i.scope!==t.EShapeDataValueScope.PRIVATE&&n.add(i.id)}const s=o.children;0<s.length&&this.newIds(s,n)}}get onUpdateRowsBound(){let t=this._onUpdateRowsBound;return null==t&&(t=this.newOnUpdateRowsBound(),this._onUpdateRowsBound=t),t}newOnUpdateRowsBound(){return()=>{this.onUpdateRows()}}onUpdateRows(){this._onUpdateRowsTimeout=void 0,this._isRowsDirty&&(this._isRowsDirty=!1,this.table.data.clearAndAddAll(this.newRows()),this._onUpdateRowsTimeout=window.setTimeout(this.onUpdateRowsBound,100))}newRows(){const e=this._ids;if(null==e||e.length<=0)return[];let n=this._mapper;const i=this._newSource;void 0!==n&&this._lastSource===i||(this._lastSource=i,n=null!=i&&0<i.trim().length?new t.EShapeDataMapperImpl(i):null);let o=this._destinations;const a=this._newDestination;void 0!==o&&this._lastDestination===a||(this._lastDestination=a,o=t.EShapeDataMapperImpl.split(a));const s=[];if(null!=n){const i=new t.EShapeDataValueImpl;i.initial="";for(let t=0,a=e.length;t<a;++t){const a=e[t];i.id=a,n.map(i,o,"")&&s.push({id:a,mappedId:i.id})}}else for(let t=0,n=e.length;t<n;++t){const n=e[t];s.push({id:n,mappedId:n})}return s}updateRows(){this._isRowsDirty=!0,null==this._onUpdateRowsTimeout&&this.onUpdateRows()}getType(){return"EDialogDataMappingValue"}}class di extends t.DDialogLayered{newContentChildren(t,e){const n=super.newContentChildren(t,e);return n.push(this.layoutType,this.layoutScope,this.inputId,this.inputAs,this.inputInitial,this.layoutInterval,this.inputFormat,this.layoutRangeType,this.inputRangeFrom,this.inputRangeTo,this.inputCapacity,this.layoutOrder),n}get inputId(){let t=this._inputId;return null==t&&(t=this.newInputId(),this._inputId=t),t}newInputId(){return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,on:{enter:()=>{this.ok()}}},label:{width:60,text:{value:this.theme.getInputIdLabel()}},space:{width:60}})}get inputAs(){let t=this._inputAs;return null==t&&(t=this.newInputAs(),this._inputAs=t),t}newInputAs(){return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,on:{enter:()=>{this.ok()}}},label:{width:60,text:{value:this.theme.getInputAsLabel()}},space:{width:60}})}get layoutType(){let t=this._layoutType;return null==t&&(t=this.newLayoutType(),this._layoutType=t),t}newLayoutType(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getSelectTypeLabel()}}),this.selectType,new t.DLayoutSpace({width:60})]})}get selectType(){let t=this._selectType;return null==t&&(t=this.newSelectType(),t.on("change",(()=>{this.onChange()})),this._selectType=t),t}newSelectType(){return new t.DSelect({weight:1,value:t.EShapeDataValueType.NUMBER,menu:{items:this.newSelectTypeItems()}})}newSelectTypeItems(){const e=this.theme,n=[{value:t.EShapeDataValueType.BOOLEAN,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.BOOLEAN)}},{value:t.EShapeDataValueType.BOOLEAN_ARRAY,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.BOOLEAN_ARRAY)}},{value:t.EShapeDataValueType.NUMBER,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.NUMBER)}},{value:t.EShapeDataValueType.NUMBER_ARRAY,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.NUMBER_ARRAY)}},{value:t.EShapeDataValueType.STRING,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.STRING)}},{value:t.EShapeDataValueType.STRING_ARRAY,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.STRING_ARRAY)}},{value:t.EShapeDataValueType.OBJECT,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.OBJECT)}},{value:t.EShapeDataValueType.OBJECT_ARRAY,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.OBJECT_ARRAY)}},{value:t.EShapeDataValueType.TICKER,text:{value:e.getSelectTypeValueLabel(t.EShapeDataValueType.TICKER)}}];return t.EShapeDataValueExtensions.each((t=>{n.push({value:t.type,text:{value:t.label}})})),n}get layoutScope(){let t=this._layoutScope;return null==t&&(t=this.newLayoutScope(),this._layoutScope=t),t}newLayoutScope(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getSelectScopeLabel()}}),this.selectScope,new t.DLayoutSpace({width:60})]})}get selectScope(){let t=this._selectScope;return null==t&&(t=this.newSelectScope(),this._selectScope=t),t}newSelectScope(){const e=this.theme;return new t.DSelect({weight:1,value:t.EShapeDataValueScope.PUBLIC,menu:{items:[{value:t.EShapeDataValueScope.PUBLIC,text:{value:e.getSelectScopeValueLabel(t.EShapeDataValueScope.PUBLIC)}},{value:t.EShapeDataValueScope.PROTECTED,text:{value:e.getSelectScopeValueLabel(t.EShapeDataValueScope.PROTECTED)}},{value:t.EShapeDataValueScope.PRIVATE,text:{value:e.getSelectScopeValueLabel(t.EShapeDataValueScope.PRIVATE)}}]}})}get inputInitial(){let t=this._inputInitial;return null==t&&(t=this.newInputInitial(),this._inputInitial=t),t}newInputInitial(){return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,text:{value:""},on:{enter:()=>{this.ok()}}},label:{width:60,text:{value:this.theme.getInputInitialLabel()}},space:{width:60}})}get layoutInterval(){let t=this._layoutInterval;return null==t&&(t=this.newLayoutInterval(),this._layoutInterval=t),t}newLayoutInterval(){const e=this.theme;return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:e.getInputIntervalLabel()}}),this.inputInterval,new t.DInputLabel({width:60,text:{value:e.getInputIntervalUnitLabel(),align:{horizontal:"LEFT"}}})]})}get inputInterval(){let t=this._inputInterval;return null==t&&(t=this.newInputInterval(),this._inputInterval=t),t}newInputInterval(){return new t.DInputInteger({weight:1,text:{value:1e3},step:1,min:0,on:{enter:()=>{this.ok()}}})}get inputFormat(){let t=this._inputFormat;return null==t&&(t=this.newInputFormat(),this._inputFormat=t),t}newInputFormat(){return new t.DInputTextAndLabel({width:"padding",height:"auto",input:{weight:1,text:{value:""},on:{enter:()=>{this.ok()}}},label:{width:60,text:{value:this.theme.getInputFormatLabel()}},space:{width:60}})}get layoutRangeType(){let t=this._layoutRangeType;return null==t&&(t=this.newLayoutRangeType(),this._layoutRangeType=t),t}newLayoutRangeType(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getSelectRangeTypeLabel()}}),this.selectRangeType,new t.DLayoutSpace({width:60})]})}get selectRangeType(){let t=this._selectRangeType;return null==t&&(t=this.newSelectRangeType(),t.on("change",(()=>{this.onChange()})),this._selectRangeType=t),t}newSelectRangeType(){const e=this.theme;return new t.DSelect({weight:1,value:t.EShapeDataValueRangeType.NONE,menu:{items:[{value:t.EShapeDataValueRangeType.NONE,text:{value:e.getSelectRangeTypeValueLabel(t.EShapeDataValueRangeType.NONE)}},{value:t.EShapeDataValueRangeType.FROM,text:{value:e.getSelectRangeTypeValueLabel(t.EShapeDataValueRangeType.FROM)}},{value:t.EShapeDataValueRangeType.TO,text:{value:e.getSelectRangeTypeValueLabel(t.EShapeDataValueRangeType.TO)}},{value:t.EShapeDataValueRangeType.FROM_TO,text:{value:e.getSelectRangeTypeValueLabel(t.EShapeDataValueRangeType.FROM_TO)}}]}})}get inputRangeFrom(){let t=this._inputRangeFrom;return null==t&&(t=this.newInputRangeFrom(),this._inputRangeFrom=t),t}newInputRangeFrom(){return new t.DInputRealAndLabel({width:"padding",height:"auto",visible:!1,input:{weight:1,text:{value:0},on:{enter:()=>{this.ok()}}},label:{width:90,text:{value:this.theme.getInputRangeFromLabel()}},space:{width:90}})}get inputRangeTo(){let t=this._inputRangeTo;return null==t&&(t=this.newInputRangeTo(),this._inputRangeTo=t),t}newInputRangeTo(){return new t.DInputRealAndLabel({width:"padding",height:"auto",visible:!1,input:{weight:1,text:{value:1},on:{enter:()=>{this.ok()}}},label:{width:90,text:{value:this.theme.getInputRangeToLabel()}},space:{width:90}})}get inputCapacity(){let t=this._inputCapacity;return null==t&&(t=this.newInputCapacity(),this._inputCapacity=t),t}newInputCapacity(){return new t.DInputIntegerAndLabel({width:"padding",height:"auto",input:{weight:1,text:{value:0},on:{enter:()=>{this.ok()}}},label:{width:60,text:{value:this.theme.getInputCapacityLabel()}},space:{width:60}})}get layoutOrder(){let t=this._layoutOrder;return null==t&&(t=this.newLayoutOrder(),this._layoutOrder=t),t}newLayoutOrder(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getSelectOrderLabel()}}),this.selectOrder,new t.DLayoutSpace({width:60})]})}get selectOrder(){let t=this._selectOrder;return null==t&&(t=this.newSelectOrder(),this._selectOrder=t),t}newSelectOrder(){const e=this.theme;return new t.DSelect({weight:1,value:t.EShapeDataValueOrder.ASCENDING,menu:{items:[{value:t.EShapeDataValueOrder.ASCENDING,text:{value:e.getSelectOrderValueLabel(t.EShapeDataValueOrder.ASCENDING)}},{value:t.EShapeDataValueOrder.DESCENDING,text:{value:e.getSelectOrderValueLabel(t.EShapeDataValueOrder.DESCENDING)}}]},on:{init:t=>{this._selectOrder=t}}})}onChange(){const e=this.selectType.value;switch(e){case t.EShapeDataValueType.BOOLEAN:case t.EShapeDataValueType.BOOLEAN_ARRAY:case t.EShapeDataValueType.NUMBER:case t.EShapeDataValueType.NUMBER_ARRAY:case t.EShapeDataValueType.STRING:case t.EShapeDataValueType.STRING_ARRAY:case t.EShapeDataValueType.OBJECT:case t.EShapeDataValueType.OBJECT_ARRAY:if(this.layoutScope.show(),this.inputId.show(),this.inputAs.show(),this.inputInitial.show(),this.layoutInterval.hide(),this.inputFormat.show(),e===t.EShapeDataValueType.NUMBER){this.layoutRangeType.show();const e=this.selectRangeType.value;null!=e&&e&t.EShapeDataValueRangeType.FROM?this.inputRangeFrom.show():this.inputRangeFrom.hide(),null!=e&&e&t.EShapeDataValueRangeType.TO?this.inputRangeTo.show():this.inputRangeTo.hide()}else this.layoutRangeType.hide(),this.inputRangeFrom.hide(),this.inputRangeTo.hide();break;case t.EShapeDataValueType.TICKER:this.layoutScope.hide(),this.inputId.hide(),this.inputAs.show(),this.inputInitial.hide(),this.layoutInterval.show(),this.inputFormat.hide(),this.layoutRangeType.hide(),this.inputRangeFrom.hide(),this.inputRangeTo.hide();break;default:this.layoutScope.hide(),this.inputId.hide(),this.inputAs.show(),this.inputInitial.hide(),this.layoutInterval.hide(),this.inputFormat.hide(),this.layoutRangeType.hide(),this.inputRangeFrom.hide(),this.inputRangeTo.hide()}}reset(){return this.selectType.value=t.EShapeDataValueType.NUMBER,this.selectScope.value=t.EShapeDataValueScope.PUBLIC,this.inputId.input.value="",this.inputAs.input.value="",this.inputInitial.input.value="",this.inputInterval.value=1e3,this.inputFormat.input.value="",this.selectRangeType.value=t.EShapeDataValueRangeType.NONE,this.inputRangeFrom.input.value=0,this.inputRangeTo.input.value=1,this.inputCapacity.input.value=0,this.selectOrder.value=t.EShapeDataValueOrder.ASCENDING,this.onChange(),this}get value(){var e,n,i,o;const a=new t.EShapeDataValueImpl,s=null!==(e=this.selectType.value)&&void 0!==e?e:t.EShapeDataValueType.NUMBER,l=null!==(n=this.selectScope.value)&&void 0!==n?n:t.EShapeDataValueScope.PUBLIC,r=null!==(i=this.selectOrder.value)&&void 0!==i?i:t.EShapeDataValueOrder.ASCENDING;switch(a.type=s,s){case t.EShapeDataValueType.BOOLEAN:case t.EShapeDataValueType.BOOLEAN_ARRAY:case t.EShapeDataValueType.NUMBER:case t.EShapeDataValueType.NUMBER_ARRAY:case t.EShapeDataValueType.STRING:case t.EShapeDataValueType.STRING_ARRAY:case t.EShapeDataValueType.OBJECT:case t.EShapeDataValueType.OBJECT_ARRAY:a.scope=l,a.id=this.inputId.input.value.trim(),a.as=this.inputAs.input.value.trim(),a.initial=this.inputInitial.input.value.trim(),a.format=this.inputFormat.input.value.trim(),s===t.EShapeDataValueType.NUMBER?(a.range.type=null!==(o=this.selectRangeType.value)&&void 0!==o?o:t.EShapeDataValueRangeType.NONE,a.range.from=this.inputRangeFrom.input.value,a.range.to=this.inputRangeTo.input.value):(a.range.type=t.EShapeDataValueRangeType.NONE,a.range.from=0,a.range.to=1),a.order=r;break;case t.EShapeDataValueType.TICKER:a.scope=t.EShapeDataValueScope.PUBLIC,a.id="",a.as=this.inputAs.input.value.trim(),a.initial=`${this.inputInterval.value}`,a.format="",a.range.type=t.EShapeDataValueRangeType.NONE,a.range.from=0,a.range.to=1,a.order=r;break;default:a.scope=t.EShapeDataValueScope.PUBLIC,a.id="",a.as=this.inputAs.input.value.trim(),a.initial="",a.format="",a.range.type=t.EShapeDataValueRangeType.NONE,a.range.from=0,a.range.to=1,a.order=r}return a}set value(e){null!=e&&(this.selectType.value=e.type,this.selectScope.value=e.scope,this.inputId.input.value=e.id,this.inputAs.input.value=e.as,e.type===t.EShapeDataValueType.TICKER?(this.inputInitial.input.value="",this.inputInterval.value=this.toInterval(e.initial)):(this.inputInitial.input.value=e.initial,this.inputInterval.value=1e3),this.inputFormat.input.value=e.format,this.selectRangeType.value=e.range.type,this.inputRangeFrom.input.value=e.range.from,this.inputRangeTo.input.value=e.range.to,this.inputCapacity.input.value=e.capacity,this.selectOrder.value=e.order,this.onChange())}toInterval(t){try{const e=parseInt(t,10);if(e==e)return Math.max(0,e)}catch(t){}return 1e3}getResolvedValue(){return this.value}getType(){return"EDialogDataValue"}}class gi extends t.DDialogLayered{newContentChildren(t,e){const n=super.newContentChildren(t,e);return n.push(this.inputName,this.inputPositionLayout,this.inputSizeLayout,this.checkBackgroundLayout,this.colorBackgroundLayout,this.selectGestureLayout,this.checkVisibleLayout,this.checkInteractiveLayout),n}newLabel(e){return new t.DInputLabel({width:60,text:{value:e}})}newSpace(){return new t.DLayoutSpace({width:60})}newLabeled(e,n,i){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[null!=e?this.newLabel(e):this.newSpace(),n,i,this.newSpace()]})}get inputName(){let t=this._inputName;return null==t&&(t=this.newInputName(),this._inputName=t),t}newInputName(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{width:60,text:{value:this.theme.getInputNameLabel()}},input:{weight:1,text:{value:""},on:{enter:()=>{this.ok()}}},space:{width:60}})}get inputX(){let t=this._inputX;return null==t&&(t=this.newInputX(),this._inputX=t),t}newInputX(){return new t.DInputReal({weight:1,on:{enter:()=>{this.ok()}}})}get inputY(){let t=this._inputY;return null==t&&(t=this.newInputY(),this._inputY=t),t}newInputY(){return new t.DInputReal({weight:1,on:{enter:()=>{this.ok()}}})}get inputPositionLayout(){let t=this._inputPositionLayout;return null==t&&(t=this.newLabeled(this.theme.getInputPositionLabel(),this.inputX,this.inputY),this._inputPositionLayout=t),t}get inputWidth(){let t=this._inputWidth;return null==t&&(t=this.newInputWidth(),this._inputWidth=t),t}newInputWidth(){return new t.DInputReal({weight:1,on:{enter:()=>{this.ok()}}})}get inputHeight(){let t=this._inputHeight;return null==t&&(t=this.newInputHeight(),this._inputHeight=t),t}newInputHeight(){return new t.DInputReal({weight:1,on:{enter:()=>{this.ok()}}})}get inputSizeLayout(){let t=this._inputSizeLayout;return null==t&&(t=this.newLabeled(this.theme.getInputSizeLabel(),this.inputWidth,this.inputHeight),this._inputSizeLayout=t),t}get checkBackground(){let t=this._checkBackground;return null==t&&(t=this.newCheckBackground(),this._checkBackground=t),t}newCheckBackground(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckBackgroundLabel(),align:{horizontal:"LEFT"}},on:{active:()=>{this.onCheckBackgroundChange(!0)},inactive:()=>{this.onCheckBackgroundChange(!1)}}})}onCheckBackgroundChange(t){this.colorBackground.state.isDisabled=!t}get checkBackgroundLayout(){let t=this._checkBackgroundLayout;return null==t&&(t=this.newLabeled(this.theme.getTextBackgroundLabel(),this.checkBackground,null),this._checkBackgroundLayout=t),t}get colorBackground(){let t=this._colorBackground;return null==t&&(t=this.newColorBackground(),this._colorBackground=t),t}newColorBackground(){return new t.DButtonColor({weight:1})}get colorBackgroundLayout(){let t=this._colorBackgroundLayout;return null==t&&(t=this.newLabeled(null,this.colorBackground,null),this._colorBackgroundLayout=t),t}get checkVisible(){let t=this._checkVisible;return null==t&&(t=this.newCheckVisible(),this._checkVisible=t),t}newCheckVisible(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckVisibleLabel(),align:{horizontal:"LEFT"}}})}get checkVisibleLayout(){let t=this._checkVisibleLayout;return null==t&&(t=this.newLabeled(null,this.checkVisible,null),this._checkVisibleLayout=t),t}get checkInteractive(){let t=this._checkInteractive;return null==t&&(t=this.newCheckInteractive(),this._checkInteractive=t),t}newCheckInteractive(){return new t.DButtonCheck({weight:1,text:{value:this.theme.getCheckInteractiveLabel(),align:{horizontal:"LEFT"}}})}get checkInteractiveLayout(){let t=this._checkInteractiveLayout;return null==t&&(t=this.newLabeled(null,this.checkInteractive,null),this._checkInteractiveLayout=t),t}get selectGesture(){let t=this._selectGesture;return null==t&&(t=this.newSelectGesture(),this._selectGesture=t),t}newSelectGesture(){const e=this.theme;return new t.DSelectMultiple({weight:1,values:this.fromGestureOperationType(t.EShapeActionValueGestureOperationType.ALL),menu:{items:[{value:t.EShapeActionValueGestureOperationType.DRAG,text:{value:e.getSelectGestureValueLabel(t.EShapeActionValueGestureOperationType.DRAG)},check:!0},{value:t.EShapeActionValueGestureOperationType.PINCH,text:{value:e.getSelectGestureValueLabel(t.EShapeActionValueGestureOperationType.PINCH)},check:!0}]}})}toGestureOperationType(e){let n=t.EShapeActionValueGestureOperationType.NONE;for(let t=0,i=e.length;t<i;++t)n|=e[t];return n}fromGestureOperationType(e){const n=[];return e&t.EShapeActionValueGestureOperationType.DRAG&&n.push(t.EShapeActionValueGestureOperationType.DRAG),e&t.EShapeActionValueGestureOperationType.PINCH&&n.push(t.EShapeActionValueGestureOperationType.PINCH),n}get selectGestureLayout(){let t=this._selectGestureLayout;return null==t&&(t=this.newLabeled(this.theme.getSelectGestureLabel(),this.selectGesture,null),this._selectGestureLayout=t),t}reset(t,e){return this.inputName.input.value="",this.inputX.value=0,this.inputY.value=0,this.inputWidth.value=t,this.inputHeight.value=e,this.checkBackground.state.isActive=!1,this.colorBackground.value.color=16777215,this.colorBackground.value.alpha=1,this.checkVisible.state.isActive=!0,this.checkInteractive.state.isActive=!0,this.selectGesture.values=[],this.onCheckBackgroundChange(!1),this}get value(){return new f(this.inputName.input.value,this.inputX.value,this.inputY.value,this.inputWidth.value,this.inputHeight.value,new L(this.checkBackground.state.isActive,this.colorBackground.value.color,this.colorBackground.value.alpha),this.checkVisible.state.isActive,this.checkInteractive.state.isActive,this.toGestureOperationType(this.selectGesture.values))}set value(t){null!=t&&(this.inputName.input.value=t.name,this.inputX.value=t.x,this.inputY.value=t.y,this.inputWidth.value=t.width,this.inputHeight.value=t.height,this.checkBackground.state.isActive=t.background.enable,this.colorBackground.value.color=t.background.color,this.colorBackground.value.alpha=t.background.alpha,this.checkVisible.state.isActive=t.visible,this.checkInteractive.state.isActive=t.interactive,this.selectGesture.values=this.fromGestureOperationType(t.gesture),this.onCheckBackgroundChange(t.background.enable))}getResolvedValue(){return this.value}getType(){return"EDialogLayer"}}class _i extends t.DDialogProcessing{toReasonMalformedLabel(t){switch(t){case"uid":return"An ID";case"password":return"A password";case"description":return"A description";case"name":return"A name";case"label":return"A label";case"summary":return"A summary";default:return"Something"}}toReasonMalformedRange(t){switch(t){case"uid":case"name":default:return{lower:1,upper:32};case"password":return{lower:6,upper:32};case"description":return{lower:0,upper:256};case"label":return{lower:0,upper:16};case"summary":return{lower:0,upper:32}}}toReasonMalformed(t,e,n){const i=this.toReasonMalformedLabel(e);switch(n){case"short":case"long":const n=this.toReasonMalformedRange(e);return`Failed to save '${t}'.\n${i} must be of ${n.lower} to ${n.upper}\ncharacters long.`;case"simple":return`Failed to save '${t}'.\n${i} must contain letters (A-Za-z_)\nand digits (0-9).`;case"slash":return`Failed to save '${t}'.\n${i} must not contain the slash mark (/).`;case"non-alphanumeric":return`Failed to save '${t}'.\n${i} must contain only letters (A-Za-z_),\ndigits (0-9) and a sharp symbol (#).`;default:return`Failed to save '${t}'.\n${i} is invalid.`}}toReasonTarget(t,e,n){return null!=e?`Failed to save '${t}'.\n${n} '${e}' does not exit.`:`Failed to save '${t}'.\n${n} is missing.`}toReasonTargetAt(t,e,n,i){return null!=e?`Failed to save.\n${n} '${t}'\nrequires ${i} '${e}'.`:`Failed to save.\n${n} '${t}'\nrequires ${i}.`}toReason(t){if(null!=t)if(0<t.length&&"{"===t[0])try{const e=JSON.parse(t);switch(e.id){case"no-sensor-found":return this.toReasonTarget(e.at,e.target,"Sensor");case"no-device-model-found":return this.toReasonTarget(e.at,e.target,"Device model");case"malformed":return this.toReasonMalformed(e.at,e.target,e.reason);case"invalid-operation-mode":return"Failed to save.\nInvalid operation mode.";case"no-graphic-found":return this.toReasonTargetAt(e.at,e.target,"A graphic sensor mapping","a graphic");case"no-alarm-list-found":return this.toReasonTargetAt(e.at,e.target,"An alarm mapping","an alarm list");case"no-trend-graph-found":return this.toReasonTargetAt(e.at,e.target,"A trend graph sensor mapping","a trend graph")}}catch(t){return}else switch(t){case"duplication":return"Failed to save.\nThe name has already been used.";case"duplications":return"Failed to save.\nIDs must be unique.";case"invalid-operation-mode":return"Failed to save.\nInvalid operation mode.";case"validation":return"A validation error has occurred.";case"validation-fail":return"A validation failed."}}toButtonText(t){return"validation"===t||"validation-fail"===t||null!=t?"OK":"Save"}reject(t){super.reject(this.toReason(t));const e=this.footer;if(e){const n=e.buttonOk;n&&(n.text=this.toButtonText(t))}}}let Si=128;const wi=()=>Si;let mi;const Ti=()=>{let t=mi;return null==t&&(t=Ei(),mi=t),t},Ei=()=>{const e=wi(),n=window.devicePixelRatio||1,i=e*n;return t.toSvgTexture(`<svg xmlns="http://www.w3.org/2000/svg" height="${i}px" width="${i}px" viewBox="0 0 24 24" fill="#000000" fill-opacity="0.05"><path d="M19,5v11.17l2,2V5c0-1.1-0.9-2-2-2H5.83l2,2H19z"/><path d="M2.81,2.81L1.39,4.22L3,5.83V19c0,1.1,0.9,2,2,2h13.17l1.61,1.61l1.41-1.41L2.81,2.81z M5,19V7.83l7.07,7.07L11.25,16 L9,13l-3,4h8.17l2,2H5z"/></svg>`,n)},yi=(n,i,o)=>{const a=wi(),s=Ti(),l=8+a+30+8,r=new Map,h=new Set,u=n=>{if(i){const o=i(n.id);if(t.isString(o)){let t=r.get(o);if(null==t){const n=e.Texture.from(o);n.baseTexture.on("error",(()=>{d(n,o)})),t=n,r.set(o,n)}return t}if(null!=o)return o}return s};let c=null;const p=()=>{h.forEach((t=>{t.image=null})),r.forEach(((t,e)=>{if(t!==s){const e=t.baseTexture;t.destroy(),e&&(e.destroy(),e.off("error"))}})),r.clear()},d=(t,e)=>{if(t!==s&&!t.valid){h.forEach((e=>{const n=e.image.get(0);null!=n&&n.source===t&&(n.source=s)}));const n=t.baseTexture;t.destroy(),n&&(n.destroy(),n.off("error")),r.set(e,s)}};return{width:"auto",height:"auto",layout:{width:"auto",height:"auto"},content:{width:"auto",height:"auto"},list:{width:3*l,height:2*l+32,data:{toImage:u},updater:{newItem:function(e){const n=new t.DDialogSelectListItem(e,{width:l,height:l,padding:8,text:{align:{vertical:"BOTTOM",horizontal:"CENTER"}},image:{align:{vertical:"TOP",horizontal:"CENTER",with:"PADDING"},margin:{vertical:0},tint:{color:16777215,alpha:1}}});return h.add(n),n}}},controller:n,on:{open:()=>{null!=c&&(window.clearTimeout(c),c=null,p()),h.forEach((t=>{const e=t.value;null!=e&&(t.image=u(e))}))},close:()=>{null==c&&(c=window.setTimeout((()=>{c=null,p()}),1e3))},select:o}}},vi=(e,n,i)=>new t.DDialogSelect(yi(e,n,i));class Ci extends t.DDialogLayered{newContentChildren(e,n){const i=super.newContentChildren(e,n);return i.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:e.getSelectDirectionLabel()}}),this.selectType,new t.DLayoutSpace({width:60})]})),i.push(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:e.getInputPositionLabel()}}),this.inputPosition,new t.DLayoutSpace({width:60})]})),i}get selectType(){let t=this._selectType;return null==t&&(t=this.newSelectType(),this._selectType=t),t}newSelectType(){const e=this.theme;return new t.DSelect({weight:1,value:t.ESnapperTargetValueType.VERTICAL,menu:{items:[{value:t.ESnapperTargetValueType.VERTICAL,text:{value:e.getSelectDirectionValueLabel(t.ESnapperTargetValueType.VERTICAL)}},{value:t.ESnapperTargetValueType.HORIZONTAL,text:{value:e.getSelectDirectionValueLabel(t.ESnapperTargetValueType.HORIZONTAL)}}]}})}get inputPosition(){let t=this._inputPosition;return null==t&&(t=this.newInputPosition(),this._inputPosition=t),t}newInputPosition(){return new t.DInputReal({weight:1,text:{value:0},step:1,on:{enter:()=>{this.ok()}}})}reset(){return this.selectType.value=t.ESnapperTargetValueType.VERTICAL,this.inputPosition.value=0,this}get value(){const e=this.selectType.value,n=this.inputPosition.value;return null!=e?new t.ESnapperTargetValue(e,n):null}set value(t){null!=t&&(this.selectType.value=t.type,this.inputPosition.value=t.position)}getResolvedValue(){return this.value}getType(){return"EDialogSnap"}}class bi extends t.DLayoutVertical{constructor(e){super(e),this._icons=e.icons;const n=e.selection;this._selection=n,this._diagram=e.diagram,this.addChild(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newTextLabel(),this.buttonNew,this.buttonDelete,this.buttonBringForward,this.buttonSendBackward]})),this.addChild(this.actionList),this.addChild(this.checkInteractive),this.addChild(this.checkFocusable),this.addChild(this.labelTitle),this.addChild(this.inputTitle),this.addChild(this.labelShortcut),this.addChild(this.inputShortcut),this.addChild(this.labelCursor),this.addChild(this.dropdownCursor),n.on("change",(()=>{this.onSelectionChange(n)}));const i=this.actionList;i.data.selection.on("change",(()=>{this.onListSelectionChange(i)})),this.onSelectionChange(n)}newTextLabel(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})}get buttonNew(){var t;return null!==(t=this._buttonNew)&&void 0!==t?t:this._buttonNew=this.newButtonNew()}newButtonNew(){return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.theme.getButtonNewTitle(),on:{active:t=>{this.onButtonNewActive(t)}}})}onButtonNewActive(t){this.actionDialog.reset().open(t).then((t=>{null!=t&&this._selection.addActionValue(t)}))}get buttonDelete(){var t;return null!==(t=this._buttonDelete)&&void 0!==t?t:this._buttonDelete=this.newButtonDelete()}newButtonDelete(){return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.theme.getButtonDeleteTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const t=this.actionList.data.selection.first;null!=t&&this._selection.removeActionValue(t)}}})}onListSelectionChangeButtonDelete(t){this.buttonDelete.state.isDisabled=t.data.selection.isEmpty()}get buttonBringForward(){var t;return null!==(t=this._buttonBringForward)&&void 0!==t?t:this._buttonBringForward=this.newButtonBringForward()}newButtonBringForward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonBringForwardTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const t=this.actionList,e=t.data.selection.first,n=t.data.items;null!=e&&n[0]!==e&&this._selection.bringActionValueForward(e)}}})}onListSelectionChangeButtonBringForward(t){const e=t.data.selection.first,n=t.data.items;this.buttonBringForward.state.isDisabled=null==e||n[0]===e}get buttonSendBackward(){var t;return null!==(t=this._buttonSendBackward)&&void 0!==t?t:this._buttonSendBackward=this.newButtonSendBackward()}newButtonSendBackward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonSendBackwardTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const t=this.actionList,e=t.data.selection.first,n=t.data.items;null!=e&&n[n.length-1]!==e&&this._selection.sendActionValueBackward(e)}}})}onListSelectionChangeButtonSendBackward(t){const e=t.data.selection.first,n=t.data.items;this.buttonSendBackward.state.isDisabled=null==e||n[n.length-1]===e}get actionDialog(){var t;return null!==(t=this._actionDialog)&&void 0!==t?t:this._actionDialog=this.newActionDialog()}newActionDialog(){return new ci({icons:this._icons,diagram:this._diagram})}get actionList(){var t;return null!==(t=this._actionList)&&void 0!==t?t:this._actionList=this.newActionList()}newActionList(){const e=new t.DList({width:"padding",weight:1,data:{toLabel:t=>t.toLabel()},updater:{newItem:n=>new t.DListItem(n,{image:{tint:{color:null}},on:{dblclick:(t,n,i)=>{this.onActionListDblClick(t,n,i,e)},set:(t,e,n)=>{this.onActionListSet(n,t)},unset:t=>{this.onActionListUnset(t)}}})}});return e}onActionListDblClick(t,e,n,i){const o=n.value;if(null!=o){const t=this.actionDialog;t.reset(),t.value=o,t.open(n).then((()=>{const e=t.value;null!=e&&this._selection.replaceActionValue(o,e,i)}))}}onActionListSet(e,n){if(n instanceof t.EShapeActionValueChangeColor){const i=e.image.get(0);if(null!=i){const o=t.DThemes.get("DButtonColor");i.source=o.getImageSource(e.state),i.tint.color=n.color}}else e.image=null}onActionListUnset(t){t.image=null}onSelectionChangeActionList(t){const e=t.last(),n=this.actionList;n.data.items=null!=e?e.action.values:[],this.onListSelectionChange(n)}get checkInteractive(){var t;return null!==(t=this._checkInteractive)&&void 0!==t?t:this._checkInteractive=this.newCheckInteractive()}newCheckInteractive(){return new t.DButtonCheckRight({width:"padding",text:{value:this.theme.getCheckInteractiveLabel()},padding:0,background:{color:null},on:{active:()=>{this._selection.setInteractive(!0)},inactive:()=>{this._selection.setInteractive(!1)}}})}onSelectionChangeCheckInteractive(t){const e=t.last(),n=this.checkInteractive;null!=e?(n.state.isActive=e.interactive,n.state.isDisabled=!1):n.state.isDisabled=!0}get checkFocusable(){var t;return null!==(t=this._checkFocusable)&&void 0!==t?t:this._checkFocusable=this.newCheckFocusable()}newCheckFocusable(){return new t.DButtonCheckRight({width:"padding",text:{value:this.theme.getCheckFocusableLabel()},padding:0,background:{color:null},on:{active:()=>{this._selection.setFocusable(!0)},inactive:()=>{this._selection.setFocusable(!1)}}})}onSelectionChangeCheckFocusable(t){const e=t.last(),n=this.checkFocusable;null!=e?(n.state.isActive=e.state.isFocusable,n.state.isDisabled=!1):n.state.isDisabled=!0}get labelShortcut(){var t;return null!==(t=this._labelShortcut)&&void 0!==t?t:this._labelShortcut=this.newLabelShortcut()}newLabelShortcut(){return new t.DText({width:"padding",text:{value:this.theme.getInputShortcutLabel()}})}get inputShortcut(){var t;return null!==(t=this._inputShortcut)&&void 0!==t?t:this._inputShortcut=this.newInputShortcut()}newInputShortcut(){return new t.DInputText({width:"padding",on:{change:t=>{this._selection.setShortcut(this.toNormalizedShortcut(t))}}})}toNormalizedShortcut(t){const e=t.trim();if(0<e.length)return e}onSelectionChangeInputShortcut(t){var e;this.inputShortcut.value=(null===(e=t.last())||void 0===e?void 0:e.shortcut)||""}get labelTitle(){var t;return null!==(t=this._labelTitle)&&void 0!==t?t:this._labelTitle=this.newLabelTitle()}newLabelTitle(){return new t.DText({width:"padding",text:{value:this.theme.getInputTitleLabel()}})}get inputTitle(){var t;return null!==(t=this._inputTitle)&&void 0!==t?t:this._inputTitle=this.newInputTitle()}newInputTitle(){return new t.DInputText({width:"padding",on:{change:t=>{this._selection.setTitle(this.toNormalizedTitle(t))}}})}toNormalizedTitle(t){if(0<t.trim().length)return t}onSelectionChangeInputTitle(t){var e;this.inputTitle.value=(null===(e=t.last())||void 0===e?void 0:e.title)||""}get labelCursor(){var t;return null!==(t=this._labelCursor)&&void 0!==t?t:this._labelCursor=this.newLabelCursor()}newLabelCursor(){return new t.DText({width:"padding",text:{value:this.theme.getDropdownCursorLabel()}})}get dropdownCursor(){var t;return null!==(t=this._dropdownCursor)&&void 0!==t?t:this._dropdownCursor=this.newDropdownCursor()}newDropdownCursor(){return new t.DDropdown({width:"padding",menu:{width:"auto",column:3,fit:!1,items:this.newDropdownCursorMenuItems()},on:{select:t=>{var e;this.dropdownCursor.text=null!==(e=this.cursors.get(t))&&void 0!==e?e:t,this._selection.setCursor(t)}}})}newDropdownCursorMenuItems(){const t=[];return this.cursors.forEach(((e,n)=>{t.push({width:200,value:n,text:{value:e}})})),t}get cursors(){var t;return null!==(t=this._cursors)&&void 0!==t?t:this._cursors=this.theme.getCursors()}onSelectionChangeDropdownCursor(t){var e,n,i;const o=null!==(n=null===(e=t.last())||void 0===e?void 0:e.cursor)&&void 0!==n?n:"";this.dropdownCursor.text=null!==(i=this.cursors.get(o))&&void 0!==i?i:o}onSelectionChange(t){this.state.isDisabled=t.isEmpty(),this.onSelectionChangeActionList(t),this.onSelectionChangeCheckInteractive(t),this.onSelectionChangeCheckFocusable(t),this.onSelectionChangeInputShortcut(t),this.onSelectionChangeInputTitle(t),this.onSelectionChangeDropdownCursor(t)}onListSelectionChange(t){this.onListSelectionChangeButtonDelete(t),this.onListSelectionChangeButtonBringForward(t),this.onListSelectionChangeButtonSendBackward(t)}getType(){return"EEditorAction"}}class Di extends t.DDialogLayered{constructor(t){super(t);const e=t.canvas;this._canvas=t.canvas,this.onDefaultChange(e)}onDefaultChange(e){const n=e.category,i=n.default,o=n.items,a=this.layoutCategory;if(null!=i&&0<o.length){const e=[];for(let t=0,n=o.length;t<n;++t){const n=o[t];e.push({value:n.id,text:{value:n.label}})}const i=this.selectCategory;i.menu=new t.DMenu({fit:!0,items:e}),i.value=n.default,a.state.isEnabled=n.writable,a.show()}else a.hide()}newContentChildren(t,e){const n=super.newContentChildren(t,e);return n.push(this.layoutName,this.layoutLabel,this.layoutWidth,this.layoutHeight,this.layoutCategory,this.layoutSummary,this.layoutDescription,this.layoutBackground),n}get layoutName(){let t=this._layoutName;return null==t&&(t=this.newLayoutName(),this._layoutName=t),t}newLayoutName(){return new t.DInputTextAndLabel({width:"padding",label:{text:{value:this.theme.getInputNameLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}get layoutLabel(){let t=this._layoutLabel;return null==t&&(t=this.newLayoutLabel(),this._layoutLabel=t),t}newLayoutLabel(){return new t.DInputTextAndLabel({width:"padding",label:{text:{value:this.theme.getInputLabelLabel()}},input:{weight:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}get layoutWidth(){let t=this._layoutWidth;return null==t&&(t=this.newLayoutWidth(),this._layoutWidth=t),t}newLayoutWidth(){return new t.DInputIntegerAndLabel({width:"padding",label:{text:{value:this.theme.getInputWidthLabel()}},input:{weight:1,min:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}get layoutHeight(){let t=this._layoutHeight;return null==t&&(t=this.newLayoutHeight(),this._layoutHeight=t),t}newLayoutHeight(){return new t.DInputIntegerAndLabel({width:"padding",label:{text:{value:this.theme.getInputHeightLabel()}},input:{weight:1,min:1,on:{enter:()=>{this.ok()}}},space:{width:60}})}get layoutCategory(){let t=this._layoutCategory;return null==t&&(t=this.newLayoutCategory(),this._layoutCategory=t),t}newLayoutCategory(){return new t.DLayoutHorizontal({width:"padding",visible:!1,children:[new t.DInputLabel({text:{value:this.theme.getSelectCategoryLabel()}}),this.selectCategory,new t.DLayoutSpace({width:60})]})}get selectCategory(){let t=this._selectCategory;return null==t&&(t=this.newSelectCategory(),this._selectCategory=t),t}newSelectCategory(){return new t.DSelect({weight:1})}get layoutSummary(){let t=this._layoutSummary;return null==t&&(t=this.newLayoutSummary(),this._layoutSummary=t),t}newLayoutSummary(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelSummary(),this.inputSummary,new t.DLayoutSpace({width:60})]})}newLabelSummary(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputSummaryLabel()}})}get inputSummary(){let t=this._inputSummary;return null==t&&(t=this.newInputSummary(),this._inputSummary=t),t}newInputSummary(){return new t.DInputTextArea({weight:1,height:60})}get layoutDescription(){let t=this._layoutDescription;return null==t&&(t=this.newLayoutDescription(),this._layoutDescription=t),t}newLayoutDescription(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelDescription(),this.inputDescription,new t.DLayoutSpace({width:60})]})}newLabelDescription(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputDescriptionLabel()}})}get inputDescription(){let t=this._inputDescription;return null==t&&(t=this.newInputDescription(),this._inputDescription=t),t}newInputDescription(){return new t.DInputTextArea({weight:1,height:100})}get layoutBackground(){let t=this._layoutBackground;return null==t&&(t=this.newLayoutBackground(),this._layoutBackground=t),t}newLayoutBackground(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelBackground(),this.inputBackground,new t.DLayoutSpace({width:60})]})}newLabelBackground(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputBackgroundLabel()}})}get inputBackground(){let t=this._inputBackground;return null==t&&(t=this.newInputBackground(),this._inputBackground=t),t}newInputBackground(){const e=new t.DButtonColor({weight:1});return e.dialog.on("open",(()=>{const t=e.dialog,n=t.new,i=t.current;n.color=i.color,n.alpha=i.alpha})),e}reset(e){const n=null==e?void 0:e.canvas;if(null!=n){const e=n.background,i=e.color,o=e.alpha;this.value={name:n.name,label:n.label,width:n.width,height:n.height,category:n.category,summary:n.summary,description:n.description,background:{color:t.isNumber(i)?i:16777215,alpha:t.isNumber(o)?o:1}}}else{const t=this._canvas;this.value={name:t.name,label:t.label,width:t.width,height:t.height,category:t.category.default,summary:t.summary,description:t.description,background:{color:t.background.color,alpha:t.background.alpha}}}return this}get value(){return{name:this.layoutName.input.value,label:this.layoutLabel.input.value,width:this.layoutWidth.input.value,height:this.layoutHeight.input.value,category:this.selectCategory.value,summary:this.inputSummary.value,description:this.inputDescription.value,background:this.inputBackground.value}}set value(t){var e,n;this.layoutName.input.value=t.name,this.layoutLabel.input.value=t.label,this.layoutWidth.input.value=t.width,this.layoutHeight.input.value=t.height,this.selectCategory.value=null!==(n=null!==(e=t.category)&&void 0!==e?e:this._canvas.category.default)&&void 0!==n?n:null,this.inputSummary.value=t.summary,this.inputDescription.value=t.description,this.inputBackground.value.color=t.background.color,this.inputBackground.value.alpha=t.background.alpha}getResolvedValue(){return this.value}getType(){return"EDialogCanvas"}}class Li extends t.DBoard{constructor(e){super((t=>{var e,n,i,o,a;return null!==(e=t.width)&&void 0!==e||(t.width=200),null!==(n=t.height)&&void 0!==n||(t.height=30),null!==(i=t.padding)&&void 0!==i||(t.padding=0),null!==(o=t.corner)&&void 0!==o||(t.corner={mask:"BOTTOM"}),null!==(a=t.shadow)&&void 0!==a||(t.shadow="WEAK"),t})(e)),this._icons=e.icons;const n=e.diagram;this._diagram=n,n.on("change",(()=>{const t=n.canvas;null!=t&&(this.inputName.value=t.name)})),n.on("set",(t=>{this.inputName.value=t.name,this.show()})),n.on("unset",(t=>{this.hide()})),this._canvas=e.canvas,this.addChild(new t.DLayoutHorizontal({x:"padding",y:"padding",width:"padding",height:"padding",margin:0,children:[this.inputName,this.buttonEditor]})),this.hide()}get inputName(){let t=this._inputName;return null==t&&(t=this.newInputName(),this._inputName=t),t}newInputName(){return new t.DInputText({weight:1,background:{color:null},border:{color:null},corner:{mask:t.DCornerMask.ALL&~t.DCornerMask.TOP_LEFT},on:{change:t=>{this.onInputNameChange(t)}}})}onInputNameChange(e){const n=this._diagram,i=n.canvas;null!=i&&i.name!==e&&t.DControllers.getCommandController().push(new u(n,i,e))}get buttonEditor(){let t=this._buttonEditor;return null==t&&(t=this.newButtonEditor(),this._buttonEditor=t),t}newButtonEditor(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_canvas},on:{active:t=>{this.onButtonEditorActive(t)}}})}onButtonEditorActive(e){this.dialogEditor.then((n=>{const o=this._diagram;n.reset(o).open(e).then((e=>{const n=o.canvas;null!=n&&t.DControllers.getCommandController().push(new i(o,n,e.name,e.label,e.width,e.height,e.category,e.summary,e.description,e.background.color,e.background.alpha))}))}))}get dialogEditor(){let t=this._dialogEditor;return null==t&&(t=this.newDialogEditor(),this._dialogEditor=t),t}newDialogEditor(){return this._canvas.get().then((t=>new Di({canvas:t})))}render(t){const e=this._diagram.canvas;if(null!=e){const t=e.position;this.position.set(t.x,t.y-this.height),this.updateTransform()}super.render(t)}getType(){return"EEditorCanvas"}}const fi=t=>""+ +t.toFixed(2),Ai=t=>fi(t/Math.PI*180),Bi=t=>parseFloat(t)/180*Math.PI;class xi extends t.DLayoutVertical{constructor(t){super(t),this._icons=t.icons,this._selection=t.selection,this._workRectangle=new e.Rectangle,this._updateInputShape=null,this._updateInputId=null,this._isUpdateInputShapeChanged=!1,this._renderInputsBound=()=>{this.renderInputs()},this.addChild(this.newTextLabel()),this.addChild(this.inputId),this.addChild(this.inputPositionX),this.addChild(this.inputPositionY),this.addChild(this.inputPositionLeft),this.addChild(this.inputPositionTop),this.addChild(this.inputSizeX),this.addChild(this.inputSizeY),this.addChild(this.inputRotation),this.addChild(this.inputSkew),this.addChild(this.layoutAlignHorizontally),this.addChild(this.layoutAlignVertically);const n=this._selection;n.on("change",(()=>{this.onSelectionChange(n)})),this.onSelectionChange(n)}newTextLabel(){return new t.DText({width:"100%",text:{value:this.theme.getLabel()}})}get inputId(){let t=this._inputId;return null==t&&(t=this.newInputId(),this._inputId=t),t}newInputId(){return new t.DInputTextAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputIdLabel()}},input:{weight:1,on:{change:t=>{this._selection.setId(t)}}}})}get inputPositionX(){let t=this._inputPositionX;return null==t&&(t=this.newInputPositionX(),this._inputPositionX=t),t}newInputPositionX(){return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputPositionXLabel()}},input:{weight:1,step:1,text:{value:0,formatter:fi},on:{input:t=>{this._selection.setPositionX(t)}}}})}get inputPositionY(){let t=this._inputPositionY;return null==t&&(t=this.newInputPositionY(),this._inputPositionY=t),t}newInputPositionY(){return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputPositionYLabel()}},input:{weight:1,step:1,text:{value:0,formatter:fi},on:{input:t=>{this._selection.setPositionY(t)}}}})}get inputPositionLeft(){let t=this._inputPositionLeft;return null==t&&(t=this.newInputPositionLeft(),this._inputPositionLeft=t),t}newInputPositionLeft(){return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputPositionLeftLabel()}},input:{weight:1,step:1,text:{value:0,formatter:fi},on:{input:t=>{this._selection.setPositionLeft(t)}}}})}get inputPositionTop(){let t=this._inputPositionTop;return null==t&&(t=this.newInputPositionTop(),this._inputPositionTop=t),t}newInputPositionTop(){return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputPositionTopLabel()}},input:{weight:1,step:1,text:{value:0,formatter:fi},on:{input:t=>{this._selection.setPositionTop(t)}}}})}get inputSizeX(){let t=this._inputSizeX;return null==t&&(t=this.newInputSizeX(),this._inputSizeX=t),t}newInputSizeX(){return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputSizeXLabel()}},input:{weight:1,step:1,text:{value:0,formatter:fi},on:{input:t=>{this._selection.setSizeX(t)}}}})}get inputSizeY(){let t=this._inputSizeY;return null==t&&(t=this.newInputSizeY(),this._inputSizeY=t),t}newInputSizeY(){return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputSizeYLabel()}},input:{weight:1,step:1,text:{value:0,formatter:fi},on:{input:t=>{this._selection.setSizeY(t)}}}})}get inputRotation(){let t=this._inputRotation;return null==t&&(t=this.newInputRotation(),this._inputRotation=t),t}newInputRotation(){return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputRotationLabel()}},input:{weight:1,step:1,text:{value:0,formatter:Ai},editing:{unformatter:Bi},on:{input:t=>{this._selection.setRotation(t)}}}})}get inputSkew(){let t=this._inputSkew;return null==t&&(t=this.newInputSkew(),this._inputSkew=t),t}newInputSkew(){return new t.DInputRealAndLabel({width:"padding",height:"auto",label:{text:{value:this.theme.getInputSkewLabel()}},input:{weight:1,step:1,text:{value:0,formatter:Ai},editing:{unformatter:Bi},on:{input:t=>{this._selection.setSkew(t)}}}})}get layoutAlignHorizontally(){let t=this._layoutAlignHorizontally;return null==t&&(t=this.newLayoutAlignHorizontally(),this._layoutAlignHorizontally=t),t}newLayoutAlignHorizontally(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonAlignLeft,this.buttonAlignCenter,this.buttonAlignRight,this.buttonDistributeHorizontally,this.buttonDistributeVertically,this.buttonLock,new t.DLayoutSpace({weight:1})]})}get layoutAlignVertically(){let t=this._layoutAlignVertically;return null==t&&(t=this.newLayoutAlignVertically(),this._layoutAlignVertically=t),t}newLayoutAlignVertically(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonAlignTop,this.buttonAlignMiddle,this.buttonAlignBottom,this.buttonRotateLeft,this.buttonRotateRight,new t.DLayoutSpace({weight:1})]})}get buttonAlignLeft(){let t=this._buttonAlignLeft;return null==t&&(t=this.newButtonAlignLeft(),this._buttonAlignLeft=t),t}newButtonAlignLeft(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_left},title:this.theme.getButtonAlignLeftTitle(),on:{active:()=>{const t=this._selection;t.saveForTranslate(),t.alignLeft()}}})}get buttonAlignCenter(){let t=this._buttonAlignCenter;return null==t&&(t=this.newButtonAlignCenter(),this._buttonAlignCenter=t),t}newButtonAlignCenter(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_center},title:this.theme.getButtonAlignCenterTitle(),on:{active:()=>{const t=this._selection;t.saveForTranslate(),t.alignCenter()}}})}get buttonAlignRight(){let t=this._buttonAlignRight;return null==t&&(t=this.newButtonAlignRight(),this._buttonAlignRight=t),t}newButtonAlignRight(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_right},title:this.theme.getButtonAlignRightTitle(),on:{active:()=>{const t=this._selection;t.saveForTranslate(),t.alignRight()}}})}get buttonAlignTop(){let t=this._buttonAlignTop;return null==t&&(t=this.newButtonAlignTop(),this._buttonAlignTop=t),t}newButtonAlignTop(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_top},title:this.theme.getButtonAlignTopTitle(),on:{active:()=>{const t=this._selection;t.saveForTranslate(),t.alignTop()}}})}get buttonAlignMiddle(){let t=this._buttonAlignMiddle;return null==t&&(t=this.newButtonAlignMiddle(),this._buttonAlignMiddle=t),t}newButtonAlignMiddle(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_middle},title:this.theme.getButtonAlignMiddleTitle(),on:{active:()=>{const t=this._selection;t.saveForTranslate(),t.alignMiddle()}}})}get buttonAlignBottom(){let t=this._buttonAlignBottom;return null==t&&(t=this.newButtonAlignBottom(),this._buttonAlignBottom=t),t}newButtonAlignBottom(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_align_bottom},title:this.theme.getButtonAlignBottomTitle(),on:{active:()=>{const t=this._selection;t.saveForTranslate(),t.alignBottom()}}})}get buttonDistributeHorizontally(){let t=this._buttonDistributeHorizontally;return null==t&&(t=this.newButtonDistributeHorizontally(),this._buttonDistributeHorizontally=t),t}newButtonDistributeHorizontally(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_distribute_horizontally},title:this.theme.getButtonDistributeHorizontallyTitle(),on:{active:()=>{const t=this._selection;t.saveForTranslate(),t.distributeHorizontally()}}})}get buttonDistributeVertically(){let t=this._buttonDistributeVertically;return null==t&&(t=this.newButtonDistributeVertically(),this._buttonDistributeVertically=t),t}newButtonDistributeVertically(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_distribute_vertically},title:this.theme.getButtonDistributeVerticallyTitle(),on:{active:()=>{const t=this._selection;t.saveForTranslate(),t.distributeVertically()}}})}get buttonRotateLeft(){let t=this._buttonRotateLeft;return null==t&&(t=this.newButtonRotateLeft(),this._buttonRotateLeft=t),t}newButtonRotateLeft(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_rotate_left},title:this.theme.getButtonRotateLeftTitle(),on:{active:()=>{const t=this._selection;t.prepareRotate()&&(t.saveForRotate(),t.rotate(-.5*Math.PI),t.finalize())}}})}get buttonRotateRight(){let t=this._buttonRotateRight;return null==t&&(t=this.newButtonRotateRight(),this._buttonRotateRight=t),t}newButtonRotateRight(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_coordinate_rotate_right},title:this.theme.getButtonRotateRightTitle(),on:{active:()=>{const t=this._selection;t.prepareRotate()&&(t.saveForRotate(),t.rotate(.5*Math.PI),t.finalize())}}})}get buttonLock(){let t=this._buttonLock;return null==t&&(t=this.newButtonLock(),this._buttonLock=t),t}newButtonLock(){return new t.DButtonCheck({theme:"EButtonEditorLock",on:{active:()=>{this._selection.lockCapability(t.EShapeCapability.COORDINATE)},inactive:()=>{this._selection.unlockCapability(t.EShapeCapability.COORDINATE)}}})}onSelectionChange(e){const n=e.last();this.state.isDisabled=null==n;const i=t.EShapeCapabilities.contains(n,t.EShapeCapability.POSITION);this.inputPositionX.state.isEnabled=i,this.inputPositionY.state.isEnabled=i,this.inputPositionLeft.state.isEnabled=i,this.inputPositionTop.state.isEnabled=i,this.inputRotation.state.isEnabled=t.EShapeCapabilities.contains(n,t.EShapeCapability.ROTATION),this.inputSizeX.state.isEnabled=t.EShapeCapabilities.contains(n,t.EShapeCapability.WIDTH),this.inputSizeY.state.isEnabled=t.EShapeCapabilities.contains(n,t.EShapeCapability.HEIGHT),this.inputSkew.state.isEnabled=t.EShapeCapabilities.contains(n,t.EShapeCapability.SKEW),this.buttonLock.state.isActive=this.isLocked(n),this.updateInputs(e.get())}isLocked(e){if(null==e)return!1;const n=e.getCapability();if(null==n)return!1;const i=t.EShapeCapability.COORDINATE;return!!(n.locked&i)}renderInputs(){if(this._updateInputId=null,this._isUpdateInputShapeChanged){this._isUpdateInputShapeChanged=!1;const t=this._updateInputShape;if(null!=t){const e=t.transform,n=e.position,i=t.size;this.inputId.input.value=t.id,this.inputPositionX.input.value=n.x,this.inputPositionY.input.value=n.y,this.inputSizeX.input.value=i.x,this.inputSizeY.input.value=i.y,this.inputRotation.input.value=e.rotation,this.inputSkew.input.value=e.skew.x;const o=this._workRectangle;t.getBoundsLocal(!1,o),this.inputPositionLeft.input.value=o.x,this.inputPositionTop.input.value=o.y}this._updateInputId=window.setTimeout(this._renderInputsBound,100)}}updateInputs(t){const e=0<t.length?t[t.length-1]:null;this._updateInputShape=e,this._isUpdateInputShapeChanged=!0,null==this._updateInputId&&this.renderInputs()}getType(){return"EEditorCoordinate"}}class Ii extends t.DLayoutVertical{constructor(e){super(e);const n=e.selection;this._selection=n,this._icons=e.icons,this.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[this.newTextLabel(),this.buttonNew,this.buttonDelete,this.buttonBringForward,this.buttonSendBackward]})),this.addChild(this.listDataMappingValue),n.on("change",(()=>{this.onSelectionChange(n)}));const i=this.listDataMappingValue;i.selection.on("change",(()=>{this.onListDataMappingValueSelectionChange(i)})),this.onSelectionChange(n)}newTextLabel(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})}get buttonNew(){let t=this._buttonNew;return null==t&&(t=this.newButtonNew(),this._buttonNew=t),t}newButtonNew(){return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.theme.getButtonNewTitle(),on:{active:t=>{this.onButtonNewActive(t)}}})}onButtonNewActive(t){this.dialogDataMappingValue.set(null,this._selection.last()).open(t).then((t=>{null!=t&&this._selection.addDataMappingValue(t)}))}get buttonDelete(){let t=this._buttonDelete;return null==t&&(t=this.newButtonDelete(),this._buttonDelete=t),t}newButtonDelete(){return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.theme.getButtonDeleteTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const t=this.listDataMappingValue.selection.first;null!=t&&this._selection.removeDataMappingValue(t)}}})}onListDataMappingValueSelectionChangeButtonDelete(t){this.buttonDelete.state.isDisabled=t.data.selection.isEmpty()}get buttonBringForward(){let t=this._buttonBringForward;return null==t&&(t=this.newButtonBringForward(),this._buttonBringForward=t),t}newButtonBringForward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonBringForwardTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const t=this.listDataMappingValue,e=t.data.selection.first,n=t.data.items;null!=e&&n[0]!==e&&this._selection.bringDataMappingValueForward(e)}}})}onListDataMappingValueSelectionChangeButtonBringForward(t){const e=t.data.selection.first,n=t.data.items;this.buttonBringForward.state.isDisabled=null==e||n[0]===e}get buttonSendBackward(){let t=this._buttonSendBackward;return null==t&&(t=this.newButtonSendBackward(),this._buttonSendBackward=t),t}newButtonSendBackward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonSendBackwardTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const t=this.listDataMappingValue,e=t.data.selection.first,n=t.data.items;null!=e&&n[n.length-1]!==e&&this._selection.sendDataMappingValueBackward(e)}}})}onListDataMappingValueSelectionChangeButtonSendBackward(t){const e=t.data.selection.first,n=t.data.items;this.buttonSendBackward.state.isDisabled=null==e||n[n.length-1]===e}get dialogDataMappingValue(){let t=this._dialogDataMappingValue;return null==t&&(t=this.newDialogDataMappingValue(),this._dialogDataMappingValue=t),t}newDialogDataMappingValue(){return new pi}get listDataMappingValue(){let t=this._listDataMappingValue;return null==t&&(t=this.newListDataMappingValue(),this._listDataMappingValue=t),t}newListDataMappingValue(){const e=new t.DList({width:"padding",weight:1,data:{toLabel:t=>{const e=t[0],n=t[1],i=t[2];return 0<n.length?0<i.length?`${e} -> ${n}, ${i}`:`${e} -> ${n}`:0<i.length?`${e} -> ${i}`:`${e}`}},updater:{newItem:n=>new t.DListItem(n,{on:{dblclick:(t,n,i)=>{this.onListDataMappingValueDblClick(t,n,i,e)}}})}});return e}onListDataMappingValueDblClick(t,e,n,i){const o=n.value;null!=o&&this.dialogDataMappingValue.set(o,this._selection.last()).open(n).then((t=>{null!=t&&this._selection.replaceDataMappingValue(o,t,i)}))}onSelectionChangeListDataMappingValue(t){var e,n;const i=this.listDataMappingValue;i.data.items=(null===(n=null===(e=t.last())||void 0===e?void 0:e.data.getMapping())||void 0===n?void 0:n.values)||[],this.onListDataMappingValueSelectionChange(i)}onSelectionChange(e){this.state.isDisabled=!t.EShapeCapabilities.contains(e.last(),t.EShapeCapability.DATA_MAPPING),this.onSelectionChangeListDataMappingValue(e)}onListDataMappingValueSelectionChange(t){this.onListDataMappingValueSelectionChangeButtonDelete(t),this.onListDataMappingValueSelectionChangeButtonBringForward(t),this.onListDataMappingValueSelectionChangeButtonSendBackward(t)}getType(){return"EEditorDataMapping"}}class Ri extends t.DLayoutVertical{constructor(e){super(e);const n=e.selection;this._selection=n,this._icons=e.icons,this.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[this.newTextLabel(),this.buttonNew,this.buttonDelete,this.buttonBringForward,this.buttonSendBackward]})),this.addChild(this.listDataValue),n.on("change",(()=>{this.onSelectionChange(n)}));const i=this.listDataValue;i.selection.on("change",(()=>{this.onListDataValueSelectionChange(i)})),this.onSelectionChange(n)}newTextLabel(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})}get buttonNew(){let t=this._buttonNew;return null==t&&(t=this.newButtonNew(),this._buttonNew=t),t}newButtonNew(){return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.theme.getButtonNewTitle(),on:{active:t=>{this.onButtonNewActive(t)}}})}onButtonNewActive(t){this.dialogDataValue.reset().open(t).then((t=>{null!=t&&this._selection.addDataValue(t)}))}get buttonDelete(){let t=this._buttonDelete;return null==t&&(t=this.newButtonDelete(),this._buttonDelete=t),t}newButtonDelete(){return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.theme.getButtonDeleteTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const t=this.listDataValue.selection.first;null!=t&&this._selection.removeDataValue(t)}}})}onListDataValueSelectionChangeButtonDelete(t){this.buttonDelete.state.isDisabled=t.data.selection.isEmpty()}get buttonBringForward(){let t=this._buttonBringForward;return null==t&&(t=this.newButtonBringForward(),this._buttonBringForward=t),t}newButtonBringForward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonBringForwardTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const t=this.listDataValue,e=t.data.selection.first,n=t.data.items;null!=e&&n[0]!==e&&this._selection.bringDataValueForward(e)}}})}onListDataValueSelectionChangeButtonBringForward(t){const e=t.data.selection.first,n=t.data.items;this.buttonBringForward.state.isDisabled=null==e||n[0]===e}get buttonSendBackward(){let t=this._buttonSendBackward;return null==t&&(t=this.newButtonSendBackward(),this._buttonSendBackward=t),t}newButtonSendBackward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonSendBackwardTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const t=this.listDataValue,e=t.data.selection.first,n=t.data.items;null!=e&&n[n.length-1]!==e&&this._selection.sendDataValueBackward(e)}}})}onListDataValueSelectionChangeButtonSendBackward(t){const e=t.data.selection.first,n=t.data.items;this.buttonSendBackward.state.isDisabled=null==e||n[n.length-1]===e}get dialogDataValue(){let t=this._dialogDataValue;return null==t&&(t=this.newDialogDataValue(),this._dialogDataValue=t),t}newDialogDataValue(){return new di}get listDataValue(){let t=this._listDataValue;return null==t&&(t=this.newListDataValue(),this._listDataValue=t),t}newListDataValue(){const e=new t.DList({width:"padding",weight:1,data:{toLabel:e=>{const n=e.type,i=e.as,o=0<i.length?`${i}: `:"";switch(n){case t.EShapeDataValueType.BOOLEAN:case t.EShapeDataValueType.BOOLEAN_ARRAY:case t.EShapeDataValueType.NUMBER:case t.EShapeDataValueType.NUMBER_ARRAY:case t.EShapeDataValueType.STRING:case t.EShapeDataValueType.STRING_ARRAY:case t.EShapeDataValueType.OBJECT:case t.EShapeDataValueType.OBJECT_ARRAY:return o+e.id;case t.EShapeDataValueType.TICKER:return o+`Ticker ${e.initial} ms`;default:const i=t.EShapeDataValueExtensions.get(n);return i?o+i.label:o+"Unknown"}}},updater:{newItem:n=>new t.DListItem(n,{on:{dblclick:(t,n,i)=>{this.onListDataValueDblClick(t,n,i,e)}}})}});return e}onListDataValueDblClick(t,e,n,i){const o=n.value;if(null!=o){const t=this.dialogDataValue;t.value=o,t.open(n).then((t=>{null!=t&&this._selection.replaceDataValue(o,t,i)}))}}onSelectionChangeListDataValue(t){var e;const n=this.listDataValue;n.data.items=(null===(e=t.last())||void 0===e?void 0:e.data.values)||[],this.onListDataValueSelectionChange(n)}onSelectionChange(t){this.state.isDisabled=t.isEmpty(),this.onSelectionChangeListDataValue(t)}onListDataValueSelectionChange(t){this.onListDataValueSelectionChangeButtonDelete(t),this.onListDataValueSelectionChangeButtonBringForward(t),this.onListDataValueSelectionChangeButtonSendBackward(t)}getType(){return"EEditorData"}}class Oi extends t.DListItem{constructor(t,e,n,i,o){super(i,o),this._iconsEye=t,this._iconsEyeSlash=e,this._iconsWork=n}onSelect(t,e){if(null!=t){const n=this._iconsWork;if("data"in t&&(this.toLocal(t.data.global,void 0,n),n.x<=this._iconsEye.width+this.padding.getLeft()))return void this.emit("eyeclick",t,e,this)}super.onSelect(t,e)}onDblClick(e,n){const i=t.UtilPointerEvent.toGlobal(e,n,this._iconsWork),o=this.toLocal(i,void 0,i);return this._iconsEye.width+this.padding.getLeft()<o.x?super.onDblClick(e,n):(this.emit("eyedblclick",e,n,this),!1)}}class ki extends t.DLayoutVertical{constructor(t){super(t),this._icons=t.icons,this._diagram=t.diagram,this._selection=t.selection,this._isInitialized=!1,this._canvas=null}show(){return super.show(),this.onShow(),this}onShow(){this._isInitialized||(this._isInitialized=!0,this.initLayout()),this.onCanvasChange(this._diagram.canvas,!0)}initLayout(){this.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[this.newTextLabel(),this.buttonNew,this.buttonDelete,this.buttonBringForward,this.buttonSendBackward]})),this.addChild(this.list);const e=this._diagram;e.on("set",(t=>{this.isShown()&&this.onCanvasChange(t,!1)})),e.on("ready",(()=>{this.isShown()&&this.onLayerChange()})),e.on("unset",(()=>{this.isShown()&&this.onCanvasChange(null,!1)}))}newTextLabel(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})}get onLayerChangeBound(){let t=this._onLayerChangeBound;return null==t&&(t=()=>{this.onLayerChange()},this._onLayerChangeBound=t),t}get dialog(){let t=this._dialog;return null==t&&(t=this.newDialog(),this._dialog=t),t}newDialog(){return new gi}get buttonNew(){let t=this._buttonNew;return null==t&&(t=this.newButtonNew(),this._buttonNew=t),t}newButtonNew(){return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.theme.getButtonNewTitle(),on:{active:t=>{this.onButtonNewActive(t)}}})}onButtonNewActive(e){const n=this._canvas;n&&this.dialog.reset(n.width,n.height).open(e).then((e=>{e&&t.DControllers.getCommandController().push(new B(e,n.layer,this._selection))}))}get buttonDelete(){let t=this._buttonDelete;return null==t&&(t=this.newButtonDelete(),this._buttonDelete=t),t}newButtonDelete(){return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.theme.getButtonDeleteTitle(),on:{active:()=>{const e=this._canvas;if(e){const n=e.layer,i=n.size(),o=n.active;1<i&&o&&t.DControllers.getCommandController().push(new x(o,e.layer,this._selection))}}}})}get buttonBringForward(){let t=this._buttonBringForward;return null==t&&(t=this.newButtonBringForward(),this._buttonBringForward=t),t}newButtonBringForward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonBringForwardTitle(),on:{active:()=>{const e=this._canvas;if(e){const n=e.layer,i=n.active;if(i){const e=n.children.indexOf(i);t.DControllers.getCommandController().push(new D(e,n))}}}}})}get buttonSendBackward(){let t=this._buttonSendBackward;return null==t&&(t=this.newButtonSendBackward(),this._buttonSendBackward=t),t}newButtonSendBackward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonSendBackwardTitle(),on:{active:()=>{const e=this._canvas;if(e){const n=e.layer,i=n.active;if(i){const e=n.children.indexOf(i);t.DControllers.getCommandController().push(new I(e,n))}}}}})}get list(){let t=this._list;return null==t&&(t=this.newList(),this._list=t),t}newList(){const n=this._icons,i=n.eye,o=n.eye_slash,a=new e.Point,s=new t.DList({x:"padding",width:"padding",weight:1,data:{selection:{on:{change:()=>{this.onListSelectionChange()}}},toImage:t=>t.visible?i:o},updater:{newItem:t=>new Oi(i,o,a,t,{on:{eyeclick:(t,e,n)=>{e&&(e.visible?(e.visible=!1,n.image=o):(e.visible=!0,n.image=i))},dblclick:(t,e,n)=>{this.onListDblClick(t,e,n,s)}}})},on:{keydown:e=>{if(t.UtilKeyboardEvent.isDeleteKey(e)){const e=this._canvas;if(e){const n=e.layer,i=n.size(),o=n.active;1<i&&o&&t.DControllers.getCommandController().push(new x(o,n,this._selection))}}}}});return s}onListDblClick(e,n,i,o){const a=this._canvas;if(a){const e=a.layer.active;if(e){const n=f.from(e),o=this.dialog;o.value=n,o.open(i).then((i=>{i&&!i.isEqual(n)&&t.DControllers.getCommandController().push(new A(e,i,a.layer))}))}}}onListLayerChange(){const t=this.list,e=this._canvas;if(e){const n=e.layer,i=n.children,o=n.active,a=t.data.items;for(let t=0,e=i.length;t<e;++t)a[t]=i[e-1-t];a.length=i.length,t.update(!0),null!=o?t.data.selection.clearAndAdd(o):t.data.selection.clear()}else t.data.items=[]}onListSelectionChange(){const e=this.list.data.selection.first;if(e){const n=this._canvas;if(n&&n.layer.active!==e){const i=this._selection;if(!i.isEmpty()){const e=i.store();if(i.clear()){const n=i.store();t.DControllers.getCommandController().push(new me(e,n,i))}}n.layer.active=e}}}onCanvasChange(t,e){const n=this._canvas;if(t!==this._canvas){const e=this.onLayerChangeBound;null!=n&&n.layer.off("change",e),this._canvas=t,null!=t?(this.state.isDisabled=!1,t.layer.on("change",e)):this.state.isDisabled=!0,this.onLayerChange()}else e&&this.onLayerChange()}isActiveDeletable(t){return!!t&&1<t.layer.size()}isActiveNotLast(t){if(t){const e=t.layer,n=e.children,i=e.active;if(i)return i!==n[n.length-1]}return!1}isActiveNotFirst(t){if(t){const e=t.layer,n=e.children,i=e.active;if(i)return i!==n[0]}return!1}onLayerChange(){const t=this._canvas;this.state.isEnabled=null!=t,this.buttonDelete.state.isEnabled=this.isActiveDeletable(t),this.buttonSendBackward.state.isEnabled=this.isActiveNotFirst(t),this.buttonBringForward.state.isEnabled=this.isActiveNotLast(t),this.onListLayerChange(),this._selection.updateModifier()}getType(){return"EEditorLayer"}}let Pi;const Vi=()=>null!=Pi?Pi:Pi=t.DThemes.get("FShapeType"),Mi=e=>{const n=e.id;if(0<n.length)return n;const i=e.type;if(t.EShapeType.EXTENSION<=i){const t=Ne.get(i);if(t&&"name"in t){const e=t.name;if(null!=e)return e}return Vi().getLabel(i)}return i===t.EShapeType.EMBEDDED&&e instanceof t.EShapeEmbedded?e.name:Vi().getLabel(i)},Ni=e=>{if(t.EShapeType.EXTENSION<=e){const t=Ne.get(e);if(t&&"name"in t){const e=t.name;if(null!=e)return e}return Vi().getLabel(e)}return Vi().getLabel(e)};class Fi extends t.DLayoutVertical{constructor(e){var n;super(e);const i=e.selection;this._selection=i,this._icons=e.icons,this._finder=e.finder,this._interval=null!==(n=e.interval)&&void 0!==n?n:333;const o=e.diagram;this._diagram=o,this.state.isDisabled=null==o.canvas,o.on("unset",(()=>{this.list.data.clear(),this.state.isDisabled=!0})),o.on("set",(()=>{this.state.isDisabled=!1})),this.addChild(this.newTextLabel()),null!=this._finder?this.addChild(this.inputSearch):(this.addChild(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getInputIdLabel()}}),this.inputId]})),this.addChild(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getSelectTypeLabel()}}),this.selectType]})),this.addChild(new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DInputLabel({width:60,text:{value:this.theme.getSelectStateLabel()}}),this.selectState]})),this.addChild(this.buttonExecute)),this.addChild(this.list)}newTextLabel(){return new t.DText({x:"padding",width:"padding",text:{value:this.theme.getLabel()}})}get inputSearch(){var t;return null!==(t=this._inputSearch)&&void 0!==t?t:this._inputSearch=this.newInputSearch()}newInputSearch(){return new t.DInputSearch({x:"padding",width:"padding",on:{input:t=>{this.search(t)},enter:t=>{this.search(t.value)}}})}get inputId(){var t;return null!==(t=this._inputId)&&void 0!==t?t:this._inputId=this.newInputId()}newInputId(){return new t.DInputText({weight:1,on:{enter:()=>{this.buttonExecute.activate()}}})}get selectType(){var t;return null!==(t=this._selectType)&&void 0!==t?t:this._selectType=this.newSelectType()}newSelectType(){return new t.DSelect({weight:1,value:-1,menu:{width:"auto",column:3,fit:!1,items:this.newSelectTypeMenuItems()}})}newSelectTypeMenuItems(){const e=[this.newSelectTypeMenuItem(-1,this.theme.toTypeLabel(-1)),this.newSelectTypeMenuItemShape(t.EShapeType.CIRCLE),this.newSelectTypeMenuItemShape(t.EShapeType.SEMICIRCLE),this.newSelectTypeMenuItemShape(t.EShapeType.RECTANGLE),this.newSelectTypeMenuItemShape(t.EShapeType.RECTANGLE_ROUNDED),this.newSelectTypeMenuItemShape(t.EShapeType.TRIANGLE),this.newSelectTypeMenuItemShape(t.EShapeType.TRIANGLE_ROUNDED),this.newSelectTypeMenuItemShape(t.EShapeType.LINE),this.newSelectTypeMenuItemShape(t.EShapeType.CONNECTOR_LINE),this.newSelectTypeMenuItemShape(t.EShapeType.CONNECTOR_ELBOW),this.newSelectTypeMenuItemShape(t.EShapeType.IMAGE),this.newSelectTypeMenuItemShape(t.EShapeType.GROUP),this.newSelectTypeMenuItemShape(t.EShapeType.BAR),this.newSelectTypeMenuItemShape(t.EShapeType.BUTTON),this.newSelectTypeMenuItemShape(t.EShapeType.EMBEDDED),this.newSelectTypeMenuItemShape(t.EShapeType.EMBEDDED_LAYER),this.newSelectTypeMenuItemShape(t.EShapeType.EMBEDDED_ACCEPTOR_EDGE)];return Ne.each((t=>{"type"in t&&e.push(this.newSelectTypeMenuItemShape(t.type))})),e}newSelectTypeMenuItem(t,e){return{width:200,value:t,text:{value:e}}}newSelectTypeMenuItemShape(t){return this.newSelectTypeMenuItem(t,Ni(t))}getSelectTypeValue(){const t=this._selectType;if(null!=t){const e=t.value;if(null!=e&&0<=e)return e}return null}get selectState(){var t;return null!==(t=this._selectState)&&void 0!==t?t:this._selectState=this.newSelectState()}newSelectState(){const e=this.theme;return new t.DSelect({weight:1,value:-1,menu:{items:[this.newSelectStateMenuItem(-1,e),this.newSelectStateMenuItem(2,e),this.newSelectStateMenuItem(1,e),this.newSelectStateMenuItem(0,e)]}})}newSelectStateMenuItem(t,e){return{value:t,text:{value:e.toStateLabel(t)}}}getSelectStateValue(){const t=this.selectState.value;return null!=t&&0<=t?t:null}get buttonExecute(){var t;return null!==(t=this._buttonExecute)&&void 0!==t?t:this._buttonExecute=this.newButtonExecute()}newButtonExecute(){return new t.DButtonPrimary({width:"padding",text:{value:this.theme.getButtonExecuteTitle()},image:{source:this._icons.editor_search},on:{active:t=>{this.onButtonExecuteActive(t)}}})}onButtonExecuteActive(e){var n,i;const o=this.indicatorExecute;o.start();const a=[],s=this._diagram.canvas;if(null!=s){const e=this.inputId.value.trim(),o=null!==(n=this.selectType.value)&&void 0!==n?n:-1,l=null!==(i=this.selectState.value)&&void 0!==i?i:-1;s.shape.each((n=>{if(0<e.length&&n.id.indexOf(e)<0)return!0;if(-1!==o&&o!==n.type)return!0;switch(l){case 2:if(n instanceof t.EShapeConnectorLine){const t=n.edge,e=t.tail.acceptor.shape,i=t.head.acceptor.shape;if(null==e||null==i)return!0}else if(n.connector.size()<=0)return!0;break;case 1:if(!(n instanceof t.EShapeConnectorLine))return!0;{const t=n.edge,e=t.tail.acceptor.shape,i=t.head.acceptor.shape;if(null==e&&null==i||null!=e&&null!=i)return!0}break;case 0:if(n instanceof t.EShapeConnectorLine){const t=n.edge,e=t.tail.acceptor.shape,i=t.head.acceptor.shape;if(null!=e||null!=i)return!0}else if(0<n.connector.size())return!0}return a.push(n),!0}))}this.list.data.clearAndAddAll(a),o.resolve()}get indicatorExecute(){var t;return null!==(t=this._indicatorExecute)&&void 0!==t?t:this._indicatorExecute=this.newIndicatorExecute()}newIndicatorExecute(){return new t.DIndicatorProcessing(this.buttonExecute)}search(t){const e=this._searching,n=this._searched,i=this._searchedAt;if(e!==n||null!=i&&Date.now()-i<500)this._requested=t,null==this._timeoutId&&(this._timeoutId=window.setTimeout((()=>{this._timeoutId=null;const t=this._requested;null!=t&&(this._requested=void 0,this.search(t))}),500));else{const e=this._timeoutId;null!=e&&(this._timeoutId=null,window.clearTimeout(e)),this._searching=t,this.doSearch(t).then((t=>{this.list.data.clearAndAddAll(t.shapes),this._searched=t.word,this._searchedAt=Date.now()}))}}doSearch(e){const n=this._finder;if(null==n)return Promise.resolve({word:e,shapes:[]});const i=this._diagram.canvas;if(null==i)return Promise.resolve({word:e,shapes:[]});const o=e.trim();if(o.length<=0)return Promise.resolve({word:e,shapes:[]});try{const a=n(i,o);return t.isArray(a)?Promise.resolve({word:e,shapes:a}):a.then((t=>({word:e,shapes:t})),(()=>({word:e,shapes:[]})))}catch(t){return Promise.resolve({word:e,shapes:[]})}}get list(){var t;return null!==(t=this._list)&&void 0!==t?t:this._list=this.newList()}newList(){return new t.DList({width:"padding",weight:1,data:{toLabel:t=>Mi(t),toTitle:t=>{},toImage:t=>null},updater:{newItem:e=>new t.DListItem(e,{on:{select:(t,e)=>{this.onListItemDown(t,e)}}})}})}onListItemDown(e,n){const i=e;if(null!=i){const e=this._diagram.canvas,o=i.root.parent;if(null!=e&&null!=o){const n=this._selection,a=n.store();if(n.set(i)){n.focus();const e=n.store();t.DControllers.getCommandController().push(new me(a,e,n))}else n.focus();e.layer.active!==o&&(e.layer.active=o)}else this.dialogError.open(n)}}get dialogError(){var t;return null!==(t=this._dialogError)&&void 0!==t?t:this._dialogError=this.newDialogError()}newDialogError(){return new t.DDialogMessage({message:this.theme.getDialogErrorLabel()})}get dialogProcessing(){var t;return null!==(t=this._dialogProcessing)&&void 0!==t?t:this._dialogProcessing=this.newDialogProcessing()}newDialogProcessing(){return new t.DDialogProcessing}getType(){return"EEditorSearch"}}class zi extends t.DPane{constructor(t){super(t),this._icons=t.icons,this._canvas=t.canvas,this._selection=t.selection,this._isInitialized=!1;const e=t.piece;e?(this._isPieceEnabled=e.enable,this._pieceExcluder=e.exclude,this._controller=e.controller):this._isPieceEnabled=!1,this._isChangeable=t.changeable}show(){return super.show(),this.onShow(),this}onShow(){this._isInitialized||(this._isInitialized=!0,this.initLayout()),this.onSelectionChange()}initLayout(){new t.DLayoutVertical({parent:this.content,x:"padding",y:"padding",width:"padding",height:"auto",children:[this.layoutChangeTo,this.buttonFill,this.buttonFillColor,this.layoutTexture,this.buttonStroke,this.buttonStrokeColor,this.inputStrokeWidth,this.inputStrokeAlign,this.layoutStrokeSide,this.textCorner,this.inputCornerRadius,this.layoutCorner,this.layoutLine,this.selectLineStyle,this.selectLineType,this.layoutLineTail,this.selectLineTailType,this.layoutLineTailSize,this.buttonLineTailColor,this.inputLineTailMargin,this.layoutLineHead,this.selectLineHeadType,this.layoutLineHeadSize,this.buttonLineHeadColor,this.inputLineHeadMargin]}),this._selection.on("change",(()=>{this.isShown()&&this.onSelectionChange()}))}get layoutChangeTo(){let t=this._layoutChangeTo;return void 0===t&&(t=!1!==this._isChangeable?this.newLayoutChangeTo():null,this._layoutChangeTo=t),t}newLayoutChangeTo(){const e=[this.newTextChangeToLabel(),this.buttonCircle,this.buttonSemicircle,this.buttonRectangle,this.buttonRectangleRounded,this.buttonTriangle,this.buttonTriangleRounded,this.buttonLine,this.buttonLineConnector,this.buttonElbowConnector,this.buttonImage,this.buttonGraphicPiece];return ri.each((t=>{e.push(this.newButtonExtensionFactory(t))})),Ne.each((n=>{if(this.isExtensionReplacable(n)){const i=n.creator;t.isFunction(i)&&e.push(this.newButtonExtension(n,i))}})),e.push(this.buttonGroup,this.buttonUngroup),new t.DLayoutVertical({width:"100%",height:"auto",column:7,children:e})}isExtensionReplacable(e){if("icon"in e){if("type"in e){const n=t.EShapeCapabilities.get(e.type);if(null!=n)return!!(n&t.EShapeCapability.REPLACING)}return!0}return!1}newTextChangeToLabel(){return new t.DText({width:"100%",text:{value:this.theme.getTextChangeToLabel()},clear:"AFTER"})}newButtonExtensionFactory(e){let n=null;return new t.DButtonAmbient({image:{source:e.icon.texture},title:this.toExtensionTitle(e),theme:"EButtonEditor",on:{active:t=>{n=n||this.newDialogSelectExtensionFactory(e),n.open(t)}}})}newDialogSelectExtensionFactory(e){return new t.DDialogSelect({controller:e,list:{data:{toLabel:e.item.toLabel}},on:{select:t=>{e.item.toCreator(t).then((t=>{this._selection.replace(t)}))}}})}newButtonExtension(e,n){return new t.DButtonAmbient({image:{source:e.icon.texture},title:this.toExtensionTitle(e),theme:"EButtonEditor",on:{active:()=>{this._selection.replace(n)}}})}toExtensionTitle(e){const n=e.title;return t.isString(n)?n:n.change}get buttonCircle(){var t;return null!==(t=this._buttonCircle)&&void 0!==t?t:this._buttonCircle=this.newButtonCircle()}newButtonCircle(){return new t.DButtonAmbient({image:{source:this._icons.shape_circle},title:this.theme.getButtonCircleTitle(),theme:"EButtonEditor",on:{active:()=>{this._selection.replace((e=>e.type!==t.EShapeType.CIRCLE?(new t.EShapeCircle).copy(e):null))}}})}get buttonSemicircle(){var t;return null!==(t=this._buttonSemicircle)&&void 0!==t?t:this._buttonSemicircle=this.newButtonSemicircle()}newButtonSemicircle(){return new t.DButtonAmbient({image:{source:this._icons.shape_semicircle},title:this.theme.getButtonSemicircleTitle(),theme:"EButtonEditor",on:{active:()=>{this._selection.replace((e=>e.type!==t.EShapeType.SEMICIRCLE?(new t.EShapeSemicircle).copy(e):null))}}})}get buttonRectangle(){var t;return null!==(t=this._buttonRectangle)&&void 0!==t?t:this._buttonRectangle=this.newButtonRectangle()}newButtonRectangle(){return new t.DButtonAmbient({image:{source:this._icons.shape_rectangle},title:this.theme.getButtonRectangleTitle(),theme:"EButtonEditor",on:{active:()=>{this._selection.replace((e=>e.type!==t.EShapeType.RECTANGLE?(new t.EShapeRectangle).copy(e):null))}}})}get buttonRectangleRounded(){var t;return null!==(t=this._buttonRectangleRounded)&&void 0!==t?t:this._buttonRectangleRounded=this.newButtonRectangleRounded()}newButtonRectangleRounded(){return new t.DButtonAmbient({image:{source:this._icons.shape_rectangle_rounded},title:this.theme.getButtonRectangleRoundedTitle(),theme:"EButtonEditor",on:{active:()=>{this._selection.replace((e=>e.type!==t.EShapeType.RECTANGLE_ROUNDED?(new t.EShapeRectangleRounded).copy(e):null))}}})}get buttonTriangle(){var t;return null!==(t=this._buttonTriangle)&&void 0!==t?t:this._buttonTriangle=this.newButtonTriangle()}newButtonTriangle(){return new t.DButtonAmbient({image:{source:this._icons.shape_triangle},title:this.theme.getButtonTriangleTitle(),theme:"EButtonEditor",on:{active:()=>{this._selection.replace((e=>e.type!==t.EShapeType.TRIANGLE?(new t.EShapeTriangle).copy(e):null))}}})}get buttonTriangleRounded(){var t;return null!==(t=this._buttonTriangleRounded)&&void 0!==t?t:this._buttonTriangleRounded=this.newButtonTriangleRounded()}newButtonTriangleRounded(){return new t.DButtonAmbient({image:{source:this._icons.shape_triangle_rounded},title:this.theme.getButtonTriangleRoundedTitle(),theme:"EButtonEditor",on:{active:()=>{this._selection.replace((e=>e.type!==t.EShapeType.TRIANGLE_ROUNDED?(new t.EShapeTriangleRounded).copy(e):null))}}})}get buttonLine(){var t;return null!==(t=this._buttonLine)&&void 0!==t?t:this._buttonLine=this.newButtonLine()}newButtonLine(){return new t.DButtonAmbient({image:{source:this._icons.shape_line},title:this.theme.getButtonLineTitle(),theme:"EButtonEditor",on:{active:()=>{this._selection.replace((t=>this.replaceLine(t)))}}})}replaceLine(e){if(e.type!==t.EShapeType.LINE){if(e instanceof t.EShapeConnectorLine)return(new t.EShapeLine).copy(e);{const n=e.size,i=.5*n.x,o=.5*n.y;return t.createLine([-i,-o,+i,+o],[],t.EShapeDefaults.STROKE_WIDTH,t.EShapePointsStyle.NONE).copy(e,t.EShapeCopyPart.ALL&~(t.EShapeCopyPart.SIZE|t.EShapeCopyPart.POINTS))}}return null}isDanglingConnectorAllowed(){var t,e,n;return null!==(n=null===(e=null===(t=this.options)||void 0===t?void 0:t.connector)||void 0===e?void 0:e.dangling)&&void 0!==n&&n}get buttonLineConnector(){var t;return null!==(t=this._buttonLineConnector)&&void 0!==t?t:this._buttonLineConnector=this.newButtonLineConnector()}newButtonLineConnector(){return new t.DButtonAmbient({image:{source:this._icons.shape_line_connector},title:this.theme.getButtonLineConnectorTitle(),theme:"EButtonEditor",on:{active:()=>{const t=this.isDanglingConnectorAllowed();this._selection.replace((e=>this.replaceLineConnector(e,t)))}}})}replaceLineConnector(e,n){if(e.type!==t.EShapeType.CONNECTOR_LINE){if(e instanceof t.EShapeConnectorLine)return(new t.EShapeConnectorLine).copy(e);if(n)return this.replaceConnector(e,new t.EShapeConnectorLine)}return null}get buttonElbowConnector(){var t;return null!==(t=this._buttonElbowConnector)&&void 0!==t?t:this._buttonElbowConnector=this.newButtonElbowConnector()}newButtonElbowConnector(){return new t.DButtonAmbient({image:{source:this._icons.shape_elbow_connector},title:this.theme.getButtonElbowConnectorTitle(),theme:"EButtonEditor",on:{active:()=>{const t=this.isDanglingConnectorAllowed();this._selection.replace((e=>this.replaceElbowConnector(e,t)))}}})}replaceElbowConnector(e,n){if(e.type!==t.EShapeType.CONNECTOR_ELBOW){if(e instanceof t.EShapeConnectorLine)return(new t.EShapeConnectorElbow).copy(e);if(n)return this.replaceConnector(e,new t.EShapeConnectorElbow)}return null}replaceConnector(e,n){n.lock(t.EShapeLockPart.ALL),n.fill.alpha=1;const i=n.points.marker;i.tail.type=t.EShapePointsMarkerType.CIRCLE,i.head.type=t.EShapePointsMarkerType.TRIANGLE,n.copy(e,t.EShapeCopyPart.ALL&~(t.EShapeCopyPart.SIZE|t.EShapeCopyPart.POINTS|t.EShapeCopyPart.TRANSFORM));const o=e.size,a=.5*o.x,s=.5*o.y,l=e.transform.localTransform,r=l.a*a+l.c*s,h=l.b*a+l.d*s,u=l.tx,c=l.ty,p=n.edge;return p.lock(),p.tail.set(null,null,null,null,0,-r+u,-h+c,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP),p.head.set(null,null,null,null,0,+r+u,+h+c,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP),p.unlock(),n.unlock(t.EShapeLockPart.ALL,!0),n}get buttonImage(){var t;return null!==(t=this._buttonImage)&&void 0!==t?t:this._buttonImage=this.newButtonImage()}newButtonImage(){return new t.DButtonFile({image:{source:this._icons.editor_image},as:t.DButtonFileAs.DATA_URL,title:this.theme.getButtonImageTitle(),theme:"EButtonEditor",on:{open:e=>{t.toImageElement(e).then((e=>{this._selection.replace((n=>new t.EShapeImage(e).copy(n,t.EShapeCopyPart.ALL&~t.EShapeCopyPart.IMAGE)))}))}}})}get buttonGraphicPiece(){let t=this._buttonGraphicPiece;return void 0===t&&(t=this._isPieceEnabled?this.newButtonGraphicPiece():null,this._buttonGraphicPiece=t),t}newButtonGraphicPiece(){return new t.DButtonAmbient({image:{source:this._icons.graphic_piece},title:this.theme.getButtonGraphicPieceTitle(),theme:"EButtonEditor",on:{active:t=>{this.onButtonGraphicPieceActive(t)}}})}onButtonGraphicPieceActive(t){this.dialogSelectGraphicPiece.then((e=>{e.open(t)}))}get dialogSelectGraphicPiece(){var t;return null!==(t=this._dialogSelectGraphicPiece)&&void 0!==t?t:this._dialogSelectGraphicPiece=this.newDialogSelectGraphicPiece()}newDialogSelectGraphicPiece(){return this._canvas.get().then((t=>{const e=this._controller;if(e){if(e.toPieceThumbnail){const n=this.newDialogSelectGraphicPieceImage(e);return n.categories=t.category.items,n}{const n=this.newDialogSelectGraphicPieceNoImage(e);return n.categories=t.category.items,n}}{const e=this.newDialogSelectGraphicPieceNoController();return e.categories=t.category.items,e}}))}newDialogSelectGraphicPieceNoImage(e){return new t.DDialogSelect({controller:this.newDialogSelectGraphicPieceController(e),on:{select:t=>{this.onDialogSelectGraphicPieceSelect(t,e)}}})}newDialogSelectGraphicPieceImage(t){return vi(this.newDialogSelectGraphicPieceController(t),t.toPieceThumbnail,(e=>{this.onDialogSelectGraphicPieceSelect(e,t)}))}newDialogSelectGraphicPieceNoController(){return new t.DDialogSelect({controller:{search:()=>Promise.resolve([])}})}newDialogSelectGraphicPieceController(t){const e=t.graphic.piece;return{search:(t,n)=>e.search(t,n).then((t=>this.toDialogSelectGraphicPieceResult(t)))}}toDialogSelectGraphicPieceResult(t){var e;const n=null===(e=this._pieceExcluder)||void 0===e?void 0:e.call(this);if(null==n)return t;const i=[];for(let e=0,o=t.length;e<o;++e){const o=t[e];o.id!==n&&i.push(o)}return i}onDialogSelectGraphicPieceSelect(e,n){n.graphic.piece.get(e.id).then((e=>{t.EShapeEmbeddeds.from(e,n.graphic,t.EShapeResourceManagerDeserializationMode.EDITOR).then((t=>{this._selection.replace((e=>t.clone().copy(e)))}))}))}get buttonGroup(){var t;return null!==(t=this._buttonGroup)&&void 0!==t?t:this._buttonGroup=this.newButtonGroup()}newButtonGroup(){return new t.DButtonAmbient({image:{source:this._icons.shape_group},title:this.theme.getButtonGroupTitle(),theme:"EButtonEditor",on:{active:()=>{this._selection.group()}}})}get buttonUngroup(){var t;return null!==(t=this._buttonUngroup)&&void 0!==t?t:this._buttonUngroup=this.newButtonUngroup()}newButtonUngroup(){return new t.DButtonAmbient({image:{source:this._icons.shape_ungroup},title:this.theme.getButtonUngroupTitle(),theme:"EButtonEditor",on:{active:()=>{this._selection.ungroup()}}})}get buttonFill(){var t;return null!==(t=this._buttonFill)&&void 0!==t?t:this._buttonFill=this.newButtonFill()}newButtonFill(){const e=this._selection;return new t.DButtonCheckRight({width:"100%",text:{value:this.theme.getButtonFillLabel()},padding:0,background:{color:null},on:{active:()=>{e.setFillEnabled(!0)},inactive:()=>{e.setFillEnabled(!1)}}})}get buttonFillColor(){var t;return null!==(t=this._buttonFillColor)&&void 0!==t?t:this._buttonFillColor=this.newButtonFillColor()}newButtonFillColor(){const e=new t.DButtonColor({width:"100%",on:{change:t=>{this._selection.setFill(t.color,t.alpha)}}});return e.dialog.on("open",(()=>{const t=e.dialog,n=t.new,i=t.current;n.color=i.color,n.alpha=i.alpha})),e}get buttonStroke(){var t;return null!==(t=this._buttonStroke)&&void 0!==t?t:this._buttonStroke=this.newButtonStroke()}newButtonStroke(){const e=this._selection;return new t.DButtonCheckRight({width:"100%",text:{value:this.theme.getButtonStrokeLabel()},padding:0,background:{color:null},on:{active:()=>{e.setStrokeEnabled(!0)},inactive:()=>{e.setStrokeEnabled(!1)}}})}get buttonStrokeColor(){var t;return null!==(t=this._buttonStrokeColor)&&void 0!==t?t:this._buttonStrokeColor=this.newButtonStrokeColor()}newButtonStrokeColor(){const e=new t.DButtonColor({width:"100%",on:{change:t=>{this._selection.setStroke(t.color,t.alpha)}}});return e.dialog.on("open",(()=>{const t=e.dialog,n=t.new,i=t.current;n.color=i.color,n.alpha=i.alpha})),e}get inputStrokeWidth(){var t;return null!==(t=this._inputStrokeWidth)&&void 0!==t?t:this._inputStrokeWidth=this.newInputStrokeWidth()}newInputStrokeWidth(){return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.theme.getInputStrokeWidthLabel()}},input:{weight:1,min:0,on:{change:t=>{this._selection.setStrokeWidth(t)}}}})}get inputStrokeAlign(){var t;return null!==(t=this._inputStrokeAlign)&&void 0!==t?t:this._inputStrokeAlign=this.newInputStrokeAlign()}newInputStrokeAlign(){return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.theme.getInputStrokeAlignLabel()}},input:{weight:1,min:0,max:1,on:{change:t=>{this._selection.setStrokeAlign(t)}}}})}get layoutStrokeSide(){var t;return null!==(t=this._layoutStrokeSide)&&void 0!==t?t:this._layoutStrokeSide=this.newLayoutStrokeSide()}newLayoutStrokeSide(){return new t.DLayoutHorizontal({width:"100%",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonStrokeSideTop,this.buttonStrokeSideRight,this.buttonStrokeSideBottom,this.buttonStrokeSideLeft,this.buttonStrokeExpandable,this.buttonStrokeShrinkable,this.buttonStrokeScalableDotDash,new t.DLayoutSpace({weight:1})]})}get buttonStrokeSideTop(){var t;return null!==(t=this._buttonStrokeSideTop)&&void 0!==t?t:this._buttonStrokeSideTop=this.newButtonStrokeSideTop()}newButtonStrokeSideTop(){const e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_side_top},title:this.theme.getButtonStrokeSideTopTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setStrokeSide(t.EShapeStrokeSide.TOP,!0)},inactive:()=>{e.setStrokeSide(t.EShapeStrokeSide.TOP,!1)}}})}get buttonStrokeSideRight(){var t;return null!==(t=this._buttonStrokeSideRight)&&void 0!==t?t:this._buttonStrokeSideRight=this.newButtonStrokeSideRight()}newButtonStrokeSideRight(){const e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_side_right},title:this.theme.getButtonStrokeSideRightTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setStrokeSide(t.EShapeStrokeSide.RIGHT,!0)},inactive:()=>{e.setStrokeSide(t.EShapeStrokeSide.RIGHT,!1)}}})}get buttonStrokeSideBottom(){var t;return null!==(t=this._buttonStrokeSideBottom)&&void 0!==t?t:this._buttonStrokeSideBottom=this.newButtonStrokeSideBottom()}newButtonStrokeSideBottom(){const e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_side_bottom},title:this.theme.getButtonStrokeSideBottomTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setStrokeSide(t.EShapeStrokeSide.BOTTOM,!0)},inactive:()=>{e.setStrokeSide(t.EShapeStrokeSide.BOTTOM,!1)}}})}get buttonStrokeSideLeft(){var t;return null!==(t=this._buttonStrokeSideLeft)&&void 0!==t?t:this._buttonStrokeSideLeft=this.newButtonStrokeSideLeft()}newButtonStrokeSideLeft(){const e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_side_left},title:this.theme.getButtonStrokeSideLeftTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setStrokeSide(t.EShapeStrokeSide.LEFT,!0)},inactive:()=>{e.setStrokeSide(t.EShapeStrokeSide.LEFT,!1)}}})}get textCorner(){var t;return null!==(t=this._textCorner)&&void 0!==t?t:this._textCorner=this.newTextCorner()}newTextCorner(){return new t.DText({width:"100%",text:{value:this.theme.getTextCornerLabel()}})}get inputCornerRadius(){var t;return null!==(t=this._inputCornerRadius)&&void 0!==t?t:this._inputCornerRadius=this.newInputCornerRadius()}newInputCornerRadius(){return new t.DInputReal({width:"100%",min:0,step:1,max:100,text:{formatter:t=>+(100*t).toFixed(2)+" %"},editing:{formatter:t=>""+ +(100*t).toFixed(2),unformatter:t=>.01*parseFloat(t)},on:{change:t=>{this._selection.setRadius(t)}}})}get layoutCorner(){var t;return null!==(t=this._layoutCorner)&&void 0!==t?t:this._layoutCorner=this.newLayoutCorner()}newLayoutCorner(){return new t.DLayoutHorizontal({width:"100%",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonCornerTopLeft,this.buttonCornerTopRight,this.buttonCornerBottomRight,this.buttonCornerBottomLeft,new t.DLayoutSpace({weight:1})]})}get buttonCornerTopLeft(){var t;return null!==(t=this._buttonCornerTopLeft)&&void 0!==t?t:this._buttonCornerTopLeft=this.newButtonCornerTopLeft()}newButtonCornerTopLeft(){const e=this._selection;return new t.DButtonCheck({image:{source:this._icons.corner_top_left},title:this.theme.getButtonCornerTopLeftTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setCorner(t.EShapeCorner.TOP_LEFT,!0)},inactive:()=>{e.setCorner(t.EShapeCorner.TOP_LEFT,!1)}}})}get buttonCornerTopRight(){var t;return null!==(t=this._buttonCornerTopRight)&&void 0!==t?t:this._buttonCornerTopRight=this.newButtonCornerTopRight()}newButtonCornerTopRight(){const e=this._selection;return new t.DButtonCheck({image:{source:this._icons.corner_top_right},title:this.theme.getButtonCornerTopRightTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setCorner(t.EShapeCorner.TOP_RIGHT,!0)},inactive:()=>{e.setCorner(t.EShapeCorner.TOP_RIGHT,!1)}}})}get buttonCornerBottomRight(){var t;return null!==(t=this._buttonCornerBottomRight)&&void 0!==t?t:this._buttonCornerBottomRight=this.newButtonCornerBottomRight()}newButtonCornerBottomRight(){const e=this._selection;return new t.DButtonCheck({image:{source:this._icons.corner_bottom_right},title:this.theme.getButtonCornerBottomRightTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setCorner(t.EShapeCorner.BOTTOM_RIGHT,!0)},inactive:()=>{e.setCorner(t.EShapeCorner.BOTTOM_RIGHT,!1)}}})}get buttonCornerBottomLeft(){var t;return null!==(t=this._buttonCornerBottomLeft)&&void 0!==t?t:this._buttonCornerBottomLeft=this.newButtonCornerBottomLeft()}newButtonCornerBottomLeft(){const e=this._selection;return new t.DButtonCheck({image:{source:this._icons.corner_bottom_left},title:this.theme.getButtonCornerBottomLeftTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setCorner(t.EShapeCorner.BOTTOM_LEFT,!0)},inactive:()=>{e.setCorner(t.EShapeCorner.BOTTOM_LEFT,!1)}}})}get layoutLine(){var t;return null!==(t=this._layoutLine)&&void 0!==t?t:this._layoutLine=this.newLayoutLine()}newLayoutLine(){return new t.DLayoutHorizontal({width:"100%",children:[this.textLine,this.buttonLineClosed,this.buttonLineLock]})}get textLine(){var t;return null!==(t=this._textLine)&&void 0!==t?t:this._textLine=this.newTextLine()}newTextLine(){return new t.DText({weight:1,text:{value:this.theme.getTextLineLabel()}})}get buttonLineLock(){var t;return null!==(t=this._buttonLineLock)&&void 0!==t?t:this._buttonLineLock=this.newButtonLineLock()}newButtonLineLock(){return new t.DButtonCheck({theme:"EButtonEditorLock",on:{active:()=>{this._selection.lockCapability(t.EShapeCapability.LINE)},inactive:()=>{this._selection.unlockCapability(t.EShapeCapability.LINE)}}})}isLocked(t,e){if(null==t)return!1;const n=t.getCapability();return null!=n&&!!(n.locked&e)}get selectLineStyle(){var t;return null!==(t=this._selectLineStyle)&&void 0!==t?t:this._selectLineStyle=this.newSelectLineStyle()}newSelectLineStyle(){const e=this.theme;return new t.DSelect({width:"100%",value:t.EShapeStrokeStyle.NONE,menu:{items:[{value:t.EShapeStrokeStyle.NONE,text:{value:e.getSelectLineStyleLabel(t.EShapeStrokeStyle.NONE)}},{value:t.EShapeStrokeStyle.DOTTED,text:{value:e.getSelectLineStyleLabel(t.EShapeStrokeStyle.DOTTED)}},{value:t.EShapeStrokeStyle.DOTTED_DENSELY,text:{value:e.getSelectLineStyleLabel(t.EShapeStrokeStyle.DOTTED_DENSELY)}},{value:t.EShapeStrokeStyle.DOTTED_LOOSELY,text:{value:e.getSelectLineStyleLabel(t.EShapeStrokeStyle.DOTTED_LOOSELY)}},{value:t.EShapeStrokeStyle.DASHED,text:{value:e.getSelectLineStyleLabel(t.EShapeStrokeStyle.DASHED)}},{value:t.EShapeStrokeStyle.DASHED_DENSELY,text:{value:e.getSelectLineStyleLabel(t.EShapeStrokeStyle.DASHED_DENSELY)}},{value:t.EShapeStrokeStyle.DASHED_LOOSELY,text:{value:e.getSelectLineStyleLabel(t.EShapeStrokeStyle.DASHED_LOOSELY)}}]},on:{change:e=>{this._selection.setLineStyle(null!=e?e:t.EShapeStrokeStyle.NONE,t.EShapeStrokeStyle.DOTTED_MASK|t.EShapeStrokeStyle.DASHED_MASK)}}})}get selectLineType(){var t;return null!==(t=this._selectLineType)&&void 0!==t?t:this._selectLineType=this.newSelectLineType()}newSelectLineType(){return new t.DSelect({width:"100%",value:t.EShapePointsStyle.NONE,menu:{items:this.newSelectLineTypeMenuItems()},on:{change:e=>{this._selection.setPointsStyle(null!=e?e:t.EShapePointsStyle.NONE,t.EShapePointsStyle.FORMATTER_MASK)}}})}newSelectLineTypeMenuItems(){const e=[{value:t.EShapePointsStyle.NONE,text:{value:this.theme.getSelectLineTypeLabel(t.EShapePointsStyle.NONE)}}];return t.EShapePointsFormatters.each(((n,i)=>{e.push({value:n<<t.EShapePointsStyle.FORMATTER_SHIFT,text:{value:i.label}})})),e}get buttonLineClosed(){var t;return null!==(t=this._buttonLineClosed)&&void 0!==t?t:this._buttonLineClosed=this.newButtonLineClosed()}newButtonLineClosed(){const e=this._selection;return new t.DButtonCheck({image:{source:this._icons.line_closed},title:this.theme.getButtonLineClosedTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setPointsStyle(t.EShapePointsStyle.CLOSED,t.EShapePointsStyle.NONE)},inactive:()=>{e.setPointsStyle(t.EShapePointsStyle.NONE,t.EShapePointsStyle.CLOSED)}}})}get buttonStrokeExpandable(){var t;return null!==(t=this._buttonStrokeExpandable)&&void 0!==t?t:this._buttonStrokeExpandable=this.newButtonStrokeExpandable()}newButtonStrokeExpandable(){const e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_expandable},title:this.theme.getButtonStrokeExpandableTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setStrokeStyle(t.EShapeStrokeStyle.NONE,t.EShapeStrokeStyle.NON_EXPANDING_WIDTH)},inactive:()=>{e.setStrokeStyle(t.EShapeStrokeStyle.NON_EXPANDING_WIDTH,t.EShapeStrokeStyle.NONE)}}})}get buttonStrokeShrinkable(){var t;return null!==(t=this._buttonStrokeShrinkable)&&void 0!==t?t:this._buttonStrokeShrinkable=this.newButtonStrokeShrinkable()}newButtonStrokeShrinkable(){const e=this._selection;return new t.DButtonCheck({image:{source:this._icons.stroke_shrinkable},title:this.theme.getButtonStrokeShrinkableTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setStrokeStyle(t.EShapeStrokeStyle.NONE,t.EShapeStrokeStyle.NON_SHRINKING_WIDTH)},inactive:()=>{e.setStrokeStyle(t.EShapeStrokeStyle.NON_SHRINKING_WIDTH,t.EShapeStrokeStyle.NONE)}}})}get buttonStrokeScalableDotDash(){var t;return null!==(t=this._buttonStrokeScalableDotDash)&&void 0!==t?t:this._buttonStrokeScalableDotDash=this.newButtonStrokeScalableDotDash()}newButtonStrokeScalableDotDash(){const e=this._selection;return new t.DButtonCheckRight({image:{source:this._icons.stroke_scalable_dot_dash},title:this.theme.getButtonStrokeScalableDotDashTitle(),theme:"EButtonEditorCheck",on:{active:()=>{e.setStrokeStyle(t.EShapeStrokeStyle.NONE,t.EShapeStrokeStyle.NON_SCALING_DOT_AND_DASH)},inactive:()=>{e.setStrokeStyle(t.EShapeStrokeStyle.NON_SCALING_DOT_AND_DASH,t.EShapeStrokeStyle.NONE)}}})}get layoutLineTail(){var t;return null!==(t=this._layoutLineTail)&&void 0!==t?t:this._layoutLineTail=this.newLayoutLineTail()}newLayoutLineTail(){return new t.DLayoutHorizontal({width:"100%",children:[this.textLineTail,this.buttonLineTailLock]})}get textLineTail(){var t;return null!==(t=this._textLineTail)&&void 0!==t?t:this._textLineTail=this.newTextLineTail()}newTextLineTail(){return new t.DText({weight:1,text:{value:this.theme.getTextLineTailLabel()}})}get buttonLineTailLock(){var t;return null!==(t=this._buttonLineTailLock)&&void 0!==t?t:this._buttonLineTailLock=this.newButtonLineTailLock()}newButtonLineTailLock(){return new t.DButtonCheck({theme:"EButtonEditorLock",on:{active:()=>{this._selection.lockCapability(t.EShapeCapability.LINE_TAIL)},inactive:()=>{this._selection.unlockCapability(t.EShapeCapability.LINE_TAIL)}}})}get selectLineTailType(){var t;return null!==(t=this._selectLineTailType)&&void 0!==t?t:this._selectLineTailType=this.newSelectLineTailType()}newSelectLineTailType(){const e=this.theme;return new t.DSelect({width:"100%",value:t.EShapePointsMarkerType.NONE,menu:{items:[{value:t.EShapePointsMarkerType.NONE,text:{value:e.getSelectLineTailTypeLabel(t.EShapePointsMarkerType.NONE)}},{value:t.EShapePointsMarkerType.CIRCLE,text:{value:e.getSelectLineTailTypeLabel(t.EShapePointsMarkerType.CIRCLE)}},{value:t.EShapePointsMarkerType.TRIANGLE,text:{value:e.getSelectLineTailTypeLabel(t.EShapePointsMarkerType.TRIANGLE)}},{value:t.EShapePointsMarkerType.RECTANGLE,text:{value:e.getSelectLineTailTypeLabel(t.EShapePointsMarkerType.RECTANGLE)}}]},on:{change:e=>{this._selection.setLineTailType(null!=e?e:t.EShapePointsMarkerType.NONE)}}})}get layoutLineTailSize(){var t;return null!==(t=this._layoutLineTailSize)&&void 0!==t?t:this._layoutLineTailSize=this.newLayoutLineTailSize()}newLayoutLineTailSize(){return new t.DLayoutHorizontal({width:"100%",children:[this.inputLineTailSizeX,this.inputLineTailSizeY]})}get inputLineTailSizeX(){var t;return null!==(t=this._inputLineTailSizeX)&&void 0!==t?t:this._inputLineTailSizeX=this.newInputLineTailSizeX()}newInputLineTailSizeX(){return new t.DInputReal({weight:1,min:0,on:{change:t=>{this._selection.setLineTailSizeX(t)}}})}get inputLineTailSizeY(){var t;return null!==(t=this._inputLineTailSizeY)&&void 0!==t?t:this._inputLineTailSizeY=this.newInputLineTailSizeY()}newInputLineTailSizeY(){return new t.DInputReal({weight:1,min:0,on:{change:t=>{this._selection.setLineTailSizeY(t)}}})}get buttonLineTailColor(){var t;return null!==(t=this._buttonLineTailColor)&&void 0!==t?t:this._buttonLineTailColor=this.newButtonLineTailColor()}newButtonLineTailColor(){const e=new t.DButtonColor({width:"100%",on:{change:t=>{this._selection.setLineTailColor(t.color,t.alpha)}}});return e.dialog.on("open",(()=>{const t=e.dialog,n=t.new,i=t.current;n.color=i.color,n.alpha=i.alpha})),e}get inputLineTailMargin(){var t;return null!==(t=this._inputLineTailMargin)&&void 0!==t?t:this._inputLineTailMargin=this.newInputLineTailMargin()}newInputLineTailMargin(){return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.theme.getInputLineTailMarginLabel()}},input:{weight:1,on:{change:t=>{this._selection.setLineTailMargin(t)}}}})}get layoutLineHead(){var t;return null!==(t=this._layoutLineHead)&&void 0!==t?t:this._layoutLineHead=this.newLayoutLineHead()}newLayoutLineHead(){return new t.DLayoutHorizontal({width:"100%",children:[this.textLineHead,this.buttonLineHeadLock]})}get textLineHead(){var t;return null!==(t=this._textLineHead)&&void 0!==t?t:this._textLineHead=this.newTextLineHead()}newTextLineHead(){return new t.DText({weight:1,text:{value:this.theme.getTextLineHeadLabel()}})}get buttonLineHeadLock(){var t;return null!==(t=this._buttonLineHeadLock)&&void 0!==t?t:this._buttonLineHeadLock=this.newButtonLineHeadLock()}newButtonLineHeadLock(){return new t.DButtonCheck({theme:"EButtonEditorLock",on:{active:()=>{this._selection.lockCapability(t.EShapeCapability.LINE_HEAD)},inactive:()=>{this._selection.unlockCapability(t.EShapeCapability.LINE_HEAD)}}})}get selectLineHeadType(){var t;return null!==(t=this._selectLineHeadType)&&void 0!==t?t:this._selectLineHeadType=this.newSelectLineHeadType()}newSelectLineHeadType(){const e=this.theme;return new t.DSelect({width:"100%",value:t.EShapePointsMarkerType.NONE,menu:{items:[{value:t.EShapePointsMarkerType.NONE,text:{value:e.getSelectLineHeadTypeLabel(t.EShapePointsMarkerType.NONE)}},{value:t.EShapePointsMarkerType.CIRCLE,text:{value:e.getSelectLineHeadTypeLabel(t.EShapePointsMarkerType.CIRCLE)}},{value:t.EShapePointsMarkerType.TRIANGLE,text:{value:e.getSelectLineHeadTypeLabel(t.EShapePointsMarkerType.TRIANGLE)}},{value:t.EShapePointsMarkerType.RECTANGLE,text:{value:e.getSelectLineHeadTypeLabel(t.EShapePointsMarkerType.RECTANGLE)}}]},on:{change:e=>{this._selection.setLineHeadType(null!=e?e:t.EShapePointsMarkerType.NONE)}}})}get layoutLineHeadSize(){var t;return null!==(t=this._layoutLineHeadSize)&&void 0!==t?t:this._layoutLineHeadSize=this.newLayoutLineHeadSize()}newLayoutLineHeadSize(){return new t.DLayoutHorizontal({width:"100%",children:[this.inputLineHeadSizeX,this.inputLineHeadSizeY]})}get inputLineHeadSizeX(){var t;return null!==(t=this._inputLineHeadSizeX)&&void 0!==t?t:this._inputLineHeadSizeX=this.newInputLineHeadSizeX()}newInputLineHeadSizeX(){return new t.DInputReal({weight:1,min:0,on:{change:t=>{this._selection.setLineHeadSizeX(t)}}})}get inputLineHeadSizeY(){var t;return null!==(t=this._inputLineHeadSizeY)&&void 0!==t?t:this._inputLineHeadSizeY=this.newInputLineHeadSizeY()}newInputLineHeadSizeY(){return new t.DInputReal({weight:1,min:0,on:{change:t=>{this._selection.setLineHeadSizeY(t)}}})}get buttonLineHeadColor(){var t;return null!==(t=this._buttonLineHeadColor)&&void 0!==t?t:this._buttonLineHeadColor=this.newButtonLineHeadColor()}newButtonLineHeadColor(){const e=new t.DButtonColor({width:"100%",on:{change:t=>{this._selection.setLineHeadColor(t.color,t.alpha)}}});return e.dialog.on("open",(()=>{const t=e.dialog,n=t.new,i=t.current;n.color=i.color,n.alpha=i.alpha})),e}get inputLineHeadMargin(){var t;return null!==(t=this._inputLineHeadMargin)&&void 0!==t?t:this._inputLineHeadMargin=this.newInputLineHeadMargin()}newInputLineHeadMargin(){return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.theme.getInputLineHeadMarginLabel()}},input:{weight:1,on:{change:t=>{this._selection.setLineHeadMargin(t)}}}})}get layoutTexture(){let t=this._layoutTexture;return null==t&&(t=this.newLayoutTexture(),this._layoutTexture=t),t}newLayoutTexture(){return new t.DLayoutHorizontal({width:"100%",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonTextureImage,this.buttonTextureGradient,this.buttonTextureFitTo,this.buttonTextureClear,new t.DLayoutSpace({weight:1})]})}get buttonTextureImage(){var t;return null!==(t=this._buttonTextureImage)&&void 0!==t?t:this._buttonTextureImage=this.newButtonTextureImage()}newButtonTextureImage(){const e=this.theme;return new t.DButtonFile({image:{source:this._icons.editor_image},as:t.DButtonFileAs.DATA_URL,title:e.getButtonTextureImageTitle(),theme:"EButtonEditor",on:{open:e=>{t.toImageElement(e).then((t=>{this._selection.setImage(t)}))}}})}get buttonTextureGradient(){var t;return null!==(t=this._buttonTextureGradient)&&void 0!==t?t:this._buttonTextureGradient=this.newButtonTextureGradient()}newButtonTextureGradient(){const e=this.theme,n=new t.DButtonColorGradient({image:{source:this._icons.texture_gradient},text:{formatter:()=>""},title:e.getButtonTextureGradientTitle(),theme:"EButtonEditor",on:{change:e=>{const n=t.toGradientImageUrl(e);t.toImageElement(n).then((t=>{this._selection.setGradient(t,e.toObject())}))}}});return n.dialog.on("open",(()=>{const t=this._selection.last();null!=t&&null!=t.gradient&&n.dialog.value.fromObject(t.gradient)})),n}get buttonTextureFitTo(){var t;return null!==(t=this._buttonTextureFitTo)&&void 0!==t?t:this._buttonTextureFitTo=this.newButtonTextureFitTo()}newButtonTextureFitTo(){const e=this.theme;return new t.DButton({image:{source:this._icons.texture_fit_to},title:e.getButtonTextureFitToTitle(),theme:"EButtonEditor",on:{active:()=>{this._selection.fitToImage()}}})}get buttonTextureClear(){var t;return null!==(t=this._buttonTextureClear)&&void 0!==t?t:this._buttonTextureClear=this.newButtonTextureClear()}newButtonTextureClear(){const e=this.theme;return new t.DButton({image:{source:this._icons.texture_clear},title:e.getButtonTextureClearTitle(),theme:"EButtonEditor",on:{active:()=>{this._selection.clearImage()}}})}onSelectionChange(){const e=this._selection;this.state.isDisabled=e.isEmpty();const n=e.last(),i=this.layoutChangeTo;i&&(i.state.isEnabled=t.EShapeCapabilities.contains(n,t.EShapeCapability.REPLACING));let o=0;if(2<=e.size()){const n=e.get();for(let e=0,i=n.length;e<i&&!(t.EShapeCapabilities.contains(n[e],t.EShapeCapability.GROUPING)&&(o+=1,2<=o));++e);}if(this.buttonGroup.state.isEnabled=2<=o,this.buttonUngroup.state.isEnabled=n instanceof t.EShapeGroup&&t.EShapeCapabilities.contains(n,t.EShapeCapability.CHILDREN)&&t.EShapeCapabilities.contains(n,t.EShapeCapability.UNGROUPING),null!=n){this.buttonFill.state.isActive=n.fill.enable;const t=n.fill,e=this.buttonFillColor,i=e.value;i.color=t.color,i.alpha=t.alpha,e.state.isEnabled=t.enable}if(null!=n){const e=n.stroke,i=e.enable;this.buttonStroke.state.isActive=i;const o=this.buttonStrokeColor,a=o.value;a.color=e.color,a.alpha=e.alpha,o.state.isEnabled=i;const s=this.inputStrokeAlign;s.input.value=e.align,s.state.isEnabled=i;const l=this.inputStrokeWidth;l.input.value=e.width,l.state.isEnabled=i;const r=e.side,h=i&&t.EShapeCapabilities.contains(n,t.EShapeCapability.STROKE_SIDE),u=this.buttonStrokeSideTop,c=this.buttonStrokeSideRight,p=this.buttonStrokeSideBottom,d=this.buttonStrokeSideLeft;u.state.isEnabled=h,c.state.isEnabled=h,p.state.isEnabled=h,d.state.isEnabled=h,u.state.isActive=!!(r&t.EShapeStrokeSide.TOP),c.state.isActive=!!(r&t.EShapeStrokeSide.RIGHT),p.state.isActive=!!(r&t.EShapeStrokeSide.BOTTOM),d.state.isActive=!!(r&t.EShapeStrokeSide.LEFT);const g=e.style,_=this.buttonStrokeExpandable,S=this.buttonStrokeShrinkable,w=this.buttonStrokeScalableDotDash;_.state.isEnabled=i,S.state.isEnabled=i,w.state.isEnabled=i,_.state.isActive=!(g&t.EShapeStrokeStyle.NON_EXPANDING_WIDTH),S.state.isActive=!(g&t.EShapeStrokeStyle.NON_SHRINKING_WIDTH),w.state.isActive=!(g&t.EShapeStrokeStyle.NON_SCALING_DOT_AND_DASH)}const a=this.layoutLine,s=this.buttonLineLock,l=this.selectLineStyle,r=this.selectLineType,h=this.buttonLineClosed,u=this.layoutLineTail,c=this.buttonLineTailLock,p=this.selectLineTailType,d=this.inputLineTailSizeX,g=this.inputLineTailSizeY,_=this.buttonLineTailColor,S=this.inputLineTailMargin,w=this.layoutLineHead,m=this.buttonLineHeadLock,T=this.selectLineHeadType,E=this.inputLineHeadSizeX,y=this.inputLineHeadSizeY,v=this.buttonLineHeadColor,C=this.inputLineHeadMargin;if(null!=n&&null!=n.points){const e=n.points,i=t.EShapeCapabilities.contains(n,t.EShapeCapability.LINE);a.state.isEnabled=!0,s.state.isActive=this.isLocked(n,t.EShapeCapability.LINE),s.state.isEnabled=!0;const o=t.EShapeStrokeStyle.DOTTED_MASK|t.EShapeStrokeStyle.DASHED_MASK;l.value=n.stroke.style&o,l.state.isEnabled=i,r.value=e.style&t.EShapePointsStyle.FORMATTER_MASK,r.state.isEnabled=i,h.state.isActive=!!(e.style&t.EShapePointsStyle.CLOSED),h.state.isEnabled=i;const b=t.EShapeCapabilities.contains(n,t.EShapeCapability.LINE_TAIL);u.state.isEnabled=!0,c.state.isActive=this.isLocked(n,t.EShapeCapability.LINE_TAIL),c.state.isEnabled=!0;const D=e.marker.tail;p.value=D.type,p.state.isEnabled=b,d.value=D.size.x,d.state.isEnabled=b,g.value=D.size.y,g.state.isEnabled=b;const L=D.fill,f=_.value;f.color=L.color,f.alpha=L.alpha,_.state.isEnabled=L.enable&&b,n instanceof t.EShapeConnectorLine?(S.input.value=n.edge.tail.margin,S.state.isEnabled=b):S.state.isEnabled=!1;const A=t.EShapeCapabilities.contains(n,t.EShapeCapability.LINE_HEAD);w.state.isEnabled=!0,m.state.isActive=this.isLocked(n,t.EShapeCapability.LINE_HEAD),m.state.isEnabled=!0;const B=e.marker.head;T.value=B.type,T.state.isEnabled=A,E.value=B.size.x,E.state.isEnabled=A,y.value=B.size.y,y.state.isEnabled=A;const x=B.fill,I=v.value;I.color=x.color,I.alpha=x.alpha,v.state.isEnabled=x.enable&&A,n instanceof t.EShapeConnectorLine?(C.input.value=n.edge.head.margin,C.state.isEnabled=A):C.state.isEnabled=!1}else a.state.isEnabled=!1,s.state.isEnabled=!1,l.state.isEnabled=!1,r.state.isEnabled=!1,h.state.isEnabled=!1,u.state.isEnabled=!1,c.state.isEnabled=!1,p.state.isEnabled=!1,d.state.isEnabled=!1,g.state.isEnabled=!1,_.state.isEnabled=!1,S.state.isEnabled=!1,w.state.isEnabled=!1,m.state.isEnabled=!1,T.state.isEnabled=!1,E.state.isEnabled=!1,y.state.isEnabled=!1,v.state.isEnabled=!1,C.state.isEnabled=!1;if(null!=n){const e=t.EShapeCapabilities.contains(n,t.EShapeCapability.BORDER_RADIUS);this.textCorner.state.isEnabled=e,this.inputCornerRadius.value=n.radius,this.inputCornerRadius.state.isEnabled=e,this.layoutCorner.state.isEnabled=e,this.buttonCornerBottomLeft.state.isActive=!!(n.corner&t.EShapeCorner.BOTTOM_LEFT),this.buttonCornerBottomRight.state.isActive=!!(n.corner&t.EShapeCorner.BOTTOM_RIGHT),this.buttonCornerTopLeft.state.isActive=!!(n.corner&t.EShapeCorner.TOP_LEFT),this.buttonCornerTopRight.state.isActive=!!(n.corner&t.EShapeCorner.TOP_RIGHT)}null!=n&&(this.buttonTextureFitTo.state.isDisabled=null==n.image,this.buttonTextureClear.state.isDisabled=null==n.image)}getType(){return"EEditorShape"}}class Hi extends t.DLayoutVertical{constructor(e){super(e),this._icons=e.icons;const n=e.diagram;this._diagram=n,this.state.isDisabled=null==n.canvas,n.on("unset",(()=>{this.state.isDisabled=!0})),n.on("set",(()=>{this.state.isDisabled=!1}));const i=n.snapper;this._snapper=i,i.on("change",(()=>{this.onSnapperChange(i)}));const o=i.target;o.on("change",(()=>{this.onSnapperTargetChange(o)}));const a=i.grid;a.on("change",(()=>{this.onSnapperGridChange(a)})),this.addChild(this.buttonLabel),this.addChild(this.buttonGrid),this.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[this.buttonGridEye,this.inputGridSize]})),this.addChild(this.buttonTarget),this.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.buttonTargetNew,this.buttonTargetDelete,this.buttonTargetBringForward,this.buttonTargetSendBackward,this.buttonTargetEye,new t.DLayoutSpace({weight:1})]})),this.addChild(this.listTarget);const s=this.listTarget;s.data.selection.on("change",(()=>{this.onSelectionChange(s)})),this.onSnapperChange(i),this.onSnapperTargetChange(o),this.onSnapperGridChange(a),this.onSelectionChange(s)}get buttonLabel(){let t=this._buttonLabel;return null==t&&(t=this.newButtonLabel(),this._buttonLabel=t),t}newButtonLabel(){const e=this._diagram.snapper;return new t.DButtonCheckRight({x:"padding",width:"padding",text:{value:this.theme.getLabel()},padding:0,background:{color:null},on:{active:()=>{e.enable||t.DControllers.getCommandController().push(new v(e))},inactive:()=>{e.enable&&t.DControllers.getCommandController().push(new v(e))}}})}get buttonTarget(){let t=this._buttonTarget;return null==t&&(t=this.newButtonTarget(),this._buttonTarget=t),t}newButtonTarget(){return new t.DButtonCheckRight({x:"padding",width:"padding",text:{value:this.theme.getButtonTargetLabel()},padding:0,background:{color:null},on:{active:()=>{const e=this._snapper;e.target.enable||t.DControllers.getCommandController().push(new y(e))},inactive:()=>{const e=this._snapper;e.target.enable&&t.DControllers.getCommandController().push(new y(e))}}})}get buttonTargetNew(){let t=this._buttonTargetNew;return null==t&&(t=this.newButtonTargetNew(),this._buttonTargetNew=t),t}newButtonTargetNew(){return new t.DButtonAmbient({width:30,image:{source:this._icons.new},title:this.theme.getButtonTargetNewTitle(),on:{active:t=>{this.onButtonTargetNewActive(t)}}})}onButtonTargetNewActive(e){this.dialogTarget.reset().open(e).then((e=>{null!=e&&t.DControllers.getCommandController().push(new d(this._snapper,e))}))}get buttonTargetDelete(){let t=this._buttonTargetDelete;return null==t&&(t=this.newButtonTargetDelete(),this._buttonTargetDelete=t),t}newButtonTargetDelete(){return new t.DButtonAmbient({width:30,image:{source:this._icons.delete},title:this.theme.getButtonTargetDeleteTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const e=this.listTarget,n=e.data.selection.first;if(null!=n){const i=e.data.items.indexOf(n);0<=i&&t.DControllers.getCommandController().push(new g(this._snapper,i,n))}}}})}get buttonTargetBringForward(){let t=this._buttonTargetBringForward;return null==t&&(t=this.newButtonTargetBringForward(),this._buttonTargetBringForward=t),t}newButtonTargetBringForward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonTargetBringForwardTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const e=this.listTarget,n=e.data.selection.first,i=e.data.items;if(null!=n&&i[0]!==n){const e=i.indexOf(n);0<=e&&t.DControllers.getCommandController().push(new p(this._snapper,e))}}}})}get buttonTargetSendBackward(){let t=this._buttonTargetSendBackward;return null==t&&(t=this.newButtonTargetSendBackward(),this._buttonTargetSendBackward=t),t}newButtonTargetSendBackward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonTargetSendBackwardTitle(),state:t.DBaseState.DISABLED,on:{active:()=>{const e=this._snapper,n=this.listTarget,i=n.data.selection.first,o=n.data.items;if(null!=i&&o[o.length]!==i){const n=o.indexOf(i);0<=n&&t.DControllers.getCommandController().push(new T(e,n))}}}})}get buttonTargetEye(){let t=this._buttonTargetEye;return null==t&&(t=this.newButtonTargetEye(),this._buttonTargetEye=t),t}newButtonTargetEye(){return new t.DButtonAmbient({width:30,image:{source:this._icons.eye},title:this.theme.getButtonTargetEyeTitle(),on:{active:()=>{t.DControllers.getCommandController().push(new E(this._snapper))}}})}get dialogTarget(){let t=this._dialogTarget;return null==t&&(t=this.newDialogTarget(),this._dialogTarget=t),t}newDialogTarget(){return new Ci}get listTarget(){let t=this._listTarget;return null==t&&(t=this.newListTarget(),this._listTarget=t),t}newListTarget(){const e=this.theme,n=new t.DList({x:"padding",width:"padding",weight:1,data:{toLabel:t=>e.getListTargetItemLabel(t)},updater:{newItem:e=>new t.DListItem(e,{on:{dblclick:(t,e,i)=>{this.onListTargetDblClick(t,e,i,n)}}})}});return n}onListTargetDblClick(e,n,i,o){const a=i.value;if(null!=a&&0<=o.data.items.indexOf(a)){const e=this.dialogTarget;e.value=a,e.open(i).then((e=>{null!=e&&t.DControllers.getCommandController().push(new m(this._snapper,a,e,o))}))}}get buttonGrid(){let t=this._buttonGrid;return null==t&&(t=this.newButtonGrid(),this._buttonGrid=t),t}newButtonGrid(){return new t.DButtonCheckRight({x:"padding",width:"padding",text:{value:this.theme.getButtonGridLabel()},padding:0,background:{color:null},on:{active:()=>{const e=this._snapper;e.grid.enable||t.DControllers.getCommandController().push(new w(e))},inactive:()=>{const e=this._snapper;e.grid.enable&&t.DControllers.getCommandController().push(new w(e))}}})}get buttonGridEye(){let t=this._buttonGridEye;return null==t&&(t=this.newButtonGridEye(),this._buttonGridEye=t),t}newButtonGridEye(){return new t.DButtonAmbient({width:30,image:{source:this._icons.eye},title:this.theme.getButtonGridEyeTitle(),on:{active:()=>{t.DControllers.getCommandController().push(new S(this._snapper))}}})}get inputGridSize(){let t=this._inputGridSize;return null==t&&(t=this.newInputGridSize(),this._inputGridSize=t),t}newInputGridSize(){return new t.DInputRealAndLabel({weight:1,label:{text:{value:this.theme.getInputGridSizeLabel()}},input:{weight:1,text:{value:10},min:2,on:{change:e=>{t.DControllers.getCommandController().push(new _(this._snapper,e))}}}})}onSnapperChange(t){this.buttonLabel.state.isActive=t.enable}onSnapperTargetChange(t){this.buttonTarget.state.isActive=t.enable;const e=this._icons;this.buttonTargetEye.image=t.visible?e.eye:e.eye_slash;const n=this.listTarget;n.data.items=t.values,this.onSelectionChange(n)}onSnapperGridChange(t){this.buttonGrid.state.isActive=t.enable;const e=this._icons;this.buttonGridEye.image=t.visible?e.eye:e.eye_slash,this.inputGridSize.input.value=t.size}onSelectionChange(t){this.buttonTargetDelete.state.isDisabled=t.data.selection.isEmpty();const e=t.data.selection.first,n=t.data.items;this.buttonTargetBringForward.state.isDisabled=null==e||n[0]===e,this.buttonTargetSendBackward.state.isDisabled=null==e||n[n.length-1]===e}getType(){return"EEditorSnap"}}class Gi extends t.DPane{constructor(e){super(e),this._fromShapeTextRegEx=/\\+n|\n/g,this._toShapeTextRegEx=/\\+n/g;const n=e.selection;this._selection=n;const i=e.icons;this._icons=i;const o=this.theme;new t.DLayoutVertical({parent:this.content,x:"padding",y:"padding",width:"padding",height:"auto",children:[this.newLabel(o.getLabel()),this.inputText,this.newLabel(o.getTextFontLabel()),this.dropdownFontFamily,this.buttonFontColor,new t.DLayoutHorizontal({width:"100%",height:"auto",children:[this.inputFontSize,this.buttonFontSizeDecrease,this.buttonFontSizeIncrease,this.buttonFontItalic,this.buttonFontBold]}),this.buttonOutline,this.buttonOutlineColor,this.inputOutlineWidth,this.newLabel(o.getTextAlignLabel()),new t.DLayoutVertical({width:"100%",height:"auto",column:7,children:[this.buttonAlignOutsideLeft,this.buttonAlignLeft,this.buttonAlignCenter,this.buttonAlignRight,this.buttonAlignOutsideRight,this.buttonAlignOutsideTop,this.buttonAlignTop,this.buttonAlignMiddle,this.buttonAlignBottom,this.buttonAlignOutsideBottom,this.buttonDirectionLeftToRight,this.buttonDirectionTopToBottom,this.buttonDirectionBottomToTop,this.buttonDirectionRightToLeft]}),this.buttonClipping,this.buttonFitting,this.newLabel(o.getTextSpacingLabel()),new t.DLayoutHorizontal({width:"100%",children:[this.inputSpacingHorizontal,this.inputSpacingVertical]}),this.newLabel(o.getTextPaddingLabel()),new t.DLayoutHorizontal({width:"100%",children:[this.inputPaddingHorizontal,this.inputPaddingVertical]}),this.newLabel(o.getTextOffsetLabel()),new t.DLayoutHorizontal({width:"100%",children:[this.inputOffsetHorizontal,this.inputOffsetVertical]})]}),n.on("change",(()=>{this.onSelectionChange(n)})),this.onSelectionChange(n)}newLabel(e){return new t.DText({width:"100%",text:{value:e}})}get inputText(){let t=this._inputText;return null==t&&(t=this.newInputText(),this._inputText=t),t}newInputText(){return new t.DInputTextArea({width:"100%",height:this.theme.getInputTextHeight(),text:{value:""},on:{input:t=>{this._selection.setText(t)}}})}get dropdownFontFamily(){let t=this._dropdownFontFamily;return null==t&&(t=this.newDropdownFontFamily(),this._dropdownFontFamily=t),t}newDropdownFontFamily(){return new t.DDropdown({width:"100%",text:{value:this.fontFamilies.get("auto")},menu:{width:"auto",column:3,fit:!1,items:this.newDropdownFontFamilyMenuItems()},on:{select:t=>{var e;this.dropdownFontFamily.text=null!==(e=this.fontFamilies.get(t))&&void 0!==e?e:t,this._selection.setTextFamily(t)}}})}newDropdownFontFamilyMenuItems(){const t=[];return this.fontFamilies.forEach(((e,n)=>{t.push({width:200,value:n,text:{value:e}})})),t}get fontFamilies(){let t=this._fontFamilies;return null==t&&(t=this.theme.getFontFamilies(),this._fontFamilies=t),t}get buttonFontColor(){let t=this._buttonFontColor;return null==t&&(t=this.newButtonFontColor(),this._buttonFontColor=t),t}newButtonFontColor(){const e=new t.DButtonColor({width:"100%",on:{change:t=>{this._selection.setTextColor(t.color,t.alpha)}}});return e.dialog.on("open",(()=>{const t=e.dialog,n=t.new,i=t.current;n.color=i.color,n.alpha=i.alpha})),e}get inputFontSize(){let t=this._inputFontSize;return null==t&&(t=this.newInputFontSize(),this._inputFontSize=t),t}newInputFontSize(){return new t.DInputReal({weight:1,text:{value:0},min:0,on:{input:t=>{this._selection.setTextSize(t)}}})}get buttonFontSizeDecrease(){let t=this._buttonFontSizeDecrease;return null==t&&(t=this.newButtonFontSizeDecrease(),this._buttonFontSizeDecrease=t),t}newButtonFontSizeDecrease(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_font_size_decrease},title:this.theme.getButtonFontSizeDecreaseTitle(),on:{active:()=>{this._selection.setTextSizeDelta(-1)}}})}get buttonFontSizeIncrease(){let t=this._buttonFontSizeIncrease;return null==t&&(t=this.newButtonFontSizeIncrease(),this._buttonFontSizeIncrease=t),t}newButtonFontSizeIncrease(){return new t.DButtonAmbient({width:30,image:{source:this._icons.editor_font_size_increase},title:this.theme.getButtonFontSizeIncreaseTitle(),on:{active:()=>{this._selection.setTextSizeDelta(1)}}})}get buttonFontItalic(){let t=this._buttonFontItalic;return null==t&&(t=this.newButtonFontItalic(),this._buttonFontItalic=t),t}newButtonFontItalic(){return new t.DButtonAmbient({width:30,image:{source:this._icons.italic},toggle:!0,title:this.theme.getButtonFontItalicTitle(),on:{active:()=>{this._selection.setTextStyle(t.EShapeTextStyle.ITALIC)},inactive:()=>{this._selection.setTextStyle(t.EShapeTextStyle.NORMAL)}}})}get buttonFontBold(){let t=this._buttonFontBold;return null==t&&(t=this.newButtonFontBold(),this._buttonFontBold=t),t}newButtonFontBold(){return new t.DButtonAmbient({width:30,image:{source:this._icons.bold},toggle:!0,title:this.theme.getButtonFontBoldTitle(),on:{active:()=>{this._selection.setTextWeight(t.EShapeTextWeight.BOLD)},inactive:()=>{this._selection.setTextWeight(t.EShapeTextWeight.NORMAL)}}})}get buttonOutline(){let t=this._buttonOutline;return null==t&&(t=this.newButtonOutline(),this._buttonOutline=t),t}newButtonOutline(){return new t.DButtonCheckRight({width:"100%",text:{value:this.theme.getButtonOutlineLabel()},padding:0,background:{color:null},on:{active:()=>{this._selection.setTextOutlineEnabled(!0)},inactive:()=>{this._selection.setTextOutlineEnabled(!1)}}})}get buttonOutlineColor(){let t=this._buttonOutlineColor;return null==t&&(t=this.newButtonOutlineColor(),this._buttonOutlineColor=t),t}newButtonOutlineColor(){const e=new t.DButtonColor({width:"100%",on:{change:t=>{this._selection.setTextOutlineColor(t.color,t.alpha)}}});return e.dialog.on("open",(()=>{const t=e.dialog,n=t.new,i=t.current;n.color=i.color,n.alpha=i.alpha})),e}get inputOutlineWidth(){var t;return null!==(t=this._inputOutlineWidth)&&void 0!==t?t:this._inputOutlineWidth=this.newInputOutlineWidth()}newInputOutlineWidth(){return new t.DInputRealAndLabel({width:"100%",label:{text:{value:this.theme.getInputOutlineWidthLabel()}},input:{weight:1,min:0,step:1,max:100,on:{change:t=>{this._selection.setTextOutlineWidth(.01*t)}}}})}get buttonAlignOutsideLeft(){let t=this._buttonAlignOutsideLeft;return null==t&&(t=this.newButtonAlignOutsideLeft(),this._buttonAlignOutsideLeft=t),t}newButtonAlignOutsideLeft(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_outside_left},title:this.theme.getButtonAlignOutsideLeftTitle(),on:{active:()=>{this._selection.setTextAlignHorizontal(t.EShapeTextAlignHorizontal.OUTSIDE_LEFT)}}})}get buttonAlignLeft(){let t=this._buttonAlignLeft;return null==t&&(t=this.newButtonAlignLeft(),this._buttonAlignLeft=t),t}newButtonAlignLeft(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_left},title:this.theme.getButtonAlignLeftTitle(),on:{active:()=>{this._selection.setTextAlignHorizontal(t.EShapeTextAlignHorizontal.LEFT)}}})}get buttonAlignCenter(){let t=this._buttonAlignCenter;return null==t&&(t=this.newButtonAlignCenter(),this._buttonAlignCenter=t),t}newButtonAlignCenter(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_center},title:this.theme.getButtonAlignCenterTitle(),on:{active:()=>{this._selection.setTextAlignHorizontal(t.EShapeTextAlignHorizontal.CENTER)}}})}get buttonAlignRight(){let t=this._buttonAlignRight;return null==t&&(t=this.newButtonAlignRight(),this._buttonAlignRight=t),t}newButtonAlignRight(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_right},title:this.theme.getButtonAlignRightTitle(),on:{active:()=>{this._selection.setTextAlignHorizontal(t.EShapeTextAlignHorizontal.RIGHT)}}})}get buttonAlignOutsideRight(){let t=this._buttonAlignOutsideRight;return null==t&&(t=this.newButtonAlignOutsideRight(),this._buttonAlignOutsideRight=t),t}newButtonAlignOutsideRight(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_outside_right},title:this.theme.getButtonAlignOutsideRightTitle(),on:{active:()=>{this._selection.setTextAlignHorizontal(t.EShapeTextAlignHorizontal.OUTSIDE_RIGHT)}}})}get buttonAlignOutsideTop(){let t=this._buttonAlignOutsideTop;return null==t&&(t=this.newButtonAlignOutsideTop(),this._buttonAlignOutsideTop=t),t}newButtonAlignOutsideTop(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_outside_top},title:this.theme.getButtonAlignOutsideTopTitle(),on:{active:()=>{this._selection.setTextAlignVertical(t.EShapeTextAlignVertical.OUTSIDE_TOP)}}})}get buttonAlignTop(){let t=this._buttonAlignTop;return null==t&&(t=this.newButtonAlignTop(),this._buttonAlignTop=t),t}newButtonAlignTop(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_top},title:this.theme.getButtonAlignTopTitle(),on:{active:()=>{this._selection.setTextAlignVertical(t.EShapeTextAlignVertical.TOP)}}})}get buttonAlignMiddle(){let t=this._buttonAlignMiddle;return null==t&&(t=this.newButtonAlignMiddle(),this._buttonAlignMiddle=t),t}newButtonAlignMiddle(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_middle},title:this.theme.getButtonAlignMiddleTitle(),on:{active:()=>{this._selection.setTextAlignVertical(t.EShapeTextAlignVertical.MIDDLE)}}})}get buttonAlignBottom(){let t=this._buttonAlignBottom;return null==t&&(t=this.newButtonAlignBottom(),this._buttonAlignBottom=t),t}newButtonAlignBottom(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_bottom},title:this.theme.getButtonAlignBottomTitle(),on:{active:()=>{this._selection.setTextAlignVertical(t.EShapeTextAlignVertical.BOTTOM)}}})}get buttonAlignOutsideBottom(){let t=this._buttonAlignOutsideBottom;return null==t&&(t=this.newButtonAlignOutsideBottom(),this._buttonAlignOutsideBottom=t),t}newButtonAlignOutsideBottom(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_align_outside_bottom},title:this.theme.getButtonAlignOutsideBottomTitle(),on:{active:()=>{this._selection.setTextAlignVertical(t.EShapeTextAlignVertical.OUTSIDE_BOTTOM)}}})}get buttonDirectionLeftToRight(){let t=this._buttonDirectionLeftToRight;return null==t&&(t=this.newButtonDirectionLeftToRight(),this._buttonDirectionLeftToRight=t),t}newButtonDirectionLeftToRight(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_direction_left_to_right},title:this.theme.getButtonDirectionLeftToRightTitle(),on:{active:()=>{this._selection.setTextDirection(t.EShapeTextDirection.LEFT_TO_RIGHT)}}})}get buttonDirectionTopToBottom(){let t=this._buttonDirectionTopToBottom;return null==t&&(t=this.newButtonDirectionTopToBottom(),this._buttonDirectionTopToBottom=t),t}newButtonDirectionTopToBottom(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_direction_top_to_bottom},title:this.theme.getButtonDirectionTopToBottomTitle(),on:{active:()=>{this._selection.setTextDirection(t.EShapeTextDirection.TOP_TO_BOTTOM)}}})}get buttonDirectionBottomToTop(){let t=this._buttonDirectionBottomToTop;return null==t&&(t=this.newButtonDirectionBottomToTop(),this._buttonDirectionBottomToTop=t),t}newButtonDirectionBottomToTop(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_direction_bottom_to_top},title:this.theme.getButtonDirectionBottomToTopTitle(),on:{active:()=>{this._selection.setTextDirection(t.EShapeTextDirection.BOTTOM_TO_TOP)}}})}get buttonDirectionRightToLeft(){let t=this._buttonDirectionRightToLeft;return null==t&&(t=this.newButtonDirectionRightToLeft(),this._buttonDirectionRightToLeft=t),t}newButtonDirectionRightToLeft(){return new t.DButtonAmbient({width:30,image:{source:this._icons.text_direction_right_to_left},title:this.theme.getButtonDirectionRightToLeftTitle(),on:{active:()=>{this._selection.setTextDirection(t.EShapeTextDirection.RIGHT_TO_LEFT)}}})}get buttonClipping(){let t=this._buttonClipping;return null==t&&(t=this.newButtonClipping(),this._buttonClipping=t),t}newButtonClipping(){return new t.DButtonCheckRight({width:"100%",text:{value:this.theme.getButtonClippingLabel()},padding:0,background:{color:null},on:{active:()=>{this._selection.setTextClipping(!0)},inactive:()=>{this._selection.setTextClipping(!1)}}})}get buttonFitting(){let t=this._buttonFitting;return null==t&&(t=this.newButtonFitting(),this._buttonFitting=t),t}newButtonFitting(){return new t.DButtonCheckRight({width:"100%",text:{value:this.theme.getButtonFittingLabel()},padding:0,background:{color:null},on:{active:()=>{this._selection.setTextFitting(!0)},inactive:()=>{this._selection.setTextFitting(!1)}}})}get inputSpacingHorizontal(){let t=this._inputSpacingHorizontal;return null==t&&(t=this.newInputSpacingHorizontal(),this._inputSpacingHorizontal=t),t}newInputSpacingHorizontal(){return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:t=>{this._selection.setTextSpacingHorizontal(t)}}})}get inputSpacingVertical(){let t=this._inputSpacingVertical;return null==t&&(t=this.newInputSpacingVertical(),this._inputSpacingVertical=t),t}newInputSpacingVertical(){return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:t=>{this._selection.setTextSpacingVertical(t)}}})}get inputPaddingHorizontal(){let t=this._inputPaddingHorizontal;return null==t&&(t=this.newInputPaddingHorizontal(),this._inputPaddingHorizontal=t),t}newInputPaddingHorizontal(){return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:t=>{this._selection.setTextPaddingHorizontal(t)}}})}get inputPaddingVertical(){let t=this._inputTextPaddingVertical;return null==t&&(t=this.newInputPaddingVertical(),this._inputTextPaddingVertical=t),t}newInputPaddingVertical(){return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:t=>{this._selection.setTextPaddingVertical(t)}}})}get inputOffsetHorizontal(){let t=this._inputOffsetHorizontal;return null==t&&(t=this.newInputOffsetHorizontal(),this._inputOffsetHorizontal=t),t}newInputOffsetHorizontal(){return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:t=>{this._selection.setTextOffsetHorizontal(t)}}})}get inputOffsetVertical(){let t=this._inputOffsetVertical;return null==t&&(t=this.newInputOffsetVertical(),this._inputOffsetVertical=t),t}newInputOffsetVertical(){return new t.DInputReal({weight:1,step:1,text:{value:0},on:{change:t=>{this._selection.setTextOffsetVertical(t)}}})}onSelectionChange(e){var n;this.state.isDisabled=e.isEmpty();const i=e.last();if(null!=i){const e=i.text;this.inputText.value=e.value;const o=e.family;this.dropdownFontFamily.text=null!==(n=this.fontFamilies.get(o))&&void 0!==n?n:o;const a=this.buttonFontColor.value;a.color=e.color,a.alpha=e.alpha,this.inputFontSize.value=e.size,this.buttonFontItalic.state.isActive=e.style===t.EShapeTextStyle.ITALIC,this.buttonFontBold.state.isActive=e.weight===t.EShapeTextWeight.BOLD;const s=e.outline;this.buttonOutline.state.isActive=s.enable;const l=this.buttonOutlineColor,r=l.value;r.color=s.color,r.alpha=s.alpha,l.state.isDisabled=!s.enable;const h=this.inputOutlineWidth;h.input.value=100*s.width,h.state.isDisabled=!s.enable,this.buttonClipping.state.isActive=e.clipping,this.buttonFitting.state.isActive=e.fitting;const u=e.spacing;this.inputSpacingHorizontal.value=u.horizontal,this.inputSpacingVertical.value=u.vertical;const c=e.padding;this.inputPaddingHorizontal.value=c.horizontal,this.inputPaddingVertical.value=c.vertical;const p=e.offset;this.inputOffsetHorizontal.value=p.horizontal,this.inputOffsetVertical.value=p.vertical}}getType(){return"EEditorText"}}const Ui=(t,e)=>t[0]-e[0];class Yi extends e.utils.EventEmitter{constructor(t,e){super(),this._parent=t,this._selection=e}get parent(){return this._parent}get indices(){const t=this._selection,e=[];return this._parent.each(((n,i)=>{t.contains(n)&&e.push(i)})),e}get rows(){const t=this._selection,e=[];return this._parent.each(((n,i)=>{t.contains(n)&&e.push(n)})),e}get type(){return t.DTableDataSelectionType.MULTIPLE}get first(){const t=this._selection.first();return t?this.toIndex(t):null}get last(){const t=this._selection.last();return t?this.toIndex(t):null}onNodeChange(t){}toggle(e){const n=this._parent.get(e);if(n){const e=this._selection,i=e.store();e.toggle(n),e.focus();const o=e.store();t.DControllers.getCommandController().push(new me(i,o,e))}}add(e){const n=this._parent.get(e);if(n){const e=this._selection;if(!e.contains(n)){const i=e.store();e.toggle(n),e.focus();const o=e.store();t.DControllers.getCommandController().push(new me(i,o,e))}}}toIndex(t){let e=null;return this._parent.each(((n,i)=>t!==n||(e=i,!1))),e}addTo(t){const e=this._selection.last();if(null!=e){const n=this.toIndex(e);null!=n&&this.addRange(n,!1,t,!0)}}addRange(e,n,i,o){const a=[],s=this._parent,l=this._selection;if(e<i?s.each((t=>{l.contains(t)||a.push(t)}),e+(n?0:1),i+(o?1:0)):s.each((t=>{l.contains(t)||a.push(t)}),i+(o?0:1),e+(n?1:0)),0<a.length){const e=l.store();l.addAll(a),l.focus();const n=l.store();t.DControllers.getCommandController().push(new me(e,n,l))}}addAll(e){if(0<e.length){const n=[],i=this._parent,o=this._selection;for(let t=0,a=e.length;t<a;++t){const a=i.get(e[t]);a&&!o.contains(a)&&n.push(a)}if(0<n.length){const e=o.store();o.addAll(n),o.focus();const i=o.store();t.DControllers.getCommandController().push(new me(e,i,o))}}}contains(t){const e=this._parent.get(t);return!!e&&this._selection.contains(e)}remove(e){const n=this._parent.get(e);if(n){const e=this._selection;if(e.contains(n)){const i=e.store();e.remove(n),e.focus();const o=e.store();t.DControllers.getCommandController().push(new me(i,o,e))}}}clear(){const e=this._selection;if(!e.isEmpty()){const n=e.store();e.clear(),e.focus();const i=e.store();t.DControllers.getCommandController().push(new me(n,i,e))}}clearAndAdd(e){const n=this._parent.get(e);if(n){const e=this._selection;if(e.contains(n))if(1<e.size()){const i=e.store();e.set(n),e.focus();const o=e.store();t.DControllers.getCommandController().push(new me(i,o,e))}else e.focus();else{const i=e.store();e.set(n),e.focus();const o=e.store();t.DControllers.getCommandController().push(new me(i,o,e))}}}clearAndAddAll(e){const n=this._selection;if(!n.isEmpty()||0<e.length){const i=[],o=this._parent;for(let t=0,n=e.length;t<n;++t){const n=o.get(e[t]);n&&i.push(n)}const a=n.store();n.clearAndAddAll(i),n.focus();const s=n.store();t.DControllers.getCommandController().push(new me(a,s,n))}}shift(t,e){}size(){return this._selection.size()}isEmpty(){return this._selection.isEmpty()}each(t){const e=this._selection;this._parent.each(((n,i)=>!e.contains(n)||!1!==t(i)))}toArray(){const t=this._selection,e=[];return this._parent.each(((n,i)=>{t.contains(n)&&e.push([i,n])})),e}toSortedArray(){return this.toArray().sort(Ui)}toObject(){const t=this._selection,e={};return this._parent.each(((n,i)=>{t.contains(n)&&(e[i]=n)})),e}toMap(){const t=this._selection,e=new Map;return this._parent.each(((n,i)=>{t.contains(n)&&e.set(i,n)})),e}}class Xi extends t.DLayoutVertical{constructor(t){super(t),this._icons=t.icons;const e=t.diagram;this._diagram=e,this._selection=t.selection,this._isInitialized=!1,this._updatedParts=J.NONE}show(){return super.show(),this.onShow(),this}onShow(){this._isInitialized||(this._isInitialized=!0,this.initLayout()),this.onSelectionChange(J.NONE)}initLayout(){this.addChild(this.layoutOrder),this.addChild(this.table),this._selection.on("change",(t=>{this.onSelectionChange(t)}));const t=()=>{this.onLayerChange()},e=this._diagram,n=e.canvas;n?(this.state.isDisabled=!1,n.layer.on("change",t)):this.state.isDisabled=!0,e.on("set",(e=>{this.state.isDisabled=!1,e.layer.on("change",t)})),e.on("ready",(()=>{this.onLayerChange()})),e.on("unset",(e=>{this.state.isDisabled=!0,this.onLayerChange(),e.layer.off("change",t)})),this.onLayerChange()}get layoutOrder(){var t;return null!==(t=this._layerOrder)&&void 0!==t?t:this._layerOrder=this.newLayoutOrder()}newLayoutOrder(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newTextLabel(),this.buttonBringToFront,this.buttonBringForward,this.buttonSendBackward,this.buttonSendToBack]})}newTextLabel(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})}get buttonBringToFront(){var t;return null!==(t=this._buttonBringToFront)&&void 0!==t?t:this._buttonBringToFront=this.newButtonBringToFront()}newButtonBringToFront(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_to_top},title:this.theme.getButtonBringToFrontTitle(),on:{active:()=>{this._selection.bringToFront()}}})}get buttonBringForward(){var t;return null!==(t=this._buttonBringForward)&&void 0!==t?t:this._buttonBringForward=this.newButtonBringForward()}newButtonBringForward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_up},title:this.theme.getButtonBringForwardTitle(),on:{active:()=>{this._selection.bringForward()}}})}get buttonSendBackward(){var t;return null!==(t=this._buttonSendBackward)&&void 0!==t?t:this._buttonSendBackward=this.newButtonSendBackward()}newButtonSendBackward(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_down},title:this.theme.getButtonSendBackwardTitle(),on:{active:()=>{this._selection.sendBackward()}}})}get buttonSendToBack(){var t;return null!==(t=this._buttonSendToBack)&&void 0!==t?t:this._buttonSendToBack=this.newButtonSendToBack()}newButtonSendToBack(){return new t.DButtonAmbient({width:30,image:{source:this._icons.arrow_to_bottom},title:this.theme.getButtonSendToBackTitle(),on:{active:()=>{this._selection.sendToBack()}}})}onSelectionChange(e){var n;this.isShown()?(e|=this._updatedParts,this._updatedParts=J.NONE,e&J.TREE?this.table.data.nodes=null===(n=this._diagram.layer)||void 0===n?void 0:n.children:e&J.SELECTION?this.table.data.update():e&J.PROPERTY_ID&&this.table.data.update(!0),this.layoutOrder.state.isEnabled=t.EShapeCapabilities.contains(this._selection.last(),t.EShapeCapability.ORDER_IN_LAYER)):this._updatedParts|=e}onLayerChange(){var t;this.table.data.nodes=null===(t=this._diagram.layer)||void 0===t?void 0:t.children}get table(){var t;return null!==(t=this._table)&&void 0!==t?t:this._table=this.newTable()}newTable(){return new t.DTable({x:"padding",width:"padding",weight:1,columns:[{type:"TREE",editable:!0,getter:t=>Mi(t),setter:(e,n,i)=>{e.id!==i&&t.DControllers.getCommandController().push(new dt(this._selection,i,[e]))}}],data:new t.DTableDataTree({reverse:!0,toChildren:e=>t.EShapeCapabilities.contains(e,t.EShapeCapability.CHILDREN)?e.children:null,selection:t=>new Yi(t,this._selection)}),on:{keydown:e=>{t.UtilKeyboardEvent.isDeleteKey(e)&&(this._selection.delete(),e.preventDefault())}}})}getType(){return"EEditorTree"}}class Wi extends t.DLayoutVertical{constructor(e){super(e);const n=e.selection;this._selection=n,this._icons=e.icons,this._validator=e.validator;const i=e.diagram;this._diagram=i,this.state.isDisabled=null==i.canvas,i.on("unset",(()=>{this.list.data.clear(),this.state.isDisabled=!0})),i.on("set",(()=>{this.state.isDisabled=!1})),this.addChild(new t.DLayoutHorizontal({x:"padding",width:"padding",height:"auto",children:[this.newTextLabel(),this.buttonRevalidate]})),this.addChild(this.list)}newTextLabel(){return new t.DText({weight:1,text:{value:this.theme.getLabel()}})}get buttonRevalidate(){let t=this._buttonRevalidate;return null==t&&(t=this.newButtonRevalidate(),this._buttonRevalidate=t),t}newButtonRevalidate(){return new t.DButtonAmbient({width:30,image:{source:this._icons.refresh},title:this.theme.getButtonRevalidateTitle(),on:{active:t=>{this.onButtonValidateActive(t)}}})}onButtonValidateActive(e){const n=this._validator;if(null!=n){const i=this._diagram.canvas;if(null!=i){const o=this.dialogProcessing;o.open(e);const a=this.list.data;try{const e=n(i);t.isArray(e)?(a.clearAndAddAll(e),o.resolve()):e.then((t=>{a.clearAndAddAll(t),o.resolve()}),(()=>{a.clear(),o.reject()}))}catch(t){a.clear(),o.reject()}}}}get list(){let t=this._list;return null==t&&(t=this.newList(),this._list=t),t}newList(){return new t.DList({width:"padding",weight:1,data:{toLabel:t=>t.message},updater:{newItem:e=>new t.DListItem(e,{on:{select:(t,e)=>{this.onListItemDown(t,e)}}})}})}onListItemDown(e,n){const i=e.shape;if(null!=i){const e=this._diagram.canvas,o=i.root.parent;if(null!=e&&null!=o){const n=this._selection,a=n.store();if(n.set(i)){n.focus();const e=n.store();t.DControllers.getCommandController().push(new me(a,e,n))}else n.focus();e.layer.active!==o&&(e.layer.active=o)}else this.dialogError.open(n)}}get dialogError(){let t=this._dialogError;return null==t&&(t=this.newDialogError(),this._dialogError=t),t}newDialogError(){return new t.DDialogMessage({message:"No shapes found."})}get dialogProcessing(){let t=this._dialogProcessing;return null==t&&(t=this.newDialogProcessing(),this._dialogProcessing=t),t}newDialogProcessing(){return new t.DDialogProcessing({footer:{button:{ok:"OK",cancel:null}}})}getType(){return"EEditorValidation"}}class Ki{constructor(){this._isSuspended=!1,this._active=null,this._activeParameter=null}activate(t,e){const n=this._active,i=this._activeParameter;n===t&&i===e||(this._activeParameter=e,n!==t&&(n&&n.deactivate(),this._active=t,this._isSuspended||t.activate()))}deactivate(t,e){this._active===t&&this._activeParameter===e&&(this._active=null,this._activeParameter=null,t.deactivate())}suspend(){if(!this._isSuspended){this._isSuspended=!0;const t=this._active;t&&t.deactivate()}}resume(){if(this._isSuspended){this._isSuspended=!1;const t=this._active;t&&t.activate()}}isSuspended(){return this._isSuspended}}class $i extends e.utils.EventEmitter{constructor(){super(),this._isActive=!1}activate(){this._isActive||(this._isActive=!0,this.onActivate())}deactivate(){this._isActive&&(this._isActive=!1,this.onDeactivate())}onActivate(){}onDeactivate(){}isActive(){return this._isActive}}class Zi extends e.Graphics{constructor(){super(),this._size=new e.Point}get size(){return this._size}update(){this.clear();const t=this._size,e=Math.min(0,t.x),n=Math.min(0,t.y),i=Math.abs(t.x),o=Math.abs(t.y);this.beginFill(2000880,.5),this.drawRect(e,n,i,o),this.endFill()}}var ji;!function(t){t[t.NONE=0]="NONE",t[t.SELECT=1]="SELECT",t[t.TRANSLATE=2]="TRANSLATE",t[t.SCALE=3]="SCALE",t[t.ROTATE=4]="ROTATE"}(ji||(ji={}));class qi extends e.Container{}class Ji extends e.Rectangle{constructor(t){super(),this._modifier=t}contains(e,n){const i=this._modifier,o=2*i.getAnchorSize(),a=.5*o,s=i.width,l=i.height,r=.5*s,h=.5*l,u=i.getAnchorRotationDistance(),c=2*i.getAnchorRotationSize();return 0-a<=e&&0-a<=n&&e<=0-a+o&&n<=0-a+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.TOP_LEFT),!0):s-a<=e&&0-a<=n&&e<=s-a+o&&n<=0-a+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.TOP_RIGHT),!0):0-a<=e&&l-a<=n&&e<=0-a+o&&n<=l-a+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.BOTTOM_LEFT),!0):s-a<=e&&l-a<=n&&e<=s-a+o&&n<=l-a+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.BOTTOM_RIGHT),!0):r-a<=e&&0-a<=n&&e<=r-a+o&&n<=0-a+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.TOP_CENTER),!0):s-a<=e&&h-a<=n&&e<=s-a+o&&n<=h-a+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.MIDDLE_RIGHT),!0):r-a<=e&&l-a<=n&&e<=r-a+o&&n<=l-a+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.BOTTOM_CENTER),!0):0-a<=e&&h-a<=n&&e<=0-a+o&&n<=h-a+o?(i.setLastHitAnchor(t.ESnapperModifierAnchor.MIDDLE_LEFT),!0):r-c<=e&&u-c<=n&&e<=r+c&&n<=u+c&&(i.setLastHitAnchor(t.ESnapperModifierAnchor.ROTATION),!0)}}class Qi extends t.EShapeContainer{constructor(e){super(),this.selected=!1,this.index=0,this._width=0,this._height=0,this._scaleBound=1,this._scaleBoundInverse=1,this._isAllowed=!0,this._lastHitAnchor=t.ESnapperModifierAnchor.NONE,null==e||!1!==e.editable?(this.cursor="grab",this.interactive=!0,this.hitArea=new Ji(this)):this.interactive=!1,this.group=!1,this._anchorBase=(new t.EShapeRectangle).attach(this),this._anchorsScale=[(new t.EShapeRectangle).attach(this),(new t.EShapeRectangle).attach(this),(new t.EShapeRectangle).attach(this),(new t.EShapeRectangle).attach(this),(new t.EShapeRectangle).attach(this),(new t.EShapeRectangle).attach(this),(new t.EShapeRectangle).attach(this),(new t.EShapeRectangle).attach(this)],this._anchorRotate=(new t.EShapeCircle).attach(this)}onPrerender(){const t=this.getParentScale(),e=this._scaleBound;.001<Math.abs(t-e)&&(this._scaleBound=t,this._scaleBoundInverse=1/t,this.update())}render(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this.onPrerender(),super.render(t))}getParentScale(){const t=this.parent;if(null!=t){const e=t.parent;if(null!=e)return e.scale.y}return 1}get factor(){return this._scaleBoundInverse}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}getLastHitAnchor(){return this._lastHitAnchor}setLastHitAnchor(t){const e=this._lastHitAnchor;return this._lastHitAnchor=t,e}getAnchorSize(){return 7*this._scaleBoundInverse}getAnchorRotationDistance(){return(0<=this._height?-18:18)*this._scaleBoundInverse}getAnchorRotationSize(){return 5*this._scaleBoundInverse}update(){const e=this.group?2027655:2000880,n=this._width,i=this._height,o=this._scaleBoundInverse,a=this.getAnchorSize(),s=n,l=i,r=.5*s,h=.5*l,u=this.getAnchorRotationDistance(),c=2*this.getAnchorRotationSize(),p=2*o,d=1.5*p,g=this._anchorBase;g.lock(t.EShapeLockPart.UPLOADED),g.fill.enable=!1,g.stroke.set(!0,e,.333,p,2),g.transform.position.set(.5*n,.5*i),g.size.set(n,i),g.unlock(t.EShapeLockPart.UPLOADED,!0);const _=this._anchorRotate;_.lock(t.EShapeLockPart.UPLOADED),_.stroke.enable=!1,_.fill.set(!0,e,1),_.size.set(c,c),_.transform.position.set(r,u),_.unlock(t.EShapeLockPart.UPLOADED,!0);const S=this._anchorsScale;for(let n=0,i=S.length;n<i;++n){const i=S[n];i.lock(t.EShapeLockPart.UPLOADED),i.stroke.enable=!1,i.fill.set(!0,e,1),i.size.set(a,a)}S[0].transform.position.set(-d,-d),S[1].transform.position.set(+d+s,-d),S[2].transform.position.set(-d,+d+l),S[3].transform.position.set(+d+s,+d+l),S[4].transform.position.set(r,-d),S[5].transform.position.set(+d+s,h),S[6].transform.position.set(r,+d+l),S[7].transform.position.set(-d,h);for(let e=0,n=S.length;e<n;++e)S[e].unlock(t.EShapeLockPart.UPLOADED,!0)}allow(){this._isAllowed=!0}isAllowed(){return this._isAllowed}disallow(){this._isAllowed=!1}destroy(){const t=this.parent;t&&t.removeChild(this)}}class to extends t.EShapeEditor{constructor(){super(),this.tailVector=new e.Point,this.headVector=new e.Point}}class eo{static prepare(t){let e=null;t.editor instanceof to?e=t.editor:(e=new to,t.editor=e);const n=e.tailVector,i=e.headVector,o=t.edge;o.tail.local.copyTo(n),o.head.local.copyTo(i);const a=t.transform.localTransform;a.applyInverse(n,n),a.applyInverse(i,i),De.prepare(t)}static finalize(t){De.finalize(t)}static apply(t,e){const n=t.editor;if(n instanceof to){const i=n.localTransform;n.internalTransformParentInverse.copyTo(i).append(e).append(n.internalTransform);const o=i.a,a=i.b,s=i.c,l=i.d,r=i.tx,h=i.ty,u=t.edge,c=u.tail,p=u.head,d=n.tailVector,g=d.x,_=d.y,S=o*g+s*_+r,w=a*g+l*_+h,m=n.headVector,T=m.x,E=m.y,y=o*T+s*E+r,v=a*T+l*E+h;u.lock(),c.local.set(S,w),p.local.set(y,v),u.unlock()}}}class no extends Wt{toCapability(e){return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE)?t.EShapeCapability.LINE:t.EShapeCapability.NONE}}const io=t=>t.x,oo=t=>t.x+.5*t.width,ao=t=>t.x+t.width,so=t=>t.y,lo=t=>t.y+.5*t.height,ro=t=>t.y+t.height,ho=t=>t.width,uo=t=>t.height,co=t=>0,po=(t,e)=>Math.min(t,e),go=(t,e)=>Math.max(t,e),_o=(t,e)=>t+e,So=(t,e)=>t,wo=(t,e)=>t/e,mo=(t,e)=>{e.x=t},To=(t,e)=>{e.y=t},Eo=(t,e,n,i)=>{i.transform.position.x=t.x+e/n.x},yo=(t,e,n,i)=>{i.transform.position.x=t.x},vo=(t,e,n,i)=>{i.transform.position.x=t.x-e/n.x},Co=(t,e,n,i)=>{i.transform.position.y=t.y+e/n.y},bo=(t,e,n,i)=>{i.transform.position.y=t.y},Do=(t,e,n,i)=>{i.transform.position.y=t.y-e/n.y};class Lo extends e.utils.EventEmitter{constructor(n){super();const i=n.diagram;this._diagram=i;const o=new Qi(n.modifier);this._modifier=o;const a=new qi;a.addChild(o),i.on("unset",(t=>{a.parent===t&&t.removeChild(a)})),this._modifierContainer=a,this._originGlobal=new e.Point,this._originLocal=new e.Point,this._rotationAxisGlobal=new e.Point,this._scale=new e.Point,this._scaleAxis0=new e.Point,this._scaleAxis1=new e.Point,this._scaleDet=1,this._scaleDetInverse=1,this._scaleTransform=new e.Matrix,this._scaleTransformInverse=new e.Matrix,this._scaleAnchor=t.ESnapperModifierAnchor.NONE,this._shapes=[],this._shapeBound=new e.Rectangle,this._shapeBoundRect=new e.Rectangle,this._alignPoint=new e.Point,this._alignRectangle=new e.Rectangle,this._shiftPoint1=new e.Point,this._shiftPoint2=new e.Point,this._transform=new e.Matrix,this._translateDelta=new e.Point,this._isUpdated=!1,this._updatedParts=J.NONE,this._lockCount=0}lock(){this._lockCount+=1,1===this._lockCount&&(this._isUpdated=!1,this._updatedParts=J.NONE)}unlock(){this._lockCount-=1,0===this._lockCount&&this._isUpdated&&this.update(this._updatedParts)}update(e){let n=J.ALL;null!=e&&(n=t.isNumber(e)?e:this.toParts(arguments)),this._lockCount<=0?(this.updateModifier(),this.emit("change",n,this)):(this._isUpdated=!0,this._updatedParts|=n)}toParts(e){if(t.isNumber(e))return e;let n=J.NONE;for(let t=0,i=e.length;t<i;++t)n|=J[e[t]];return n}updateModifier(){const e=this._diagram,n=this._modifier;if(n.isAllowed()){const i=this._shapes,o=e.canvas,a=this._modifierContainer;if(null==o||i.length<=0)n.visible=!1,t.DApplications.update(e);else if(i.length<=1){const s=i[0];if(s.parent instanceof t.EShapeBase){s.updateTransform();const t=s.transform.internalTransform,e=t.a,i=t.b,o=t.c,l=t.d,r=s.transform.pivot;n.position.set(e*r.x+o*r.y+t.tx,i*r.x+l*r.y+t.ty);const h=s.root.parent;h?a.transform.position.copyFrom(h.transform.position):a.transform.position.set(0,0);const u=s.size.x*Math.sqrt(e*e+i*i),c=s.size.y*Math.sqrt(o*o+l*l);n.width=u,n.height=c,n.pivot.set(.5*u,.5*c);const p=Math.atan2(-o,l),d=Math.atan2(+i,e),g=.5*(d-p),_=.5*(p+d);n.rotation=_,n.skew.set(g,g)}else{s.updateTransform();const t=s.transform.internalTransform,e=t.a,i=t.b,o=t.c,l=t.d,r=s.transform.pivot;n.position.set(e*r.x+o*r.y+t.tx,i*r.x+l*r.y+t.ty);const h=s.root.parent;h?a.transform.position.copyFrom(h.transform.position):a.transform.position.set(0,0),n.width=s.size.x,n.height=s.size.y,n.pivot.set(.5*s.size.x,.5*s.size.y),n.rotation=s.transform.rotation,n.skew.copyFrom(s.transform.skew)}n.visible=!0,n.group=t.EShapeCapabilities.contains(s,t.EShapeCapability.CHILDREN)&&0<s.children.length,a.parent!==o&&o.addChild(a),n.update(),t.DApplications.update(e)}else{const s=this._shapeBound,l=this._shapeBoundRect;i[0].getBoundsInternal(!1,s);for(let t=1,e=i.length;t<e;++t)i[t].getBoundsInternal(!1,l),s.enlarge(l);const r=i[0].root.parent;r?a.transform.position.copyFrom(r.transform.position):a.transform.position.set(0,0),n.position.set(s.x,s.y),n.width=s.width,n.height=s.height,n.rotation=0,n.pivot.set(0,0),n.skew.set(0,0),n.visible=!0,n.group=!1,a.parent!==o&&o.addChild(a),n.update(),t.DApplications.update(e)}}else n.visible=!1,t.DApplications.update(e)}toggle(e){const n=this._shapes;if(n.length<=0){const t=e.root;t.selected=!0,n.push(t)}else{const i=n[0];if($.isParent(e,i))if(i.selected=!1,t.EShapeCapabilities.contains(i,t.EShapeCapability.CHILDREN)){const t=$.toOfParent(e,i);t.selected=!0,n[0]=t}else n.splice(0,1);else if(i.parent===e.parent)e.selected?(e.selected=!1,n.splice(n.indexOf(e),1)):(e.selected=!0,n.push(e));else{const t=$.toSharedParent(i,e);if(i.parent===t){const i=$.toOfParent(e,t);i.selected?(i.selected=!1,n.splice(n.indexOf(i),1)):(i.selected=!0,n.push(i))}else{let i=0;for(let e=0,o=n.length;e<o;++e){const o=n[e];o.selected=!1;const a=$.toOfParent(o,t);a.selected||(a.selected=!0,n[i]=a,i+=1)}n.length=i;const o=$.toOfParent(e,t);o.selected||(o.selected=!0,n.push(o))}}}this.update(J.SELECTION)}addAll(t){const e=this._shapes;let n=!1;if(0<e.length){const t=e[0];if(t.root!==t){const t=e.slice(0);e.length=0;for(let n=0,i=t.length;n<i;++n){const i=t[n];i.selected=!1;const o=i.root;o.selected||(o.selected=!0,e.push(o))}n=!0}}for(let i=0,o=t.length;i<o;++i){const o=t[i];o.selected||(o.selected=!0,e.push(o),n=!0)}return n&&this.update(J.SELECTION),n}clearAndAddAll(t){const e=this._shapes;for(let t=0,n=e.length;t<n;++t)e[t].selected=!1;e.length=0;for(let n=0,i=t.length;n<i;++n){const i=t[n];i.selected=!0,e.push(i)}return this.update(J.SELECTION),!0}set(t){const e=this._shapes;if(1<e.length){for(let t=0,n=e.length;t<n;++t)e[t].selected=!1;return e.length=0,t.selected=!0,e.push(t),this.update(J.SELECTION),!0}return 1===e.length?e[0]!==t&&(e[0].selected=!1,t.selected=!0,e[0]=t,this.update(J.SELECTION),!0):(t.selected=!0,e.push(t),this.update(J.SELECTION),!0)}get(){return this._shapes}first(){const t=this._shapes;return 0<t.length?t[0]:null}last(){const t=this._shapes;return 0<t.length?t[t.length-1]:null}swapLast(t,e){const n=this._shapes;if(0<n.length){const i=n[n.length-1];i===t&&(i.selected=!1,n[n.length-1]=e,e.selected=!0,this.update(J.TREE|J.SELECTION))}}remove(t){const e=this._shapes,n=e.indexOf(t);0<=n&&(t.selected=!1,e.splice(n,1),this.update(J.TREE|J.SELECTION))}contains(t){return t.selected}size(){return this._shapes.length}isEmpty(){return this._shapes.length<=0}clear(){const t=this._shapes;if(0<t.length){for(let e=0,n=t.length;e<n;++e)t[e].selected=!1;return this._shapes.length=0,this.update(J.SELECTION),!0}return!1}focus(){if(this.isEmpty())return!1;const e=this._diagram,n=e.canvas;if(null==n)return!1;const i=n.parent;if(!(i instanceof t.DBase))return!1;const o=n.width,a=n.height,s=i.padding,l=s.getLeft(),r=s.getTop(),h=s.getRight(),u=s.getBottom(),c=l+.5*(Math.max(0,i.width-l-h)-o),p=r+.5*(Math.max(0,i.height-r-u)-a),d=this._modifier,g=this._alignPoint;g.set(.5*d.width,.5*d.height),d.toGlobal(g,g,!1),i.toLocal(g,void 0,g,!1);const _=n.position,S=.5*o-(g.x-_.x),w=.5*a-(g.y-_.y);return e.view.moveTo(c+S,p+w),!0}prepare(){const e=this._shapes;if(0<e.length){for(let n=0,i=e.length;n<i;++n){const i=e[n];i instanceof t.EShapeConnectorLine?eo.prepare(i):De.prepare(i)}return!0}return!1}prepareTranslateSnap(){const e=this._diagram;e instanceof t.DDiagramEditor&&e.snapper.prepareForTranslate(this._modifier)}prepareRotateSnap(){const e=this._diagram;e instanceof t.DDiagramEditor&&e.snapper.prepareForRotate(this._modifier)}prepareScaleSnap(){const e=this._diagram;e instanceof t.DDiagramEditor&&e.snapper.prepareForScale(this._modifier,this._scaleAnchor)}prepareTranslate(){return this.prepare()}prepareRotate(t){if(this.prepare()){const e=this._originGlobal,n=this._originLocal,i=this._modifier;if(n.set(.5*i.width,.5*i.height),e.copyFrom(n),i.updateTransform(),i.transform.localTransform.apply(n,n),i.transform.worldTransform.apply(e,e),null==t)return!0;{const n=this._rotationAxisGlobal,i=t.x-e.x,o=t.y-e.y,a=Math.sqrt(i*i+o*o);if(.001<a){const t=1/a;return n.set(i*t,o*t),!0}return this.finalize(),!1}}return!1}prepareScale(t){if(this.prepare()){if(this.prepareScaleOriginAndAxes(t)){const t=this._modifier,e=t.rotation,n=t.skew,i=this._originLocal,o=this._scaleTransform;return o.setTransform(0,0,0,0,1,1,e,n.x,n.y).invert(),o.apply(i,i),o.translate(-i.x,-i.y),o.copyTo(this._scaleTransformInverse).invert(),!0}return this.finalize(),!1}return!1}prepareScaleOriginAndAxes(e){const n=this._modifier;n.updateTransform();const i=n.transform.localTransform,o=n.transform.worldTransform,a=n.width,s=n.height,l=this._originGlobal,r=this._originLocal;switch(this._scaleAnchor=e,e){case t.ESnapperModifierAnchor.TOP_LEFT:return r.set(a,s),l.copyFrom(r),i.apply(r,r),o.apply(l,l),this.prepareScaleAxes(0,s,a,0,l);case t.ESnapperModifierAnchor.TOP_CENTER:return r.set(.5*a,s),l.copyFrom(r),i.apply(r,r),o.apply(l,l),this.prepareScaleAxis(.5*a,0,l);case t.ESnapperModifierAnchor.TOP_RIGHT:return r.set(0,s),l.copyFrom(r),i.apply(r,r),o.apply(l,l),this.prepareScaleAxes(a,s,0,0,l);case t.ESnapperModifierAnchor.MIDDLE_LEFT:return r.set(a,.5*s),l.copyFrom(r),i.apply(r,r),o.apply(l,l),this.prepareScaleAxis(0,.5*s,l);case t.ESnapperModifierAnchor.NONE:return r.set(.5*a,.5*s),l.copyFrom(r),i.apply(r,r),o.apply(l,l),.001<Math.abs(a)&&(this._scaleAxis0.x=a,.001<Math.abs(s)&&(this._scaleAxis0.y=s,!0));case t.ESnapperModifierAnchor.MIDDLE_RIGHT:return r.set(0,.5*s),l.copyFrom(r),i.apply(r,r),o.apply(l,l),this.prepareScaleAxis(a,.5*s,l);case t.ESnapperModifierAnchor.BOTTOM_LEFT:return r.set(a,0),l.copyFrom(r),i.apply(r,r),o.apply(l,l),this.prepareScaleAxes(0,0,a,s,l);case t.ESnapperModifierAnchor.BOTTOM_CENTER:return r.set(.5*a,0),l.copyFrom(r),i.apply(r,r),o.apply(l,l),this.prepareScaleAxis(.5*a,s,l);case t.ESnapperModifierAnchor.BOTTOM_RIGHT:return r.set(0,0),l.copyFrom(r),i.apply(r,r),o.apply(l,l),this.prepareScaleAxes(a,0,0,s,l)}return!1}prepareScaleAxis(t,e,n){const i=this._scaleAxis0;i.set(t,e),this._modifier.toGlobal(i,i,!0),i.x-=n.x,i.y-=n.y;const o=Math.sqrt(i.x*i.x+i.y*i.y);if(.001<o){const t=1/o;return i.x*=t,i.y*=t,this._scaleDet=o,this._scaleDetInverse=t,!0}return!1}prepareScaleAxes(t,e,n,i,o){const a=this._modifier.transform.worldTransform,s=this._scaleAxis0;s.set(t,e),a.apply(s,s),s.x-=o.x,s.y-=o.y;const l=this._scaleAxis1;l.set(n,i),a.apply(l,l),l.x-=o.x,l.y-=o.y;const r=s.x*l.y-s.y*l.x;return.001<Math.abs(r)&&(this._scaleDet=r,this._scaleDetInverse=1/r,!0)}finalize(){const e=this._shapes;if(0<e.length)for(let n=0,i=e.length;n<i;++n){const i=e[n];i instanceof t.EShapeConnectorLine?eo.finalize(i):De.finalize(i)}}saveForTranslate(){t.DControllers.getCommandController().push(new kt(this))}saveForRotate(){t.DControllers.getCommandController().push(new Bt(this))}saveForScale(){t.DControllers.getCommandController().push(new tt(this))}alignLeft(){this.align(io,ho,po,So,mo,Eo)}alignCenter(){this.align(oo,co,_o,wo,mo,yo)}alignRight(){this.align(ao,ho,go,So,mo,vo)}alignTop(){this.align(so,uo,po,So,To,Co)}alignMiddle(){this.align(lo,co,_o,wo,To,bo)}alignBottom(){this.align(ro,uo,go,So,To,Do)}align(e,n,i,o,a,s){const l=this._diagram.canvas,r=this._shapes,h=r.length;if(l&&1<=h){const u=r[0].parent;if(u){const c=this._alignPoint,p=this._alignRectangle;let d=!0,g=0;const _=[];for(let o=0;o<h;++o){const a=r[o];t.EShapeCapabilities.contains(a,t.EShapeCapability.POSITION)&&(a.getBounds(!1,p),d?(d=!1,g=e(p)):g=i(g,e(p)),_.push([n(p),a]))}const S=_.length;if(1<=S){S<=1&&(g=e(l.getBounds(!1,p))),g=o(g,S),c.set(0,0),a(g,c),u.toLocal(c,void 0,c);const t=l.scale;for(let e=0;e<S;++e){const n=_[e];s(c,.5*n[0],t,n[1])}this.update(J.PROPERTY)}}}}distributeHorizontally(){this.distribute(oo,ho,mo,Eo)}distributeVertically(){this.distribute(lo,uo,To,Co)}distribute(e,n,i,o){const a=this._diagram.canvas,s=this._shapes,l=s.length;if(a&&1<=l){const r=s[0].parent;if(r){const h=this._alignPoint,u=this._alignRectangle;let c=0;const p=[];for(let i=0;i<l;++i){const o=s[i];if(t.EShapeCapabilities.contains(o,t.EShapeCapability.POSITION)){o.getBounds(!1,u);const t=n(u);c+=t,p.push([e(u),t,o])}}const d=p.length;if(2<d){p.sort(((t,e)=>t[0]-e[0]));const t=p[0],e=p[d-1],n=(e[0]-t[0]-(c-.5*e[1]-.5*t[1]))/(d-1);h.set(0,0),i(t[0],h),r.toLocal(h,void 0,h);let s=.5*t[1]+n;const l=a.scale;for(let t=1,e=d-1;t<e;++t){const e=p[t],i=e[2];s+=.5*e[1],o(h,s,l,i),s+=.5*e[1]+n}this.update(J.PROPERTY)}else if(1===d){h.set(0,0),i(e(a.getBounds(!1,u)),h),r.toLocal(h,void 0,h);const t=p[0];o(h,0,a.scale,t[2]),this.update(J.PROPERTY)}}}}replace(e){const n=this._shapes;if(0<n.length){const i=n[0].parent;i&&t.DControllers.getCommandController().push(new we(i,e,this))}}group(){const e=this._shapes;if(2<=e.length){const n=e[0].parent;n&&t.DControllers.getCommandController().push(new q(n,this))}}hasUngroupable(t){for(let e=t.length-1;0<=e;--e)if(this.isUngroupable(t[e]))return!0;return!1}isUngroupable(e){return e instanceof t.EShapeGroup&&t.EShapeCapabilities.contains(e,t.EShapeCapability.CHILDREN)&&t.EShapeCapabilities.contains(e,t.EShapeCapability.UNGROUPING)}ungroup(){const e=this._shapes;if(this.hasUngroupable(e)){const n=e[0].parent;n&&t.DControllers.getCommandController().push(new Le(n,this))}}setFill(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new ut(this,[e,n]))}setFillEnabled(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ct(this,e))}setStroke(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new Gt(this,[e,n]))}setStrokeWidth(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Kt(this,e))}setStrokeAlign(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Ht(this,e))}setStrokeSide(e,n){0<this._shapes.length&&(n?t.DControllers.getCommandController().push(new Xt(this,e)):t.DControllers.getCommandController().push(new Yt(this,e)))}setStrokeStyle(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new Wt(this,e,n))}setStrokeEnabled(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Ut(this,e))}setLineStyle(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new no(this,e,n))}setLineTailType(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ft(this,e))}setLineTailSizeX(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Dt(this,e))}setLineTailSizeY(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Lt(this,e))}setLineTailColor(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new Ct(this,[e,n]))}setLineTailMargin(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new bt(this,e))}setLineHeadType(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new vt(this,e))}setLineHeadSizeX(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Et(this,e))}setLineHeadSizeY(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new yt(this,e))}setLineHeadColor(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new mt(this,[e,n]))}setLineHeadMargin(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Tt(this,e))}setPointsStyle(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new At(this,e,n))}setText(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new de(this,e))}setTextColor(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new qt(this,[e,n]))}setTextFamily(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Qt(this,e))}setTextSize(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new he(this,e))}setTextSizeDelta(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new re(this,e))}setTextWeight(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ge(this,e))}setTextStyle(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new pe(this,e))}setTextAlignHorizontal(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new $t(this,e))}setTextAlignVertical(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Zt(this,e))}setTextPaddingHorizontal(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new se(this,e))}setTextPaddingVertical(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new le(this,e))}setTextOffsetHorizontal(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ee(this,e))}setTextOffsetVertical(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ne(this,e))}setTextOutlineColor(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new ie(this,[e,n]))}setTextOutlineWidth(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ae(this,e))}setTextOutlineEnabled(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new oe(this,e))}setTextClipping(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new jt(this,e))}setTextFitting(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new te(this,e))}setTextSpacingHorizontal(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ue(this,e))}setTextSpacingVertical(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new ce(this,e))}setTextDirection(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Jt(this,e))}setInteractive(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new wt(this,e))}setFocusable(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new pt(this,e))}setShortcut(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Mt(this,e))}setTitle(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new _e(this,e))}setCursor(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new lt(this,e))}setRadius(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Pt(this,e))}setCorner(e,n){0<this._shapes.length&&(n?t.DControllers.getCommandController().push(new at(this,e)):t.DControllers.getCommandController().push(new ot(this,e)))}setImage(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new St(this,e,void 0))}setGradient(e,n){0<this._shapes.length&&t.DControllers.getCommandController().push(new St(this,e,n))}fitToImage(){0<this._shapes.length&&t.DControllers.getCommandController().push(new _t(this))}clearImage(){0<this._shapes.length&&t.DControllers.getCommandController().push(new gt(this))}bringToFront(){const e=this._shapes;if(0<e.length){const n=e[0].parent;if(n){const e=n.children,i=e.length,o=[];for(let t=i-1;0<=t;--t){const n=e[t];n.selected?(n.index=i+t,o.push(t)):n.index=t}e.sort($.COMPARATOR_INDEX);let a=!1;for(let t=0,e=o.length;t<e;++t)i-1-t!==o[t]&&(a=!0);return a&&(n.toDirty(),t.DControllers.getCommandController().push(new ye(o,n,this)),this.update(J.TREE)),!0}}return!1}bringForward(){const e=this._shapes;if(0<e.length){const n=e[0].parent;if(n){let e=!1;const i=n.children,o=[];let a=null;for(let t=i.length-1;0<=t;--t){const n=i[t];n.selected?a&&(i[t]=i[t+1],i[t+1]=n,o.push(t),e=!0):a=n}return e&&(n.toDirty(),t.DControllers.getCommandController().push(new Te(o,n,this)),this.update(J.TREE)),e}}return!1}sendBackward(){const e=this._shapes;if(0<e.length){const n=e[0].parent;if(n){let e=!1;const i=n.children,o=[];let a=null;for(let t=0,n=i.length;t<n;++t){const n=i[t];n.selected?a&&(i[t]=i[t-1],i[t-1]=n,o.push(t),e=!0):a=n}return e&&(n.toDirty(),t.DControllers.getCommandController().push(new ve(o,n,this)),this.update(J.TREE)),e}}return!1}sendToBack(){const e=this._shapes;if(0<e.length){const n=e[0].parent;if(n){const e=n.children,i=[],o=e.length;for(let t=0;t<o;++t){const n=e[t];n.selected?(n.index=t-o,i.push(t)):n.index=t}e.sort($.COMPARATOR_INDEX);let a=!1;for(let t=0;t<i.length;++t)t!==i[t]&&(a=!0);return a&&(n.toDirty(),t.DControllers.getCommandController().push(new be(i,n,this)),this.update(J.TREE)),!0}}return!1}serialize(){const e=this._diagram,n=e.canvas;if(null==n)return null;const i=new t.EShapeResourceManagerSerialization,o=this._shapes;if(0<o.length){const e=o[0].root;if(null!=e){const n=e.parent;n instanceof t.DDiagramLayer&&(n.addUuid(i),n.updateUuid(i))}}const a=new Set;for(let t=0,e=o.length;t<e;++t)a.add(o[t]);const s=[];for(let e=0,n=o.length;e<n;++e){const n=o[e],l=n.serialize(i);if(l[16]=0,n instanceof t.EShapeConnectorLine){let e=l[29];e&t.EShapeCapability.LINE_TAIL&&(a.has(n.edge.tail.acceptor.shape)||(e&=~t.EShapeCapability.LINE_TAIL)),e&t.EShapeCapability.LINE_HEAD&&(a.has(n.edge.head.acceptor.shape)||(e&=~t.EShapeCapability.LINE_HEAD)),l[29]=e}s.push(l)}const l={version:t.DDiagramSerializedVersion,name:n.name,label:n.label,width:n.width,height:n.height,summary:n.summary,description:n.description,resources:i.resources,data:i.data,pieces:i.pieces,items:s,layers:[[e instanceof t.DDiagramEditor?e.theme.getBaseLayerLabel():"Base Layer"]]};return JSON.stringify(l)}deserialize(e){const n=this._diagram,i=n.layer;if(null!=i){const o=t.DDiagrams.parse(e);null!=o&&t.DDiagrams.toPieceData(n.controller,o.pieces,t.EShapeResourceManagerDeserializationMode.EDITOR).then((t=>{this.deserialize_(i,o,t)}))}}deserialize_(e,n,i){const o=new t.EShapeResourceManagerDeserialization(n,n.pieces,i,t.EShapeResourceManagerDeserializationMode.EDITOR,0),a=t.deserializeAll(n.items,o);a&&a.then((n=>{const i=this.calcShift(n,e),o=n.length,a=e.children;for(let t=0;t<o;++t){const i=n[t];i.parent=e,i.uploaded=void 0,a.push(i)}e.onChildTransformChange(),e.toDirty();for(let t=0;t<o;++t)n[t].onAttach();this.shift(n,i),t.DControllers.getCommandController().push(new M(n,e,this,!0))}))}calcShift(t,e){if(t.length<=0)return null;const n=this._shiftPoint1,i=this._shiftPoint2,o=t[0];o.updateTransform();const a=o.transform;n.copyFrom(a.pivot),a.worldTransform.apply(n,n),e.transform.worldTransform.apply(n,n);const s=n.x,l=n.y;let r=0;for(;;){if(n.set(s+r,l+r),null==e.hitTestBBox(n,(t=>{if(t.type===o.type){t.updateTransform();const e=t.transform;i.copyFrom(e.pivot),e.worldTransform.apply(i,i);const n=i.x-(s+r),o=i.y-(l+r);return Math.abs(n)<=.1&&Math.abs(o)<=.1}return!1})))return n.set(s+r,l+r),e.toLocal(n,void 0,n),i.set(n.x-a.position.x,n.y-a.position.y),i;r+=10}}shift(e,n){if(e.length<=0||null==n)return;const i=n.x,o=n.y;for(let n=0,a=e.length;n<a;++n){const a=e[n];if(t.EShapeCapabilities.contains(a,t.EShapeCapability.POSITION)){const t=a.transform.position;t.set(t.x+i,t.y+o)}else if(a instanceof t.EShapeConnectorLine){const t=a.edge,e=t.head,n=t.tail;if(null==e.acceptor.shape&&null==n.acceptor.shape){t.lock();const a=e.local;a.set(a.x+i,a.y+o);const s=n.local;s.set(s.x+i,s.y+o),t.unlock()}}}}setId(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new dt(this,e))}addActionValue(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new R(e,this))}replaceActionValue(e,n,i){0<this._shapes.length&&t.DControllers.getCommandController().push(new P(e,n,this,i))}removeActionValue(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new k(e,this))}bringActionValueForward(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new O(e,this))}sendActionValueBackward(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new V(e,this))}addDataValue(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new U(e,this))}replaceDataValue(e,n,i){0<this._shapes.length&&t.DControllers.getCommandController().push(new W(e,n,this,i))}removeDataValue(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new X(e,this))}bringDataValueForward(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Y(e,this))}sendDataValueBackward(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new K(e,this))}addDataMappingValue(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new N(e,this))}replaceDataMappingValue(e,n,i){0<this._shapes.length&&t.DControllers.getCommandController().push(new H(e,n,this,i))}removeDataMappingValue(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new z(e,this))}bringDataMappingValueForward(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new F(e,this))}sendDataMappingValueBackward(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new G(e,this))}setPositionX(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Rt(this,e))}setPositionY(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Ot(this,e))}setPositionLeft(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new xt(this,e))}setPositionTop(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new It(this,e))}setSizeX(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Nt(this,e))}setSizeY(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Ft(this,e))}setRotation(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new Vt(this,e))}setSkew(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new zt(this,e))}toInternalVector(t,e){const n=this._modifier;n.updateTransform();const i=n.parent.worldTransform,o=i.a,a=i.b,s=i.c,l=i.d,r=1/(o*l-s*a);return e.set((l*t.x-s*t.y)*r,(o*t.y-a*t.x)*r),e}translate(e,n,i){const o=this._shapes;if(0<o.length){const a=this._translateDelta;if(a.set(e,n),this.toInternalVector(a,a),i){const e=this._diagram;e instanceof t.DDiagramEditor&&e.snapper.toTranslationSnapped(a,a)}const s=this._transform.set(1,0,0,1,a.x,a.y);for(let e=0,n=o.length;e<n;++e){const n=o[e];if(n instanceof t.EShapeConnectorLine){const t=n.edge;null==t.tail.acceptor.shape&&null==t.head.acceptor.shape&&eo.apply(n,s)}else{let e=t.EShapeCapability.NONE;t.EShapeCapabilities.contains(n,t.EShapeCapability.POSITION)&&(e|=t.EShapeCapability.POSITION),e!==t.EShapeCapability.NONE&&De.apply(n,s,e)}}this.update(J.PROPERTY)}}rotateTo(e,n){const i=this._rotationAxisGlobal,o=this._originGlobal,a=e.x-o.x,s=e.y-o.y,l=Math.sqrt(a*a+s*s);if(.001<l){const e=1/l,o=a*e,r=s*e,h=Math.max(-1,Math.min(1,i.x*o+i.y*r));let u=0<=i.x*r-i.y*o?+Math.acos(h):-Math.acos(h);if(n){const e=this._diagram;if(e instanceof t.DDiagramEditor){const t=this._modifier.rotation;u=e.snapper.toRotationSnapped(t,u)}}this.rotate(u)}}rotate(e){const n=this._shapes;if(0<n.length){const i=this._originLocal,o=this._transform.identity().translate(-i.x,-i.y).rotate(e).translate(+i.x,+i.y);for(let e=0,i=n.length;e<i;++e){const i=n[e];if(i instanceof t.EShapeConnectorLine){const t=i.edge;null==t.tail.acceptor.shape&&null==t.head.acceptor.shape&&eo.apply(i,o)}else{let e=t.EShapeCapability.NONE;t.EShapeCapabilities.contains(i,t.EShapeCapability.POSITION)&&(e|=t.EShapeCapability.POSITION),t.EShapeCapabilities.contains(i,t.EShapeCapability.ROTATION)&&(e|=t.EShapeCapability.ROTATION),e!==t.EShapeCapability.NONE&&De.apply(i,o,e)}}this.update(J.PROPERTY)}}getScale(e,n,i,o,a){switch(i){case t.ESnapperModifierAnchor.TOP_LEFT:this.getScaleXY(e,n,o,a);break;case t.ESnapperModifierAnchor.TOP_CENTER:this.getScaleY(e,n,o,a);break;case t.ESnapperModifierAnchor.TOP_RIGHT:this.getScaleXY(e,n,o,a);break;case t.ESnapperModifierAnchor.MIDDLE_LEFT:this.getScaleX(e,n,o,a);break;case t.ESnapperModifierAnchor.NONE:const i=this._scaleAxis0,s=i.x,l=i.y,r=(s+e)/s,h=(l+n)/l;o?a.x=a.y=Math.max(r,h):a.set(r,h);break;case t.ESnapperModifierAnchor.MIDDLE_RIGHT:this.getScaleX(e,n,o,a);break;case t.ESnapperModifierAnchor.BOTTOM_LEFT:this.getScaleXY(e,n,o,a);break;case t.ESnapperModifierAnchor.BOTTOM_CENTER:this.getScaleY(e,n,o,a);break;case t.ESnapperModifierAnchor.BOTTOM_RIGHT:this.getScaleXY(e,n,o,a)}}getScaleX(t,e,n,i){const o=this.calcScale(t,e);n?i.set(o,o):i.set(o,1)}getScaleY(t,e,n,i){const o=this.calcScale(t,e);n?i.set(o,o):i.set(1,o)}calcScale(t,e){const n=this._scaleAxis0,i=n.x*t+n.y*e;return(this._scaleDet+i)*this._scaleDetInverse}getScaleXY(t,e,n,i){const o=this._scaleAxis0,a=o.x,s=o.y,l=this._scaleAxis1,r=l.x,h=l.y,u=a+r+t,c=s+h+e,p=this._scaleDetInverse,d=(+h*u-r*c)*p,g=(-s*u+a*c)*p;this.setScale(d,g,n,i)}setScale(t,e,n,i){if(n)if(0<=t)if(0<=e){const n=Math.max(t,e);i.set(n,n)}else{const n=Math.max(t,-e);i.set(n,-n)}else if(0<=e){const n=Math.max(-t,e);i.set(-n,n)}else{const n=Math.min(t,e);i.set(n,n)}else i.set(t,e);return i}makeScaleTransform(t,e){return this._scaleTransform.copyTo(e).scale(t.x,t.y).prepend(this._scaleTransformInverse)}scale(e,n,i,o){const a=this._shapes;if(0<a.length){const s=this._scale,l=this._scaleAnchor;this.getScale(e,n,l,i,s);const r=this._transform;if(this.makeScaleTransform(s,r),o){const e=this._diagram;e instanceof t.DDiagramEditor&&e.snapper.toScaleSnapped(r,l,i,s)&&this.makeScaleTransform(s,r)}for(let e=0,n=a.length;e<n;++e){const n=a[e];if(n instanceof t.EShapeConnectorLine){const t=n.edge;null==t.tail.acceptor.shape&&null==t.head.acceptor.shape&&eo.apply(n,r)}else{let e=t.EShapeCapability.NONE;t.EShapeCapabilities.contains(n,t.EShapeCapability.POSITION)&&(e|=t.EShapeCapability.POSITION),t.EShapeCapabilities.contains(n,t.EShapeCapability.WIDTH)&&(e|=t.EShapeCapability.WIDTH),t.EShapeCapabilities.contains(n,t.EShapeCapability.HEIGHT)&&(e|=t.EShapeCapability.HEIGHT),t.EShapeCapabilities.contains(n,t.EShapeCapability.ROTATION)&&(e|=t.EShapeCapability.ROTATION),t.EShapeCapabilities.contains(n,t.EShapeCapability.SKEW)&&(e|=t.EShapeCapability.SKEW),e!==t.EShapeCapability.NONE&&De.apply(n,r,e)}}this.update(J.PROPERTY)}}delete(e){const n=this._shapes;if(0<n.length){const i=n[0].parent;if(i){if(!1!==e){const e=Z.delete(i,n,!0);if(e){const n=$.toIndices(e);t.DControllers.getCommandController().push(new j(e,n,i,this,!0))}}else Z.delete(i,n,!1);this.update(J.TREE|J.SELECTION)}}}createChildren(e){this.lock();const i=[],o=this._shapes;for(let t=0,n=o.length;t<n;++t){const n=o[t],a=e(n);a&&i.push(new M(a,n,this,!1))}0<i.length&&(t.DControllers.getCommandController().push(new n(i,this)),this.update(J.TREE)),this.unlock()}deleteChildren(e){this.lock();const i=[],o=this._shapes;for(let t=0,n=o.length;t<n;++t){const n=o[t],a=e(n);if(a){for(let t=0,e=a.length;t<e;++t)a[t].selected=!0;const t=Z.delete(n,void 0,!0);if(t){const e=$.toIndices(t);i.push(new j(t,e,n,this,!1))}}}0<i.length&&(t.DControllers.getCommandController().push(new n(i,this)),this.update(J.TREE)),this.unlock()}lockCapability(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new nt(this,e))}unlockCapability(e){0<this._shapes.length&&t.DControllers.getCommandController().push(new it(this,e))}store(){return this._shapes.slice(0)}restore(t){const e=this._shapes;for(let t=0,n=e.length;t<n;++t)e[t].selected=!1;e.length=0;for(let n=0,i=t.length;n<i;++n){const i=t[n];i.selected=!0,e.push(i)}this.update(J.SELECTION)}get modifier(){return this._modifier}}class fo{static isShapeIn(t,n){var i;const o=t.getBounds(!1,null!==(i=this._work)&&void 0!==i?i:this._work=new e.Rectangle),a=o.x,s=o.y,l=o.width,r=o.height;return n.contains(a,s)&&n.contains(a+l,s)&&n.contains(a,s+r)&&n.contains(a+l,s+r)}static findShapes(t,e,n){const i=t.children;for(let t=0,o=i.length;t<o;++t){const o=i[t];this.isShapeIn(o,e)&&n.push(o)}}}class Ao{static execute(t,n,i){var o,a;const s=null!==(o=Ao.OFFSETS)&&void 0!==o?o:Ao.OFFSETS=this.newOffsets(),l=null!==(a=Ao.WORK)&&void 0!==a?a:Ao.WORK=new e.Point,r=t.x,h=t.y;if(i)for(let t=0,e=s.length;t<e;t+=1){l.set(r+s[t],h+s[t+1]);const e=i.hitTest(l,n);if(null!=e)return e}else for(let t=0,e=s.length;t<e;t+=1){l.set(r+s[t],h+s[t+1]);const e=n.hitTest(l);if(null!=e)return e}return null}static newOffsets(){return[0,0,-1,-1,1,-1,1,1,-1,1,0,-2,2,0,0,-2,-2,0,-2,-2,2,-2,2,2,-2,2,0,-4,4,0,0,-4,-4,0]}}class Bo extends $i{constructor(t){super(),this._selection=new Lo((t=>{const e=t.selection;return{diagram:t.diagram,modifier:e&&e.modifier}})(t)),this._area=new Zi,this._diagram=t.diagram,this._applicationLayer=null,this._onDownPoint=new e.Point,this._onMovePoint=new e.Point,this._onUpPoint=new e.Point,this._areaRect=new e.Rectangle,this._mode=0,this._isFirstMove=!1,this._childSelectTime=-1,this._childSelectChild=null;const n=t.allow;n?(this._isTransformationAllowed=!1!==n.transformation,this._isDeletionAllowed=!1!==n.deletion):(this._isTransformationAllowed=!0,this._isDeletionAllowed=!0),this._onDownBound=t=>{this.onDown(t)},this._onMoveBound=t=>{this.onMove(t)},this._onUpBound=t=>{this.onUp(t)},this._onKeydownBound=t=>{this.onKeydown(t)},this._onKeyupBound=t=>{this.onKeyup(t)},this._onDblClickBound=t=>{this.onDblClick(t)}}get selection(){return this._selection}onActivate(){const e=this._diagram;e.on(t.UtilPointerEvent.down,this._onDownBound),e.on("dblclick",this._onDblClickBound),e.on("keydown",this._onKeydownBound),e.on("keyup",this._onKeyupBound)}onDeactivate(){const e=this._diagram;e.off(t.UtilPointerEvent.down,this._onDownBound),e.off("dblclick",this._onDblClickBound),e.off("keydown",this._onKeydownBound),e.off("keyup",this._onKeyupBound)}onDown(e){const n=e.data.originalEvent;if(n.altKey)return;const i=this._diagram,o=i.canvas,a=i.layer;if(o&&a){const s=n.ctrlKey||n.shiftKey;if(1===this._mode)return this._mode=0,void this.onSelectEnd(o,a,s);const l=e.data.global,r=this._onDownPoint;r.copyFrom(l);const h=this._selection,u=h.modifier,c=this.hitTest(l,u,a),p=t.DControllers.getCommandController();if(c instanceof t.EShapeBase){if(s){const t=h.store();h.toggle(c);const e=h.store();p.push(new me(t,e,h))}else if(!h.contains(c)){const e=h.first();if(null==e){const t=h.store();if(h.set(c.root)){const e=h.store();p.push(new me(t,e,h))}}else{const n=$.toSelected(c);if(null!=n)t.EShapeCapabilities.contains(n,t.EShapeCapability.CHILDREN)&&(this._childSelectTime=Date.now(),this._childSelectChild=$.toOfParent(c,n));else{const t=$.toSharedParent(e,c),n=h.store();if(h.set($.toOfParent(c,t))){const t=h.store();p.push(new me(n,t,h))}}}}this._isTransformationAllowed&&h.prepareTranslate()&&(h.prepareTranslateSnap(),this._mode=2,this._isFirstMove=!0)}else if(c===u)u.getLastHitAnchor()===t.ESnapperModifierAnchor.ROTATION?h.prepareRotate(l)&&(h.prepareRotateSnap(),this._mode=4,this._isFirstMove=!0):h.prepareScale(u.getLastHitAnchor())&&(h.prepareScaleSnap(),this._mode=3,this._isFirstMove=!0);else{const e=this._area;o.toLocal(l,void 0,r),e.x=r.x,e.y=r.y,e.size.set(0,0),e.update(),o.addChild(e),t.DApplications.update(i),this._mode=1}if(0!==this._mode){const e=this._applicationLayer;if(e){this._applicationLayer=null;const n=e.renderer.plugins.interaction;n.off(t.UtilPointerEvent.move,this._onMoveBound);const i=this._onUpBound;n.off(t.UtilPointerEvent.up,i),n.off(t.UtilPointerEvent.upoutside,i),n.off(t.UtilPointerEvent.cancel,i)}const n=t.DApplications.getLayer(i);if(n){this._applicationLayer=n;const e=n.renderer.plugins.interaction;e.on(t.UtilPointerEvent.move,this._onMoveBound);const i=this._onUpBound;e.on(t.UtilPointerEvent.up,i),e.on(t.UtilPointerEvent.upoutside,i),e.on(t.UtilPointerEvent.cancel,i)}}}}onMove(t){const e=t.data.originalEvent;if(e.altKey)return;const n=this._diagram,i=n.canvas,o=n.layer,a=this._mode,s=this._applicationLayer;if(i&&o&&0!==a&&s){const n=t.data.global;s.lock();const o=this._onDownPoint;if(1===a){const t=this._area,e=i.toLocal(n,void 0,this._onMovePoint);t.x=Math.min(o.x,e.x),t.y=Math.min(o.y,e.y),t.size.set(Math.max(o.x,e.x)-t.x,Math.max(o.y,e.y)-t.y),t.update()}else{const t=n.x-o.x,i=n.y-o.y;if(1<=Math.abs(t)||1<=Math.abs(i)){const o=this._isFirstMove;this._isFirstMove=!1,this._childSelectChild=null;const s=this._selection;switch(s.modifier.disallow(),a){case 2:o&&s.saveForTranslate(),s.translate(t,i,!0);break;case 4:o&&s.saveForRotate(),s.rotateTo(n,!0);break;case 3:o&&s.saveForScale();const a=e.shiftKey;s.scale(t,i,a,!0)}}}s.unlock(),s.update()}}hitTest(e,n,i){if(this._isTransformationAllowed&&n.visible){const o=t.DApplications.getLayer(i);if(o){const t=o.renderer.plugins.interaction,i=Ao.execute(e,n,t);if(null!=i)return i}}return i.visible?Ao.execute(e,i):null}onSelectEnd(e,n,i){const o=this._area,a=this._selection,s=t.DControllers.getCommandController();if(0<o.size.x&&0<o.size.y){const t=o.getBounds(!1,this._areaRect),e=[];if(fo.findShapes(n,t,e),i){if(0<e.length){const t=a.store();if(a.addAll(e)){const e=a.store();s.push(new me(t,e,a))}}}else if(0<e.length||!a.isEmpty()){const t=a.store();if(a.clearAndAddAll(e)){const e=a.store();s.push(new me(t,e,a))}}}else if(!i&&!a.isEmpty()){const t=a.store();if(a.clear()){const e=a.store();s.push(new me(t,e,a))}}e.removeChild(o),t.DApplications.update(n)}onUp(e){const n=this._diagram,i=n.canvas,o=n.layer,a=this._mode,s=this._applicationLayer;if(s){this._applicationLayer=null;const e=s.renderer.plugins.interaction;e.off(t.UtilPointerEvent.move,this._onMoveBound);const n=this._onUpBound;e.off(t.UtilPointerEvent.up,n),e.off(t.UtilPointerEvent.upoutside,n),e.off(t.UtilPointerEvent.cancel,n)}if(i&&o&&0!==a)if(this._mode=0,1===a){const t=e.data.originalEvent,n=t.ctrlKey||t.shiftKey;this.onSelectEnd(i,o,n)}else{const e=this._selection;e.finalize();const n=this._childSelectChild;if(null!=n&&(this._childSelectChild=null,Date.now()-this._childSelectTime<333)){const i=e.store();if(e.set(n)){const n=e.store();t.DControllers.getCommandController().push(new me(i,n,e))}}e.modifier.allow(),e.updateModifier(),s&&s.update()}}getRotateAmount(t){return Math.PI*(t.ctrlKey?1:15)/180}getScaleAmount(t){return t.ctrlKey?1:10}getTranslateAmount(t){return t.ctrlKey?1:10}onKeydown(e){const n=this._selection;if(n.isEmpty()||(this._isTransformationAllowed&&(t.UtilKeyboardEvent.isArrowUpKey(e)?(e.shiftKey?n.prepareScale(t.ESnapperModifierAnchor.NONE)&&(n.saveForScale(),n.scale(0,this.getScaleAmount(e),!1,!1),n.finalize()):n.prepareTranslate()&&(n.saveForTranslate(),n.translate(0,-this.getTranslateAmount(e),!1),n.finalize()),e.preventDefault()):t.UtilKeyboardEvent.isArrowRightKey(e)?(e.altKey?n.prepareRotate()&&(n.saveForRotate(),n.rotate(this.getRotateAmount(e)),n.finalize()):e.shiftKey?n.prepareScale(t.ESnapperModifierAnchor.NONE)&&(n.saveForScale(),n.scale(this.getScaleAmount(e),0,!1,!1),n.finalize()):n.prepareTranslate()&&(n.saveForTranslate(),n.translate(this.getTranslateAmount(e),0,!1),n.finalize()),e.preventDefault()):t.UtilKeyboardEvent.isArrowDownKey(e)?(e.shiftKey?n.prepareScale(t.ESnapperModifierAnchor.NONE)&&(n.saveForScale(),n.scale(0,-this.getScaleAmount(e),!1,!1),n.finalize()):n.prepareTranslate()&&(n.saveForTranslate(),n.translate(0,this.getTranslateAmount(e),!1),n.finalize()),e.preventDefault()):t.UtilKeyboardEvent.isArrowLeftKey(e)&&(e.altKey?n.prepareRotate()&&(n.saveForRotate(),n.rotate(-this.getRotateAmount(e)),n.finalize()):e.shiftKey?n.prepareScale(t.ESnapperModifierAnchor.NONE)&&(n.saveForScale(),n.scale(-this.getScaleAmount(e),0,!1,!1),n.finalize()):n.prepareTranslate()&&(n.saveForTranslate(),n.translate(-this.getTranslateAmount(e),0,!1),n.finalize()),e.preventDefault())),this._isDeletionAllowed&&t.UtilKeyboardEvent.isDeleteKey(e)&&(n.delete(),e.preventDefault())),t.UtilKeyboardEvent.isSelectAllKey(e)){const i=n.first(),o=null==i?this._diagram.layer:i.parent;if(null!=o){const i=o.children;if(0<i.length){const o=n.store();if(e.altKey){const e=new Set;for(let t=0,n=o.length;t<n;++t)e.add(o[t].type);const a=[];for(let t=0,n=i.length;t<n;++t){const n=i[t];(n.selected||e.has(n.type))&&a.push(n)}n.clearAndAddAll(a)&&t.DControllers.getCommandController().push(new me(o,a,n))}else if(n.clearAndAddAll(i)){const e=n.store();t.DControllers.getCommandController().push(new me(o,e,n))}}}}}onKeyup(t){}onDblClick(t){const e=this._selection.last();null!=e&&this.emit("edit",e,this)}}class xo extends t.EShapeContainer{constructor(e){super(),this._edge=e,this._circles=this.newCircles(),this._foundEdges=[],this._radius=2*t.EShapeDefaults.SIZE_X,this._scaleBound=1,this._scaleBoundInverse=1,this._type=t.EShapeAcceptorEdgeType.TAIL,this._x=0,this._y=0,this._ox=0,this._oy=0,this._isDirty=!1,this._isBegan=!1,this._doUpdateBound=()=>{this._timeout=null,this._isDirty&&(this._isDirty=!1,this._isBegan&&(this.visible=!0,this.doUpdate()))}}newCircles(){const e=[],n=t.EShapeDefaults.STROKE_COLOR,i=t.EShapeDefaults.STROKE_ALPHA;for(let o=0,a=64;o<a;++o){const o=new t.EShapeCircle;o.stroke.set(!1),o.fill.set(!0,n,i),o.visible=!1,o.attach(this),e.push(o)}return e}begin(t){t.addChild(this);const e=t.layer.active;if(null!=e){const t=e.transform.position;this._ox=t.x,this._oy=t.y}else this._ox=0,this._oy=0;this.visible=!1,this._isBegan=!0}end(){const t=this.parent;null!=t&&t.removeChild(this),this.visible=!1,this._isBegan=!1}onPrerender(){const t=this.getParentScale(),e=this._scaleBound;if(.001<Math.abs(t-e)){this._scaleBound=t,this._scaleBoundInverse=1/t;const e=this.getCircleSize(),n=this._circles;for(let t=0,i=n.length;t<i;++t)n[t].size.set(e,e)}}render(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this.onPrerender(),super.render(t))}getParentScale(){const t=this.parent;return null!=t?t.scale.y:1}getCircleSize(){return 10*Math.min(1,this._scaleBoundInverse)}update(t,e,n){this._isBegan&&(this._type=t,this._x=e,this._y=n,null==this._timeout?(this.visible=!0,this.doUpdate(),this._timeout=window.setTimeout(this._doUpdateBound,100)):this._isDirty=!0)}doUpdate(){const e=this._radius,n=this._circles,i=n.length,o=this._foundEdges;this._edge.findAll(this._type,this._x,this._y,e,i,o);const a=o.length,s=this._ox,l=this._oy,r=this.getCircleSize(),h=Math.min(i,a),u=e*e;for(let e=0;e<h;++e){const i=o[e],a=i.center,h=n[e];h.lock(t.EShapeLockPart.UPLOADED),h.transform.position.set(s+a.x,l+a.y),h.size.set(r,r),h.fill.alpha=.5*Math.max(0,1-i.distance/u),h.visible=!0,h.unlock(t.EShapeLockPart.UPLOADED,!0)}for(let t=h;t<i;++t)n[t].visible=!1;t.DApplications.update(this)}}const Io=10;class Ro{constructor(t,e){this._diagram=t,this._canvasMode=e,this._renderer=new xo(this),this._work=new Set}begin(t,e){this.clear(),this._shape=e,null!=t&&this._renderer.begin(t)}end(){this._renderer.end(),this.clear()}update(t,e,n){this._renderer.update(t,e,n)}show(){this._renderer.visible=!0}hide(){this._renderer.visible=!1}get edges(){let t=this._edges;return null==t&&(t=this.newEdges(),this._edges=t),t}newEdges(){const t=new Map,e=this._diagram.layer;if(e){let n=0,i=0;if(this._canvasMode){const t=e.transform.position;n=t.x,i=t.y}const o=this._shape;if(null!=o){const e=o.parent;null!=e&&this.addAll(e.children,n,i,t)}else this.addAll(e.children,n,i,t)}return t}addAll(n,i,o,a){for(let s=0,l=n.length;s<l;++s){const l=n[s];if(!(l instanceof t.EShapeConnectorLine)){const n=l.size,s=n.x,r=n.y,h=l.transform,u=h.internalTransform,c=u.a,p=u.b,d=u.c,g=u.d,_=h.pivot,S=_.x,w=_.y,m=new e.Matrix(c*s,p*s,d*r,g*r,u.tx+i+(c*S+d*w),u.ty+o+(p*S+g*w));if(t.EShapeAcceptors.get(l.type).each(l,((t,e)=>{this.add(m,e,t,l,a)})),t.EShapeCapabilities.contains(l,t.EShapeCapability.CHILDREN)){const t=l.children;t&&this.addAll(t,i,o,a)}}}}add(t,n,i,o,a){const s=i.size,l=s.x,r=s.y,h=i.x,u=i.y,c=t.a,p=t.b,d=t.c,g=t.d,_=t.tx,S=t.ty,w=c*h+d*u+_,m=p*h+g*u+S,T={shape:o,id:n,x:null,y:null,acceptor:i,matrix:t,local:new e.Point(w,m),center:new e.Point(w,m),distance:0};if(0===l&&0===r){const t=this.toGridIndex(w),e=this.toGridIndex(m),n=this.toCoordinate(t,e),i=a.get(n);null==i?a.set(n,[T]):i.push(T)}else{const t=.5*l,e=.5*r,n=h-t,i=u-e,o=h+t,s=u-e,w=h+t,m=u+e,E=h-t,y=u+e,v=c*n+d*i,C=p*n+g*i,b=c*o+d*s,D=p*o+g*s,L=c*w+d*m,f=p*w+g*m,A=c*E+d*y,B=p*E+g*y,x=Math.min(v,b,L,A)+_,I=Math.min(C,D,f,B)+S,R=Math.max(v,b,L,A)+_,O=Math.max(C,D,f,B)+S,k=Math.floor(x/Io),P=Math.floor(I/Io),V=Math.ceil(R/Io),M=Math.ceil(O/Io);for(let t=k;t<=V;++t)for(let e=P;e<=M;++e){const n=this.toCoordinate(t,e),i=a.get(n);null==i?a.set(n,[T]):i.push(T)}}}toCoordinate(t,e){return t%1024+(e%1024<<10)}toGridIndex(t){return Math.round(t/Io)}find(t,e,n){let i=null,o=0;const a=this.edges;for(let s=-10;s<=Io;s+=Io)for(let l=-10;l<=Io;l+=Io){const r=this.toGridIndex(e+s),h=this.toGridIndex(n+l),u=a.get(this.toCoordinate(r,h));if(null!=u)for(let a=0,s=u.length;a<s;++a){const s=u[a],l=s.acceptor;if(!(l.type&t))continue;const r=l.size,h=r.x,c=r.y;if(0===h&&0===c){const t=s.center,a=e-t.x,l=n-t.y,r=a*a+l*l;r<=100&&(null==i||r<o)&&(i=s,o=r)}else{const t=s.matrix,a=t.a,r=t.b,u=t.c,p=t.d,d=t.tx,g=t.ty,_=a*p-u*r;if(1e-7<Math.abs(_)){const t=1/_,S=e-d,w=n-g,m=(+p*S-u*w)*t,T=(-r*S+a*w)*t,E=.5*h,y=.5*c,v=l.x,C=l.y,b=v-E,D=C-y,L=v+E,f=C+y,A=Math.min(L,Math.max(b,m)),B=Math.min(f,Math.max(D,T)),x=a*A+u*B+d,I=r*A+p*B+g,R=e-x,O=n-I,k=R*R+O*O;k<=100&&(null==i||k<o)&&(i=s,i.x=A,i.y=B,i.local.set(x,I),o=k)}else{const t=s.center,a=e-t.x,l=n-t.y,r=a*a+l*l;r<=100&&(null==i||r<o)&&(i=s,o=r)}}}}return i}findAll(t,e,n,i,o,a){const s=this.edges,l=(i=Math.ceil(i/Io)*Io)*i,r=this._work;r.clear(),this.findAllS1(t,e,n,0,0,s,l,r);for(let a=Io;a<=i&&r.size<o;a+=Io)this.findAllS2(t,e,n,s,l,a,r);let h=-1;return r.forEach((t=>{a[++h]=t})),a.length=r.size,a.sort(this.compare),a}findAllS2(t,e,n,i,o,a,s){for(let l=-a;l<=a;l+=Io)this.findAllS1(t,e,n,l,-a,i,o,s),this.findAllS1(t,e,n,l,+a,i,o,s);for(let l=-a+Io,r=a-Io;l<=r;l+=Io)this.findAllS1(t,e,n,-a,l,i,o,s),this.findAllS1(t,e,n,+a,l,i,o,s)}findAllS1(t,e,n,i,o,a,s,l){const r=this.toGridIndex(e+i),h=this.toGridIndex(n+o),u=a.get(this.toCoordinate(r,h));if(u)for(let i=0,o=u.length;i<o;++i){const o=u[i];if(o.acceptor.type&t){const t=o.local,i=e-t.x,a=n-t.y,r=i*i+a*a;r<=s&&(o.distance=r,l.add(o))}}}compare(t,e){const n=t.distance,i=e.distance;return n<i?-1:n>i?1:0}clear(){this._edges=void 0}}const Oo={OFF:-1,TAIL:0,HEAD:1,DONE:2};class ko extends $i{constructor(t){super(),this._options=t,this._selection=t.selection,this._diagram=t.diagram,this._edge=new Ro(t.diagram,!1),this._newShape=t.newShape||(()=>this.newShape()),this._phase=Oo.OFF,this._work=new e.Point,this._onDownBound=t=>{this.onDown(t)},this._onMoveBound=t=>{this.onMove(t)},this._onUpBound=t=>{this.onUp(t)},this._onKeyDownBound=t=>{this.onKeyDown(t)},this._onSetBound=t=>{this.onSet(t)},this._onUnsetBound=t=>{this.onUnset(t)}}onActivate(){this._phase=Oo.TAIL;const e=this._diagram,n=t.DApplications.getLayer(e);if(n){const i=n.renderer.plugins.interaction;e.on(t.UtilPointerEvent.down,this._onDownBound),e.on(t.UtilPointerEvent.move,this._onMoveBound);const o=this._onUpBound;i.on(t.UtilPointerEvent.up,o),i.on(t.UtilPointerEvent.upoutside,o),i.on(t.UtilPointerEvent.cancel,o),e.on("keydown",this._onKeyDownBound),e.on("set",this._onSetBound),e.on("unset",this._onUnsetBound)}this._edge.begin(e.canvas,null);const i=this._selection;i.modifier.disallow(),i.updateModifier()}onDeactivate(){const e=this._diagram,n=t.DApplications.getLayer(e);if(n){const i=n.renderer.plugins.interaction;e.off(t.UtilPointerEvent.down,this._onDownBound),e.off(t.UtilPointerEvent.move,this._onMoveBound);const o=this._onUpBound;i.off(t.UtilPointerEvent.up,o),i.off(t.UtilPointerEvent.upoutside,o),i.off(t.UtilPointerEvent.cancel,o),e.off("keydown",this._onKeyDownBound),e.off("set",this._onSetBound),e.off("unset",this._onUnsetBound)}this._edge.end();const i=this._selection;i.modifier.allow(),i.updateModifier();const o=this._connector;null!=o&&(this._connector=void 0,o.detach(),o.destroy()),this._phase=Oo.OFF}onSet(t){this._edge.begin(t,null)}onUnset(t){this._edge.end();const e=this._connector;null!=e&&(this._connector=void 0,e.detach(),e.destroy()),this._phase=Oo.TAIL}onDown(t){if(!t.data.originalEvent.altKey)switch(this._phase){case Oo.OFF:break;case Oo.TAIL:this.onTail(t)&&(this._phase=Oo.HEAD);break;case Oo.HEAD:this.onHead(t)&&(this._phase=Oo.DONE)}}onMove(t){if(!t.data.originalEvent.altKey)switch(this._phase){case Oo.OFF:break;case Oo.TAIL:this.onTail(t);break;case Oo.HEAD:this.onHead(t)}}onUp(t){this.onDone()}onTail(e){const n=this._diagram,i=n.layer;if(i){let o=this._connector;const a=e.data.global,s=i.toLocal(a,void 0,this._work),l=this._edge.find(t.EShapeAcceptorEdgeType.TAIL,s.x,s.y);if(this._edge.update(t.EShapeAcceptorEdgeType.TAIL,s.x,s.y),this.isTailAccepted(o,s,l))return null==o&&(o=this._newShape(),o.fill.alpha=1,this._connector=o,o.attach(i)),this.onTailAccepted(o,s,l),t.DApplications.update(n),!0;if(null!=o)return this.onTailUnaccepted(o,s),t.DApplications.update(n),!1}return!1}isDanglingEdgeAllowed(){var t;return null!==(t=this._options.dangling)&&void 0!==t&&t}isTailAccepted(t,e,n){return null!=n||this.isDanglingEdgeAllowed()}getTailType(){return t.EShapePointsMarkerType.CIRCLE}onTailAccepted(e,n,i){e.points.marker.tail.type=this.getTailType(),null!=i?(e.edge.tail.set(i.shape,i.id,i.x,i.y,0,i.local.x,i.local.y,void 0,void 0,i.acceptor.side),e.edge.head.local.copyFrom(i.local)):(e.edge.tail.set(null,null,null,null,0,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP),e.edge.head.local.copyFrom(n))}onTailUnaccepted(e,n){e.points.marker.tail.type=t.EShapePointsMarkerType.NONE,e.edge.tail.set(null,null,null,null,0,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP),e.edge.head.local.copyFrom(n)}newShape(){const e=new t.EShapeConnectorLine;return e.fill.alpha=1,e}onHead(e){const n=this._diagram,i=n.layer;if(i){const o=this._connector;if(o){const a=e.data.global,s=i.toLocal(a,void 0,this._work),l=this._edge.find(t.EShapeAcceptorEdgeType.HEAD,s.x,s.y);return this._edge.update(t.EShapeAcceptorEdgeType.HEAD,s.x,s.y),this.isHeadAccepted(o,s,l)?(this.onHeadAccepted(o,s,l),t.DApplications.update(n),!0):(this.onHeadUnaccepted(o,s),t.DApplications.update(n),!1)}}return!1}isHeadAccepted(t,e,n){return null==n?this.isDanglingEdgeAllowed():!this.isSameAcceptor(t.edge.tail.acceptor,n)}isSameAcceptor(t,e){return t.shape===e.shape&&t.edge===e.id&&t.x===e.x&&t.y===e.y}getHeadType(){return t.EShapePointsMarkerType.TRIANGLE}onHeadAccepted(e,n,i){e.points.marker.head.type=this.getHeadType(),null!=i?e.edge.head.set(i.shape,i.id,i.x,i.y,10,i.local.x,i.local.y,void 0,void 0,i.acceptor.side):e.edge.head.set(null,null,null,null,10,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP)}onHeadUnaccepted(e,n){e.points.marker.head.type=t.EShapePointsMarkerType.NONE,e.edge.head.set(null,null,null,null,0,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP)}onDone(){if(this._phase===Oo.DONE){this._phase=Oo.OFF;const e=this._connector;if(e){this._connector=void 0;const n=this._diagram.layer;n?(e.edge.attach(),t.DControllers.getCommandController().push(new M([e],n,this._selection,!0))):(e.detach(),e.destroy()),this.emit("done",this)}}}onCancel(){const t=this._connector;null!=t&&(this._connector=void 0,t.detach(),t.destroy()),this._phase!==Oo.OFF&&(this._phase=Oo.OFF,this.emit("cancel",this))}onKeyDown(e){t.UtilKeyboardEvent.isCancelKey(e)&&this.onCancel()}}class Po extends ko{newShape(){const e=new t.EShapeConnectorElbow;return e.fill.alpha=1,e}}class Vo extends $i{constructor(t){super(),this._options=t,this._selection=t.selection,this._diagram=t.diagram,this._isNewPoint=!1,this._onDownPoint=new e.Point,this._onMovePoint=new e.Point,this._onDownBound=t=>{this.onDown(t)},this._onMoveBound=t=>{this.onMove(t)},this._onDblClickBound=()=>{this.onDblClick()},this._onKeydownBound=t=>{this.onKeydown(t)}}onActivate(){const e=this._diagram;e.on(t.UtilPointerEvent.down,this._onDownBound),e.on(t.UtilPointerEvent.move,this._onMoveBound),e.on("dblclick",this._onDblClickBound),e.on("keydown",this._onKeydownBound);const n=this._selection;n.modifier.disallow(),n.updateModifier()}onDeactivate(){const e=this._diagram;e.off(t.UtilPointerEvent.down,this._onDownBound),e.off(t.UtilPointerEvent.move,this._onMoveBound),e.off("dblclick",this._onDblClickBound),e.off("keydown",this._onKeydownBound),this.onCancel();const n=this._selection;n.modifier.allow(),n.updateModifier()}onDown(e){if(e.data.originalEvent.altKey)return;const n=this._diagram,i=n.canvas,o=n.layer;if(i&&o&&(this._isNewPoint=!0,null==this._line)){const a=this._onDownPoint;i.toLocal(e.data.global,void 0,a),n.snapper.toSnapped(a,a),o.transform.localTransform.applyInverse(a,a);const s=t.createLine([a.x,a.y],[],t.EShapeDefaults.STROKE_WIDTH,t.EShapePointsStyle.NONE);s.attach(o),this._line=s}}onMove(e){const n=e.data.originalEvent;if(n.altKey)return;const i=this._line;if(i){const o=this._diagram,a=o.canvas;if(a){const s=i.points.values;this._isNewPoint&&(this._isNewPoint=!1,s.push(0,0));const l=this._onMovePoint;a.toLocal(e.data.global,void 0,l),o.snapper.toSnapped(l,l);const r=i.parent;r&&r.transform.localTransform.applyInverse(l,l);const h=i.transform.position,u=l.x-h.x,c=l.y-h.y,p=s.length;if(n.shiftKey&&4<=p){const t=s[p-4],e=s[p-3],n=u-t,i=c-e,o=.25*Math.PI,a=Math.round(Math.atan2(i,n)/o)*o,l=0|Math.sqrt(n*n+i*i);s[p-2]=t+l*Math.cos(a),s[p-1]=e+l*Math.sin(a)}else s[p-2]=0|u,s[p-1]=0|c;i.points.values=s,t.DApplications.update(o)}}}toValues(t){const e=t.transform.position,n=e.x,i=e.y,o=t.points.values,a=[];let s=NaN,l=NaN;for(let t=0,e=o.length;t<e;t+=2){const e=o[t+0],r=o[t+1];s===e&&l===r||(a.push(n+e,i+r),s=e,l=r)}return a}add(e){const n=this._diagram.layer;if(n&&4<=e.length){const i=t.createLine(e,[],t.EShapeDefaults.STROKE_WIDTH,t.EShapePointsStyle.NONE);i.attach(n),t.DControllers.getCommandController().push(new M([i],n,this._selection,!0))}}onDblClick(){const e=this._line;e&&(this._line=void 0,e.detach(),this.add(this.toValues(e)),t.DApplications.update(this._diagram),this.emit("done",this))}onCancel(){const t=this._line;t&&(t.points.values.length-=2,this.onDblClick())}onKeydown(e){t.UtilKeyboardEvent.isCancelKey(e)&&this.onCancel()}}class Mo extends $i{constructor(t,n){super(),this._selection=t,this._diagram=n,this._applicationLayer=null,this._onDownPoint=new e.Point,this._onMovePoint=new e.Point,this._shape=null,this._creator=void 0,this._onDownBound=t=>{this.onDown(t)},this._onMoveBound=t=>{this.onMove(t)},this._onUpBound=t=>{this.onUp(t)}}get shape(){return this._creator}set shape(t){this._creator=t}onActivate(){this._diagram.on(t.UtilPointerEvent.down,this._onDownBound)}onDeactivate(){this._diagram.off(t.UtilPointerEvent.down,this._onDownBound),this.onDone()}onDown(e){const n=e.data.originalEvent;if(n.altKey)return;const i=this._selection,o=this._diagram,a=o.layer,s=this._creator;if(null!=a&&null!=s&&null==this._shape){const l=a.toLocal(e.data.global,void 0,this._onDownPoint);o.snapper.toSnapped(l,l),this._onMovePoint.copyFrom(l);const r=this._shape=s();t.toResized(r,l,l,n.ctrlKey,n.shiftKey),r.attach(a),i.modifier.disallow(),t.DControllers.getCommandController().push(new M([r],a,this._selection,!0));const h=this._applicationLayer;if(h){this._applicationLayer=null;const e=h.renderer.plugins.interaction;e.off(t.UtilPointerEvent.move,this._onMoveBound);const n=this._onUpBound;e.off(t.UtilPointerEvent.up,n),e.off(t.UtilPointerEvent.upoutside,n),e.off(t.UtilPointerEvent.cancel,n)}const u=t.DApplications.getLayer(o);if(u){this._applicationLayer=u;const e=u.renderer.plugins.interaction;e.on(t.UtilPointerEvent.move,this._onMoveBound);const n=this._onUpBound;e.on(t.UtilPointerEvent.up,n),e.on(t.UtilPointerEvent.upoutside,n),e.on(t.UtilPointerEvent.cancel,n)}}}onMove(e){const n=e.data.originalEvent;if(n.altKey)return;const i=this._shape;if(i){const o=this._diagram,a=o.layer,s=this._selection,l=this._applicationLayer;if(a&&l){l.lock();const r=this._onDownPoint,h=a.toLocal(e.data.global,void 0,this._onMovePoint);o.snapper.toSnapped(h,h),t.toResized(i,r,h,n.ctrlKey,n.shiftKey),s.update("PROPERTY"),l.unlock(),l.update()}}}onUp(t){this.onDone()}onDone(){const e=this._shape;if(e){this._shape=null;const n=this._selection,i=this._onDownPoint,o=this._onMovePoint,a=this._applicationLayer;if(a){this._applicationLayer=null;const s=a.renderer.plugins.interaction;s.off(t.UtilPointerEvent.move,this._onMoveBound);const l=this._onUpBound;s.off(t.UtilPointerEvent.up,l),s.off(t.UtilPointerEvent.upoutside,l),s.off(t.UtilPointerEvent.cancel,l),a.lock(),i.x===o.x&&i.y===o.y&&(o.set(i.x+100,i.y+100),t.toResized(e,i,o,!1,!1)),n.modifier.allow(),n.update("PROPERTY"),a.unlock(),a.update()}this.emit("done",this)}}}class No extends e.Rectangle{constructor(e){super(),this._parent=e,this._capability=t.EShapeCapability.LINE_TAIL|t.EShapeCapability.LINE_HEAD}get capability(){return this._capability}set capability(t){this._capability=t}contains(e,n){const i=this._parent;if(i.isEditing())return!0;const o=i.points,a=i.closed,s=this._capability,l=!!(s&t.EShapeCapability.LINE_TAIL),r=!!(s&t.EShapeCapability.LINE_HEAD),h=2*i.getAnchorSize(),u=h*h,c=2*u;for(let t=l?0:1,a=o.length-(r?0:1);t<a;++t){const a=o[t],s=a.x-e,l=a.y-n;if(s*s+l*l<c)return i.setLastHitAnchor(t),!0}for(let t=0,a=o.length-1;t<a;++t){const a=o[t+0],s=o[t+1],l=this.calcHitPoint(e,n,a.x,a.y,s.x,s.y,u);if(0<=l)return i.setLastHitSegment(t,l),!0}if(l&&r&&a){const t=o[o.length-1],a=o[0],s=this.calcHitPoint(e,n,t.x,t.y,a.x,a.y,u);if(0<=s)return i.setLastHitSegment(o.length-1,s),!0}return i.setLastHitSegment(-1,-1),!1}calcHitPoint(t,e,n,i,o,a,s){const l=o-n,r=a-i,h=t-n,u=e-i,c=l*l+r*r,p=l*h+r*u,d=h*h+u*u;if(1e-4<c){const t=Math.max(0,Math.min(1,p/c));if(c*t*t-2*p*t+d<s)return t}return-1}}class Fo extends e.Graphics{constructor(n){super(),this._options=n,this._selection=n.selection,this._diagram=n.diagram,this._onDownPoint=new e.Point,this._points=[],this._pointsStyle=t.EShapePointsStyle.NONE,this._onMovePoint=new e.Point,this._isEditing=!1,this._isEdited=!1,this._isActive=!1,this._shape=null,this._capability=t.EShapeCapability.LINE_TAIL|t.EShapeCapability.LINE_HEAD,this._scaleBound=1,this._scaleBoundInverse=1,this._lastHitAnchor=-1,this._lastHitSegment=-1,this._lastHitSegmentPosition=-1,this._targetCopy=new e.Point,this._target=null,this._targetIndex=-1,this._onDownBound=t=>{this.onDown(t)},this._onMoveBound=t=>{this.onMove(t)},this._onUpBound=t=>{this.onUp(t)},this._onKeydownBound=t=>{this.onKeydown(t)},this._onSetBound=t=>{this.onSet(t)},this._onUnsetBound=t=>{this.onUnset(t)},this.cursor="grab",this.interactive=!0,this.hitArea=new No(this),this._unformatted={length:0,plength:0,values:[],segments:[],style:t.EShapePointsStyle.NONE},this._formatted={length:0,plength:0,values:[],segments:[],style:t.EShapePointsStyle.NONE}}onPrerender(){const t=this.getParentScale(),e=this._scaleBound;.001<Math.abs(t-e)&&(this._scaleBound=t,this._scaleBoundInverse=1/t,this.reshape())}getParentScale(){const t=this.parent;return null!=t?t.scale.y:1}render(t){this.onPrerender(),super.render(t)}getAnchorSize(){return 6*this._scaleBoundInverse}activate(){this._isActive||(this._isActive=!0,this.onActivate())}onActivate(){this._isEditing=!1,this._isEdited=!1,this._target=null,this._targetIndex=-1;const e=this._diagram,n=t.DApplications.getLayer(e);if(n){const i=n.renderer.plugins.interaction;e.on(t.UtilPointerEvent.down,this._onDownBound),i.on(t.UtilPointerEvent.move,this._onMoveBound);const o=this._onUpBound;i.on(t.UtilPointerEvent.up,o),i.on(t.UtilPointerEvent.upoutside,o),i.on(t.UtilPointerEvent.cancel,o),e.on("keydown",this._onKeydownBound),e.on("set",this._onSetBound),e.on("unset",this._onUnsetBound)}const i=this._selection;i.modifier.disallow(),i.updateModifier()}deactivate(){this._isActive&&(this._isActive=!1,this.onDeactivate())}onDeactivate(){this._isEditing=!1,this._isEdited=!1,this._target=null,this._targetIndex=-1,this.shape=null;const e=this._diagram,n=t.DApplications.getLayer(e);if(n){const i=n.renderer.plugins.interaction;e.off(t.UtilPointerEvent.down,this._onDownBound),i.off(t.UtilPointerEvent.move,this._onMoveBound);const o=this._onUpBound;i.off(t.UtilPointerEvent.up,o),i.off(t.UtilPointerEvent.upoutside,o),i.off(t.UtilPointerEvent.cancel,o),e.off("keydown",this._onKeydownBound),e.off("set",this._onSetBound),e.off("unset",this._onUnsetBound)}const i=this._selection;i.modifier.allow(),i.updateModifier()}onSet(t){}onUnset(t){this.onCancel()}isActive(){return this._isActive}isEditing(){return this._isEditing}get points(){return this._points}get closed(){return!!(this._pointsStyle&t.EShapePointsStyle.CLOSED)}get shape(){return this._shape}set shape(e){var n,i;if(this._shape!==e){this._shape=e;const o=this.toCapability(e);if(this.hitArea.capability=o,this._capability=o,this._isEdited=!1,null==e){this._points=[],this._pointsStyle=t.EShapePointsStyle.NONE,this._formatter=void 0;const e=this.parent;e&&(e.removeChild(this),t.DApplications.update(this))}else{const o=e.points;if(o){e.updateTransform(),this._points=this.toPoints(e,o,this.toTransform(e));const a=o.style;this._pointsStyle=a,this._formatter=null!==(n=o.formatter)&&void 0!==n?n:null===(i=t.EShapePointsFormatters.find(a))||void 0===i?void 0:i.formatter}else this._points=[],this._pointsStyle=t.EShapePointsStyle.NONE,this._formatter=void 0;this.reshape();const a=this._diagram.canvas;a&&a.addChild(this)}}}toTransform(t){var n;const i=null!==(n=this._workTransform)&&void 0!==n?n:this._workTransform=new e.Matrix;i.copyFrom(t.transform.internalTransform);const o=t.root.parent;return o&&i.prepend(o.transform.localTransform),i}toPoints(t,n,i){const o=[],a=n.values;for(let t=0,n=a.length;t<n;t+=2){const n=new e.Point(a[t+0],a[t+1]);o.push(i.apply(n,n))}return o}setLastHitAnchor(e){this._lastHitAnchor===e&&-1===this._lastHitSegment||(this._lastHitAnchor=e,this._lastHitSegment=-1,this._lastHitSegmentPosition=-1,this.reshape(),t.DApplications.update(this))}setLastHitSegment(e,n){this._lastHitSegmentPosition=n,-1===this._lastHitAnchor&&this._lastHitSegment===e||(this._lastHitAnchor=-1,this._lastHitSegment=e,this.reshape(),t.DApplications.update(this))}reshape(){const e=this,n=this._points,i=n.length,o=this._pointsStyle,a=this._formatter,s=!!(o&t.EShapePointsStyle.CLOSED),l=this._capability,r=!!(l&t.EShapeCapability.LINE_TAIL),h=!!(l&t.EShapeCapability.LINE_HEAD);if(e.clear(),0<i){const t=this.getAnchorSize(),l=.5*t,u=2000880,c=15953703,p=11184810,d=1,g=.5,_=this._lastHitAnchor,S=this._lastHitSegment;if(null!=a){const t=this._unformatted,s=t.values,r=t.segments;for(let t=0,e=0;t<i;t+=1,e+=2){const i=n[t];s[e]=i.x,s[e+1]=i.y}const h=this._formatted;a(i,s,r,o,h);const u=h.values;if(e.lineStyle(l,p,g),0<u.length){e.moveTo(u[0],u[1]);for(let t=2,n=u.length;t<n;t+=2)e.lineTo(u[t],u[t+1])}}for(let t=0,o=i-1;t<o;++t){const i=n[t],o=n[t+1],a=S===t?c:u;e.lineStyle(l,a,d),e.moveTo(i.x,i.y),e.lineTo(o.x,o.y)}if(r&&h&&s){const t=n.length-1,i=n[t],o=n[0],a=S===t?c:u;e.lineStyle(l,a,d),e.moveTo(i.x,i.y),e.lineTo(o.x,o.y)}const w=this._targetIndex;for(let o=r?0:1,a=i-(h?0:1);o<a;++o){const i=n[o],a=_===o||w===o?c:u;e.lineStyle(l,a,d),e.beginFill(a,d),e.drawRect(i.x-l,i.y-l,t,t),e.endFill()}}}replace(){const e=this._shape,n=this._points;if(e&&e.parent&&2<=n.length){const i=this.toValues(n,e);if(2<i.length){const n=this.newShape(i,[],this._pointsStyle,e);t.DControllers.getCommandController().push(new Se(n,e,e.parent,this._selection))}}}toValues(t,e){e.updateTransform();const n=this.toTransform(e).invert(),i=[],o=n.a,a=n.b,s=n.c,l=n.d,r=n.tx,h=n.ty;let u=NaN,c=NaN;for(let e=0,n=t.length;e<n;++e){const n=t[e],p=n.x,d=n.y;if(u!==p||c!==d){const t=o*p+s*d+r,e=a*p+l*d+h;i.push(t,e),u=t,c=e}}return i}onDown(n){if(n.target===this){if(n.data.originalEvent.altKey)return;const i=this._diagram.canvas;if(null!=i&&!this._isEditing){const o=this._lastHitAnchor,a=this._points,s=this._onDownPoint;if(0<=o&&o<a.length)this._isEditing=!0,i.toLocal(n.data.global,void 0,s),this._target=a[o],this._targetCopy.copyFrom(this._target),this._targetIndex=o,this.onTargetChange(o,s),this.reshape(),t.DApplications.update(this);else{const o=this._lastHitSegment;if(0<=o){this._lastHitSegment=-1,this._isEditing=!0,i.toLocal(n.data.global,void 0,s);const l=a[o+0],r=a[o<a.length-1?o+1:0],h=this._lastHitSegmentPosition,u=1-h,c=u*l.x+h*r.x,p=u*l.y+h*r.y,d=new e.Point(c,p);a.splice(o+1,0,d),this._target=d,this._targetCopy.copyFrom(d),this._targetIndex=o+1,this.onTargetChange(this._targetIndex,s),this.reshape(),t.DApplications.update(this)}}}}else this.onDone()}onTargetChange(t,e){}onMove(e){if(this._isEditing){const n=e.data.originalEvent;if(n.altKey)return;const i=this._diagram,o=i.canvas,a=this._target,s=this._targetCopy;if(o&&a){this._isEdited=!0;const l=this._onDownPoint,r=o.toLocal(e.data.global,void 0,this._onMovePoint);if(a.set(s.x+r.x-l.x,s.y+r.y-l.y),this.toSnapped(a,i,a),n.shiftKey){const t=this._points,e=this._targetIndex,n=0<e?e-1:e+1;if(0<=n&&n<t.length){const e=t[n],i=a.x-e.x,o=a.y-e.y,s=.25*Math.PI,l=Math.round(Math.atan2(o,i)/s)*s,r=Math.sqrt(i*i+o*o);a.set(e.x+r*Math.cos(l),e.y+r*Math.sin(l))}}this.onTargetMove(r),this.reshape(),t.DApplications.update(this)}}else this.onTargetNotMove(e)}onTargetMove(t){}onTargetNotMove(t){}toSnapped(t,e,n){e.snapper.toSnapped(t,n)}onUp(t){this._isEditing&&(this._isEditing=!1,this._target=null)}onDone(){this._isEditing=!1,this._isEdited&&(this._isEdited=!1,this.replace()),this.emit("done",this)}onCancel(){this._isEditing=!1,this._isEdited=!1;const e=this.parent;e&&(e.removeChild(this),t.DApplications.update(this)),this.emit("cancel",this)}onKeydown(e){if(t.UtilKeyboardEvent.isCancelKey(e))this.onDone();else if(t.UtilKeyboardEvent.isDeleteKey(e)){const e=this._targetIndex,n=this._points;0<=e&&e<n.length&&2<n.length&&(this._isEdited=!0,n.splice(e,1),e===n.length&&(this._targetIndex-=1,this.onTargetChange(this._targetIndex,null)),this.reshape(),t.DApplications.update(this))}}}class zo extends Fo{constructor(t){super(t),this._edge=new Ro(this._diagram,!0),this._work=new e.Point}toCapability(e){let n=t.EShapeCapability.NONE;return t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_TAIL)&&(n|=t.EShapeCapability.LINE_TAIL),t.EShapeCapabilities.contains(e,t.EShapeCapability.LINE_HEAD)&&(n|=t.EShapeCapability.LINE_HEAD),n}onActivate(){this._edge.begin(this._diagram.canvas,this._shape),this._edgeTail=void 0,this._edgeHead=void 0,super.onActivate()}onDeactivate(){this._edge.end(),this._edgeTail=void 0,this._edgeHead=void 0,super.onDeactivate()}onTargetChange(e,n){if(0===e){const e=this._edge;e.show(),null!=n&&e.update(t.EShapeAcceptorEdgeType.TAIL,n.x,n.y)}else if(e===this._points.length-1){const e=this._edge;e.show(),null!=n&&e.update(t.EShapeAcceptorEdgeType.HEAD,n.x,n.y)}else this._edge.hide()}onTargetMove(e){const n=this._targetIndex;0===n?this._edge.update(t.EShapeAcceptorEdgeType.TAIL,e.x,e.y):n===this._points.length-1&&this._edge.update(t.EShapeAcceptorEdgeType.HEAD,e.x,e.y)}onTargetNotMove(e){const n=this._targetIndex;if(0===n){const n=this._diagram.canvas;if(n){const i=n.toLocal(e.data.global,void 0,this._onMovePoint);this._edge.update(t.EShapeAcceptorEdgeType.TAIL,i.x,i.y)}}else if(n===this._points.length-1){const n=this._diagram.canvas;if(n){const i=n.toLocal(e.data.global,void 0,this._onMovePoint);this._edge.update(t.EShapeAcceptorEdgeType.HEAD,i.x,i.y)}}}toSnapped(e,n,i){const o=this._targetIndex;if(0===o){const n=this._edge.find(t.EShapeAcceptorEdgeType.TAIL,e.x,e.y);null!=n&&i.copyFrom(n.local),this._edgeTail=n}else if(o===this._points.length-1){const n=this._edge.find(t.EShapeAcceptorEdgeType.HEAD,e.x,e.y);null!=n&&i.copyFrom(n.local),this._edgeHead=n}else n.snapper.toSnapped(e,i)}toPoints(n,i,o){const a=[];if(n instanceof t.EShapeConnectorLine){const t=n.edge,i=t.tail.local,s=t.head.local,l=n.transform.position,r=l.x,h=l.y,u=i.x-r,c=i.y-h,p=s.x-r,d=s.y-h,g=new e.Point(u,c);a.push(o.apply(g,g));const _=n.body.values,S=_.length;if(0<S){const t=.5*(p+u),n=.5*(d+c),i=p-u,s=d-c,l=Math.atan2(s,i),r=Math.sqrt(i*i+s*s),h=Math.cos(l)*r,g=Math.sin(l)*r;for(let i=0;i<S;i+=2){const s=_[i+0],l=_[i+1],r=t+h*s-g*l,u=n+h*l+g*s,c=new e.Point(r,u);a.push(o.apply(c,c))}}const w=new e.Point(p,d);a.push(o.apply(w,w))}return a}newShape(e,n,i,o){const a=t.toPointsBoundary(e,[0,0,0,0]),s=.5*(a[2]+a[0]),l=.5*(a[3]+a[1]),r=a[2]-a[0],h=a[3]-a[1],u=o.clone(),c=u.transform,p=c.position,d=p.x,g=p.y;u.lock(t.EShapeLockPart.UPLOADED),p.set(d+s,g+l),c.scale.set(1,1),c.rotation=0,c.skew.set(0,0),u.points.toFitted(r,h),u.size.set(r,h),u.edge.lock(),u.body.set(t.EShapeConnectorBodies.from(e,0,0));const _=this._work;2<=e.length?_.set(d+e[0],g+e[1]):_.set(d,g);const S=this._edgeTail;if(void 0!==S&&this.isTailAccepted(u,_,S)&&this.onTailAccepted(u,_,S),2<=e.length){const t=e.length;_.set(d+e[t-2],g+e[t-1])}else _.set(d,g);const w=this._edgeHead;return void 0!==w&&this.isHeadAccepted(u,_,w)&&this.onHeadAccepted(u,_,w),u.edge.unlock(),u.unlock(t.EShapeLockPart.UPLOADED,!0),u}isDanglingEdgeAllowed(){var t;return null!==(t=this._options.dangling)&&void 0!==t&&t}isTailAccepted(t,e,n){return null!=n||this.isDanglingEdgeAllowed()}onTailAccepted(e,n,i){null!=i?e.edge.tail.set(i.shape,i.id,i.x,i.y,void 0,void 0,void 0,void 0,void 0,i.acceptor.side):e.edge.tail.set(null,null,null,null,void 0,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP)}isHeadAccepted(t,e,n){return null!=n||this.isDanglingEdgeAllowed()}onHeadAccepted(e,n,i){null!=i?e.edge.head.set(i.shape,i.id,i.x,i.y,void 0,void 0,void 0,void 0,void 0,i.acceptor.side):e.edge.head.set(null,null,null,null,void 0,n.x,n.y,void 0,void 0,t.EShapeAcceptorEdgeSide.TOP)}}class Ho extends Fo{constructor(t){super(t)}toCapability(e){return t.EShapeCapability.LINE_TAIL|t.EShapeCapability.LINE_HEAD}newShape(e,n,i,o){const a=t.toPointsBoundary(e,[0,0,0,0]),s=.5*(a[2]+a[0]),l=.5*(a[3]+a[1]),r=a[2]-a[0],h=a[3]-a[1],u=o.clone(),c=u.transform.position,p=c.x,d=c.y,g=o.transform.localTransform,_=g.a*s+g.c*l,S=g.b*s+g.d*l,w=[];for(let t=0,n=e.length;t<n;t+=2)w.push(e[t+0]-s,e[t+1]-l);u.lock(t.EShapeLockPart.UPLOADED),u.transform.position.set(p+_,d+S),u.size.set(r,h);const m=u.points;return m&&m.set(w,n,i),u.unlock(t.EShapeLockPart.UPLOADED,!0),u}}const Go={send(t,e){let n=!1;const i=t=>()=>{n||(n=!0,e.error(t,o))},o=new XMLHttpRequest;o.open(t,e.url,!0),o.onload=()=>{if(!n){n=!0;const t=o.status;200<=t&&t<300||0===t||304===t||1223===t?e.success(o.responseText,o):e.error(o.statusText,o)}};const a=i("error");o.onerror=a,o.onabort=i("abort");const s=e.headers;if(null!=s)for(const t in s){const e=s[t];null!=e&&o.setRequestHeader(t,e)}o.setRequestHeader("X-Requested-With","XMLHttpRequest");const l=e.timeout;null!=l&&(o.timeout=l,o.ontimeout=i("timeout"),0<l&&setTimeout((()=>{o.abort()}),l));try{const t=e.data;null!=t?o.send(t):o.send()}catch(t){a()}}};class Uo{constructor(t){this._options=t}get(){var t;return null!==(t=this._promise)&&void 0!==t?t:this._promise=this.fetch()}fetch(){return Promise.all([this.doFetch()]).then((t=>{const e=t[0];return this.toFetched(e)}))}doFetch(){const e=this._options;return t.isFunction(e)?e():e}toFetched(e){const n=t.DThemes.get("EEditorCanvas");if(null!=e){const t=this.toItems(n,e);return{default:this.toDefault(t,n,e),items:t,writable:this.toWritable(n,e)}}return{default:n.getDefaultCategory(),items:[],writable:n.isCategoryWritable()}}toItems(t,e){const n=[],i=e.items;if(null!=i)for(let e=0,o=i.length;e<o;++e){const o=i[e],a=t.toCategoryId(o),s=t.toCategoryLabel(o);n.push({id:a,label:s})}return n}toDefault(t,e,n){return null!=n.default?n.default:0<t.length?t[0].id:e.getDefaultCategory()}toWritable(t,e){var n;return null!==(n=e.writable)&&void 0!==n?n:t.isCategoryWritable()}}class Yo{constructor(t){this._category=new Uo(null==t?void 0:t.category),this._options=t}get(){var t;return null!==(t=this._promise)&&void 0!==t?t:this._promise=this.fetch()}fetch(){return this._category.get().then((t=>this.toDefault(t)))}toDefault(e){var n,i,o,a,s,l,r,h,u,c;const p=t.DThemes.get("EEditorCanvas"),d=this._options;return null!=d?{name:null!==(n=d.name)&&void 0!==n?n:p.getDefaultName(),label:null!==(i=d.label)&&void 0!==i?i:p.getDefaultLabel(),width:null!==(o=d.width)&&void 0!==o?o:p.getDefaultWidth(),height:null!==(a=d.height)&&void 0!==a?a:p.getDefaultHeight(),category:e,summary:null!==(s=d.summary)&&void 0!==s?s:p.getDefaultSummary(),description:null!==(l=d.description)&&void 0!==l?l:p.getDefaultDescription(),background:{color:null!==(h=null===(r=d.background)||void 0===r?void 0:r.color)&&void 0!==h?h:p.getDefaultBackgroundColor(),alpha:null!==(c=null===(u=d.background)||void 0===u?void 0:u.alpha)&&void 0!==c?c:p.getDefaultBackgroundAlpha()}}:{name:p.getDefaultName(),label:p.getDefaultLabel(),width:p.getDefaultWidth(),height:p.getDefaultHeight(),category:e,summary:p.getDefaultSummary(),description:p.getDefaultDescription(),background:{color:p.getDefaultBackgroundColor(),alpha:p.getDefaultBackgroundAlpha()}}}}class Xo{static getFormatter(){return null==Xo.DATE_FORMATTER&&(Xo.DATE_FORMATTER=t.NumberFormatters.create("%Y%M%D%H%m%s")),Xo.DATE_FORMATTER}static format(t){return this.getFormatter().format(t,1)}}Xo.DATE_FORMATTER=null;class Wo extends t.DPane{constructor(t){super(t);const e=t.diagram;this._diagram=e,this.state.isDisabled=null==e.canvas,e.on("unset",(()=>{this.state.isDisabled=!0})),e.on("set",(()=>{this.state.isDisabled=!1})),this._canvas=t.canvas,this.content.addChild(this.newLayout())}newLayout(){return new t.DLayoutVertical({x:"padding",y:"padding",width:"padding",height:"auto",children:this.newLayoutItems()})}newLayoutItems(){return[this.newTextLabel(),this.newLayoutName(),this.newLayoutLabel(),this.newLayoutWidth(),this.newLayoutHeight(),this.newLayoutCategory(),this.newLayoutSummary(),this.newLayoutDescription(),this.newLayoutBackground()]}newTextLabel(){return new t.DText({width:"100%",text:{value:this.theme.getLabel()}})}newLayoutName(){const e=this._diagram,n=new t.DInputTextAndLabel({width:"100%",label:{text:{value:this.theme.getInputNameLabel()}},input:{weight:1,on:{change:n=>{const i=e.canvas;null!=i&&i.name!==n&&t.DControllers.getCommandController().push(new u(e,i,n))}}}}),i=()=>{const t=e.canvas;null!=t&&(n.input.value=t.name)};return i(),e.on("change",i),e.on("set",(t=>{n.input.value=t.name})),n}newLayoutLabel(){const e=this._diagram,n=new t.DInputTextAndLabel({width:"100%",label:{text:{value:this.theme.getInputLabelLabel()}},input:{weight:1,on:{change:n=>{const i=e.canvas;null!=i&&i.label!==n&&t.DControllers.getCommandController().push(new h(e,i,n))}}}}),i=()=>{const t=e.canvas;null!=t&&(n.input.value=t.label)};return i(),e.on("change",i),e.on("set",(t=>{n.input.value=t.label})),n}newLayoutWidth(){const e=this._diagram,n=new t.DInputIntegerAndLabel({width:"100%",label:{text:{value:this.theme.getInputWidthLabel()}},input:{weight:1,min:1,on:{change:n=>{const i=e.canvas;null!=i&&i.width!==n&&t.DControllers.getCommandController().push(new b(e,i,n))}}}}),i=()=>{const t=e.canvas;null!=t&&(n.input.value=t.width)};return i(),e.on("change",i),e.on("set",(t=>{n.input.value=t.width})),n}newLayoutHeight(){const e=this._diagram,n=new t.DInputIntegerAndLabel({width:"100%",label:{text:{value:this.theme.getInputHeightLabel()}},input:{weight:1,min:1,on:{change:n=>{const i=e.canvas;null!=i&&i.height!==n&&t.DControllers.getCommandController().push(new r(e,i,n))}}}}),i=()=>{const t=e.canvas;null!=t&&(n.input.value=t.height)};return i(),e.on("change",i),e.on("set",(t=>{n.input.value=t.height})),n}newLayoutBackground(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelBackground(),this.newInputBackground()]})}newLabelBackground(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputBackgroundLabel()}})}newInputBackground(){const e=this._diagram,n=new t.DButtonColor({weight:1,on:{change:n=>{t.DControllers.getCommandController().push(new o(e,n.color,n.alpha))}}});n.dialog.on("open",(()=>{const t=n.dialog,e=t.new,i=t.current;e.color=i.color,e.alpha=i.alpha}));const i=()=>{const i=n.value,o=e.canvas;if(null!=o){const e=o.background,n=e.color,a=e.alpha;i.color=t.isNumber(n)?n:16777215,i.alpha=t.isNumber(a)?a:1}};return i(),e.on("change",i),e.on("set",i),n}newLayoutCategory(){const e=this.newLabelCategory(),n=this.newSelectCategory(),i=new t.DLayoutHorizontal({width:"padding",height:"auto",visible:!1,children:[e,n]});return this._canvas.get().then((t=>{this.onCanvasValueFetched(t,i,n)})),i}onCanvasValueFetched(e,n,i){const o=e.category,a=o.default,s=o.items;if(null!=a&&0<s.length){const l=[];for(let t=0,e=s.length;t<e;++t){const e=s[t];l.push({value:e.id,text:{value:e.label}})}i.menu=new t.DMenu({fit:!0,items:l}),i.value=a;const r=this._diagram,h=()=>{var t;const n=r.canvas;null!=n&&(i.value=null!==(t=n.category)&&void 0!==t?t:e.category.default)};h(),r.on("change",h),r.on("set",(t=>{var n;i.value=null!==(n=t.category)&&void 0!==n?n:e.category.default})),n.state.isEnabled=o.writable,n.show()}else i.value=null,n.hide()}newLabelCategory(){return new t.DInputLabel({width:60,text:{value:this.theme.getSelectCategoryLabel()}})}newSelectCategory(){return new t.DSelect({weight:1,on:{change:e=>{const n=this._diagram,i=n.canvas;null!=i&&i.category!==e&&t.DControllers.getCommandController().push(new a(n,i,e))}}})}newLayoutSummary(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelSummary(),this.newInputSummary()]})}newLabelSummary(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputSummaryLabel()}})}newInputSummary(){const e=this._diagram,n=new t.DInputTextArea({weight:1,height:60,on:{change:n=>{const i=e.canvas;null!=i&&i.summary!==n&&t.DControllers.getCommandController().push(new C(e,i,n))}}}),i=()=>{const t=e.canvas;null!=t&&(n.value=t.summary)};return i(),e.on("change",i),e.on("set",(t=>{n.value=t.summary})),n}newLayoutDescription(){return new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.newLabelDescription(),this.newInputDescription()]})}newLabelDescription(){return new t.DInputLabel({width:60,text:{value:this.theme.getInputDescriptionLabel()}})}newInputDescription(){const e=this._diagram,n=new t.DInputTextArea({weight:1,height:100,on:{change:n=>{const i=e.canvas;null!=i&&i.description!==n&&t.DControllers.getCommandController().push(new l(e,i,n))}}}),i=()=>{const t=e.canvas;null!=t&&(n.value=t.description)};return i(),e.on("change",i),e.on("set",(t=>{n.value=t.description})),n}getType(){return"EEditorCanvasLegacy"}}var Ko={__proto__:null,ECommandChartAxisXPadding:wn,ECommandChartAxisYPadding:mn,ECommandChartTickXMajorCount:Tn,ECommandChartTickXMinorCount:En,ECommandChartTickYMajorCount:yn,ECommandChartTickYMinorCount:vn,ECommandComposition:n,ECommandDocumentAll:i,ECommandDocumentBackground:o,ECommandDocumentCategory:a,ECommandDocumentCreate:s,ECommandDocumentDescription:l,ECommandDocumentHeight:r,ECommandDocumentLabel:h,ECommandDocumentName:u,ECommandDocumentOpen:c,ECommandDocumentSnapBringForward:p,ECommandDocumentSnapCreate:d,ECommandDocumentSnapDelete:g,ECommandDocumentSnapGridSize:_,ECommandDocumentSnapGridToggle:w,ECommandDocumentSnapGridToggleVisibility:S,ECommandDocumentSnapReplace:m,ECommandDocumentSnapSendBackward:T,ECommandDocumentSnapTargetToggle:y,ECommandDocumentSnapTargetToggleVisibility:E,ECommandDocumentSnapToggle:v,ECommandDocumentSummary:C,ECommandDocumentWidth:b,ECommandLayerBringForward:D,ECommandLayerChange:A,ECommandLayerCreate:B,ECommandLayerDelete:x,ECommandLayerSendBackward:I,ECommandShapeActionValueAdd:R,ECommandShapeActionValueBringForward:O,ECommandShapeActionValueRemove:k,ECommandShapeActionValueReplace:P,ECommandShapeActionValueSendBackward:V,ECommandShapeButtonLayerValueAdd:Qe,ECommandShapeButtonLayerValueBringForward:tn,ECommandShapeButtonLayerValueMargin:en,ECommandShapeButtonLayerValueRemove:nn,ECommandShapeButtonLayerValueReplace:on,ECommandShapeButtonLayerValueSendBackward:an,ECommandShapeButtonPropertyIsActive:Ye,ECommandShapeButtonPropertyIsGrouped:Xe,ECommandShapeButtonPropertyIsToggle:We,ECommandShapeCreate:M,ECommandShapeDataMappingValueAdd:N,ECommandShapeDataMappingValueBringForward:F,ECommandShapeDataMappingValueRemove:z,ECommandShapeDataMappingValueReplace:H,ECommandShapeDataMappingValueSendBackward:G,ECommandShapeDataValueAdd:U,ECommandShapeDataValueBringForward:Y,ECommandShapeDataValueRemove:X,ECommandShapeDataValueReplace:W,ECommandShapeDataValueSendBackward:K,ECommandShapeDelete:j,ECommandShapeGroup:q,ECommandShapeProperty:Q,ECommandShapePropertyAll:tt,ECommandShapePropertyCapability:et,ECommandShapePropertyCapabilityLock:nt,ECommandShapePropertyCapabilityUnlock:it,ECommandShapePropertyCornerOff:ot,ECommandShapePropertyCornerOn:at,ECommandShapePropertyCursor:lt,ECommandShapePropertyFillColor:ut,ECommandShapePropertyFillEnable:ct,ECommandShapePropertyFocusable:pt,ECommandShapePropertyId:dt,ECommandShapePropertyImage:St,ECommandShapePropertyImageClear:gt,ECommandShapePropertyImageFitTo:_t,ECommandShapePropertyInteractive:wt,ECommandShapePropertyLineHeadColor:mt,ECommandShapePropertyLineHeadMargin:Tt,ECommandShapePropertyLineHeadSizeX:Et,ECommandShapePropertyLineHeadSizeY:yt,ECommandShapePropertyLineHeadType:vt,ECommandShapePropertyLineTailColor:Ct,ECommandShapePropertyLineTailMargin:bt,ECommandShapePropertyLineTailSizeX:Dt,ECommandShapePropertyLineTailSizeY:Lt,ECommandShapePropertyLineTailType:ft,ECommandShapePropertyPointsStyle:At,ECommandShapePropertyPosition:kt,ECommandShapePropertyPositionAndRotate:Bt,ECommandShapePropertyPositionLeft:xt,ECommandShapePropertyPositionTop:It,ECommandShapePropertyPositionX:Rt,ECommandShapePropertyPositionY:Ot,ECommandShapePropertyRadius:Pt,ECommandShapePropertyRecursive:rt,ECommandShapePropertyRecursiveSimple:ht,ECommandShapePropertyRotation:Vt,ECommandShapePropertyShortcut:Mt,ECommandShapePropertySizeX:Nt,ECommandShapePropertySizeY:Ft,ECommandShapePropertySkew:zt,ECommandShapePropertyStrokeAlign:Ht,ECommandShapePropertyStrokeColor:Gt,ECommandShapePropertyStrokeEnable:Ut,ECommandShapePropertyStrokeSideOff:Yt,ECommandShapePropertyStrokeSideOn:Xt,ECommandShapePropertyStrokeStyle:Wt,ECommandShapePropertyStrokeWidth:Kt,ECommandShapePropertyTextAlignHorizontal:$t,ECommandShapePropertyTextAlignVertical:Zt,ECommandShapePropertyTextClipping:jt,ECommandShapePropertyTextColor:qt,ECommandShapePropertyTextDirection:Jt,ECommandShapePropertyTextFamily:Qt,ECommandShapePropertyTextFitting:te,ECommandShapePropertyTextOffsetHorizontal:ee,ECommandShapePropertyTextOffsetVertical:ne,ECommandShapePropertyTextOutlineColor:ie,ECommandShapePropertyTextOutlineEnable:oe,ECommandShapePropertyTextOutlineWidth:ae,ECommandShapePropertyTextPaddingHorizontal:se,ECommandShapePropertyTextPaddingVertical:le,ECommandShapePropertyTextSize:he,ECommandShapePropertyTextSizeDelta:re,ECommandShapePropertyTextSpacingHorizontal:ue,ECommandShapePropertyTextSpacingVertical:ce,ECommandShapePropertyTextStyle:pe,ECommandShapePropertyTextValue:de,ECommandShapePropertyTextWeight:ge,ECommandShapePropertyTitle:_e,ECommandShapeReplace:we,ECommandShapeReplaceOne:Se,ECommandShapeSelect:me,ECommandShapeTableColumnValueAdd:zn,ECommandShapeTableColumnValueBringForward:Hn,ECommandShapeTableColumnValueRemove:Gn,ECommandShapeTableColumnValueReplace:Un,ECommandShapeTableColumnValueSendBackward:Yn,ECommandShapeTableRowHeight:Xn,ECommandShapeTableRowSelectionType:Wn,ECommandShapeTreeBringForward:Te,ECommandShapeTreeBringToFront:ye,ECommandShapeTreeSendBackward:ve,ECommandShapeTreeSendToBack:be,ECommandShapeUngroup:Le,EDialogAction:ci,EDialogActionExtension:Pe,EDialogActionExtensionContainer:Ve,EDialogDataMappingValue:pi,EDialogDataValue:di,EDialogLayer:gi,EDialogLayerValue:f,EDialogLayerValueBackground:L,EDialogProcessing:_i,EDialogShapeButtonLayerValue:sn,EDialogSnap:Ci,EDialogTableColumn:Kn,EEDITOR_BUTTON_COUNT:7,EEditorAction:bi,EEditorCanvas:Li,EEditorCoordinate:xi,EEditorData:Ri,EEditorDataMapping:Ii,EEditorLayer:ki,EEditorLayerItem:Oi,EEditorSearch:Fi,EEditorShape:zi,EEditorShapeButton:Ke,EEditorShapeButtonLayer:ln,EEditorShapeChartLine:bn,EEditorShapeTable:$n,EEditorSnap:Hi,EEditorText:Gi,EEditorTree:Xi,EEditorTreeSelection:Yi,EEditorValidation:Wi,EShapeActionExtensionInputType:ke,EShapeActionExtensions:Oe,EShapeButtonLayer:Je,EShapeButtonLayerButtonValue:Ze,EShapeButtonLayerButtonValueContainer:je,EShapeButtonLayerIds:qe,EShapeButtonLayers:rn,EShapeButtons:$e,EShapeChartAxes:Cn,EShapeChartAxis:gn,EShapeChartAxisX:pn,EShapeChartAxisY:dn,EShapeChartLine:Sn,EShapeChartLineActionRuntime:Dn,EShapeChartLineIds:_n,EShapeChartLineRuntime:Ln,EShapeChartLines:fn,EShapeChartTick:hn,EShapeChartTickMajor:un,EShapeChartTickMinor:cn,EShapeEmbeddedAcceptorEdges:Ue,EShapeExtensionFactories:ri,EShapeExtensions:Ne,EShapeInputs:An,EShapeTable:Fn,EShapeTableActionRuntime:Zn,EShapeTableBody:Jn,EShapeTableBodyRuntime:qn,EShapeTableCell:Bn,EShapeTableCellActionValueChangeColor:jn,EShapeTableColumn:kn,EShapeTableColumnValue:On,EShapeTableColumnValueBody:xn,EShapeTableColumnValueHeader:In,EShapeTableColumnValueRuntime:ni,EShapeTableColumnValueType:Rn,EShapeTableHeader:oi,EShapeTableHeaderRuntime:ii,EShapeTableIds:Pn,EShapeTableRow:Nn,EShapeTableRowSelection:Mn,EShapeTableRowSelectionType:Vn,EShapeTableRuntime:ai,EShapeTables:si,EToolGroupImpl:Ki,EToolImpl:$i,EToolSelect:Bo,EToolSelectArea:Zi,get EToolSelectMode(){return ji},EToolSelectModifier:Qi,EToolSelectModifierContainer:qi,EToolSelectModifierHitArea:Ji,EToolSelectSelection:Lo,EToolSelectSelectionUpdatedPart:J,EToolShapeAcceptorEdge:Ro,EToolShapeAcceptorEdgeRenderer:xo,EToolShapeCreate:Mo,EToolShapeCreateElbowConnector:Po,EToolShapeCreateLine:Vo,EToolShapeCreateLineConnector:ko,EToolShapeCreateLineConnectorPhase:Oo,EToolShapeEditLine:Ho,EToolShapeEditLineBase:Fo,EToolShapeEditLineConnector:zo,EToolShapeEditLineHitArea:No,FGraphicEditor:class{constructor(e){var n,i,o;this._options=e;const a=this.toTheme(e);this._theme=a,this._margin=null!==(n=e.margin)&&void 0!==n?n:a.getMargin();const s=e.piece;this._isPieceEnabled=null===(i=null==s?void 0:s.enable)||void 0===i||i,this._toPieceId=null!==(o=null==s?void 0:s.toId)&&void 0!==o?o:()=>null,this._isEditable=!1!==e.editable,this._icons=this.toIcons(a),this._validation=this.toValidation(e),this._search=this.toSearch(e),this._controller=e.controller,this._canvas=new Yo(e.canvas),this._application=new t.DApplication(e.application),this._editorButtonGroup=null,this.init()}get application(){return this._application}get controller(){return this._controller}toIcons(t){const e=t.getIconBuilder();Ne.merge(e),ri.merge(e);const n=e.build();return Ne.build(n),ri.build(n),n}toValidation(t){const e=t.validation;return null!=e?{validator:e.validator,force:!0===e.force}:{validator:void 0,force:!1}}toSearch(t){const e=t.search;return null!=e?{finder:e.finder}:{finder:void 0}}init(){this.initDiagram(),this.initHeader(),this.initTools(),this.initEditors(),this.initCopyAndPaste(),this.initShortcut()}initDiagram(){const e=this.diagram;this.getDiagramContainer().addChild(e),t.DControllers.setDocumentController(e)}initHeader(){const t=this.newHeader(this._options);t&&(this.getHeaderContainer().addChild(t),this._header=t)}initTools(){this.getToolButtonLayoutContainer().addChild(this.newToolButtonLayout()),this.toolShapeButtonSelect.activate(),this.toolShapeButtonGroup.disable()}initEditors(){this.getEditorLayoutContainer().addChild(this.newEditorLayout()),this.isEditorCanvasCompatible()||this.diagram.addChild(this.editorCanvas),this.editorButtonCoordinate.activate()}initCopyAndPaste(){(new t.UtilClipboard).on("copy",(t=>{const e=this.toolShapeSelect.selection.serialize();null!=e&&t.setData("text",e)})).on("cut",(t=>{const e=this.toolShapeSelect.selection.serialize();null!=e&&(t.setData("text",e),this.toolShapeSelect.selection.delete())})).on("paste",(t=>{const e=t.getData("text");this.toolShapeSelect.selection.deserialize(e)}))}initShortcut(){this.initShortcutShape(),this.initShortcutTree()}initShortcutShape(){const e=t.DThemes.get("EEditorShape"),n=e.getButtonGroupShortcut();null!=n&&t.UtilKeyboardEvent.on(this.diagram,n,(t=>{this.toolShapeSelect.selection.group()}));const i=e.getButtonUngroupShortcut();null!=i&&t.UtilKeyboardEvent.on(this.diagram,i,(t=>{this.toolShapeSelect.selection.ungroup()}))}initShortcutTree(){const e=t.DThemes.get("EEditorTree"),n=e.getButtonBringToFrontShortcut();null!=n&&t.UtilKeyboardEvent.on(this.diagram,n,(t=>{this.toolShapeSelect.selection.bringToFront()}));const i=e.getButtonBringForwardShortcut();null!=i&&t.UtilKeyboardEvent.on(this.diagram,i,(t=>{this.toolShapeSelect.selection.bringForward()}));const o=e.getButtonSendBackwardShortcut();null!=o&&t.UtilKeyboardEvent.on(this.diagram,o,(t=>{this.toolShapeSelect.selection.sendBackward()}));const a=e.getButtonSendToBackShortcut();null!=a&&t.UtilKeyboardEvent.on(this.diagram,a,(t=>{this.toolShapeSelect.selection.sendToBack()}))}newHeader(t){const e=t.header;if(null!=e){const t=e(this.newToolFileButtons());if(t){const e=this._margin;return t.x=e,t.y=e,t.setWidth((t=>t-2*e)),t}}return null}getHeaderContainer(){return this._application.stage}get toolFileButtonCreate(){var t;return null!==(t=this._toolFileButtonCreate)&&void 0!==t?t:this._toolFileButtonCreate=this.newToolFileButtonCreate()}newToolFileButtonCreate(){const e=this._theme;return new t.DButton({image:{source:this._icons.new},title:e.getToolFileButtonCreateTitle(),shortcut:e.getToolFileButtonCreateShortcut(),theme:e.getToolFileButtonTheme(),state:this._isEditable?void 0:t.DBaseState.DISABLED,on:{active:t=>{this.onToolFileButtonCreateActive(t)}}})}onToolFileButtonCreateActive(t){this.diagram.isChanged()?this.dialogDiscard.open(t).then((()=>{this.dialogCreate.then((e=>{e.reset().open(t)}))})):this.dialogCreate.then((e=>{e.reset().open(t)}))}get toolFileButtonOpen(){var t;return null!==(t=this._toolFileButtonOpen)&&void 0!==t?t:this._toolFileButtonOpen=this.newToolFileButtonOpen()}newToolFileButtonOpen(){const e=this._theme;return new t.DButton({image:{source:this._icons.open},title:e.getToolFileButtonOpenTitle(),shortcut:e.getToolFileButtonOpenShortcut(),theme:e.getToolFileButtonTheme(),on:{active:t=>{this.onToolFileButtonOpenActive(t)}}})}onToolFileButtonOpenActive(t){this.diagram.isChanged()?this.dialogDiscard.open(t).then((()=>{this.dialogSelect.then((e=>{e.open(t)}))})):this.dialogSelect.then((e=>{e.open(t)}))}get toolFileButtonSave(){var t;return null!==(t=this._toolFileButtonSave)&&void 0!==t?t:this._toolFileButtonSave=this.newToolFileButtonSave()}newToolFileButtonSave(){const e=this._theme,n=new t.DButton({image:{source:this._icons.save},title:e.getToolFileButtonSaveTitle(),shortcut:e.getToolFileButtonSaveShortcut(),theme:e.getToolFileButtonTheme(),state:t.DBaseState.DISABLED,on:{active:()=>{this.onToolFileButtonSaveActive()}}});if(this._isEditable){const t=this.diagram;t.on("change",(()=>{n.state.isDisabled=!t.isChanged()}))}return n}onToolFileButtonSaveActive(){this.validate().then((()=>{t.DControllers.getCommandController().push(new t.DCommandSave)}))}validate(){const e=this._validation,n=e.validator;if(null!=n&&e.force){const e=this.diagram.canvas;if(e)try{const i=n(e);if(null!=i){const e=this.dialogSaveProcessing;if(e.open(this.toolFileButtonSave),t.isArray(i)){if(0<i.length){this.editorValidation.list.data.clearAndAddAll(i);const t=this.editorButtonValidation;return t.state.isActive||t.activate(),e.reject("validation"),Promise.reject()}return Promise.resolve()}return i.then((t=>{if(0<t.length){this.editorValidation.list.data.clearAndAddAll(t);const n=this.editorButtonValidation;return n.state.isActive||n.activate(),e.reject("validation"),Promise.reject()}return Promise.resolve()}),(()=>(e.reject("validation-fail"),Promise.reject())))}}catch(t){const e=this.dialogSaveProcessing;return e.open(this.toolFileButtonSave),e.reject("validation-fail"),Promise.reject()}}return Promise.resolve()}get toolFileButtonSaveAs(){var t;return null!==(t=this._toolFileButtonSaveAs)&&void 0!==t?t:this._toolFileButtonSaveAs=this.newToolFileButtonSaveAs()}newToolFileButtonSaveAs(){const e=this._theme,n=new t.DButton({image:{source:this._icons.save_as},title:e.getToolFileButtonSaveAsTitle(),shortcut:e.getToolFileButtonSaveAsShortcut(),theme:e.getToolFileButtonTheme(),state:t.DBaseState.DISABLED,on:{active:()=>{this.onToolFileButtonSaveAsActive()}}});if(this._isEditable){const t=this.diagram;t.on("set",(()=>{n.state.isDisabled=!1})),t.on("unset",(()=>{n.state.isDisabled=!0}))}return n}onToolFileButtonSaveAsActive(){this.validate().then((()=>{this.dialogSaveAs.open(this.toolFileButtonSaveAs)}))}get toolFileButtonUpload(){var t;return null!==(t=this._toolFileButtonUpload)&&void 0!==t?t:this._toolFileButtonUpload=this.newToolFileButtonUpload()}newToolFileButtonUpload(){const e=this._theme,n=new t.DButtonFile({image:{source:this._icons.upload},title:e.getToolFileButtonUploadTitle(),shortcut:e.getToolFileButtonUploadShortcut(),theme:e.getToolFileButtonTheme(),as:t.DButtonFileAs.TEXT,checker:()=>!this.diagram.isChanged()||this.dialogDiscard.open(n),on:{open:t=>{this.onToolFileButtonUploadOpen(t)}}});return n}onToolFileButtonUploadOpen(e){const n=t.DDiagrams.parse(e);null!=n&&(n.id=void 0,this.diagram.set(n))}get toolFileButtonDownload(){var t;return null!==(t=this._toolFileButtonDownload)&&void 0!==t?t:this._toolFileButtonDownload=this.newToolFileButtonDownload()}newToolFileButtonDownload(){const e=this._theme,n=new t.DButton({image:{source:this._icons.download},title:e.getToolFileButtonDownloadTitle(),shortcut:e.getToolFileButtonDownloadShortcut(),theme:e.getToolFileButtonTheme(),state:t.DBaseState.DISABLED,on:{active:()=>{this.onToolFileButtonDownloadActive()}}}),i=this.diagram;return i.on("set",(()=>{n.state.isDisabled=!1})),i.on("unset",(()=>{n.state.isDisabled=!0})),n}onToolFileButtonDownloadActive(){const e=this.diagram.serialize();null!=e&&t.UtilFileDownloader.download(`${e.name}.json`,JSON.stringify(e))}get toolFileButtonUndo(){var t;return null!==(t=this._toolFileButtonUndo)&&void 0!==t?t:this._toolFileButtonUndo=this.newToolFileButtonUndo()}newToolFileButtonUndo(){const e=this._theme;return new t.DButtonUndo({title:e.getToolFileButtonUndoTitle(),shortcut:e.getToolFileButtonUndoShortcut(),theme:e.getToolFileButtonTheme(),image:{source:this._icons.undo}})}get toolFileButtonRedo(){var t;return null!==(t=this._toolFileButtonRedo)&&void 0!==t?t:this._toolFileButtonRedo=this.newToolFileButtonRedo()}newToolFileButtonRedo(){const e=this._theme;return new t.DButtonRedo({title:e.getToolFileButtonRedoTitle(),shortcut:e.getToolFileButtonRedoShortcut(),theme:e.getToolFileButtonTheme(),image:{source:this._icons.redo}})}get toolFileButtonDelete(){var t;return null!==(t=this._toolFileButtonDelete)&&void 0!==t?t:this._toolFileButtonDelete=this.newToolFileButtonDelete()}newToolFileButtonDelete(){const e=this._theme,n=new t.DButton({image:{source:this._icons.delete},title:e.getToolFileButtonDeleteTitle(),shortcut:e.getToolFileButtonDeleteShortcut(),theme:e.getToolFileButtonTheme(),state:t.DBaseState.DISABLED,on:{active:t=>{this.onToolFileButtonDelete(t)}}});if(this._isEditable){const t=this.diagram;t.on("set",(()=>{n.state.isDisabled=!1})),t.on("unset",(()=>{n.state.isDisabled=!0}))}return n}onToolFileButtonDelete(t){this.dialogDelete.open(t)}get toolShapeButtonGroup(){var t;return null!==(t=this._toolShapeButtonGroup)&&void 0!==t?t:this._toolShapeButtonGroup=this.newToolShapeButtonGroup()}newToolShapeButtonGroup(){const e=new t.DButtonGroup,n=this.diagram;return n.on("set",(()=>{e.enable()})),n.on("unset",(()=>{e.disable()})),e}get toolShapeButtonSelect(){var t;return null!==(t=this._toolShapeButtonSelect)&&void 0!==t?t:this._toolShapeButtonSelect=this.newToolShapeButtonSelect()}newToolShapeButtonSelect(){const e=this._theme;return new t.DButton({group:this.toolShapeButtonGroup,toggle:!0,title:e.getToolShapeButtonSelectTitle(),theme:e.getToolShapeButtonTheme(),image:{source:this._icons.select},on:{active:()=>{this.onToolShapeButtonSelectActive()},inactive:()=>{this.onToolShapeButtonSelectInactive()}}})}onToolShapeButtonSelectActive(){this.toolGroup.activate(this.toolShapeSelect)}onToolShapeButtonSelectInactive(){this.toolGroup.deactivate(this.toolShapeSelect)}newToolShapeButtonCreate(e,n,i){return new t.DButton({group:this.toolShapeButtonGroup,toggle:!0,title:e,theme:this._theme.getToolShapeButtonTheme(),image:{source:this._icons[n]},on:{active:()=>{this.onToolShapeButtonCreateActive(i)},inactive:()=>{this.onToolShapeButtonCreateInactive()}}})}onToolShapeButtonCreateActive(t){const e=this.toolShapeCreate;e.shape=()=>new t,this.toolGroup.activate(e,t)}onToolShapeButtonCreateInactive(){this.toolGroup.deactivate(this.toolShapeCreate)}get toolShapeButtonCircle(){var t;return null!==(t=this._toolShapeButtonCircle)&&void 0!==t?t:this._toolShapeButtonCircle=this.newToolShapeButtonCircle()}newToolShapeButtonCircle(){const e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonCircleTitle(),"shape_circle",t.EShapeCircle)}get toolShapeButtonSemicircle(){var t;return null!==(t=this._toolShapeButtonSemicircle)&&void 0!==t?t:this._toolShapeButtonSemicircle=this.newToolShapeButtonSemicircle()}newToolShapeButtonSemicircle(){const e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonSemicircleTitle(),"shape_semicircle",t.EShapeSemicircle)}get toolShapeButtonRectangle(){var t;return null!==(t=this._toolShapeButtonRectangle)&&void 0!==t?t:this._toolShapeButtonRectangle=this.newToolShapeButtonRectangle()}newToolShapeButtonRectangle(){const e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonRectangleTitle(),"shape_rectangle",t.EShapeRectangle)}get toolShapeButtonRectangleRounded(){var t;return null!==(t=this._toolShapeButtonRectangleRounded)&&void 0!==t?t:this._toolShapeButtonRectangleRounded=this.newToolShapeButtonRectangleRounded()}newToolShapeButtonRectangleRounded(){const e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonRectangleRoundedTitle(),"shape_rectangle_rounded",t.EShapeRectangleRounded)}get toolShapeButtonTriangle(){var t;return null!==(t=this._toolShapeButtonTriangle)&&void 0!==t?t:this._toolShapeButtonTriangle=this.newToolShapeButtonTriangle()}newToolShapeButtonTriangle(){const e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonTriangleTitle(),"shape_triangle",t.EShapeTriangle)}get toolShapeButtonTriangleRounded(){var t;return null!==(t=this._toolShapeButtonTriangleRounded)&&void 0!==t?t:this._toolShapeButtonTriangleRounded=this.newToolShapeButtonTriangleRounded()}newToolShapeButtonTriangleRounded(){const e=this._theme;return this.newToolShapeButtonCreate(e.getToolShapeButtonTriangleRoundedTitle(),"shape_triangle_rounded",t.EShapeTriangleRounded)}get toolShapeButtonLine(){var t;return null!==(t=this._toolShapeButtonLine)&&void 0!==t?t:this._toolShapeButtonLine=this.newToolShapeButtonLine()}newToolShapeButtonLine(){const e=this._theme,n=new t.DButton({group:this.toolShapeButtonGroup,toggle:!0,title:e.getToolShapeButtonLineTitle(),theme:e.getToolShapeButtonTheme(),image:{source:this._icons.shape_line},on:{active:()=>{this.onToolShapeButtonLineActive()},inactive:()=>{this.onToolShapeButtonLineInactive()}}});return this.toolShapeSelect.on("edit",(e=>{if(e instanceof t.EShapeLine){const t=this.toolShapeEditLine;t.shape=e,this.toolGroup.activate(t)}})),n}onToolShapeButtonLineActive(){this.toolGroup.activate(this.toolShapeCreateLine)}onToolShapeButtonLineInactive(){this.toolGroup.deactivate(this.toolShapeCreateLine)}get toolShapeButtonLineConnector(){var t;return null!==(t=this._toolShapeButtonLineConnector)&&void 0!==t?t:this._toolShapeButtonLineConnector=this.newToolShapeButtonLineConnector()}newToolShapeButtonLineConnector(){const e=this._theme,n=new t.DButton({group:this.toolShapeButtonGroup,toggle:!0,title:e.getToolShapeButtonLineConnectorTitle(),theme:e.getToolShapeButtonTheme(),image:{source:this._icons.shape_line_connector},on:{active:()=>{this.onToolShapeButtonLineConnectorActive()},inactive:()=>{this.onToolShapeButtonLineConnectorInactive()}}});return this.toolShapeSelect.on("edit",(e=>{if(e instanceof t.EShapeConnectorLine){const t=this.toolShapeEditLineConnector;t.shape=e,this.toolGroup.activate(t)}})),n}onToolShapeButtonLineConnectorActive(){this.toolGroup.activate(this.toolShapeCreateLineConnector)}onToolShapeButtonLineConnectorInactive(){this.toolGroup.deactivate(this.toolShapeCreateLineConnector)}get toolShapeButtonElbowConnector(){var t;return null!==(t=this._toolShapeButtonElbowConnector)&&void 0!==t?t:this._toolShapeButtonElbowConnector=this.newToolShapeButtonElbowConnector()}newToolShapeButtonElbowConnector(){const e=this._theme,n=new t.DButton({group:this.toolShapeButtonGroup,toggle:!0,title:e.getToolShapeButtonElbowConnectorTitle(),theme:e.getToolShapeButtonTheme(),image:{source:this._icons.shape_elbow_connector},on:{active:()=>{this.onToolShapeButtonElbowConnectorActive()},inactive:()=>{this.onToolShapeButtonElbowConnectorInactive()}}});return this.toolShapeSelect.on("edit",(e=>{if(e instanceof t.EShapeConnectorLine){const t=this.toolShapeEditLineConnector;t.shape=e,this.toolGroup.activate(t)}})),n}onToolShapeButtonElbowConnectorActive(){this.toolGroup.activate(this.toolShapeCreateElbowConnector)}onToolShapeButtonElbowConnectorInactive(){this.toolGroup.deactivate(this.toolShapeCreateElbowConnector)}get toolShapeButtonImage(){var t;return null!==(t=this._toolShapeButtonImage)&&void 0!==t?t:this._toolShapeButtonImage=this.newToolShapeButtonImage()}newToolShapeButtonImage(){const e=this._theme;return new t.DButtonFile({group:this.toolShapeButtonGroup,title:e.getToolShapeButtonImageTitle(),theme:e.getToolShapeButtonTheme(),as:t.DButtonFileAs.DATA_URL,image:{source:this._icons.editor_image},on:{open:t=>{this.onToolShapeButtonImageOpen(t)}}})}onToolShapeButtonImageOpen(e){const n=this.diagram,i=n.layer,o=n.canvas;null!=o&&null!=i&&t.createImage(e).then((e=>{e.transform.position.set(.5*o.width,.5*o.height),e.attach(i),t.DControllers.getCommandController().push(new M([e],i,this.toolShapeSelect.selection,!0))}))}get toolShapeButtonGraphicPiece(){var t;return null!==(t=this._toolShapeButtonGraphicPiece)&&void 0!==t?t:this._toolShapeButtonGraphicPiece=this.newToolShapeButtonGraphicPiece()}newToolShapeButtonGraphicPiece(){const e=this._theme;return new t.DButton({group:this.toolShapeButtonGroup,title:e.getToolShapeButtonGraphicPieceTitle(),theme:e.getToolShapeButtonTheme(),image:{source:this._icons.graphic_piece},on:{active:t=>{this.onToolShapeButtonGraphicPieceActive(t)}}})}onToolShapeButtonGraphicPieceActive(t){this.dialogSelectPiece.then((e=>{e.open(t)}))}newToolShapeButtonExtensionFactory(e){let n=null;return new t.DButton({group:this.toolShapeButtonGroup,title:this.toExtensionTitle(e),theme:this._theme.getToolShapeButtonTheme(),image:{source:e.icon.texture},on:{active:t=>{(null!=n?n:n=this.newDialogSelectExtensionFactory(e)).open(t)}}})}newToolShapeButtonExtension(e){let n=null;const i=new t.DButton({group:this.toolShapeButtonGroup,title:this.toExtensionTitle(e),theme:this._theme.getToolShapeButtonTheme(),toggle:!0,image:{source:e.icon.texture},on:{active:()=>{null==n&&(n=this.toExtensionCreatorOrTool(e)),this.onToolShapeButtonExtensionActive(n)},inactive:()=>{null==n&&(n=this.toExtensionCreatorOrTool(e)),this.onToolShapeButtonExtensionInactive(n)}}});if("type"in e){const t=e.updater;if(null!=t){const n=e.type;let i=null;this.toolShapeSelect.on("edit",(e=>{e.type===n&&(null==i&&(i=this.toExtensionUpdater(t)),i.shape=e,this.toolGroup.activate(i))}))}}return i}toExtensionUpdater(e){const n=(t.isFunction(e)?e:e.tool)(this.toolShapeSelect.selection,this.diagram);return n.on("done",(()=>{this.toolGroup.activate(this.toolShapeSelect)})),n.on("cancel",(()=>{this.toolGroup.activate(this.toolShapeSelect)})),n}toExtensionCreatorOrTool(e){const n=e.creator;if(t.isFunction(n))return n;{const t=n.tool(this.toolShapeSelect.selection,this.diagram);return t.on("done",(()=>{this.toolShapeButtonSelect.activate()})),t.on("cancel",(()=>{this.toolShapeButtonSelect.activate()})),t}}onToolShapeButtonExtensionActive(e){const n=this.toolGroup;if(t.isFunction(e)){const t=this.toolShapeCreate;t.shape=e,n.activate(t,e)}else n.activate(e)}onToolShapeButtonExtensionInactive(e){const n=this.toolGroup;t.isFunction(e)?n.deactivate(this.toolShapeCreate,e):n.deactivate(e)}toExtensionTitle(e){const n=e.title;return t.isString(n)?n:n.create}newDialogSelectExtensionFactory(e){return new t.DDialogSelect({controller:e,list:{data:{toLabel:e.item.toLabel}},on:{select:t=>{this.onDialogSelectExtensionFactorySelect(t,e)}}})}onDialogSelectExtensionFactorySelect(e,n){const i=this.diagram,o=i.layer,a=i.canvas;a&&o&&n.item.toCreator(e).then((e=>{const n=e();n.transform.position.set(.5*a.width,.5*a.height),n.attach(o),t.DControllers.getCommandController().push(new M([n],o,this.toolShapeSelect.selection,!0))}))}newToolFileButtons(){return[this.toolFileButtonCreate,this.toolFileButtonOpen,this.toolFileButtonSave,this.toolFileButtonSaveAs,this.toolFileButtonUpload,this.toolFileButtonDownload,this.toolFileButtonUndo,this.toolFileButtonRedo,this.toolFileButtonDelete]}newToolShapeButtons(){const t=[this.toolShapeButtonSelect,this.toolShapeButtonLine,this.toolShapeButtonCircle,this.toolShapeButtonSemicircle,this.toolShapeButtonRectangle,this.toolShapeButtonRectangleRounded,this.toolShapeButtonTriangle,this.toolShapeButtonTriangleRounded,this.toolShapeButtonLineConnector,this.toolShapeButtonElbowConnector,this.toolShapeButtonImage];return this._isPieceEnabled&&t.push(this.toolShapeButtonGraphicPiece),t}newToolShapeButtonsExtension(){const t=[];return Ne.each((e=>{"icon"in e&&t.push(this.newToolShapeButtonExtension(e))})),ri.each((e=>{t.push(this.newToolShapeButtonExtensionFactory(e))})),t}getToolButtonLayoutContainer(){return this._application.stage}newToolButtonLayout(){const e=this._margin;return new t.DLayoutVertical({x:e,y:this.getToolButtonLayoutY(e),theme:"EButtonToolLayout",children:this.newToolButtons()})}getToolButtonLayoutY(t){const e=this._header;return null!=e?t+e.height+t:t}newToolButtons(){const e=this._toolFileButtonCreate;return null==e||null==e.parent?this.newToolFileButtons().concat(new t.DLayoutSpace({height:10})).concat(this.newToolShapeButtons()).concat(this.newToolShapeButtonsExtension()):this.newToolShapeButtons().concat(this.newToolShapeButtonsExtension())}get editorButtonGroup(){var t;return null!==(t=this._editorButtonGroup)&&void 0!==t?t:this._editorButtonGroup=this.newEditorButtonGroup()}newEditorButtonGroup(){}get editorButtonCoordinate(){var t;return null!==(t=this._editorButtonCoordinate)&&void 0!==t?t:this._editorButtonCoordinate=this.newEditorButtonCoordinate()}newEditorButtonCoordinate(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_coordinate},title:e.getEditorButtonCoordinateTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorCoordinate.show()},inactive:()=>{this.editorCoordinate.hide()}}})}get editorCoordinate(){var t;return null!==(t=this._editorCoordinate)&&void 0!==t?t:this._editorCoordinate=this.newEditorCoordinate()}newEditorCoordinate(){return this.initEditor(0,new xi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons}))}initEditor(e,n){return n.zIndex=e,n.parent.sortChildren(),n.interactive=!0,n instanceof t.DBase&&(n.state.isFocusable=!1),n}get editorButtonShape(){var t;return null!==(t=this._editorButtonShape)&&void 0!==t?t:this._editorButtonShape=this.newEditorButtonShape()}newEditorButtonShape(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_shape},title:e.getEditorButtonShapeTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorShape.show()},inactive:()=>{this.editorShape.hide()}}})}get editorShape(){var t;return null!==(t=this._editorShape)&&void 0!==t?t:this._editorShape=this.newEditorShape()}newEditorShape(){return this.initEditor(1,new zi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,canvas:this._canvas,content:{theme:"EEditorPaneContent"},piece:{enable:this._isPieceEnabled,controller:this._options.controller,exclude:()=>this._toPieceId(this.diagram)},connector:{dangling:this.isDanglingConnectorAllowed()}}))}get editorButtonText(){var t;return null!==(t=this._editorButtonText)&&void 0!==t?t:this._editorButtonText=this.newEditorButtonText()}newEditorButtonText(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_text},title:e.getEditorButtonTextTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorText.show()},inactive:()=>{this.editorText.hide()}}})}get editorText(){var t;return null!==(t=this._editorText)&&void 0!==t?t:this._editorText=this.newEditorText()}newEditorText(){return this.initEditor(2,new Gi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,content:{theme:"EEditorPaneContent"}}))}get editorButtonData(){var t;return null!==(t=this._editorButtonData)&&void 0!==t?t:this._editorButtonData=this.newEditorButtonData()}newEditorButtonData(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_data},title:e.getEditorButtonDataTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorData.show()},inactive:()=>{this.editorData.hide()}}})}get editorData(){var t;return null!==(t=this._editorData)&&void 0!==t?t:this._editorData=this.newEditorData()}newEditorData(){return this.initEditor(3,new Ri({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons}))}get editorButtonDataMapping(){var t;return null!==(t=this._editorButtonDataMapping)&&void 0!==t?t:this._editorButtonDataMapping=this.newEditorButtonDataMapping()}newEditorButtonDataMapping(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_data_mapping},title:e.getEditorButtonDataMappingTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorDataMapping.show()},inactive:()=>{this.editorDataMapping.hide()}}})}get editorDataMapping(){var t;return null!==(t=this._editorDataMapping)&&void 0!==t?t:this._editorDataMapping=this.newEditorDataMapping()}newEditorDataMapping(){return this.initEditor(4,new Ii({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons}))}get editorButtonAction(){var t;return null!==(t=this._editorButtonAction)&&void 0!==t?t:this._editorButtonAction=this.newEditorButtonAction()}newEditorButtonAction(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_action},title:e.getEditorButtonActionTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorAction.show()},inactive:()=>{this.editorAction.hide()}}})}get editorAction(){var t;return null!==(t=this._editorAction)&&void 0!==t?t:this._editorAction=this.newEditorAction()}newEditorAction(){return this.initEditor(5,new bi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram}))}get editorButtonTree(){var t;return null!==(t=this._editorButtonTree)&&void 0!==t?t:this._editorButtonTree=this.newEditorButtonTree()}newEditorButtonTree(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_tree},title:e.getEditorButtonTreeTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorTree.show()},inactive:()=>{this.editorTree.hide()}}})}get editorTree(){var t;return null!==(t=this._editorTree)&&void 0!==t?t:this._editorTree=this.newEditorTree()}newEditorTree(){return this.initEditor(6,new Xi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram}))}get editorButtonLayer(){var t;return null!==(t=this._editorButtonLayer)&&void 0!==t?t:this._editorButtonLayer=this.newEditorButtonLayer()}newEditorButtonLayer(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_layer},title:e.getEditorButtonLayerTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorLayer.show()},inactive:()=>{this.editorLayer.hide()}}})}get editorLayer(){var t;return null!==(t=this._editorLayer)&&void 0!==t?t:this._editorLayer=this.newEditorLayer()}newEditorLayer(){return this.initEditor(7,new ki({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram}))}get editorButtonSnap(){var t;return null!==(t=this._editorButtonSnap)&&void 0!==t?t:this._editorButtonSnap=this.newEditorButtonSnap()}newEditorButtonSnap(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_snap},title:e.getEditorButtonSnapTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorSnap.show()},inactive:()=>{this.editorSnap.hide()}}})}get editorSnap(){var t;return null!==(t=this._editorSnap)&&void 0!==t?t:this._editorSnap=this.newEditorSnap()}newEditorSnap(){return this.initEditor(8,new Hi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram}))}get editorButtonValidation(){var t;return null!==(t=this._editorButtonValidation)&&void 0!==t?t:this._editorButtonValidation=this.newEditorButtonValidation()}newEditorButtonValidation(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_validation},title:e.getEditorButtonValidationTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorValidation.show()},inactive:()=>{this.editorValidation.hide()}}})}get editorValidation(){var t;return null!==(t=this._editorValidation)&&void 0!==t?t:this._editorValidation=this.newEditorValidation()}newEditorValidation(){return this.initEditor(9,new Wi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram,validator:this._validation.validator}))}get editorButtonSearch(){var t;return null!==(t=this._editorButtonSearch)&&void 0!==t?t:this._editorButtonSearch=this.newEditorButtonSearch()}newEditorButtonSearch(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_search},title:e.getEditorButtonSearchTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorSearch.show()},inactive:()=>{this.editorSearch.hide()}}})}get editorSearch(){var t;return null!==(t=this._editorSearch)&&void 0!==t?t:this._editorSearch=this.newEditorSearch()}newEditorSearch(){return this.initEditor(9,new Fi({parent:this.editorContainer,selection:this.toolShapeSelect.selection,icons:this._icons,diagram:this.diagram,finder:this._search.finder,interval:this._search.interval}))}get editorCanvas(){var t;return null!==(t=this._editorCanvas)&&void 0!==t?t:this._editorCanvas=this.newEditorCanvas()}newEditorCanvas(){return new Li({icons:this._icons,diagram:this.diagram,canvas:this._canvas})}isEditorCanvasCompatible(){var t,e;return!!(null===(e=null===(t=this._options.compatibility)||void 0===t?void 0:t.editor)||void 0===e?void 0:e.canvas)}get editorButtonCanvasLegacy(){var t;return null!==(t=this._editorButtonCanvasLegacy)&&void 0!==t?t:this._editorButtonCanvasLegacy=this.newEditorButtonCanvasLegacy()}newEditorButtonCanvasLegacy(){const e=this._theme;return new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:this._icons.editor_canvas_legacy},title:e.getEditorButtonCanvasLegacyTitle(),theme:e.getEditorButtonTheme(),on:{active:()=>{this.editorCanvasLegacy.show()},inactive:()=>{this.editorCanvasLegacy.hide()}}})}get editorCanvasLegacy(){var t;return null!==(t=this._editorCanvasLegacy)&&void 0!==t?t:this._editorCanvasLegacy=this.newEditorCanvasLegacy()}newEditorCanvasLegacy(){return this.initEditor(10,new Wo({parent:this.editorContainer,diagram:this.diagram,canvas:this._canvas,content:{theme:"EEditorPaneContent"}}))}newEditorButtonExtension(e,n){let i=null;const o=new t.DButton({group:this.editorButtonGroup,toggle:!0,image:{source:e.icon.texture},title:n.title,theme:this._theme.getEditorButtonTheme(),visible:!1,on:{active:()=>{null!=i||(i=this.newEditorExtension(n)),i.show()},inactive:()=>{i&&i.hide()}}});return this.toolShapeSelect.selection.on("change",(()=>{this.onEditorButtonExtensionSelectionChange(o,e.type)})),o}newEditorExtension(t){return this.initEditor(11,new t.constructor({parent:this.editorContainer,selection:this.toolShapeSelect.selection,diagram:this.diagram,icons:this._icons,content:{theme:"EEditorPaneContent"},theme:t.theme}))}onEditorButtonExtensionSelectionChange(t,e){const n=this.toolShapeSelect.selection.last(),i=this._editorButtonExtensionLast;if(null!=n&&n.type===e&&i!==t){let e=!1;null!=i&&(i.hide(),i.state.isActive&&(i.activate(),e=!0)),t.show(),this._editorButtonExtensionLast=t,e&&!t.state.isActive&&t.activate()}}get viewButtonZoomOut(){var t;return null!==(t=this._viewButtonZoomOut)&&void 0!==t?t:this._viewButtonZoomOut=this.newViewButtonZoomOut()}newViewButtonZoomOut(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_out},title:e.getViewButtonZoomOutTitle(),shortcut:e.getViewButtonZoomOutShortcut(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.zoomOut()}}})}get viewButtonZoomIn(){var t;return null!==(t=this._viewButtonZoomIn)&&void 0!==t?t:this._viewButtonZoomIn=this.newViewButtonZoomIn()}newViewButtonZoomIn(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_in},title:e.getViewButtonZoomInTitle(),shortcut:e.getViewButtonZoomInShortcut(),shortcuts:e.getViewButtonZoomInShortcuts(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.zoomIn()}}})}get viewButtonDragAndPinch(){var t;return null!==(t=this._viewButtonDragAndPinch)&&void 0!==t?t:this._viewButtonDragAndPinch=this.newViewButtonDragAndPinch()}newViewButtonDragAndPinch(){const e=this._theme;return new t.DButton({image:{source:this._icons.camera},toggle:!0,title:e.getViewButtonDragAndPinchTitle(),shortcut:e.getViewButtonDragAndPinchShortcut(),theme:e.getViewButtonTheme(),on:{active:()=>{this.toolGroup.suspend()},inactive:()=>{this.toolGroup.resume()}}})}get viewButtonReset(){var t;return null!==(t=this._viewButtonReset)&&void 0!==t?t:this._viewButtonReset=this.newViewButtonReset()}newViewButtonReset(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_reset},title:e.getViewButtonResetTitle(),shortcut:e.getViewButtonResetShortcut(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.reset()}}})}get viewButtonFit(){var t;return null!==(t=this._viewButtonFit)&&void 0!==t?t:this._viewButtonFit=this.newViewButtonFit()}newViewButtonFit(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_fit},title:e.getViewButtonFitTitle(),shortcut:e.getViewButtonFitShortcut(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.fit()}}})}newEditorButtons(){const e=[this.editorButtonCoordinate,this.editorButtonShape,this.editorButtonText,this.editorButtonData,this.editorButtonDataMapping,this.editorButtonAction,this.editorButtonTree,this.editorButtonLayer,this.editorButtonSnap];return null!=this._validation.validator&&e.push(this.editorButtonValidation),e.push(this.editorButtonSearch),this.isEditorCanvasCompatible()&&e.push(this.editorButtonCanvasLegacy),Ne.each((t=>{if("editor"in t){const n=this.toEditorExtentionConstructorOptions(t);n&&e.push(this.newEditorButtonExtension(t,n))}})),e.push(new t.DLayoutSpace({weight:1}),this.viewButtonZoomOut,this.viewButtonZoomIn,this.viewButtonDragAndPinch,this.viewButtonReset,this.viewButtonFit),e}toEditorExtentionConstructorOptions(e){var n,i;const o=e.editor;return t.isFunction(o)?{constructor:o,title:e.name||"",theme:"EEditorPane"}:o.constructor?{constructor:o.constructor,title:null!==(n=o.title)&&void 0!==n?n:e.name||"",theme:null!==(i=o.theme)&&void 0!==i?i:"EEditorPane"}:void 0}get editorContainer(){var t;return null!==(t=this._editorContainer)&&void 0!==t?t:this._editorContainer=this.newEditorContainer()}newEditorContainer(){return new t.DLayoutHorizontal({width:"auto",height:"padding"})}getEditorLayoutContainer(){return this._application.stage}newEditorLayout(){const e=this._margin,n=this.getToolButtonLayoutY(e);return new t.DLayoutHorizontal({x:(t,n)=>t-n-e,y:n,width:"auto",height:t=>t-n-e,theme:"EEditorLayout",children:[this.editorContainer,this.newEditorButtonLayout()],on:{resize:(t,e)=>{this.onEditorLayoutResized(t,e)}}})}newEditorButtonLayout(){return new t.DLayoutVertical({theme:"EEditorButtonLayout",children:this.newEditorButtons()})}onEditorLayoutResized(t,e){const n=this.diagram,i=n.theme,o=n.padding,a=this._margin,s=o.getLeft()-o.getRight();o.left=i.getPaddingLeft()+a+65,o.right=i.getPaddingRight()+a+t;const l=n.canvas;if(null!=l){const t=o.getLeft()-o.getRight();l.position.x+=.5*(t-s)}}get toolShapeSelect(){var t;return null!==(t=this._toolShapeSelect)&&void 0!==t?t:this._toolShapeSelect=this.newToolShapeSelect()}newToolShapeSelect(){const t=this.diagram,e=new Bo({diagram:t});return t.on("set",(()=>{e.selection.clear()})),t.on("unset",(()=>{e.selection.clear()})),e}get toolShapeCreate(){var t;return null!==(t=this._toolShapeCreate)&&void 0!==t?t:this._toolShapeCreate=this.newToolShapeCreate()}newToolShapeCreate(){const t=new Mo(this.toolShapeSelect.selection,this.diagram);return t.on("done",(()=>{this.toolShapeButtonSelect.activate()})),t}get toolShapeCreateLine(){var t;return null!==(t=this._toolShapeCreateLine)&&void 0!==t?t:this._toolShapeCreateLine=this.newToolShapeCreateLine()}newToolShapeCreateLine(){const t=new Vo({selection:this.toolShapeSelect.selection,diagram:this.diagram});return t.on("done",(()=>{this.toolShapeButtonSelect.activate()})),t.on("cancel",(()=>{this.toolShapeButtonSelect.activate()})),t}get toolShapeCreateLineConnector(){var t;return null!==(t=this._toolShapeCreateLineConnector)&&void 0!==t?t:this._toolShapeCreateLineConnector=this.newToolShapeCreateLineConnector()}newToolShapeCreateLineConnector(){const t=new ko({selection:this.toolShapeSelect.selection,diagram:this.diagram,dangling:this.isDanglingConnectorAllowed()});return t.on("done",(()=>{this.toolShapeButtonSelect.activate()})),t.on("cancel",(()=>{this.toolShapeButtonSelect.activate()})),t}get toolShapeCreateElbowConnector(){var t;return null!==(t=this._toolShapeCreateElbowConnector)&&void 0!==t?t:this._toolShapeCreateElbowConnector=this.newToolShapeCreateElbowConnector()}newToolShapeCreateElbowConnector(){const t=new Po({selection:this.toolShapeSelect.selection,diagram:this.diagram,dangling:this.isDanglingConnectorAllowed()});return t.on("done",(()=>{this.toolShapeButtonSelect.activate()})),t.on("cancel",(()=>{this.toolShapeButtonSelect.activate()})),t}isDanglingConnectorAllowed(){var t;return null===(t=this._options.connector)||void 0===t?void 0:t.dangling}get toolShapeEditLine(){var t;return null!==(t=this._toolShapeEditLine)&&void 0!==t?t:this._toolShapeEditLine=this.newToolShapeEditLine()}newToolShapeEditLine(){const t=new Ho({selection:this.toolShapeSelect.selection,diagram:this.diagram});return t.on("done",(()=>{this.toolGroup.activate(this.toolShapeSelect)})),t.on("cancel",(()=>{this.toolGroup.activate(this.toolShapeSelect)})),t}get toolShapeEditLineConnector(){var t;return null!==(t=this._toolShapeEditLineConnector)&&void 0!==t?t:this._toolShapeEditLineConnector=this.newToolShapeEditLineConnector()}newToolShapeEditLineConnector(){const t=new zo({selection:this.toolShapeSelect.selection,diagram:this.diagram,dangling:this.isDanglingConnectorAllowed()});return t.on("done",(()=>{this.toolGroup.activate(this.toolShapeSelect)})),t.on("cancel",(()=>{this.toolGroup.activate(this.toolShapeSelect)})),t}get toolGroup(){var t;return null!==(t=this._toolGroup)&&void 0!==t?t:this._toolGroup=this.newToolGroup()}newToolGroup(){return new Ki}get diagram(){var t;return null!==(t=this._diagram)&&void 0!==t?t:this._diagram=this.newDiagram()}newDiagram(){return new t.DDiagramEditor(this.toDiagramOptions(this._options))}getDiagramContainer(){return this._application.stage}toDiagramOptions(e){var n,i,o,a,s,l,r,h,u,c,p,d,g,_,S,w,m,T,E,y,v,C,b,D,L,f,A,B,x,I,R;const O=e.diagram||{};null!==(n=O.controller)&&void 0!==n||(O.controller=this._controller.graphic),null!==(i=O.x)&&void 0!==i||(O.x=0),null!==(o=O.y)&&void 0!==o||(O.y=0),null!==(a=O.width)&&void 0!==a||(O.width="100%"),null!==(s=O.height)&&void 0!==s||(O.height="100%");const k=null!==(l=O.outline)&&void 0!==l?l:O.outline={};null!==(r=k.color)&&void 0!==r||(k.color=null);const P=null!==(h=O.view)&&void 0!==h?h:O.view={},V=null!==(u=P.gesture)&&void 0!==u?u:P.gesture={};null!==(c=V.modifier)&&void 0!==c||(V.modifier=t.UtilGestureModifier.ALT);const M=null!==(p=V.checker)&&void 0!==p?p:V.checker={};null!==(d=M.start)&&void 0!==d||(M.start=(e,n)=>t.UtilGestureModifiers.match(e,n)||this.toolGroup.isSuspended()),null!==(g=M.move)&&void 0!==g||(M.move=(e,n)=>t.UtilGestureModifiers.match(e,n)||this.diagram.state.isGesturing);const N=null!==(_=P.zoom)&&void 0!==_?_:P.zoom={},F=null!==(S=N.dblclick)&&void 0!==S?S:N.dblclick={};null!==(w=F.checker)&&void 0!==w||(F.checker=(t,e)=>this.toolGroup.isSuspended());const z=null!==(m=P.on)&&void 0!==m?m:P.on={};null!==(T=z.gesturestart)&&void 0!==T||(z.gesturestart=()=>{this.onDiagramViewOnStart()}),null!==(E=z.transformstart)&&void 0!==E||(z.transformstart=()=>{this.onDiagramViewOnStart()}),null!==(y=z.wheeltranslationstart)&&void 0!==y||(z.wheeltranslationstart=()=>{this.onDiagramViewOnStart()}),null!==(v=P.constraint)&&void 0!==v||(P.constraint=(t,e,n,i,o)=>{this.onDiagramViewConstraint(t,e,n,i,o)});const H=O.thumbnail;(null==H?void 0:H.enable)&&(null!==(C=H.size)&&void 0!==C||(H.size=2*wi()));const G=null!==(b=O.on)&&void 0!==b?b:O.on={};null!==(D=G.saving)&&void 0!==D||(G.saving=()=>{this.onDiagramSaving(this._toolFileButtonSave)}),null!==(L=G.saved)&&void 0!==L||(G.saved=t=>{this.onDiagramSaved(t,this._toolFileButtonSave)}),null!==(f=G.deleting)&&void 0!==f||(G.deleting=()=>{this.onDiagramDeleting(this._toolFileButtonDelete)}),null!==(A=G.deleted)&&void 0!==A||(G.deleted=t=>{this.onDiagramDeleted(t,this._toolFileButtonDelete)});const U=null!==(B=O.snapshot)&&void 0!==B?B:O.snapshot={},Y=null!==(x=U.on)&&void 0!==x?x:U.on={};return null!==(I=Y.taking)&&void 0!==I||(Y.taking=()=>{this.onDiagramSnapshotTaking()}),null!==(R=Y.took)&&void 0!==R||(Y.took=()=>{this.onDiagramSnapshotTook()}),O}onDiagramViewOnStart(){var t,n;const i=this._diagram;if(null!=i){const o=null!==(t=this._localBoundsDiagram)&&void 0!==t?t:this._localBoundsDiagram=new e.Rectangle,a=i.padding,s=a.getLeft()-65-this._margin,l=a.getTop(),r=i.width-a.getRight(),h=i.height-a.getBottom();o.x=s,o.y=l,o.width=Math.max(0,r-s),o.height=Math.max(0,h-l);const u=i.canvas;if(null!=u){const t=null!==(n=this._localBoundsCanvas)&&void 0!==n?n:this._localBoundsCanvas=new e.Rectangle;u.getLocalBounds(t)}}}onDiagramViewConstraint(t,e,n,i,o){const a=this._localBoundsDiagram,s=this._localBoundsCanvas;null!=a&&null!=s&&(t.position.set(Math.max(a.x-(s.x+s.width)*i,Math.min(a.x+a.width-s.x*i,e)),Math.max(a.y-(s.y+s.height)*o,Math.min(a.y+a.height-s.y*o,n))),t.scale.set(i,o))}onDiagramSaving(t){this.dialogSaveProcessing.open(t)}onDiagramSaved(t,e){const n=this.dialogSaveProcessing;null==t?n.resolve():("duplication"===t&&n.once("close",(()=>{this.dialogSaveAs.open(e)})),n.reject(t))}onDiagramDeleting(t){this.dialogDeleteProcessing.open(t)}onDiagramDeleted(t,e){const n=this.dialogDeleteProcessing;null==t?n.resolve():n.reject(t)}onDiagramSnapshotTaking(){this.toolShapeSelect.selection.modifier.renderable=!1}onDiagramSnapshotTook(){this.toolShapeSelect.selection.modifier.renderable=!0}get dialogSaveProcessing(){var t;return null!==(t=this._dialogSaveProcessing)&&void 0!==t?t:this._dialogSaveProcessing=this.newDialogSaveProcessing()}newDialogSaveProcessing(){return new _i}get dialogDeleteProcessing(){var t;return null!==(t=this._dialogDeleteProcessing)&&void 0!==t?t:this._dialogDeleteProcessing=this.newDialogDeleteProcessing()}newDialogDeleteProcessing(){return new _i}get dialogSaveAs(){var t;return null!==(t=this._dialogSaveAs)&&void 0!==t?t:this._dialogSaveAs=this.newDialogSaveAs()}newDialogSaveAs(){return new t.DDialogSaveAs}get dialogCreate(){var t;return null!==(t=this._dialogCreate)&&void 0!==t?t:this._dialogCreate=this.newDialogCreate()}newDialogCreate(){return this._canvas.get().then((t=>new Di({canvas:t,on:{ok:(t,e)=>{this.onDialogCreateOk(t,e)}}})))}onDialogCreateOk(e,n){this.diagram.create(e).then((e=>{t.DControllers.getCommandController().push(new s(this.diagram,e))}))}get dialogDiscard(){var t;return null!==(t=this._dialogDiscard)&&void 0!==t?t:this._dialogDiscard=this.newDialogDiscard()}newDialogDiscard(){return new t.DDialogConfirmDiscard}get dialogSelect(){var t;return null!==(t=this._dialogSelect)&&void 0!==t?t:this._dialogSelect=this.newDialogSelect()}newDialogSelect(){return this._canvas.get().then((t=>{var e,n;if(null===(n=null===(e=this._options.diagram)||void 0===e?void 0:e.thumbnail)||void 0===n?void 0:n.enable){const e=this.newDialogSelectImage();return e.categories=t.category.items,e}{const e=this.newDialogSelectNoImage();return e.categories=t.category.items,e}}))}newDialogSelectNoImage(){return new t.DDialogSelect({controller:this._controller.graphic,on:{select:t=>{this.onDialogSelectSelect(t)}}})}onDialogSelectSelect(e){this.diagram.open(e.id).then((e=>{t.DControllers.getCommandController().push(new c(this.diagram,e))}))}newDialogSelectImage(){return vi(this._options.controller.graphic,this._controller.toThumbnail,(t=>{this.onDialogSelectSelect(t)}))}get dialogSelectPiece(){var t;return null!==(t=this._dialogSelectPiece)&&void 0!==t?t:this._dialogSelectPiece=this.newDialogSelectPiece()}newDialogSelectPiece(){return this._canvas.get().then((t=>{var e,n;if(null===(n=null===(e=this._options.diagram)||void 0===e?void 0:e.thumbnail)||void 0===n?void 0:n.enable){const e=this.newDialogSelectPieceImage();return e.categories=t.category.items,e}{const e=this.newDialogSelectPieceNoImage();return e.categories=t.category.items,e}}))}newDialogSelectPieceNoImage(){return new t.DDialogSelect({controller:this.newDialogSelectPieceController(),on:{select:t=>{this.onDialogSelectPieceSelect(t)}}})}newDialogSelectPieceImage(){return vi(this.newDialogSelectPieceController(),this._options.controller.toPieceThumbnail,(t=>{this.onDialogSelectPieceSelect(t)}))}newDialogSelectPieceController(){const t=this._options.controller.graphic.piece;return{search:(e,n)=>void 0===n?t.search(e).then((t=>this.toDialogSelectPieceResult(t))):t.search(e,n).then((t=>this.toDialogSelectPieceResult(t)))}}toDialogSelectPieceResult(t){const e=this._toPieceId(this.diagram);if(null==e)return t;const n=[];for(let i=0,o=t.length;i<o;++i){const o=t[i];o.id!==e&&n.push(o)}return n}onDialogSelectPieceSelect(e){const n=this.diagram,i=n.layer,o=n.canvas;if(o&&i){const n=this._options.controller.graphic;n.piece.get(e.id).then((e=>{t.EShapeEmbeddeds.from(e,n,t.EShapeResourceManagerDeserializationMode.EDITOR).then((e=>{e.transform.position.set(.5*o.width,.5*o.height),e.attach(i),t.DControllers.getCommandController().push(new M([e],i,this.toolShapeSelect.selection,!0))}))}))}}get dialogDelete(){var t;return null!==(t=this._dialogDelete)&&void 0!==t?t:this._dialogDelete=this.newDialogDelete()}newDialogDelete(){return new t.DDialogConfirmDelete({on:{ok:(t,e)=>{this.onDialogDeleteOk(e)}}})}onDialogDeleteOk(e){this.diagram.delete().then((()=>{t.DControllers.getCommandController().clear()}))}toTheme(e){const n=null==e?void 0:e.theme;return n?t.isString(n)?t.DThemes.getInstance().get(n):n:this.getThemeDefault()}getThemeDefault(){return t.DThemes.getInstance().get(this.getType())}getType(){return"FGraphicEditor"}},FGraphicTester:class{constructor(n){var i,o;this._options=n;const a=this.toTheme(n);this._theme=a,this._controller=n.controller,this._category=new Uo(null===(i=n.canvas)||void 0===i?void 0:i.category),this._icons=a.getIconBuilder().build();const s=null!==(o=n.margin)&&void 0!==o?o:a.getMargin();this._margin=s,this._isEditable=!1!==n.editable,this._isChanged=!1,this._onDiagramMoveBound=t=>{this.onDiagramMove(t)},this._onDiagramUpBound=t=>{this.onDiagramUp(t)},this._onDiagramDownPoint=new e.Point,this._onDiagramMovePoint=new e.Point,this._selectAreaRect=new e.Rectangle,this._selectMode=0,this._childSelectTime=0,this._childSelectChild=null,this._isSelectSuspended=!1,this._expressionMap=new Map,this._appliedValues=new Map,this._isMappingsDirty=!1;const l=new t.DApplication(n.application);this._application=l,l.stage.addChild(this.newPanes(n)),this.onChange();const r=()=>{this._isMappingsDirty&&(this._isMappingsDirty=!1,this.onMappingsChange()),setTimeout(r,100)};r()}get application(){return this._application}get controller(){return this._controller}newHeader(t){const e=t.header;if(e){const t=e();if(t){const e=this._margin;return t.x=e,t.y=e,t.setWidth((t=>t)),t}}return null}newPanes(e){const n=this._margin;return new t.DLayoutVertical({x:n,y:n,width:t=>t-2*n,height:t=>t-2*n,margin:n,children:[this.newHeader(e),new t.DLayoutHorizontal({weight:1,width:"padding",margin:.5*this._margin,children:[this.leftPane,this.rightPane]})]})}get leftPane(){let t=this._paneLeft;return null==t&&(t=this.newLeftPane(),this._paneLeft=t),t}newLeftPane(){return new t.DBoard({weight:1,height:"padding",shadow:"WEAK",children:[this.diagram,this.toolFileButtonGraphicOpen,this.layoutViewButton]})}get toolFileButtonGraphicOpen(){let t=this._toolFileButtonGraphicOpen;return null==t&&(t=this.newToolFileButtonGraphicOpen(),this._toolFileButtonGraphicOpen=t),t}newToolFileButtonGraphicOpen(){const e=this._theme,n=.5*this._margin;return new t.DButton({x:n,y:n,image:{source:this._icons.open},title:e.getToolFileButtonGraphicOpenTitle(),shortcut:e.getToolFileButtonGraphicOpenShortcut(),theme:e.getToolFileButtonGraphicTheme(),on:{active:t=>{this.onToolFileButtonGraphicOpenActive(t)}}})}onToolFileButtonGraphicOpenActive(t){this.isChanged?this.dialogDiscard.open(t).then((()=>{this.dialogSelectGraphic.then((e=>{e.open(t)}))})):this.dialogSelectGraphic.then((e=>{e.open(t)}))}get layoutViewButton(){let t=this._layoutViewButton;return null==t&&(t=this.newLayoutViewButton(),this._layoutViewButton=t),t}newLayoutViewButton(){const e=.5*this._margin,n=(t,n)=>t-n-e;return new t.DLayoutHorizontal({x:n,y:n,width:"auto",height:"auto",margin:0,padding:0,children:this.newViewButtons()})}newViewButtons(){return[this.viewButtonZoomOut,this.viewButtonZoomIn,this.viewButtonDragAndPinch,this.viewButtonReset,this.viewButtonFit]}get viewButtonZoomOut(){let t=this._viewButtonZoomOut;return null==t&&(t=this.newViewButtonZoomOut(),this._viewButtonZoomOut=t),t}newViewButtonZoomOut(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_out},title:e.getViewButtonZoomOutTitle(),shortcut:e.getViewButtonZoomOutShortcut(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.zoomOut()}}})}get viewButtonZoomIn(){let t=this._viewButtonZoomIn;return null==t&&(t=this.newViewButtonZoomIn(),this._viewButtonZoomIn=t),t}newViewButtonZoomIn(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_in},title:e.getViewButtonZoomInTitle(),shortcut:e.getViewButtonZoomInShortcut(),shortcuts:e.getViewButtonZoomInShortcuts(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.zoomIn()}}})}get viewButtonReset(){let t=this._viewButtonReset;return null==t&&(t=this.newViewButtonReset(),this._viewButtonReset=t),t}newViewButtonReset(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_reset},title:e.getViewButtonResetTitle(),shortcut:e.getViewButtonResetShortcut(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.reset()}}})}get viewButtonDragAndPinch(){let t=this._viewButtonDragAndPinch;return null==t&&(t=this.newViewButtonDragAndPinch(),this._viewButtonDragAndPinch=t),t}newViewButtonDragAndPinch(){const e=this._theme;return new t.DButton({image:{source:this._icons.camera},toggle:!0,title:e.getViewButtonDragAndPinchTitle(),shortcut:e.getViewButtonDragAndPinchShortcut(),theme:e.getViewButtonTheme(),on:{active:()=>{this._isSelectSuspended=!0},inactive:()=>{this._isSelectSuspended=!1}}})}get viewButtonFit(){let t=this._viewButtonFit;return null==t&&(t=this.newViewButtonFit(),this._viewButtonFit=t),t}newViewButtonFit(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_fit},title:e.getViewButtonFitTitle(),shortcut:e.getViewButtonFitShortcut(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.fit()}}})}get rightPane(){let t=this._paneRight;return null==t&&(t=this.newRightPane(),this._paneRight=t),t}newRightPane(){return new t.DLayoutVertical({width:400,height:"padding",margin:.5*this._margin,children:[new t.DLayoutHorizontal({width:"padding",height:"auto",children:[new t.DLayoutSpace({weight:1}),this.toolFileButtonCreate,this.toolFileButtonOpen,this.toolFileButtonSave,this.toolFileButtonDelete]}),this.inputName,new t.DLayoutHorizontal({width:"padding",height:"auto",children:[this.tableFilterInput,this.toolFileButtonUpload,this.toolFileButtonDownload]}),this.table]})}get dialogProcessing(){let t=this._dialogProcessing;return null==t&&(t=this.newDialogProcessing(),this._dialogProcessing=t),t}newDialogProcessing(){return new _i}get dialogDelete(){let t=this._dialogConfirmDelete;return null==t&&(t=this.newDialogDelete(),this._dialogConfirmDelete=t),t}newDialogDelete(){return new t.DDialogConfirmDelete({on:{ok:()=>{const t=this._tester;t&&(null!=t.id&&this._controller.graphicTester.delete(t.id),this.tester=void 0)}}})}get tableFilterInput(){let t=this._tableFilterInput;return null==t&&(t=this.newTableFilterInput(),this._tableFilterInput=t),t}newTableFilterInput(){return new t.DInputSearch({weight:1,on:{input:t=>{const e=t.trim();this.tableFilter.word=e;const n=this.table.data.filter;0<e.length?n.apply():n.unapply()}}})}get toolFileButtonCreate(){let t=this._toolFileButtonCreate;return null==t&&(t=this.newToolFileButtonCreate(),this._toolFileButtonCreate=t),t}newToolFileButtonCreate(){const e=this._theme;return new t.DButton({image:{source:this.icons.new},title:e.getToolFileButtonCreateTitle(),shortcut:e.getToolFileButtonCreateShortcut(),theme:e.getToolFileButtonTheme(),on:{active:t=>{this.onToolFileButtonCreateActive(t)}}})}onToolFileButtonCreateActive(t){this.isChanged?this.dialogDiscard.open(t).then((()=>{this.dialogCreate.open(t)})):this.dialogCreate.open(t)}get toolFileButtonOpen(){let t=this._toolFileButtonOpen;return null==t&&(t=this.newToolFileButtonOpen(),this._toolFileButtonOpen=t),t}newToolFileButtonOpen(){const e=this._theme;return new t.DButton({image:{source:this.icons.open},title:e.getToolFileButtonOpenTitle(),shortcut:e.getToolFileButtonOpenShortcut(),theme:e.getToolFileButtonTheme(),on:{active:t=>{this.onToolFileButtonOpenActive(t)}}})}onToolFileButtonOpenActive(t){this.isChanged?this.dialogDiscard.open(t).then((()=>{this.dialogSelectMapping.open(t)})):this.dialogSelectMapping.open(t)}get toolFileButtonUpload(){let t=this._toolFileButtonUpload;return null==t&&(t=this.newToolFileButtonUpload(),this._toolFileButtonUpload=t),t}newToolFileButtonUpload(){const e=this._theme;return new t.DButtonFile({image:{source:this.icons.upload},title:e.getToolFileButtonUploadTitle(),shortcut:e.getToolFileButtonUploadShortcut(),theme:e.getToolFileButtonTheme(),as:t.DButtonFileAs.TEXT,on:{open:(t,e)=>{this.onToolFileButtonUploadOpen(t,e)}}})}onToolFileButtonUploadOpen(t,e){const n=this._tester;n&&(n.mappings=xe(t),this.onDiagramSelectionChange(),this.toDirty(),this.toMappingsDirty())}get toolFileButtonDownload(){let t=this._toolFileButtonDownload;return null==t&&(t=this.newToolFileButtonDownload(),this._toolFileButtonDownload=t),t}newToolFileButtonDownload(){const e=this._theme;return new t.DButton({image:{source:this.icons.download},title:e.getToolFileButtonDownloadTitle(),shortcut:e.getToolFileButtonDownloadShortcut(),theme:e.getToolFileButtonTheme(),on:{active:()=>{this.onToolFileButtonDownloadActive()}}})}onToolFileButtonDownloadActive(){const e=this._graphic,n=this._tester;if(e&&n){const e=this.diagram.canvas;if(e){const i=e.layer.children,o=new Map,a=[];for(let t=0,e=i.length;t<e;++t)this.toCsvRows(i[t].children,n.mappings,null,o,a);a.sort(((t,e)=>t[0]-e[0])),t.UtilFileDownloader.download(this.getFilename(),Be.stringify(a))}}}toCsvRows(t,e,n,i,o){for(let a=0,s=t.length;a<s;++a){const s=t[a],l=(n||s).uuid,r=e.get(l),h=s.data;let u=i.get(l);null==u&&(u=new Set,i.set(l,u));for(let t=0,e=h.size();t<e;++t){const e=h.get(t);if(e){const t=e.id;if(!u.has(t)){u.add(t);const e=r&&r[t]||"";o.push([l,t,e])}}}this.toCsvRows(s.children,e,this.toDataShape(n,s),i,o)}return o}get toolFileButtonSave(){let t=this._toolFileButtonSave;return null==t&&(t=this.newToolFileButtonSave(),this._toolFileButtonSave=t),t}newToolFileButtonSave(){const e=this._theme;return new t.DButton({image:{source:this.icons.save},title:e.getToolFileButtonSaveTitle(),shortcut:e.getToolFileButtonSaveShortcut(),theme:e.getToolFileButtonTheme(),on:{active:t=>{this.onToolFileButtonSaveActive(t)}}})}onToolFileButtonSaveActive(t){const e=this._graphic,n=this._tester;if(e&&n){n.name=this.inputName.input.value;const e=Re(n),i=this.dialogProcessing;i.open(t),this._controller.graphicTester.save(e).then((t=>{e.id=t,this.tester=Ie(e),i.resolve()}),(t=>{i.reject(t)}))}}get toolFileButtonDelete(){let t=this._toolFileButtonDelete;return null==t&&(t=this.newToolFileButtonDelete(),this._toolFileButtonDelete=t),t}newToolFileButtonDelete(){const e=this._theme;return new t.DButton({image:{source:this.icons.delete},title:e.getToolFileButtonDeleteTitle(),shortcut:e.getToolFileButtonDeleteShortcut(),theme:e.getToolFileButtonTheme(),on:{active:t=>{this.onToolFileButtonDeleteActive(t)}}})}onToolFileButtonDeleteActive(t){this.dialogDelete.open(t)}get inputName(){let t=this._inputName;return null==t&&(t=this.newInputName(),this._inputName=t),t}newInputName(){return new t.DInputTextAndLabel({width:"100%",label:{text:{value:this._theme.getInputNameLabel()}},input:{weight:1,on:{change:()=>{this.toDirty()}}}})}get icons(){return this._icons}get diagram(){let t=this._diagram;return null==t&&(t=this.newDiagram(),this._diagram=t),t}newDiagram(){const e=new t.DDiagram(this.toDiagramOptions(this._options));return e.on("down",((t,e)=>{this.onDiagramDown(t,e)})),e.on("keydown",(t=>{this.onDiagramKeydown(t)})),e}toDiagramOptions(e){var n,i,o,a,s,l,r,h,u,c,p,d,g,_;const S=e.diagram||{};null!==(n=S.controller)&&void 0!==n||(S.controller=this._controller.graphic),null!==(i=S.width)&&void 0!==i||(S.width="100%"),null!==(o=S.height)&&void 0!==o||(S.height="100%"),null!==(a=S.mask)&&void 0!==a||(S.mask=!0),null!==(s=S.ambient)&&void 0!==s||(S.ambient=!0);const w=null!==(l=S.view)&&void 0!==l?l:S.view={},m=null!==(r=w.gesture)&&void 0!==r?r:w.gesture={};null!==(h=m.modifier)&&void 0!==h||(m.modifier=t.UtilGestureModifier.ALT);const T=null!==(u=m.checker)&&void 0!==u?u:m.checker={};null!==(c=T.start)&&void 0!==c||(T.start=(e,n)=>t.UtilGestureModifiers.match(e,n)||this._isSelectSuspended),null!==(p=T.move)&&void 0!==p||(T.move=(e,n)=>{const i=this._diagram;return t.UtilGestureModifiers.match(e,n)||!(!i||!i.state.isGesturing)});const E=null!==(d=w.zoom)&&void 0!==d?d:w.zoom={},y=null!==(g=E.dblclick)&&void 0!==g?g:E.dblclick={};return null!==(_=y.checker)&&void 0!==_||(y.checker=(t,e)=>this._isSelectSuspended),S}get selection(){let t=this._selection;return null==t&&(t=new Lo({diagram:this.diagram,modifier:{editable:!1}}),t.on("change",(()=>{this.onDiagramSelectionChange()})),this._selection=t),t}toDataMappingRows(t,e,n,i,o){for(let a=0,s=t.length;a<s;++a){const s=t[a],l=(n||s).uuid,r=e.get(l),h=s.data;for(let t=0,e=h.size();t<e;++t){const e=h.get(t);if(null!=e){const t=e.id,n=r&&r[t]||"";let a=i.get(t);null==a?(a={uuids:[l],id:t,value:n},i.set(t,a),o.push(a)):(a.uuids.push(l),a.value=n)}}this.toDataMappingRows(s.children,e,this.toDataShape(n,s),i,o)}return o}toDataShape(e,n){return e||(n instanceof t.EShapeEmbedded?n:null)}onDiagramSelectionChange(){const t=this._selection,e=this._tester,n=this.table;if(t&&e){const i=t.get();if(0<i.length){const t=[];this.toDataMappingRows(i,e.mappings,null,new Map,t),n.data.clearAndAddAll(t)}else n.data.clear()}else n.data.clear()}onDiagramDown(e,n){if(this._isSelectSuspended)return;const i=e.data.originalEvent;if(i.altKey)return;const o=n.canvas;if(o){const a=i.ctrlKey||i.shiftKey;if(1===this._selectMode)return this._selectMode=0,void this.onDiagramSelectEnd(o,a);const s=e.data.global,l=this._onDiagramDownPoint;l.copyFrom(s);const r=this.selection,h=this.hitTest(s,o);if(h instanceof t.EShapeBase){if(a)r.toggle(h);else if(!r.contains(h)){const e=r.first();if(null==e)r.set(h.root);else{const n=$.toSelected(h);if(null!=n)t.EShapeCapabilities.contains(n,t.EShapeCapability.CHILDREN)&&(this._childSelectTime=Date.now(),this._childSelectChild=$.toOfParent(h,n));else{const t=$.toSharedParent(e,h);r.set($.toOfParent(h,t))}}}this._selectMode=2}else{const e=this.selectArea;o.toLocal(s,void 0,l),e.x=l.x,e.y=l.y,e.size.set(0,0),e.update(),o.addChild(e),t.DApplications.update(n),this._selectMode=1}const u=this._interactionManager;if(u){this._interactionManager=null,u.off(t.UtilPointerEvent.move,this._onDiagramMoveBound);const e=this._onDiagramUpBound;u.off(t.UtilPointerEvent.up,e),u.off(t.UtilPointerEvent.upoutside,e),u.off(t.UtilPointerEvent.cancel,e)}const c=t.DApplications.getLayer(n);if(c){const e=c.renderer.plugins.interaction;this._interactionManager=e,e.on(t.UtilPointerEvent.move,this._onDiagramMoveBound);const n=this._onDiagramUpBound;e.on(t.UtilPointerEvent.up,n),e.on(t.UtilPointerEvent.upoutside,n),e.on(t.UtilPointerEvent.cancel,n)}}}get selectArea(){let t=this._selectArea;return null==t&&(t=new Zi,this._selectArea=t),t}onDiagramMove(e){if(e.data.originalEvent.altKey)return;const n=this.diagram,i=n.canvas,o=n.layer,a=this._selectMode;if(i&&o&&0!==a){const o=e.data.global,s=this._onDiagramDownPoint;if(1===a){const e=this.selectArea,a=i.toLocal(o,void 0,this._onDiagramMovePoint);e.x=Math.min(s.x,a.x),e.y=Math.min(s.y,a.y),e.size.set(Math.max(s.x,a.x)-e.x,Math.max(s.y,a.y)-e.y),e.update(),t.DApplications.update(n)}else{const t=o.x-s.x,e=o.y-s.y;(1<=Math.abs(t)||1<=Math.abs(e))&&(this._childSelectChild=null)}}}onDiagramUp(e){const n=this.diagram,i=n.canvas,o=n.layer,a=this._selectMode,s=this._interactionManager;if(s){this._interactionManager=null,s.off(t.UtilPointerEvent.move,this._onDiagramMoveBound);const e=this._onDiagramUpBound;s.off(t.UtilPointerEvent.up,e),s.off(t.UtilPointerEvent.upoutside,e),s.off(t.UtilPointerEvent.cancel,e)}if(i&&o&&0!==a)if(this._selectMode=0,1===a){const t=e.data.originalEvent,n=t.ctrlKey||t.shiftKey;this.onDiagramSelectEnd(i,n)}else{const e=this.selection,i=this._childSelectChild;null!=i&&(this._childSelectChild=null,Date.now()-this._childSelectTime<333&&e.set(i)),t.DApplications.update(n)}}onDiagramSelectEnd(e,n){const i=this.selectArea,o=this.selection;if(0<i.size.x&&0<i.size.y){const t=i.getBounds(!1,this._selectAreaRect),a=[],s=e.layer.children;for(let e=s.length-1;0<=e;--e)fo.findShapes(s[e],t,a);n?0<a.length&&o.addAll(a):(0<a.length||!o.isEmpty())&&o.clearAndAddAll(a)}else n||o.isEmpty()||o.clear();e.removeChild(i),t.DApplications.update(e)}hitTest(t,e){const n=e.layer.children;for(let e=n.length-1;0<=e;--e){const i=Ao.execute(t,n[e]);if(null!=i)return i}return null}onDiagramKeydown(e){if(t.UtilKeyboardEvent.isSelectAllKey(e)){const t=this.diagram.canvas;if(null!=t){const e=this.selection;e.clear();const n=t.layer.children;for(let t=0,i=n.length;t<i;++t){const i=n[t].children;0<i.length&&e.addAll(i)}}}}get table(){let t=this._table;return null==t&&(t=this.newTable(),this._table=t),t}newTable(){return new t.DTable({weight:1,width:"padding",columns:this.newColumnOptions(),data:{filter:this.tableFilter}})}get tableFilter(){let t=this._tableFilter;return null==t&&(t=this.newTableFilter(),this._tableFilter=t),t}newTableFilter(){return{word:"",test(t){const e=this.word;return e.length<=0||0<=t.id.indexOf(e)||0<=t.value[0].indexOf(e)||0<=t.value[1].indexOf(e)}}}get dialogSelectGraphic(){let t=this._dialogSelectGraphic;return null==t&&(t=this.newDialogSelectGraphic(),this._dialogSelectGraphic=t),t}newDialogSelectGraphic(){return this._category.get().then((t=>{if(null!=this._options.controller.toThumbnail){const e=this.newDialogSelectGraphicImage();return e.categories=t.items,e}{const e=this.newDialogSelectGraphicNoImage();return e.categories=t.items,e}}))}newDialogSelectGraphicNoImage(){return new t.DDialogSelect({controller:this._controller.graphic,on:{select:t=>{this.onDialogSelectGraphicSelect(t)}}})}newDialogSelectGraphicImage(){return vi(this._options.controller.graphic,this._controller.toThumbnail,(t=>{this.onDialogSelectGraphicSelect(t)}))}onDialogSelectGraphicSelect(e){this._controller.graphic.get(e.id).then((e=>{this.graphic=t.DDiagrams.toSerialized(e)}))}get graphic(){return this._graphic}set graphic(t){this._graphic=t;const e=this.diagram;null!=t?e.set(t):e.set(null),this._appliedValues.clear(),this.tester=void 0}get dialogSelectMapping(){let t=this._dialogSelectTester;return null==t&&(t=this.newDialogSelectMapping(),this._dialogSelectTester=t),t}newDialogSelectMapping(){const e=this._controller;return new t.DDialogSelect({controller:{search:t=>{const n=this._graphic;return n?e.graphicTester.search(n.name,t):Promise.resolve([])}},on:{select:t=>{e.graphicTester.get(t.id).then((t=>{this._graphic&&(this.tester=Ie(t))}))}}})}get dialogDiscard(){let e=this._dialogDiscard;return null==e&&(e=new t.DDialogConfirmDiscard,this._dialogDiscard=e),e}get dialogCreate(){let t=this._dialogCreate;return null==t&&(t=this.newDialogCreate(),this._dialogCreate=t),t}newDialogCreate(){const e=new t.DDialogInputText({on:{open:()=>{e.value=this._theme.newDialogCreateTextValue()},ok:t=>{const e=this._graphic;e&&(this.tester=fe(t,e))}}});return e}get tester(){return this._tester}set tester(t){this._isChanged=!1;const e=this.inputName.input;this._tester=t,e.value=t?t.name:"",this.onDiagramSelectionChange(),this.onChange(),this.toMappingsDirty()}get isNew(){const t=this._tester;return null!=t&&null==t.id}get isChanged(){return this._isChanged||this.isNew}onChange(){const t=null==this._graphic,e=null==this._tester,n=!this.isChanged,i=!this._isEditable;this.table.state.isDisabled=e,this.tableFilterInput.state.isDisabled=e,this.inputName.state.isDisabled=e||i,this.toolFileButtonCreate.state.isDisabled=t||i,this.toolFileButtonOpen.state.isDisabled=t,this.toolFileButtonUpload.state.isDisabled=e||i,this.toolFileButtonDownload.state.isDisabled=e,this.toolFileButtonSave.state.isDisabled=e||n||i,this.toolFileButtonDelete.state.isDisabled=e||i}evaluate(t){return Function(`try { return (${t}); } catch( e ) { return 0; }`)()}onMappingsChange(){const e=this._tester;if(e){const n=e.mappings,i=this.diagram,o=i.canvas;if(o){let e=!1;const a=o.layer.children;for(let t=0,i=a.length;t<i;++t)this.applyMappings(a[t].children,n,null)&&(e=!0);e&&t.DApplications.update(i)}}}applyMappings(t,e,n){let i=!1;for(let o=0,a=t.length;o<a;++o){const a=t[o],s=(n||a).uuid,l=e.get(s);if(l){const t=a.data;for(let e=0,n=t.size();e<n;++e){const n=t.get(e);null!=n&&this.applyMapping(n,l[n.id])&&(i=!0)}}this.applyMappings(a.children,e,this.toDataShape(n,a))&&(i=!0)}return i}applyMapping(t,e){if(null!=e){const n=this._expressionMap;if(n.has(e))return this.applyMappingIfChanged(t,n.get(e));if(0<e.length)try{const i=this.evaluate(e);return n.set(e,i),this.applyMappingIfChanged(t,i)}catch(t){}}return!1}applyMappingIfChanged(t,e){const n=this._appliedValues;return n.has(t)?n.get(t)!==e&&(n.set(t,e),t.value=e,!0):(n.set(t,e),t.value=e,!0)}toDirty(){this._isChanged||(this._isChanged=!0,this.onChange())}toMappingsDirty(){this._isMappingsDirty=!0}getFilename(){return`graphic-tester-${this.inputName.input.value.toLowerCase()}-${Xo.format(Date.now())}.csv`}newColumnOptions(){const t=this._isEditable,e=this._theme;return[{type:"TEXT",label:e.getTableColumnDataLabel(),editable:!1,sortable:!0,getter:t=>t.id,setter:(t,e,n)=>{t.id=n,this.toDirty()}},{type:"TEXT",label:e.getTableColumnValueLabel(),align:"LEFT",editable:t,sortable:!0,formatter:t=>t||"",getter:t=>t.value,setter:(t,e,n)=>{const i=this._tester;if(i){const e=t.uuids,o=i.mappings,a=t.id;if(0<n.length)for(let t=0,i=e.length;t<i;++t){const i=e[t];let s=o.get(i);null==s&&(s={},o.set(i,s)),s[a]=n}else for(let t=0,n=e.length;t<n;++t){const n=e[t],i=o.get(n);null!=i&&delete i[a]}}t.value=n,this.toDirty(),this.toMappingsDirty()}}]}toTheme(e){const n=null==e?void 0:e.theme;return n?t.isString(n)?t.DThemes.getInstance().get(n):n:this.getThemeDefault()}getThemeDefault(){return t.DThemes.getInstance().get(this.getType())}getType(){return"FGraphicTester"}},FGraphicViewer:class{constructor(e){var n,i;this._options=e;const o=this.toTheme(e);this._theme=o;const a=null!==(n=e.margin)&&void 0!==n?n:o.getMargin();this._margin=a;const s=o.getIconBuilder().build();this._icons=s,this._category=new Uo(null===(i=e.canvas)||void 0===i?void 0:i.category);const l=new t.DApplication(e.application);this._application=l;const r=l.stage,h=this.diagram;r.addChild(h);const u=this.header;null!=u&&r.addChild(u);const c=e.button;null!=c&&!1===c.view||r.addChild(this.layoutViewButton)}get application(){return this._application}get diagram(){let t=this._diagram;return null==t&&(t=this.newDiagram(),this._diagram=t),t}newDiagram(){const e=this._options.controller;return new t.DDiagram({x:0,y:0,width:"100%",height:"100%",outline:{color:null},controller:e.graphic,data:{mapper:this.newDataMapper(),remote:{controller:e.remote}}})}get header(){let t=this._header;return void 0===t&&(t=this.newHeader(),this._header=t),t}newHeader(){const t=this._options.header;if(null!=t){const e=t(this.newToolFileButtons());if(null!=e){const t=this._margin;return e.x=t,e.y=t,e.setWidth((e=>e-2*t)),e}}return null}newToolFileButtons(){const t=[],e=this._options.button;return null!=e&&!1===e.open||t.push(this.toolFileButtonGraphicOpen),t}get toolFileButtonGraphicOpen(){let t=this._toolFileButtonGraphicOpen;return null==t&&(t=this.newToolFileButtonGraphicOpen(),this._toolFileButtonGraphicOpen=t),t}newToolFileButtonGraphicOpen(){const e=this._theme;return new t.DButton({image:{source:this._icons.open},title:e.getToolFileButtonGraphicOpenTitle(),shortcut:e.getToolFileButtonGraphicOpenShortcut(),theme:e.getToolFileButtonGraphicTheme(),on:{active:t=>{this.onToolFileButtonGraphicOpenActive(t)}}})}onToolFileButtonGraphicOpenActive(t){this.dialogSelect.then((e=>{e.open(t)}))}get layoutViewButton(){let t=this._layoutViewButton;return null==t&&(t=this.newLayoutViewButton(),this._layoutViewButton=t),t}newLayoutViewButton(){const e=this._margin,n=(t,n)=>t-n-e;return new t.DLayoutHorizontal({x:n,y:n,width:"auto",height:"auto",margin:0,children:this.newViewButtons()})}newViewButtons(){return[this.viewButtonZoomOut,this.viewButtonZoomIn,this.viewButtonReset,this.viewButtonFit]}get viewButtonZoomOut(){let t=this._viewButtonZoomOut;return null==t&&(t=this.newViewButtonZoomOut(),this._viewButtonZoomOut=t),t}newViewButtonZoomOut(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_out},title:e.getViewButtonZoomOutTitle(),shortcut:e.getViewButtonZoomOutShortcut(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.zoomOut()}}})}get viewButtonZoomIn(){let t=this._viewButtonZoomIn;return null==t&&(t=this.newViewButtonZoomIn(),this._viewButtonZoomIn=t),t}newViewButtonZoomIn(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_zoom_in},title:e.getViewButtonZoomInTitle(),shortcut:e.getViewButtonZoomInShortcut(),shortcuts:e.getViewButtonZoomInShortcuts(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.zoomIn()}}})}get viewButtonReset(){let t=this._viewButtonReset;return null==t&&(t=this.newViewButtonReset(),this._viewButtonReset=t),t}newViewButtonReset(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_reset},title:e.getViewButtonResetTitle(),shortcut:e.getViewButtonResetShortcut(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.reset()}}})}get viewButtonFit(){let t=this._viewButtonFit;return null==t&&(t=this.newViewButtonFit(),this._viewButtonFit=t),t}newViewButtonFit(){const e=this._theme;return new t.DButton({image:{source:this._icons.view_fit},title:e.getViewButtonFitTitle(),shortcut:e.getViewButtonFitShortcut(),theme:e.getViewButtonTheme(),on:{active:()=>{this.diagram.view.fit()}}})}get dialogSelect(){let t=this._dialogSelect;return null==t&&(t=this.newDialogSelect(),this._dialogSelect=t),t}newDialogSelect(){return this._category.get().then((t=>{if(null!=this._options.controller.toThumbnail){const e=this.newDialogSelectImage();return e.categories=t.items,e}{const e=this.newDialogSelectNoImage();return e.categories=t.items,e}}))}newDialogSelectNoImage(){return new t.DDialogSelect({controller:this._options.controller.graphic,on:{select:t=>{this.onDialogSelectSelect(t)}}})}newDialogSelectImage(){const t=this._options.controller;return vi(t.graphic,t.toThumbnail,(t=>{this.onDialogSelectSelect(t)}))}onDialogSelectSelect(e){this._options.controller.graphic.get(e.id).then((e=>{this.diagram.set(t.DDiagrams.toSerialized(e))}))}newDataMapper(){}toTheme(e){const n=null==e?void 0:e.theme;return n?t.isString(n)?t.DThemes.getInstance().get(n):n:this.getThemeDefault()}getThemeDefault(){return t.DThemes.getInstance().get(this.getType())}getType(){return"FGraphicViewer"}},UtilAjax:Go,UtilCanvas:Yo,UtilCanvasCategory:Uo,UtilCsv:Be,UtilCsvState:Ae,UtilDataValues:class{constructor(t){this.parent=t,this.mappings={}}set(t){this.mappings=t;const e=this.parent,n=e.data;for(const e in t){const i=t[e];i&&n.set(e,i.value,i.time,i.state)}e.update()}retain(t){const e={},n=this.mappings;for(let i=0,o=t.length;i<o;++i){const o=t[i];o in n&&(e[o]=n[o])}this.set(e)}},UtilDate:Xo,UtilHitTest:Ao,UtilShapeAreaSelect:fo,UtilShapeConnectorTransformData:to,UtilShapeConnectorTransforms:eo,UtilShapeDeleter:Z,UtilShapeSearch:$,UtilShapeTransforms:De,getDialogSelectThumbnailNotFound:Ti,getDialogSelectThumbnailSize:wi,getShapeTypeTheme:Vi,loadShapeExtensionButton:()=>{$e.load()},loadShapeExtensionButtonLayer:()=>{rn.load()},loadShapeExtensionChartLine:()=>{fn.load()},loadShapeExtensionEmbeddedAcceptorEdge:()=>{Ue.load()},loadShapeExtensionInput:()=>{An.load()},loadShapeExtensionTable:()=>{si.load()},newDialogSelectWithThumbnails:vi,newDialogSelectWithThumbnailsOptions:yi,newDialogTHumbnailNotFound:Ei,newGraphicTester:fe,setDialogSelectThumbnailSize:t=>{Si=t},toGraphicTesterObject:xe,toGraphicTesterSerialized:Ie,toGraphicTesterSimple:Re,toShapeLabel:Mi,toShapeTypeLabel:Ni};const $o=window;$o.wcardinal=$o.wcardinal||{},$o.wcardinal.geditor=Ko}(wcardinal.ui,PIXI);
//# sourceMappingURL=wcardinal-geditor.min.js.map
